<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.62">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/imgs/favicon.ico"><title>pinia | 不愿飞的蜂鸟首页</title><meta name="description" content="Five的垃圾库">
    <link rel="preload" href="/home/assets/style-d11d67ee.css" as="style"><link rel="stylesheet" href="/home/assets/style-d11d67ee.css">
    <link rel="modulepreload" href="/home/assets/app-69b48761.js"><link rel="modulepreload" href="/home/assets/pinia.html-93944f84.js"><link rel="modulepreload" href="/home/assets/pinia.html-7ff381a1.js"><link rel="prefetch" href="/home/assets/index.html-36e1d9cd.js" as="script"><link rel="prefetch" href="/home/assets/index.html-88b7806c.js" as="script"><link rel="prefetch" href="/home/assets/index.html-c1c04fbe.js" as="script"><link rel="prefetch" href="/home/assets/index.html-5001069c.js" as="script"><link rel="prefetch" href="/home/assets/1.html-b316c5ed.js" as="script"><link rel="prefetch" href="/home/assets/2.html-ac2ea519.js" as="script"><link rel="prefetch" href="/home/assets/3.html-a16fc765.js" as="script"><link rel="prefetch" href="/home/assets/4.html-798018cd.js" as="script"><link rel="prefetch" href="/home/assets/5.html-18ce25f4.js" as="script"><link rel="prefetch" href="/home/assets/6.html-f31143bd.js" as="script"><link rel="prefetch" href="/home/assets/index.html-d4d6df4d.js" as="script"><link rel="prefetch" href="/home/assets/algorithms.html-f5b5ee0a.js" as="script"><link rel="prefetch" href="/home/assets/c__.html-05ab7a9e.js" as="script"><link rel="prefetch" href="/home/assets/graph.html-dab7b16e.js" as="script"><link rel="prefetch" href="/home/assets/leetcode.html-f105e9f1.js" as="script"><link rel="prefetch" href="/home/assets/other_tree.html-22fe33b0.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b98c27b4.js" as="script"><link rel="prefetch" href="/home/assets/sort_and_search.html-11f53bfb.js" as="script"><link rel="prefetch" href="/home/assets/string.html-e9db3916.js" as="script"><link rel="prefetch" href="/home/assets/tree.html-ec32110e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-99884eac.js" as="script"><link rel="prefetch" href="/home/assets/10.html-75dc6e9d.js" as="script"><link rel="prefetch" href="/home/assets/11.html-44ed8d03.js" as="script"><link rel="prefetch" href="/home/assets/12.html-1cafae42.js" as="script"><link rel="prefetch" href="/home/assets/13.html-cf9e5046.js" as="script"><link rel="prefetch" href="/home/assets/14.html-513b431e.js" as="script"><link rel="prefetch" href="/home/assets/2.html-094a87ee.js" as="script"><link rel="prefetch" href="/home/assets/3.html-4a8b2796.js" as="script"><link rel="prefetch" href="/home/assets/4.html-1f39f3b9.js" as="script"><link rel="prefetch" href="/home/assets/5.html-e78784fc.js" as="script"><link rel="prefetch" href="/home/assets/6.html-cc4acb22.js" as="script"><link rel="prefetch" href="/home/assets/7.html-ff096a2a.js" as="script"><link rel="prefetch" href="/home/assets/8.html-14b4319a.js" as="script"><link rel="prefetch" href="/home/assets/9.html-f1fd1f24.js" as="script"><link rel="prefetch" href="/home/assets/index.html-47fde470.js" as="script"><link rel="prefetch" href="/home/assets/1.html-769a7684.js" as="script"><link rel="prefetch" href="/home/assets/2.html-594984b8.js" as="script"><link rel="prefetch" href="/home/assets/3.html-5ac058a8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-8a655167.js" as="script"><link rel="prefetch" href="/home/assets/23_Nov.html-3f528a1c.js" as="script"><link rel="prefetch" href="/home/assets/index.html-d1eb4efc.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-4b397581.js" as="script"><link rel="prefetch" href="/home/assets/index.html-96c11e08.js" as="script"><link rel="prefetch" href="/home/assets/system_usage.html-5e15cb39.js" as="script"><link rel="prefetch" href="/home/assets/docker_tutorial.html-4f5d0900.js" as="script"><link rel="prefetch" href="/home/assets/firewall_tutorial.html-a1c0f732.js" as="script"><link rel="prefetch" href="/home/assets/mysql_tutorial.html-4c6ba5d6.js" as="script"><link rel="prefetch" href="/home/assets/nginx_tutorial.html-93df5119.js" as="script"><link rel="prefetch" href="/home/assets/other_tutorial.html-c3d0505a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-1bcb2be9.js" as="script"><link rel="prefetch" href="/home/assets/1.html-51f0ec55.js" as="script"><link rel="prefetch" href="/home/assets/2.html-a59bf622.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b0e9f560.js" as="script"><link rel="prefetch" href="/home/assets/5.html-a4a0234f.js" as="script"><link rel="prefetch" href="/home/assets/6.html-d1f646bc.js" as="script"><link rel="prefetch" href="/home/assets/7.html-4bfc5de3.js" as="script"><link rel="prefetch" href="/home/assets/Mybatis.html-999b181b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3e3eac32.js" as="script"><link rel="prefetch" href="/home/assets/Spring.html-ebdaae63.js" as="script"><link rel="prefetch" href="/home/assets/SpringBoot.html-c1676d63.js" as="script"><link rel="prefetch" href="/home/assets/SpringMVC.html-7bf971fc.js" as="script"><link rel="prefetch" href="/home/assets/1.html-095f3a2d.js" as="script"><link rel="prefetch" href="/home/assets/2.html-820329b9.js" as="script"><link rel="prefetch" href="/home/assets/3.html-65fa04a9.js" as="script"><link rel="prefetch" href="/home/assets/4.html-6cc0fdbb.js" as="script"><link rel="prefetch" href="/home/assets/5.html-4382da55.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2c443520.js" as="script"><link rel="prefetch" href="/home/assets/less.html-26b18828.js" as="script"><link rel="prefetch" href="/home/assets/index.html-0a2a0106.js" as="script"><link rel="prefetch" href="/home/assets/sass.html-e33a9ecf.js" as="script"><link rel="prefetch" href="/home/assets/1.html-e6ed9dbf.js" as="script"><link rel="prefetch" href="/home/assets/2.html-76ba2e41.js" as="script"><link rel="prefetch" href="/home/assets/index.html-202d5f4b.js" as="script"><link rel="prefetch" href="/home/assets/1.html-c051337a.js" as="script"><link rel="prefetch" href="/home/assets/2.html-c475ae33.js" as="script"><link rel="prefetch" href="/home/assets/index.html-7a9eb86e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-2d63875b.js" as="script"><link rel="prefetch" href="/home/assets/2.html-96ffe2d7.js" as="script"><link rel="prefetch" href="/home/assets/3.html-164f28d8.js" as="script"><link rel="prefetch" href="/home/assets/4.html-770067b7.js" as="script"><link rel="prefetch" href="/home/assets/5.html-94e4a58f.js" as="script"><link rel="prefetch" href="/home/assets/6.html-5fbe2511.js" as="script"><link rel="prefetch" href="/home/assets/7.html-6aaf4692.js" as="script"><link rel="prefetch" href="/home/assets/8.html-6c442319.js" as="script"><link rel="prefetch" href="/home/assets/9.html-1a1241a0.js" as="script"><link rel="prefetch" href="/home/assets/new.html-f39ecd3a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-ca14f1ca.js" as="script"><link rel="prefetch" href="/home/assets/1.html-f45e37f8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3b81aa58.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3505c412.js" as="script"><link rel="prefetch" href="/home/assets/uniCloud.html-d6f4a4e6.js" as="script"><link rel="prefetch" href="/home/assets/uniTips.html-c522b2d1.js" as="script"><link rel="prefetch" href="/home/assets/1.html-3be78b60.js" as="script"><link rel="prefetch" href="/home/assets/index.html-6602172a.js" as="script"><link rel="prefetch" href="/home/assets/api_tutorial.html-201e8b68.js" as="script"><link rel="prefetch" href="/home/assets/base_tutorial.html-553e9cd8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-dcc009ab.js" as="script"><link rel="prefetch" href="/home/assets/vue2.html-396e5caf.js" as="script"><link rel="prefetch" href="/home/assets/vue3_1.html-a3f127a4.js" as="script"><link rel="prefetch" href="/home/assets/vue3_2.html-52a41818.js" as="script"><link rel="prefetch" href="/home/assets/1.html-6b5b0d34.js" as="script"><link rel="prefetch" href="/home/assets/index.html-f9a24ca8.js" as="script"><link rel="prefetch" href="/home/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-01b3e3e1.js" as="script"><link rel="prefetch" href="/home/assets/index.html-d5653f20.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2482efd5.js" as="script"><link rel="prefetch" href="/home/assets/index.html-d929f486.js" as="script"><link rel="prefetch" href="/home/assets/1.html-3747d7f5.js" as="script"><link rel="prefetch" href="/home/assets/2.html-7c45bf2c.js" as="script"><link rel="prefetch" href="/home/assets/3.html-dbd88c19.js" as="script"><link rel="prefetch" href="/home/assets/4.html-2cc15a68.js" as="script"><link rel="prefetch" href="/home/assets/5.html-bcc98ac1.js" as="script"><link rel="prefetch" href="/home/assets/6.html-3dfef00e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-66d0eaa2.js" as="script"><link rel="prefetch" href="/home/assets/algorithms.html-4a04e29e.js" as="script"><link rel="prefetch" href="/home/assets/c__.html-cc08e98d.js" as="script"><link rel="prefetch" href="/home/assets/graph.html-ab22f4e5.js" as="script"><link rel="prefetch" href="/home/assets/leetcode.html-0001d9d3.js" as="script"><link rel="prefetch" href="/home/assets/other_tree.html-9485da1e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-44071b52.js" as="script"><link rel="prefetch" href="/home/assets/sort_and_search.html-98d35828.js" as="script"><link rel="prefetch" href="/home/assets/string.html-4718e57a.js" as="script"><link rel="prefetch" href="/home/assets/tree.html-7c4516aa.js" as="script"><link rel="prefetch" href="/home/assets/1.html-6c23ce2c.js" as="script"><link rel="prefetch" href="/home/assets/10.html-594847ec.js" as="script"><link rel="prefetch" href="/home/assets/11.html-a5f2ed51.js" as="script"><link rel="prefetch" href="/home/assets/12.html-94653cf5.js" as="script"><link rel="prefetch" href="/home/assets/13.html-6ee41e0c.js" as="script"><link rel="prefetch" href="/home/assets/14.html-ecee25f4.js" as="script"><link rel="prefetch" href="/home/assets/2.html-31bb7565.js" as="script"><link rel="prefetch" href="/home/assets/3.html-0c28ee7a.js" as="script"><link rel="prefetch" href="/home/assets/4.html-09920f5b.js" as="script"><link rel="prefetch" href="/home/assets/5.html-ff3df9e4.js" as="script"><link rel="prefetch" href="/home/assets/6.html-3e31d4a1.js" as="script"><link rel="prefetch" href="/home/assets/7.html-9c7f204c.js" as="script"><link rel="prefetch" href="/home/assets/8.html-a6bcd3f8.js" as="script"><link rel="prefetch" href="/home/assets/9.html-f3936c48.js" as="script"><link rel="prefetch" href="/home/assets/index.html-ddb8e32c.js" as="script"><link rel="prefetch" href="/home/assets/1.html-27adfb7b.js" as="script"><link rel="prefetch" href="/home/assets/2.html-b075b6d2.js" as="script"><link rel="prefetch" href="/home/assets/3.html-676d6aa8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-49a50439.js" as="script"><link rel="prefetch" href="/home/assets/23_Nov.html-61016249.js" as="script"><link rel="prefetch" href="/home/assets/index.html-6cb566ff.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-be08af9a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-cfbe4cb3.js" as="script"><link rel="prefetch" href="/home/assets/system_usage.html-4f1bb885.js" as="script"><link rel="prefetch" href="/home/assets/docker_tutorial.html-9a590801.js" as="script"><link rel="prefetch" href="/home/assets/firewall_tutorial.html-7c533897.js" as="script"><link rel="prefetch" href="/home/assets/mysql_tutorial.html-06f340a2.js" as="script"><link rel="prefetch" href="/home/assets/nginx_tutorial.html-723fe1f8.js" as="script"><link rel="prefetch" href="/home/assets/other_tutorial.html-34710a14.js" as="script"><link rel="prefetch" href="/home/assets/index.html-12d2dee6.js" as="script"><link rel="prefetch" href="/home/assets/1.html-be8d16bb.js" as="script"><link rel="prefetch" href="/home/assets/2.html-aaca4aac.js" as="script"><link rel="prefetch" href="/home/assets/index.html-ad577b44.js" as="script"><link rel="prefetch" href="/home/assets/5.html-154a00fb.js" as="script"><link rel="prefetch" href="/home/assets/6.html-5363441b.js" as="script"><link rel="prefetch" href="/home/assets/7.html-837a914f.js" as="script"><link rel="prefetch" href="/home/assets/Mybatis.html-d3413f90.js" as="script"><link rel="prefetch" href="/home/assets/index.html-fe902769.js" as="script"><link rel="prefetch" href="/home/assets/Spring.html-b6336d86.js" as="script"><link rel="prefetch" href="/home/assets/SpringBoot.html-acf17c82.js" as="script"><link rel="prefetch" href="/home/assets/SpringMVC.html-5a22b51b.js" as="script"><link rel="prefetch" href="/home/assets/1.html-6d5ea318.js" as="script"><link rel="prefetch" href="/home/assets/2.html-685fd259.js" as="script"><link rel="prefetch" href="/home/assets/3.html-fa36c000.js" as="script"><link rel="prefetch" href="/home/assets/4.html-467bb9c5.js" as="script"><link rel="prefetch" href="/home/assets/5.html-b7903c1e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-9494e991.js" as="script"><link rel="prefetch" href="/home/assets/less.html-bc8b5c5a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-ed059959.js" as="script"><link rel="prefetch" href="/home/assets/sass.html-f2929def.js" as="script"><link rel="prefetch" href="/home/assets/1.html-e967af0f.js" as="script"><link rel="prefetch" href="/home/assets/2.html-093a5ee5.js" as="script"><link rel="prefetch" href="/home/assets/index.html-cea482d0.js" as="script"><link rel="prefetch" href="/home/assets/1.html-5db3b3c6.js" as="script"><link rel="prefetch" href="/home/assets/2.html-2b3089ca.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2c0c65f4.js" as="script"><link rel="prefetch" href="/home/assets/1.html-03599f9b.js" as="script"><link rel="prefetch" href="/home/assets/2.html-de40060f.js" as="script"><link rel="prefetch" href="/home/assets/3.html-4c76f207.js" as="script"><link rel="prefetch" href="/home/assets/4.html-d2d76f44.js" as="script"><link rel="prefetch" href="/home/assets/5.html-430f5624.js" as="script"><link rel="prefetch" href="/home/assets/6.html-ad0cf37d.js" as="script"><link rel="prefetch" href="/home/assets/7.html-0814eb45.js" as="script"><link rel="prefetch" href="/home/assets/8.html-e9e64f46.js" as="script"><link rel="prefetch" href="/home/assets/9.html-447e780e.js" as="script"><link rel="prefetch" href="/home/assets/new.html-cc0417f2.js" as="script"><link rel="prefetch" href="/home/assets/index.html-8d621a0a.js" as="script"><link rel="prefetch" href="/home/assets/1.html-9764d334.js" as="script"><link rel="prefetch" href="/home/assets/index.html-e3aab79d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-58ebe073.js" as="script"><link rel="prefetch" href="/home/assets/uniCloud.html-c6bd710e.js" as="script"><link rel="prefetch" href="/home/assets/uniTips.html-08656747.js" as="script"><link rel="prefetch" href="/home/assets/1.html-4cbba599.js" as="script"><link rel="prefetch" href="/home/assets/index.html-5fa2af83.js" as="script"><link rel="prefetch" href="/home/assets/api_tutorial.html-b2dbcc44.js" as="script"><link rel="prefetch" href="/home/assets/base_tutorial.html-a0e6fa8d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-a9179c46.js" as="script"><link rel="prefetch" href="/home/assets/vue2.html-b2299c71.js" as="script"><link rel="prefetch" href="/home/assets/vue3_1.html-e062d13e.js" as="script"><link rel="prefetch" href="/home/assets/vue3_2.html-af4ef073.js" as="script"><link rel="prefetch" href="/home/assets/1.html-0444b816.js" as="script"><link rel="prefetch" href="/home/assets/index.html-c6cb427d.js" as="script"><link rel="prefetch" href="/home/assets/404.html-f6f72f31.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/home/" class=""><!----><span class="site-name">不愿飞的蜂鸟首页</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/master/daily/" class="" aria-label="Daily"><!--[--><!--]--> Daily <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/ubuntu/" class="" aria-label="Ubuntu"><!--[--><!--]--> Ubuntu <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>foreground</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/js/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/typescript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/html_css/" class="" aria-label="HTML_CSS"><!--[--><!--]--> HTML_CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/less_sass/" class="" aria-label="Less_Sass"><!--[--><!--]--> Less_Sass <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/react/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vue/" class="router-link-active" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>background</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/java/" class="" aria-label="JAVA"><!--[--><!--]--> JAVA <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>app.mp</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/miniProgram/" class="" aria-label="MiniProgram"><!--[--><!--]--> MiniProgram <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/uni-app/" class="" aria-label="uni-app"><!--[--><!--]--> uni-app <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>server</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/centos/" class="" aria-label="Centos"><!--[--><!--]--> Centos <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/course/operating_system/" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/computer_network/" class="" aria-label="计算机网络技术"><!--[--><!--]--> 计算机网络技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/datastructure_and_algorithm/" class="" aria-label="数据结构和算法"><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/liushun-ing" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/master/daily/" class="" aria-label="Daily"><!--[--><!--]--> Daily <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/ubuntu/" class="" aria-label="Ubuntu"><!--[--><!--]--> Ubuntu <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>foreground</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/js/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/typescript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/html_css/" class="" aria-label="HTML_CSS"><!--[--><!--]--> HTML_CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/less_sass/" class="" aria-label="Less_Sass"><!--[--><!--]--> Less_Sass <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/react/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vue/" class="router-link-active" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>background</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/java/" class="" aria-label="JAVA"><!--[--><!--]--> JAVA <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>app.mp</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/miniProgram/" class="" aria-label="MiniProgram"><!--[--><!--]--> MiniProgram <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/uni-app/" class="" aria-label="uni-app"><!--[--><!--]--> uni-app <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>server</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/centos/" class="" aria-label="Centos"><!--[--><!--]--> Centos <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/course/operating_system/" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/computer_network/" class="" aria-label="计算机网络技术"><!--[--><!--]--> 计算机网络技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/datastructure_and_algorithm/" class="" aria-label="数据结构和算法"><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/liushun-ing" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">Vue <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/home/tech/vue/" class="router-link-active sidebar-item" aria-label="Navigation"><!--[--><!--]--> Navigation <!--[--><!--]--></a><!----></li><li><a href="/home/tech/vue/vue2.html" class="sidebar-item" aria-label="VUE2笔记"><!--[--><!--]--> VUE2笔记 <!--[--><!--]--></a><!----></li><li><a href="/home/tech/vue/base_tutorial.html" class="sidebar-item" aria-label="VUE问题合集"><!--[--><!--]--> VUE问题合集 <!--[--><!--]--></a><!----></li><li><a href="/home/tech/vue/api_tutorial.html" class="sidebar-item" aria-label="VUE封装axios api"><!--[--><!--]--> VUE封装axios api <!--[--><!--]--></a><!----></li><li><a href="/home/tech/vue/vue3_1.html" class="sidebar-item" aria-label="Vue3快速上手"><!--[--><!--]--> Vue3快速上手 <!--[--><!--]--></a><!----></li><li><a href="/home/tech/vue/vue3_2.html" class="sidebar-item" aria-label="VUE3新特性"><!--[--><!--]--> VUE3新特性 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/tech/vue/pinia.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="pinia"><!--[--><!--]--> pinia <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/tech/vue/pinia.html#介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/tech/vue/pinia.html#pinia项目实战-基于腾讯im的客服程序" class="router-link-active router-link-exact-active sidebar-item" aria-label="pinia项目实战-基于腾讯IM的客服程序"><!--[--><!--]--> pinia项目实战-基于腾讯IM的客服程序 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/tech/vue/pinia.html#了解自定义插件" class="router-link-active router-link-exact-active sidebar-item" aria-label="了解自定义插件"><!--[--><!--]--> 了解自定义插件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/tech/vue/pinia.html#项目实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="项目实现"><!--[--><!--]--> 项目实现 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="pinia" tabindex="-1"><a class="header-anchor" href="#pinia" aria-hidden="true">#</a> pinia</h1><h2 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍" aria-hidden="true">#</a> 介绍</h2><p>Pinia 是 Vue 的存储库，它允许您跨组件/页面共享状态。 如果您熟悉 Composition API，您可能会认为您已经可以通过一个简单的 <code>export const state = reactive({})</code>. 这对于单页应用程序来说是正确的，但如果它是服务器端呈现的，<strong>会使您的应用程序暴露于安全漏洞</strong>。 但即使在小型单页应用程序中，您也可以从使用 Pinia 中获得很多好处：</p><ul><li>dev-tools 支持 <ul><li>跟踪动作、突变的时间线</li><li>Store 出现在使用它们的组件中</li><li>time travel 和 更容易的调试</li></ul></li><li>热模块更换 <ul><li>在不重新加载页面的情况下修改您的 Store</li><li>在开发时保持任何现有状态</li></ul></li><li>插件：使用插件扩展 Pinia 功能</li><li>为 JS 用户提供适当的 TypeScript 支持或 <strong>autocompletion</strong></li><li>服务器端渲染支持</li></ul><p>与 Vuex 相比，Pinia 提供了一个更简单的 API，具有更少的规范，提供了 Composition-API 风格的 API，最重要的是，在与 TypeScript 一起使用时具有可靠的类型推断支持。</p><h2 id="pinia项目实战-基于腾讯im的客服程序" tabindex="-1"><a class="header-anchor" href="#pinia项目实战-基于腾讯im的客服程序" aria-hidden="true">#</a> pinia项目实战-基于腾讯IM的客服程序</h2><h3 id="了解自定义插件" tabindex="-1"><a class="header-anchor" href="#了解自定义插件" aria-hidden="true">#</a> 了解自定义插件</h3><h4 id="介绍-1" tabindex="-1"><a class="header-anchor" href="#介绍-1" aria-hidden="true">#</a> 介绍</h4><p>Pinia 插件是一个函数，可以选择返回要添加到 store 的属性。 它需要一个可选参数，一个 <em>context</em>：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>export function myPiniaPlugin(context) {
  context.pinia // 使用 `createPinia()` 创建的 pinia
  context.app // 使用 `createApp()` 创建的当前应用程序（仅限 Vue 3）
  context.store // 插件正在扩充的 store
  context.options // 定义存储的选项对象传递给`defineStore()`
  // ...
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后使用 <code>pinia.use()</code> 将此函数传递给 <code>pinia</code>：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pinia.use(myPiniaPlugin)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>插件仅适用于**在将<code>pinia</code>传递给应用程序后创建的 store **，否则将不会被应用。</p><h4 id="自定义状态持久化插件" tabindex="-1"><a class="header-anchor" href="#自定义状态持久化插件" aria-hidden="true">#</a> 自定义状态持久化插件</h4><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> PiniaPluginContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;pinia&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span>context<span class="token operator">:</span> PiniaPluginContext<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> currState <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>store<span class="token punctuation">.</span>$id<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39;{}&#39;</span><span class="token punctuation">)</span>
  context<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">$patch</span><span class="token punctuation">(</span>currState<span class="token punctuation">)</span>

  context<span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">$subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_state<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>_state<span class="token punctuation">.</span>storeId<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    detached<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 该订阅在组件卸载后保留</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="项目实现" tabindex="-1"><a class="header-anchor" href="#项目实现" aria-hidden="true">#</a> 项目实现</h3><p>腾讯IM的功能以pinia插件的形式实现，将IM的核心功能作为pinia插件，在pinia初始化时，自动初始化IM api</p><p><a href="https://cloud.tencent.com/document/product/269/75285" target="_blank" rel="noopener noreferrer">腾讯IM文档地址<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> <a href="https://cloud.tencent.com/act/free/personal?from=20417" target="_blank" rel="noopener noreferrer">免费试用腾讯IM<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h4 id="为pinia添加im核心功能属性和创建选项" tabindex="-1"><a class="header-anchor" href="#为pinia添加im核心功能属性和创建选项" aria-hidden="true">#</a> 为pinia添加IM核心功能属性和创建选项</h4><p>需要在src目录下，新建<code>type.d.ts</code>类型声明文件</p><p>创建选项，是需要在创建pinia，初始化IM时，传入IM的服务<code>SDKAppID</code></p><p>核心功能属性时将整个TIM对象挂载到pinia上，方便调用其api</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// type.ts</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ITimCoreProps</span> <span class="token punctuation">{</span>
  SDKAppID<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token string">&#39;pinia&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ITimCoreProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./stores/plugins/TIM-plugin/type&#39;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token class-name">TIMCore</span> <span class="token keyword">from</span> <span class="token string">&#39;./stores/plugins/TIM-plugin/TIM_core&#39;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&#39;pinia&#39;</span> <span class="token punctuation">{</span>
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">DefineStoreOptionsBase<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> Store<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * TIM初始化的参数
     */</span>
    TIMOptions<span class="token operator">?</span><span class="token operator">:</span> ITimCoreProps
  <span class="token punctuation">}</span>
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">PiniaCustomProperties</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * TIM核心功能对象
     */</span>
    timCore<span class="token operator">:</span> TIMCore
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="创建timcore核心类" tabindex="-1"><a class="header-anchor" href="#创建timcore核心类" aria-hidden="true">#</a> 创建TIMCore核心类</h4><p><img src="/home/assets/image-20230802102842491-87b238c0.png" alt="image-20230802102842491"></p><p>可以创建一个类，在需要使用的时候，new一个类实例即可</p><p>在<code>store</code>文件夹中，创建<code>TIM-plugin</code>文件夹，创建<code>TIM_core.ts</code>文件，用来定义核心功能类</p><p>这里直接复制官网的代码即可，只不过将<code>TencentCloudChat.create(options)</code>生成的对象作为类属性即可</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// 如果您已集成 v2.x 的 SDK，想升级到 V3 并且想尽可能地少改动项目代码，可以继续沿用 TIM</span>
<span class="token comment">// import TIM from &#39;@tencentcloud/chat&#39;;</span>
<span class="token keyword">import</span> TIMUploadPlugin <span class="token keyword">from</span> <span class="token string">&#39;tim-upload-plugin&#39;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> ITimCoreProps<span class="token punctuation">,</span> TIMLoginParams <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./type&#39;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> ChatSDK<span class="token punctuation">,</span> Message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@tencentcloud/chat&#39;</span>
<span class="token keyword">import</span> TencentCloudChat <span class="token keyword">from</span> <span class="token string">&#39;@tencentcloud/chat&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">TIMCore</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> chat<span class="token operator">:</span> ChatSDK <span class="token operator">|</span> <span class="token keyword">undefined</span>
  <span class="token keyword">public</span> userID<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>
  <span class="token keyword">public</span> userSig<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token operator">:</span> ITimCoreProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initTimSdk</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>SDKAppID<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bindTIMEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">initTimSdk</span><span class="token punctuation">(</span>SDKAppID<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
      SDKAppID<span class="token punctuation">,</span> <span class="token comment">// 接入时需要将0替换为您的即时通信 IM 应用的 SDKAppID</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 创建 SDK 实例，`TIM.create()`方法对于同一个 `SDKAppID` 只会返回同一份实例</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>chat <span class="token operator">=</span> TencentCloudChat<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token comment">// SDK 实例通常用 chat 表示</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">.</span><span class="token function">setLogLevel</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 普通级别，日志量较多，接入时建议使用</span>
    <span class="token comment">// chat.setLogLevel(1); // release 级别，SDK 输出关键信息，生产环境时建议使用</span>
    <span class="token comment">// 注册腾讯云即时通信 IM 上传插件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">.</span><span class="token function">registerPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string-property property">&#39;tim-upload-plugin&#39;</span><span class="token operator">:</span> TIMUploadPlugin <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 注册腾讯云即时通信 IM 本地审核插件</span>
    <span class="token comment">// chat.registerPlugin({</span>
    <span class="token comment">//   &#39;tim-profanity-filter-plugin&#39;: TIMProfanityFilterPlugin,</span>
    <span class="token comment">// })</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">persisted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="创建tim插件" tabindex="-1"><a class="header-anchor" href="#创建tim插件" aria-hidden="true">#</a> 创建TIM插件</h4><p>即目录的<code>/TIM_plugin/index.ts</code>文件</p><p>在这个插件中，需要根据自定义的options，去创建一个TIMCore对象，挂载到store即可</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> PiniaPluginContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;pinia&#39;</span>
<span class="token keyword">import</span> TIMCore <span class="token keyword">from</span> <span class="token string">&#39;./TIM_core&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span>context<span class="token operator">:</span> PiniaPluginContext<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>options<span class="token punctuation">.</span>TIMOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> timCore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TIMCore</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>options<span class="token punctuation">.</span>TIMOptions<span class="token punctuation">)</span>
    context<span class="token punctuation">.</span>store<span class="token punctuation">.</span>timCore <span class="token operator">=</span> timCore
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="创建timstore" tabindex="-1"><a class="header-anchor" href="#创建timstore" aria-hidden="true">#</a> 创建TIMStore</h4><p>即<code>store/chat.ts</code></p><p>在这个store中，需要声明TIMOptions，赋值SDKAppID，这样在插件中才会有值</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Message<span class="token punctuation">,</span> Conversation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@tencentcloud/chat&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;pinia&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> useTIMStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">&#39;chat&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  TIMOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
    SDKAppID<span class="token operator">:</span> <span class="token number">1400823884</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>完成以上工作，就可以看到控制台会打印很多chat的日志，就说明IM初始化好了</p><h4 id="登录登出" tabindex="-1"><a class="header-anchor" href="#登录登出" aria-hidden="true">#</a> 登录登出</h4><p>在TIMCore中完善登录逻辑</p><p>在这里需要注意持久化登录，每次刷新页面，pinia都会重新初始化，所以需要自动刷新登陆状态</p><p>在登出的时候，需要取消订阅消息</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// type.ts</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">TIMLoginParams</span> <span class="token punctuation">{</span>
  userID<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  userSig<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">/**
 * 持久登录
 */</span>
<span class="token keyword">private</span> <span class="token function-variable function">persisted</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&#39;TIMCoreLogin&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;{}&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>userID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">TIMLogin</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 登录TIM
 * @param options 用户信息
 * @returns
 */</span>
<span class="token function-variable function">TIMLogin</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>options<span class="token operator">:</span> TIMLoginParams<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;TIMCoreLogin&#39;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>userID <span class="token operator">=</span> options<span class="token punctuation">.</span>userID
  <span class="token keyword">this</span><span class="token punctuation">.</span>userSig <span class="token operator">=</span> options<span class="token punctuation">.</span>userSig
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 登出TIM
 * @returns
 */</span>
<span class="token function-variable function">TIMLogout</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span>TencentCloudChat<span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">MESSAGE_RECEIVED</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span>TencentCloudChat<span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">SDK_READY</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">&#39;TIMCoreLogin&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="订阅ready事件" tabindex="-1"><a class="header-anchor" href="#订阅ready事件" aria-hidden="true">#</a> 订阅ready事件</h4><p>在TIMCore中完善逻辑</p><p>在创建TIMCore对象时，便需要订阅好SDKReady事件，在SDK ready后，订阅接收消息事件和会话列表更新事件</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code>  <span class="token comment">/**
   * 订阅sdk ready事件
   * @returns
   */</span>
  <span class="token keyword">private</span> <span class="token function-variable function">bindTIMEvent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>TencentCloudChat<span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">SDK_READY</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleSDKReady<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">/**
   * SDKready回调，并订阅接收消息事件
   * @returns
   */</span>
  <span class="token keyword">private</span> <span class="token function-variable function">handleSDKReady</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;SDK ready..........&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>
      TencentCloudChat<span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">MESSAGE_RECEIVED</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>onMessageReceived<span class="token punctuation">,</span>
      <span class="token keyword">this</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>TencentCloudChat<span class="token punctuation">.</span><span class="token constant">EVENT</span><span class="token punctuation">.</span><span class="token constant">CONVERSATION_LIST_UPDATED</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onReady<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 准备就绪回调，可覆盖，交给用户自定义逻辑
   */</span>
  <span class="token keyword">public</span> <span class="token function-variable function">onReady</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="发送消息" tabindex="-1"><a class="header-anchor" href="#发送消息" aria-hidden="true">#</a> 发送消息</h4><p>在TIMCore中完善逻辑</p><p>定义一个发送文本消息函数，暴露出去即可</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code>  <span class="token comment">/**
   * 发送消息
   * @param userId 用户名
   * @param text 消息
   * @returns 无
   */</span>
  <span class="token keyword">public</span> <span class="token function-variable function">sendTextMessage</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token comment">// 1. 创建消息实例，接口返回的实例可以上屏</span>
    <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">.</span><span class="token function">createTextMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      to<span class="token operator">:</span> userId<span class="token punctuation">,</span>
      conversationType<span class="token operator">:</span> TencentCloudChat<span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">CONV_C2C</span><span class="token punctuation">,</span>
      <span class="token comment">// 消息优先级，用于群聊。如果某个群的消息超过了频率限制，后台会优先下发高优先级的消息</span>
      <span class="token comment">// priority: TencentCloudChat.TYPES.MSG_PRIORITY_NORMAL,</span>
      payload<span class="token operator">:</span> <span class="token punctuation">{</span>
        text<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 如果您发消息需要已读回执，需购买旗舰版套餐，并且创建消息时将 needReadReceipt 设置为 true</span>
      <span class="token comment">// needReadReceipt: true,</span>
      <span class="token comment">// 消息自定义数据（云端保存，会发送到对端，程序卸载重装后还能拉取到）</span>
      <span class="token comment">// cloudCustomData: &#39;your cloud custom data&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 2. 发送消息</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;发送成功&#39;</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span>
    <span class="token keyword">return</span> message
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="接收消息" tabindex="-1"><a class="header-anchor" href="#接收消息" aria-hidden="true">#</a> 接收消息</h4><p>在TIMCore中完善逻辑</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code>  <span class="token comment">/**
   * 接收消息回调
   *
   * @param event 事件对象
   */</span>
  <span class="token keyword">private</span> <span class="token function-variable function">onMessageReceived</span> <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> Message<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// event.data - 存储 Message 对象的数组 - [Message]</span>
    <span class="token keyword">const</span> messageList <span class="token operator">=</span> event<span class="token punctuation">.</span>data
    messageList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>type <span class="token operator">===</span> TencentCloudChat<span class="token punctuation">.</span><span class="token constant">TYPES</span><span class="token punctuation">.</span><span class="token constant">MSG_TEXT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 文本消息 - https://web.sdk.qcloud.com/im/doc/v3/zh-cn/Message.html#.TextPayload</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;TIM---- &quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        <span class="token comment">// 设置消息已读</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>chat<span class="token operator">?.</span><span class="token function">setMessageRead</span><span class="token punctuation">(</span><span class="token punctuation">{</span>conversationID<span class="token operator">:</span> message<span class="token punctuation">.</span>conversationID<span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">messageReceived</span><span class="token punctuation">(</span>messageList<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 对外暴露的接收消息回调，可重写,交给用户自定义
   * @param event 
   */</span>
  <span class="token keyword">public</span> <span class="token function-variable function">messageReceived</span> <span class="token operator">=</span> <span class="token punctuation">(</span>messageList<span class="token operator">:</span> Message<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>到这里，就已经完成了TIMCore的核心功能，登录登出，发送和接收消息的api</p><h4 id="获取会话列表" tabindex="-1"><a class="header-anchor" href="#获取会话列表" aria-hidden="true">#</a> 获取会话列表</h4><p>在<code>chat.ts</code>中完善逻辑</p><p>这里获取会话列表后，需要将其存储到store中，因此要定义在状态中</p><p>保存下来各个会话的<code>conversationID</code>即可</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code>  state<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    conversationList<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      conversationList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 获取会话列表
     */</span>
    <span class="token keyword">async</span> <span class="token function">getSessionList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>timCore<span class="token punctuation">.</span>chat<span class="token operator">?.</span><span class="token function">getConversationList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>conversationList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>item<span class="token operator">:</span> Conversation<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
          <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>conversationList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>conversationID<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>conversationList<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>conversationID<span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;get conversation&#39;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>conversationList<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="维护消息列表" tabindex="-1"><a class="header-anchor" href="#维护消息列表" aria-hidden="true">#</a> 维护消息列表</h4><p>在<code>chat.ts</code>中完善逻辑</p><p>消息列表获取后，也用store保存一下，减少请求次数</p><p>用一个对象存储，key是会话id，值是消息列表</p><p>提供添加消息，获取消息action，getMessageList作为过渡，如果存在则拿现有的，否则请求腾讯IM</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code>  state<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    conversationList<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    messageList<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> Message<span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      conversationList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      messageList<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  actions<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">addMessage</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> message<span class="token operator">:</span> Message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>messageList<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>messageList<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>messageList<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>message<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token keyword">async</span> <span class="token function">getHistoryMessageList</span><span class="token punctuation">(</span>conversationId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>timCore<span class="token punctuation">.</span>chat<span class="token operator">?.</span><span class="token function">getMessageList</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        conversationID<span class="token operator">:</span> conversationId<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>messageList<span class="token punctuation">[</span>conversationId<span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">.</span>data<span class="token punctuation">.</span>messageList
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>messageList<span class="token punctuation">[</span>conversationId<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token keyword">async</span> <span class="token function">getMessageList</span><span class="token punctuation">(</span>conversationId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>messageList<span class="token punctuation">[</span>conversationId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111111111111111</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>messageList<span class="token punctuation">[</span>conversationId<span class="token punctuation">]</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getHistoryMessageList</span><span class="token punctuation">(</span>conversationId<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">resetStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>conversationList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>messageList <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="页面登录登出逻辑" tabindex="-1"><a class="header-anchor" href="#页面登录登出逻辑" aria-hidden="true">#</a> 页面登录登出逻辑</h4><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// utils.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> genTestUserSig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../../debug/index&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> getUserSig <span class="token operator">=</span> <span class="token punctuation">(</span>
  userId<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  SDKAppID<span class="token operator">:</span> <span class="token builtin">number</span>
  userSig<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">genTestUserSig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    SDKAppID<span class="token operator">:</span> <span class="token number">1400823884</span><span class="token punctuation">,</span>
    userID<span class="token operator">:</span> userId<span class="token punctuation">,</span>
    <span class="token comment">// 在腾讯网站复制即可</span>
    secretKey<span class="token operator">:</span>
      <span class="token string">&#39;3f6b4e829fdc360d58c8a6fe92ad0706f71ee256d0ee9203dccca6842a1d2b69&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// 登录</span>
<span class="token keyword">interface</span> <span class="token class-name">FormState</span> <span class="token punctuation">{</span>
  username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  password<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> formState <span class="token operator">=</span> <span class="token generic-function"><span class="token function">reactive</span><span class="token generic class-name"><span class="token operator">&lt;</span>FormState<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  username<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useTIMStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">onFinish</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>values<span class="token operator">:</span> FormState<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 调用timCore对象的登陆方法即可</span>
  <span class="token keyword">await</span> store<span class="token punctuation">.</span>timCore<span class="token punctuation">.</span><span class="token function">TIMLogin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    userID<span class="token operator">:</span> values<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
    userSig<span class="token operator">:</span> <span class="token function">getUserSig</span><span class="token punctuation">(</span>values<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>userSig
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">&#39;role&#39;</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>values<span class="token punctuation">.</span>username <span class="token operator">==</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;role&#39;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      role<span class="token operator">:</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span>
      username<span class="token operator">:</span> values<span class="token punctuation">.</span>username
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;role&#39;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      role<span class="token operator">:</span> <span class="token string">&#39;normal&#39;</span><span class="token punctuation">,</span>
      username<span class="token operator">:</span> values<span class="token punctuation">.</span>username
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 登出</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useTIMStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">logout</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">&#39;role&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// 调用timCore登出方法</span>
  <span class="token keyword">await</span> store<span class="token punctuation">.</span>timCore<span class="token punctuation">.</span><span class="token function">TIMLogout</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 要重置store</span>
  store<span class="token punctuation">.</span><span class="token function">resetStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="页面聊天逻辑" tabindex="-1"><a class="header-anchor" href="#页面聊天逻辑" aria-hidden="true">#</a> 页面聊天逻辑</h4><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>service-box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-menu</span> <span class="token attr-name"><span class="token namespace">v-model:</span>selectedKeys</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>selectedKeys<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 256px<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 100%</span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertical<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:items</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>items<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@select</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleClick<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>right<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>messageRef<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in messageList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.text + Math.random().toString()<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{
          textAlign: item.align == &#39;left&#39; ? &#39;left&#39; : &#39;right&#39;,
        }<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{
            display: &#39;inline-block&#39;,
            marginLeft: item.align == &#39;left&#39; ? &#39;0&#39; : &#39;50px&#39;,
            marginRight: item.align == &#39;left&#39; ? &#39;50px&#39; : &#39;0&#39;,
          }<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item-content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>left-arrow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.align == &#39;left&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ item.text }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>right-arrow<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.align == &#39;right&#39;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>input-box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-textarea</span> <span class="token attr-name"><span class="token namespace">v-model:</span>value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>inputValue<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@pressEnter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendMessage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>回车发送消息<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">:auto-size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ minRows: 2, maxRows: 4 }<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> h<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> nextTick <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  MailOutlined
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@ant-design/icons-vue&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useTIMStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/stores/chat&#39;</span>
<span class="token keyword">import</span> type <span class="token punctuation">{</span> Message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@tencentcloud/chat&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> selectedKeys <span class="token operator">=</span> ref<span class="token operator">&lt;</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">interface</span> <span class="token class-name">messageItem</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">text</span><span class="token operator">:</span> string
  <span class="token literal-property property">align</span><span class="token operator">:</span> string
<span class="token punctuation">}</span>
<span class="token keyword">const</span> messageList <span class="token operator">=</span> ref<span class="token operator">&lt;</span>messageItem<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 每次切换会话，都需要重新获取消息</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> key <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> string <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  selectedKeys<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> roleItem <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&#39;role&#39;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;{}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> userId <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> selectedKeys<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> inputValue <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useTIMStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 会话列表计算属性，根据store保存的会话列表计算出来</span>
<span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里需要注意，如果是普通用户，那么默认一个admin客户会话</span>
    <span class="token keyword">const</span> list <span class="token operator">=</span> store<span class="token punctuation">.</span>conversationList<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span>
      <span class="token operator">?</span> store<span class="token punctuation">.</span>conversationList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">key</span><span class="token operator">:</span> item<span class="token punctuation">,</span>
          <span class="token function-variable function">icon</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>MailOutlined<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">label</span><span class="token operator">:</span> item<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">title</span><span class="token operator">:</span> item<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">:</span> roleItem<span class="token punctuation">.</span>role <span class="token operator">==</span> <span class="token string">&#39;normal&#39;</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token comment">// 记得要加C2C</span>
        <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;C2Cadmin&#39;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">icon</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">h</span><span class="token punctuation">(</span>MailOutlined<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// 初始化会话选择，默认选择第一个会话</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>selectedKeys<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      selectedKeys<span class="token punctuation">.</span>value <span class="token operator">=</span> list<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">[</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">?.</span>key<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> list
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// 发送消息，调用timCore的方法，然后更新store的消息列表</span>
<span class="token keyword">const</span> <span class="token function-variable function">sendMessage</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token keyword">await</span> store<span class="token punctuation">.</span>timCore<span class="token punctuation">.</span><span class="token function">sendTextMessage</span><span class="token punctuation">(</span>userId<span class="token punctuation">.</span>value<span class="token punctuation">,</span> inputValue<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  inputValue<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>
  message <span class="token operator">&amp;&amp;</span> store<span class="token punctuation">.</span><span class="token function">addMessage</span><span class="token punctuation">(</span>selectedKeys<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span>
  <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 自定义sdkready逻辑，sdk ready后，获取会话列表</span>
store<span class="token punctuation">.</span>timCore<span class="token punctuation">.</span><span class="token function-variable function">onReady</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">getSessionList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 获取store的消息，然后保存到页面的数据中，刷新页面</span>
<span class="token keyword">const</span> <span class="token function-variable function">getMessage</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  messageList<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token keyword">await</span> store<span class="token punctuation">.</span><span class="token function">getMessageList</span><span class="token punctuation">(</span>selectedKeys<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  messageList<span class="token punctuation">.</span>value <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> item<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
      <span class="token literal-property property">align</span><span class="token operator">:</span> item<span class="token punctuation">.</span>flow <span class="token operator">==</span> <span class="token string">&#39;out&#39;</span> <span class="token operator">?</span> <span class="token string">&#39;right&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;left&#39;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 自定义接受消息逻辑，将接收到的消息保存到store</span>
store<span class="token punctuation">.</span>timCore<span class="token punctuation">.</span><span class="token function-variable function">messageReceived</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">messageList</span><span class="token operator">:</span> Message<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  messageList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    item <span class="token operator">&amp;&amp;</span> store<span class="token punctuation">.</span><span class="token function">addMessage</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>conversationID<span class="token punctuation">,</span> item<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 每次消息列表更新，都将滚动条移到最后，保证在最后一条消息</span>
<span class="token keyword">const</span> messageRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">setScroll</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token literal-property property">dom</span><span class="token operator">:</span> any <span class="token operator">=</span> messageRef<span class="token punctuation">.</span>value <span class="token operator">&amp;&amp;</span> messageRef<span class="token punctuation">.</span>value
  <span class="token keyword">if</span> <span class="token punctuation">(</span>dom<span class="token punctuation">)</span>
    dom<span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> dom<span class="token punctuation">.</span>scrollHeight
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scss<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.service-box</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #ddd<span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">padding-left</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>

  <span class="token selector">.right</span> <span class="token punctuation">{</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
    <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>

    <span class="token selector">.message</span> <span class="token punctuation">{</span>
      <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> 10px 0<span class="token punctuation">;</span>
      <span class="token property">overflow-y</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>

      <span class="token selector">&amp;::-webkit-scrollbar</span> <span class="token punctuation">{</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 6px<span class="token punctuation">;</span>
        <span class="token property">height</span><span class="token punctuation">:</span> 6px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token selector">// 滚动条的轨道的两端按钮，允许通过点击微调小方块的位置。
      &amp;::-webkit-scrollbar-button</span> <span class="token punctuation">{</span>
        <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token selector">// 滚动条的轨道（里面装有Thumb）
      &amp;::-webkit-scrollbar-track</span> <span class="token punctuation">{</span>
        <span class="token property">background</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token selector">// 滚动条的轨道（里面装有Thumb）
      &amp;::-webkit-scrollbar-track-piece</span> <span class="token punctuation">{</span>
        <span class="token property">background-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token selector">// 滚动条里面的小方块，能向上向下移动（或往左往右移动，取决于是垂直滚动条还是水平滚动条）
      &amp;::-webkit-scrollbar-thumb</span> <span class="token punctuation">{</span>
        <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>144<span class="token punctuation">,</span> 147<span class="token punctuation">,</span> 153<span class="token punctuation">,</span> 0.3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
        <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token selector">// 边角，即两个滚动条的交汇处
      &amp;::-webkit-scrollbar-corner</span> <span class="token punctuation">{</span>
        <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token selector">// 两个滚动条的交汇处上用于通过拖动调整元素大小的小控件
      &amp;::-webkit-resizer</span> <span class="token punctuation">{</span>
        <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>


      <span class="token selector">.message-item</span> <span class="token punctuation">{</span>
        <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>

        <span class="token selector">.item-content</span> <span class="token punctuation">{</span>
          <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
          <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>

          <span class="token selector">.left-arrow</span> <span class="token punctuation">{</span>
            <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
            <span class="token property">border-top</span><span class="token punctuation">:</span> 5px solid transparent<span class="token punctuation">;</span>
            <span class="token property">border-right</span><span class="token punctuation">:</span> 5px solid #41a2fc<span class="token punctuation">;</span>
            <span class="token property">border-bottom</span><span class="token punctuation">:</span> 5px solid transparent<span class="token punctuation">;</span>
            <span class="token property">border-left</span><span class="token punctuation">:</span> 5px solid transparent<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token selector">.content</span> <span class="token punctuation">{</span>
            <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
            <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> #41a2fc<span class="token punctuation">;</span>
            <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
            <span class="token property">word-break</span><span class="token punctuation">:</span> break-all<span class="token punctuation">;</span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>
            <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
            <span class="token property">padding</span><span class="token punctuation">:</span> 8px 10px<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token selector">.right-arrow</span> <span class="token punctuation">{</span>
            <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
            <span class="token property">border-top</span><span class="token punctuation">:</span> 5px solid transparent<span class="token punctuation">;</span>
            <span class="token property">border-right</span><span class="token punctuation">:</span> 5px solid transparent<span class="token punctuation">;</span>
            <span class="token property">border-bottom</span><span class="token punctuation">:</span> 5px solid transparent<span class="token punctuation">;</span>
            <span class="token property">border-left</span><span class="token punctuation">:</span> 5px solid #41a2fc<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="store-index-ts" tabindex="-1"><a class="header-anchor" href="#store-index-ts" aria-hidden="true">#</a> /store/index.ts</h4><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createPinia <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;pinia&#39;</span>
<span class="token keyword">import</span> persistedState <span class="token keyword">from</span> <span class="token string">&#39;./plugins/persisted-state&#39;</span>
<span class="token keyword">import</span> TIMPlugin <span class="token keyword">from</span> <span class="token string">&#39;./plugins/TIM-plugin&#39;</span>

<span class="token keyword">const</span> pinia <span class="token operator">=</span> <span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 使用插件</span>
pinia<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>persistedState<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>TIMPlugin<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> pinia
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="最后结果" tabindex="-1"><a class="header-anchor" href="#最后结果" aria-hidden="true">#</a> 最后结果</h4><p><img src="/home/assets/image-20230802112843349-aa6663eb.png" alt="image-20230802112843349"></p><p><img src="/home/assets/image-20230802112927726-76b0ad07.png" alt="image-20230802112927726"></p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1743760069@qq.com">liushun</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/home/tech/vue/vue3_2.html" class="" aria-label="VUE3新特性"><!--[--><!--]--> VUE3新特性 <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/home/assets/app-69b48761.js" defer></script>
  </body>
</html>
