<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.62">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/imgs/favicon.ico"><title>UniCloud使用 | 不愿飞的蜂鸟首页</title><meta name="description" content="Five的垃圾库">
    <link rel="preload" href="/home/assets/style-d11d67ee.css" as="style"><link rel="stylesheet" href="/home/assets/style-d11d67ee.css">
    <link rel="modulepreload" href="/home/assets/app-753c81c9.js"><link rel="modulepreload" href="/home/assets/uniCloud.html-7fc3d72a.js"><link rel="modulepreload" href="/home/assets/uniCloud.html-d6f4a4e6.js"><link rel="prefetch" href="/home/assets/index.html-5f18312a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-88b7806c.js" as="script"><link rel="prefetch" href="/home/assets/index.html-4e7b4220.js" as="script"><link rel="prefetch" href="/home/assets/index.html-655005a5.js" as="script"><link rel="prefetch" href="/home/assets/1.html-b316c5ed.js" as="script"><link rel="prefetch" href="/home/assets/2.html-ac2ea519.js" as="script"><link rel="prefetch" href="/home/assets/3.html-a16fc765.js" as="script"><link rel="prefetch" href="/home/assets/4.html-798018cd.js" as="script"><link rel="prefetch" href="/home/assets/5.html-18ce25f4.js" as="script"><link rel="prefetch" href="/home/assets/6.html-f31143bd.js" as="script"><link rel="prefetch" href="/home/assets/index.html-d4d6df4d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b98c27b4.js" as="script"><link rel="prefetch" href="/home/assets/algorithms.html-f5b5ee0a.js" as="script"><link rel="prefetch" href="/home/assets/c__.html-05ab7a9e.js" as="script"><link rel="prefetch" href="/home/assets/graph.html-dab7b16e.js" as="script"><link rel="prefetch" href="/home/assets/leetcode.html-f105e9f1.js" as="script"><link rel="prefetch" href="/home/assets/other_tree.html-22fe33b0.js" as="script"><link rel="prefetch" href="/home/assets/sort_and_search.html-11f53bfb.js" as="script"><link rel="prefetch" href="/home/assets/string.html-e9db3916.js" as="script"><link rel="prefetch" href="/home/assets/tree.html-ec32110e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-769a7684.js" as="script"><link rel="prefetch" href="/home/assets/2.html-594984b8.js" as="script"><link rel="prefetch" href="/home/assets/3.html-5ac058a8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-8a655167.js" as="script"><link rel="prefetch" href="/home/assets/1.html-99884eac.js" as="script"><link rel="prefetch" href="/home/assets/10.html-75dc6e9d.js" as="script"><link rel="prefetch" href="/home/assets/11.html-44ed8d03.js" as="script"><link rel="prefetch" href="/home/assets/12.html-1cafae42.js" as="script"><link rel="prefetch" href="/home/assets/13.html-cf9e5046.js" as="script"><link rel="prefetch" href="/home/assets/14.html-513b431e.js" as="script"><link rel="prefetch" href="/home/assets/2.html-094a87ee.js" as="script"><link rel="prefetch" href="/home/assets/3.html-4a8b2796.js" as="script"><link rel="prefetch" href="/home/assets/4.html-1f39f3b9.js" as="script"><link rel="prefetch" href="/home/assets/5.html-e78784fc.js" as="script"><link rel="prefetch" href="/home/assets/6.html-cc4acb22.js" as="script"><link rel="prefetch" href="/home/assets/7.html-ff096a2a.js" as="script"><link rel="prefetch" href="/home/assets/8.html-14b4319a.js" as="script"><link rel="prefetch" href="/home/assets/9.html-f1fd1f24.js" as="script"><link rel="prefetch" href="/home/assets/index.html-47fde470.js" as="script"><link rel="prefetch" href="/home/assets/index.html-994c7095.js" as="script"><link rel="prefetch" href="/home/assets/base_concept.html-8c9eb618.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-6eb25c4d.js" as="script"><link rel="prefetch" href="/home/assets/pytorch_usage.html-12ebfb9e.js" as="script"><link rel="prefetch" href="/home/assets/23_Dec.html-b55b0d44.js" as="script"><link rel="prefetch" href="/home/assets/23_Nov.html-7f12af9c.js" as="script"><link rel="prefetch" href="/home/assets/24_Jan.html-aa29373f.js" as="script"><link rel="prefetch" href="/home/assets/index.html-cf670ace.js" as="script"><link rel="prefetch" href="/home/assets/1.html-48678c65.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3732bf90.js" as="script"><link rel="prefetch" href="/home/assets/1.html-8f3c150c.js" as="script"><link rel="prefetch" href="/home/assets/2.html-d129358c.js" as="script"><link rel="prefetch" href="/home/assets/3.html-5d7e2173.js" as="script"><link rel="prefetch" href="/home/assets/4.html-059ca9e2.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3bbc0199.js" as="script"><link rel="prefetch" href="/home/assets/1.html-655bafa6.js" as="script"><link rel="prefetch" href="/home/assets/2.html-e335910c.js" as="script"><link rel="prefetch" href="/home/assets/index.html-33a4fe7d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-5747b02b.js" as="script"><link rel="prefetch" href="/home/assets/base_usage.html-313edb82.js" as="script"><link rel="prefetch" href="/home/assets/1.html-84171baf.js" as="script"><link rel="prefetch" href="/home/assets/2.html-9adc52d4.js" as="script"><link rel="prefetch" href="/home/assets/3.html-20b1a547.js" as="script"><link rel="prefetch" href="/home/assets/4.html-599827f5.js" as="script"><link rel="prefetch" href="/home/assets/index.html-9d407164.js" as="script"><link rel="prefetch" href="/home/assets/index.html-78582fbf.js" as="script"><link rel="prefetch" href="/home/assets/jwt.html-fc0bf9c3.js" as="script"><link rel="prefetch" href="/home/assets/index.html-60425c3d.js" as="script"><link rel="prefetch" href="/home/assets/spring_annotation.html-3e4c4f76.js" as="script"><link rel="prefetch" href="/home/assets/springboot.html-dd3747fd.js" as="script"><link rel="prefetch" href="/home/assets/index.html-dbf7dd00.js" as="script"><link rel="prefetch" href="/home/assets/java_usage.html-baf8cd68.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-5785b28e.js" as="script"><link rel="prefetch" href="/home/assets/system_usage.html-e9649787.js" as="script"><link rel="prefetch" href="/home/assets/index.html-1bcb2be9.js" as="script"><link rel="prefetch" href="/home/assets/docker_tutorial.html-4f5d0900.js" as="script"><link rel="prefetch" href="/home/assets/firewall_tutorial.html-a1c0f732.js" as="script"><link rel="prefetch" href="/home/assets/mysql_tutorial.html-4c6ba5d6.js" as="script"><link rel="prefetch" href="/home/assets/nginx_tutorial.html-93df5119.js" as="script"><link rel="prefetch" href="/home/assets/other_tutorial.html-c3d0505a.js" as="script"><link rel="prefetch" href="/home/assets/1.html-51f0ec55.js" as="script"><link rel="prefetch" href="/home/assets/2.html-a59bf622.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b0e9f560.js" as="script"><link rel="prefetch" href="/home/assets/5.html-a4a0234f.js" as="script"><link rel="prefetch" href="/home/assets/6.html-d1f646bc.js" as="script"><link rel="prefetch" href="/home/assets/7.html-4bfc5de3.js" as="script"><link rel="prefetch" href="/home/assets/Mybatis.html-999b181b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3e3eac32.js" as="script"><link rel="prefetch" href="/home/assets/Spring.html-ebdaae63.js" as="script"><link rel="prefetch" href="/home/assets/SpringBoot.html-c1676d63.js" as="script"><link rel="prefetch" href="/home/assets/SpringMVC.html-7bf971fc.js" as="script"><link rel="prefetch" href="/home/assets/1.html-095f3a2d.js" as="script"><link rel="prefetch" href="/home/assets/2.html-820329b9.js" as="script"><link rel="prefetch" href="/home/assets/3.html-65fa04a9.js" as="script"><link rel="prefetch" href="/home/assets/4.html-6cc0fdbb.js" as="script"><link rel="prefetch" href="/home/assets/5.html-4382da55.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2c443520.js" as="script"><link rel="prefetch" href="/home/assets/index.html-0a2a0106.js" as="script"><link rel="prefetch" href="/home/assets/less.html-26b18828.js" as="script"><link rel="prefetch" href="/home/assets/sass.html-e33a9ecf.js" as="script"><link rel="prefetch" href="/home/assets/1.html-e6ed9dbf.js" as="script"><link rel="prefetch" href="/home/assets/2.html-76ba2e41.js" as="script"><link rel="prefetch" href="/home/assets/index.html-202d5f4b.js" as="script"><link rel="prefetch" href="/home/assets/1.html-c051337a.js" as="script"><link rel="prefetch" href="/home/assets/2.html-c475ae33.js" as="script"><link rel="prefetch" href="/home/assets/index.html-7a9eb86e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-2d63875b.js" as="script"><link rel="prefetch" href="/home/assets/2.html-96ffe2d7.js" as="script"><link rel="prefetch" href="/home/assets/3.html-164f28d8.js" as="script"><link rel="prefetch" href="/home/assets/4.html-770067b7.js" as="script"><link rel="prefetch" href="/home/assets/5.html-94e4a58f.js" as="script"><link rel="prefetch" href="/home/assets/6.html-5fbe2511.js" as="script"><link rel="prefetch" href="/home/assets/7.html-6aaf4692.js" as="script"><link rel="prefetch" href="/home/assets/8.html-6c442319.js" as="script"><link rel="prefetch" href="/home/assets/9.html-1a1241a0.js" as="script"><link rel="prefetch" href="/home/assets/index.html-ca14f1ca.js" as="script"><link rel="prefetch" href="/home/assets/new.html-f39ecd3a.js" as="script"><link rel="prefetch" href="/home/assets/1.html-f45e37f8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3b81aa58.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3505c412.js" as="script"><link rel="prefetch" href="/home/assets/uniTips.html-c522b2d1.js" as="script"><link rel="prefetch" href="/home/assets/1.html-3be78b60.js" as="script"><link rel="prefetch" href="/home/assets/index.html-6602172a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-dcc009ab.js" as="script"><link rel="prefetch" href="/home/assets/api_tutorial.html-201e8b68.js" as="script"><link rel="prefetch" href="/home/assets/base_tutorial.html-553e9cd8.js" as="script"><link rel="prefetch" href="/home/assets/pinia.html-93944f84.js" as="script"><link rel="prefetch" href="/home/assets/vue2.html-396e5caf.js" as="script"><link rel="prefetch" href="/home/assets/vue3_1.html-a3f127a4.js" as="script"><link rel="prefetch" href="/home/assets/vue3_2.html-52a41818.js" as="script"><link rel="prefetch" href="/home/assets/1.html-6b5b0d34.js" as="script"><link rel="prefetch" href="/home/assets/index.html-f9a24ca8.js" as="script"><link rel="prefetch" href="/home/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-12893d94.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3f98a976.js" as="script"><link rel="prefetch" href="/home/assets/index.html-0957faaa.js" as="script"><link rel="prefetch" href="/home/assets/index.html-7f63312a.js" as="script"><link rel="prefetch" href="/home/assets/1.html-faa739aa.js" as="script"><link rel="prefetch" href="/home/assets/2.html-f0923e39.js" as="script"><link rel="prefetch" href="/home/assets/3.html-aaea1dc4.js" as="script"><link rel="prefetch" href="/home/assets/4.html-3e6b659c.js" as="script"><link rel="prefetch" href="/home/assets/5.html-a1ec9d3f.js" as="script"><link rel="prefetch" href="/home/assets/6.html-bdefcfc6.js" as="script"><link rel="prefetch" href="/home/assets/index.html-cbe3cc7e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-cf1c9b78.js" as="script"><link rel="prefetch" href="/home/assets/algorithms.html-d4ba990b.js" as="script"><link rel="prefetch" href="/home/assets/c__.html-36d850d6.js" as="script"><link rel="prefetch" href="/home/assets/graph.html-679a36b5.js" as="script"><link rel="prefetch" href="/home/assets/leetcode.html-6381dcaf.js" as="script"><link rel="prefetch" href="/home/assets/other_tree.html-4d24b74a.js" as="script"><link rel="prefetch" href="/home/assets/sort_and_search.html-1ae82744.js" as="script"><link rel="prefetch" href="/home/assets/string.html-5ff7f7f1.js" as="script"><link rel="prefetch" href="/home/assets/tree.html-3bf4fce8.js" as="script"><link rel="prefetch" href="/home/assets/1.html-035b4b8e.js" as="script"><link rel="prefetch" href="/home/assets/2.html-4786da20.js" as="script"><link rel="prefetch" href="/home/assets/3.html-96e9e126.js" as="script"><link rel="prefetch" href="/home/assets/index.html-225e8529.js" as="script"><link rel="prefetch" href="/home/assets/1.html-0f2def79.js" as="script"><link rel="prefetch" href="/home/assets/10.html-d3e9ca97.js" as="script"><link rel="prefetch" href="/home/assets/11.html-777b2ba0.js" as="script"><link rel="prefetch" href="/home/assets/12.html-dded271e.js" as="script"><link rel="prefetch" href="/home/assets/13.html-0c5aa643.js" as="script"><link rel="prefetch" href="/home/assets/14.html-480f476e.js" as="script"><link rel="prefetch" href="/home/assets/2.html-619365a9.js" as="script"><link rel="prefetch" href="/home/assets/3.html-ff214ca4.js" as="script"><link rel="prefetch" href="/home/assets/4.html-66cd673a.js" as="script"><link rel="prefetch" href="/home/assets/5.html-34482428.js" as="script"><link rel="prefetch" href="/home/assets/6.html-a0921a75.js" as="script"><link rel="prefetch" href="/home/assets/7.html-3961acb8.js" as="script"><link rel="prefetch" href="/home/assets/8.html-7a9e55e7.js" as="script"><link rel="prefetch" href="/home/assets/9.html-a20ff633.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2bd1a25a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b4067f7f.js" as="script"><link rel="prefetch" href="/home/assets/base_concept.html-8ceba0a2.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-f54e1bfc.js" as="script"><link rel="prefetch" href="/home/assets/pytorch_usage.html-f06662cd.js" as="script"><link rel="prefetch" href="/home/assets/23_Dec.html-5418da32.js" as="script"><link rel="prefetch" href="/home/assets/23_Nov.html-41824f24.js" as="script"><link rel="prefetch" href="/home/assets/24_Jan.html-4bcd745b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-d998f5f1.js" as="script"><link rel="prefetch" href="/home/assets/1.html-018be89e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-05a14c50.js" as="script"><link rel="prefetch" href="/home/assets/1.html-506e1633.js" as="script"><link rel="prefetch" href="/home/assets/2.html-fdba20b9.js" as="script"><link rel="prefetch" href="/home/assets/3.html-4fa7313f.js" as="script"><link rel="prefetch" href="/home/assets/4.html-27648272.js" as="script"><link rel="prefetch" href="/home/assets/index.html-4ce451d3.js" as="script"><link rel="prefetch" href="/home/assets/1.html-64f758db.js" as="script"><link rel="prefetch" href="/home/assets/2.html-69940463.js" as="script"><link rel="prefetch" href="/home/assets/index.html-634e3fef.js" as="script"><link rel="prefetch" href="/home/assets/index.html-425d7ecf.js" as="script"><link rel="prefetch" href="/home/assets/base_usage.html-8f56d3e0.js" as="script"><link rel="prefetch" href="/home/assets/1.html-0e28ec51.js" as="script"><link rel="prefetch" href="/home/assets/2.html-a80d7739.js" as="script"><link rel="prefetch" href="/home/assets/3.html-8402daa9.js" as="script"><link rel="prefetch" href="/home/assets/4.html-b763df4e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-474a88f6.js" as="script"><link rel="prefetch" href="/home/assets/index.html-07bf755c.js" as="script"><link rel="prefetch" href="/home/assets/jwt.html-c1a52219.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2347b7ee.js" as="script"><link rel="prefetch" href="/home/assets/spring_annotation.html-15398e3b.js" as="script"><link rel="prefetch" href="/home/assets/springboot.html-12adad43.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3b8a196e.js" as="script"><link rel="prefetch" href="/home/assets/java_usage.html-41759271.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-b68323b7.js" as="script"><link rel="prefetch" href="/home/assets/system_usage.html-f4617d12.js" as="script"><link rel="prefetch" href="/home/assets/index.html-633ac8c4.js" as="script"><link rel="prefetch" href="/home/assets/docker_tutorial.html-b1c1f8de.js" as="script"><link rel="prefetch" href="/home/assets/firewall_tutorial.html-a1972b8e.js" as="script"><link rel="prefetch" href="/home/assets/mysql_tutorial.html-c0906e92.js" as="script"><link rel="prefetch" href="/home/assets/nginx_tutorial.html-bd8226e1.js" as="script"><link rel="prefetch" href="/home/assets/other_tutorial.html-70a46352.js" as="script"><link rel="prefetch" href="/home/assets/1.html-b196862f.js" as="script"><link rel="prefetch" href="/home/assets/2.html-b3c6aa89.js" as="script"><link rel="prefetch" href="/home/assets/index.html-f7bf900d.js" as="script"><link rel="prefetch" href="/home/assets/5.html-261d75f2.js" as="script"><link rel="prefetch" href="/home/assets/6.html-7467a581.js" as="script"><link rel="prefetch" href="/home/assets/7.html-2f941ffa.js" as="script"><link rel="prefetch" href="/home/assets/Mybatis.html-32309beb.js" as="script"><link rel="prefetch" href="/home/assets/index.html-7a6cdd72.js" as="script"><link rel="prefetch" href="/home/assets/Spring.html-8afd8941.js" as="script"><link rel="prefetch" href="/home/assets/SpringBoot.html-01ec84b8.js" as="script"><link rel="prefetch" href="/home/assets/SpringMVC.html-8c51d79a.js" as="script"><link rel="prefetch" href="/home/assets/1.html-9f2b5e63.js" as="script"><link rel="prefetch" href="/home/assets/2.html-5cb52557.js" as="script"><link rel="prefetch" href="/home/assets/3.html-f05ce608.js" as="script"><link rel="prefetch" href="/home/assets/4.html-96e0d492.js" as="script"><link rel="prefetch" href="/home/assets/5.html-a4ac77d8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-5ebb3440.js" as="script"><link rel="prefetch" href="/home/assets/index.html-84dea3e1.js" as="script"><link rel="prefetch" href="/home/assets/less.html-b82b04cd.js" as="script"><link rel="prefetch" href="/home/assets/sass.html-20a28c85.js" as="script"><link rel="prefetch" href="/home/assets/1.html-bdf0a190.js" as="script"><link rel="prefetch" href="/home/assets/2.html-9838b007.js" as="script"><link rel="prefetch" href="/home/assets/index.html-f782e23f.js" as="script"><link rel="prefetch" href="/home/assets/1.html-bf0fa88d.js" as="script"><link rel="prefetch" href="/home/assets/2.html-2694f748.js" as="script"><link rel="prefetch" href="/home/assets/index.html-df2fa358.js" as="script"><link rel="prefetch" href="/home/assets/1.html-c4479135.js" as="script"><link rel="prefetch" href="/home/assets/2.html-c2743141.js" as="script"><link rel="prefetch" href="/home/assets/3.html-e49d5463.js" as="script"><link rel="prefetch" href="/home/assets/4.html-a5bdd21e.js" as="script"><link rel="prefetch" href="/home/assets/5.html-c0b919d3.js" as="script"><link rel="prefetch" href="/home/assets/6.html-552f2b8e.js" as="script"><link rel="prefetch" href="/home/assets/7.html-f4bea3f6.js" as="script"><link rel="prefetch" href="/home/assets/8.html-085be1cc.js" as="script"><link rel="prefetch" href="/home/assets/9.html-1d405ddb.js" as="script"><link rel="prefetch" href="/home/assets/index.html-af707855.js" as="script"><link rel="prefetch" href="/home/assets/new.html-8355ebd5.js" as="script"><link rel="prefetch" href="/home/assets/1.html-c2fe5d34.js" as="script"><link rel="prefetch" href="/home/assets/index.html-f4f80248.js" as="script"><link rel="prefetch" href="/home/assets/index.html-45b3333b.js" as="script"><link rel="prefetch" href="/home/assets/uniTips.html-5252a24a.js" as="script"><link rel="prefetch" href="/home/assets/1.html-f8b2c9b7.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3e078204.js" as="script"><link rel="prefetch" href="/home/assets/index.html-c0f5844d.js" as="script"><link rel="prefetch" href="/home/assets/api_tutorial.html-16be2e2d.js" as="script"><link rel="prefetch" href="/home/assets/base_tutorial.html-1fcad9e2.js" as="script"><link rel="prefetch" href="/home/assets/pinia.html-0d0d0b2b.js" as="script"><link rel="prefetch" href="/home/assets/vue2.html-51c277ca.js" as="script"><link rel="prefetch" href="/home/assets/vue3_1.html-62a48870.js" as="script"><link rel="prefetch" href="/home/assets/vue3_2.html-13459311.js" as="script"><link rel="prefetch" href="/home/assets/1.html-26ef4515.js" as="script"><link rel="prefetch" href="/home/assets/index.html-578a6eb2.js" as="script"><link rel="prefetch" href="/home/assets/404.html-aeff193a.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/home/" class=""><!----><span class="site-name">不愿飞的蜂鸟首页</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/master/ubuntu/" class="" aria-label="Ubuntu"><!--[--><!--]--> Ubuntu <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/GNN/" class="" aria-label="GNN"><!--[--><!--]--> GNN <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/python/" class="" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/spring/" class="" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/jvm/" class="" aria-label="JVM"><!--[--><!--]--> JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/redis/" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/juc" class="" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/netty" class="" aria-label="Netty"><!--[--><!--]--> Netty <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/security" class="" aria-label="Security"><!--[--><!--]--> Security <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>foreground</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/js/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/typescript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/html_css/" class="" aria-label="HTML_CSS"><!--[--><!--]--> HTML_CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/less_sass/" class="" aria-label="Less_Sass"><!--[--><!--]--> Less_Sass <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/react/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>background</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/java/" class="" aria-label="JAVA"><!--[--><!--]--> JAVA <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>app.mp</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/miniProgram/" class="" aria-label="MiniProgram"><!--[--><!--]--> MiniProgram <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/uni-app/" class="router-link-active" aria-label="uni-app"><!--[--><!--]--> uni-app <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>server</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/centos/" class="" aria-label="Centos"><!--[--><!--]--> Centos <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/course/operating_system/" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/computer_network/" class="" aria-label="计算机网络技术"><!--[--><!--]--> 计算机网络技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/datastructure_and_algorithm/" class="" aria-label="数据结构和算法"><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/liushun-ing" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/master/ubuntu/" class="" aria-label="Ubuntu"><!--[--><!--]--> Ubuntu <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/GNN/" class="" aria-label="GNN"><!--[--><!--]--> GNN <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/python/" class="" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/spring/" class="" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/jvm/" class="" aria-label="JVM"><!--[--><!--]--> JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/redis/" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/juc" class="" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/netty" class="" aria-label="Netty"><!--[--><!--]--> Netty <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/master/security" class="" aria-label="Security"><!--[--><!--]--> Security <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>foreground</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/js/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/typescript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/html_css/" class="" aria-label="HTML_CSS"><!--[--><!--]--> HTML_CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/less_sass/" class="" aria-label="Less_Sass"><!--[--><!--]--> Less_Sass <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/react/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>background</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/java/" class="" aria-label="JAVA"><!--[--><!--]--> JAVA <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>app.mp</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/miniProgram/" class="" aria-label="MiniProgram"><!--[--><!--]--> MiniProgram <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/uni-app/" class="router-link-active" aria-label="uni-app"><!--[--><!--]--> uni-app <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>server</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/centos/" class="" aria-label="Centos"><!--[--><!--]--> Centos <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/course/operating_system/" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/computer_network/" class="" aria-label="计算机网络技术"><!--[--><!--]--> 计算机网络技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/datastructure_and_algorithm/" class="" aria-label="数据结构和算法"><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/liushun-ing" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">uni-app <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/home/tech/uni-app/" class="router-link-active sidebar-item" aria-label="Navigation"><!--[--><!--]--> Navigation <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="UniCloud使用"><!--[--><!--]--> UniCloud使用 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_1-引言" class="router-link-active router-link-exact-active sidebar-item" aria-label="1 引言"><!--[--><!--]--> 1 引言 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_1-1-什么是unicloud" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1 什么是UniCloud"><!--[--><!--]--> 1.1 什么是UniCloud <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_1-2-什么是serverless" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2 什么是serverless"><!--[--><!--]--> 1.2 什么是serverless <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_2-基本概念" class="router-link-active router-link-exact-active sidebar-item" aria-label="2 基本概念"><!--[--><!--]--> 2 基本概念 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_2-1-服务空间" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1 服务空间"><!--[--><!--]--> 2.1 服务空间 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_2-2-数据库" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2 数据库"><!--[--><!--]--> 2.2 数据库 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_2-3-云函数-云对象" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3 云函数/云对象"><!--[--><!--]--> 2.3 云函数/云对象 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_3-云函数-云对象" class="router-link-active router-link-exact-active sidebar-item" aria-label="3 云函数/云对象"><!--[--><!--]--> 3 云函数/云对象 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_3-1-简介" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1 简介"><!--[--><!--]--> 3.1 简介 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_3-2-普通云函数创建使用" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2 普通云函数创建使用"><!--[--><!--]--> 3.2 普通云函数创建使用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_3-3-云对象" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3 云对象"><!--[--><!--]--> 3.3 云对象 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_4-云数据库" class="router-link-active router-link-exact-active sidebar-item" aria-label="4 云数据库"><!--[--><!--]--> 4 云数据库 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_4-1-基础概念" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1 基础概念"><!--[--><!--]--> 4.1 基础概念 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_4-2-数据表的3个组成部分" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2 数据表的3个组成部分"><!--[--><!--]--> 4.2 数据表的3个组成部分 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_4-3-传统api操作数据库" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3 传统api操作数据库"><!--[--><!--]--> 4.3 传统api操作数据库 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_4-4-db-schema" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4 DB Schema"><!--[--><!--]--> 4.4 DB Schema <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_5-云存储" class="router-link-active router-link-exact-active sidebar-item" aria-label="5 云存储"><!--[--><!--]--> 5 云存储 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_5-1-概述" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1 概述"><!--[--><!--]--> 5.1 概述 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_5-2-客户端api" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2 客户端API"><!--[--><!--]--> 5.2 客户端API <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/tech/uni-app/uniCloud.html#_5-3-云函数api" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3 云函数API"><!--[--><!--]--> 5.3 云函数API <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/home/tech/uni-app/uniTips.html" class="sidebar-item" aria-label="uniapp开发tips"><!--[--><!--]--> uniapp开发tips <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="unicloud使用" tabindex="-1"><a class="header-anchor" href="#unicloud使用" aria-hidden="true">#</a> UniCloud使用</h1><h2 id="_1-引言" tabindex="-1"><a class="header-anchor" href="#_1-引言" aria-hidden="true">#</a> 1 引言</h2><h3 id="_1-1-什么是unicloud" tabindex="-1"><a class="header-anchor" href="#_1-1-什么是unicloud" aria-hidden="true">#</a> 1.1 什么是UniCloud</h3><p><code>uniCloud</code> 是 DCloud 联合阿里云、腾讯云，为开发者提供的基于 serverless 模式和 js 编程的云开发平台。</p><p><code>uniCloud</code>是DCloud在阿里云和腾讯云的serverless服务上封装而成的。</p><p>它包含IaaS层（由阿里云和腾讯云提供硬件和网络）和PaaS层（由DCloud提供开发环境）。</p><p>开发者可以自主选择uniCloud的硬件和网络资源的供应商，在阿里云版和腾讯云版之间切换。</p><h3 id="_1-2-什么是serverless" tabindex="-1"><a class="header-anchor" href="#_1-2-什么是serverless" aria-hidden="true">#</a> 1.2 什么是serverless</h3><p>serverless是目前很火的概念，它是下一代云技术，是真正的“云”。</p><p>传统的云服务，让开发者免于购买实体服务器硬件，改为购买虚拟机。但开发者仍然要自己装操作系统、web服务器、数据库，自己处理热备，自己新购服务器来应对高并发，自己抗DDOS攻击...这不是成熟的“云”！</p><p>真正的云计算，就像用水用电，没有复杂的门槛，即用即有、按需付费。serverless的云，真正的把计算、存储的能力进行了云化，开发者只需要按量租用这些计算和存储能力，再也不用关心扩容和攻击。开发者不再有“服务器”的概念，因为没有一台具体的机器。</p><p>当用户量激增时，开发者什么都不用做，系统自动承载更高并发。开发者只需要按照对资源的消耗付费即可。同理，如果没有用户使用，即没有资源消耗，则根本无需为云资源付费。云端庞大的serverless资源池，有无数个node进程待命。当手机用户发起请求时，serverless系统会调配闲置的资源来运行开发者相应的云函数。</p><p>serverless在国外兴起，但国内的发展速度已经超过了国外。微信、支付宝、百度、抖音、快应用联盟都上线了自己的serverless云开发。目前国内已经有超过60万开发者在使用serverless云开发，包括腾讯、阿里、DCloud的很多自有业务都在使用。</p><h2 id="_2-基本概念" tabindex="-1"><a class="header-anchor" href="#_2-基本概念" aria-hidden="true">#</a> 2 基本概念</h2><h3 id="_2-1-服务空间" tabindex="-1"><a class="header-anchor" href="#_2-1-服务空间" aria-hidden="true">#</a> 2.1 服务空间</h3><p>一个服务空间对应一整套独立的云开发资源，包括数据库、存储空间、云函数等资源。服务空间之间彼此隔离。</p><p>每个服务空间都有一个全局唯一的space ID。</p><p>创建服务空间后，在同样的 <code>uniCloud</code> 目录右键菜单中关联该服务空间。只有项目关联好服务空间后，才能上传云函数、操作服务空间下的数据库、存储等资源。</p><blockquote><p>应用和服务空间的关系</p></blockquote><p>每个uni-app应用都有一个appid，每个服务空间都有一个spaceid。</p><p>服务空间和手机端项目是多对多绑定关系。同DCloud账号下，一个应用可以关联到多个服务空间。一个服务空间也可以被多个项目访问。</p><h3 id="_2-2-数据库" tabindex="-1"><a class="header-anchor" href="#_2-2-数据库" aria-hidden="true">#</a> 2.2 数据库</h3><p><code>uniCloud</code> 提供了 2 个 nosql 数据库。</p><ul><li><p>JSON文档型云数据库</p><p>uniCloud阿里云版的云数据库就是 MongoDB 的 serverless版；uniCloud腾讯云版的云数据库是兼容 MongoDB 的自研数据库。</p><p>数据库中的每条记录都是一个 JSON 格式的对象。一个数据库可以有多个集合（相当于关系型数据中的表），集合可看做一个 JSON 数组，数组中的每个对象就是一条记录，记录的格式是 JSON 对象。</p></li><li><p>redis 数据库</p><p>redis 是一种可以运行在内存中的键值对数据库，它的能力没有MongoDB强大，但由于可运行在内存中，它的性能远超常规数据库。redis 也使用 json 方式 key/value 键值对存储数据。</p></li></ul><p>如果开发者需要其他数据库，比如 mysql、ElasticSearch、数据湖，这些数据库没有在uniCloud的服务空间内置，云函数中通过 nodejs 的 api 可以访问这些远程数据库。</p><h3 id="_2-3-云函数-云对象" tabindex="-1"><a class="header-anchor" href="#_2-3-云函数-云对象" aria-hidden="true">#</a> 2.3 云函数/云对象</h3><p>云函数即在云端（服务器端）运行的函数。从 HBuilderX 3.4起，新增了云函数的扩展版，云对象。</p><p>开发者无需购买、搭建服务器，只需编写代码并部署到云端即可在客户端（App/Web/小程序等）调用，同时云函数之间也可互相调用。</p><p>一个云函数的写法与一个在本地定义的 <code>JavaScript</code> 方法无异，代码运行在云端 <code>Node.js</code> 中。当云函数被客户端调用时，定义的代码会被放在 <code>Node.js</code> 运行环境中执行。</p><p>开发者可以如在 <code>Node.js</code> 环境中使用 <code>JavaScript</code> 一样在云函数中进行网络请求等操作，也可以使用 node_modules。 DCloud提供了 uniCloud对象内置在云函数/云对象中</p><p>云对象本质是对云函数的一种封装，可以对象化的方式使用云服务。</p><h2 id="_3-云函数-云对象" tabindex="-1"><a class="header-anchor" href="#_3-云函数-云对象" aria-hidden="true">#</a> 3 云函数/云对象</h2><h3 id="_3-1-简介" tabindex="-1"><a class="header-anchor" href="#_3-1-简介" aria-hidden="true">#</a> 3.1 简介</h3><blockquote><p>介绍</p></blockquote><p>云函数是运行在云端的 <code>JavaScript</code> 代码，是基于 <code>Node.js</code> 的扩展。</p><p>在常规的 <code>Node API</code> 基础上，uniCloud的云函数环境内置了<code>uniCloud</code>对象，这个对象内置了网络、数据库等各种API。每个云函数是一个js包，在云函数被调用时，由 serverless 调度系统分配硬件资源启动一个 node 环境来运行这个云函数。</p><p>每个云函数是一个目录，其中普通云函数有<code>index.js</code>入口文件，云对象的入口文件则是<code>index.obj.js</code>。云函数的配置文件和 npm规范相同，在云函数目录下可新建一个 package.json 来存放配置。uniCloud云函数扩展了 package.json，增加了一些特有的配置项。</p><p>云函数启动后实例会保留一段时间（如15分钟），超过保留期后若该云函数一直没有被再调用，那这个实例会被释放。所以云函数有<strong>冷启动</strong>的概念。不过由于js实例的启动要比php和java更快，所以js更适合serverless方式。</p><p>HBuilderX中uniCloud项目的云函数均在项目的<code>uniCloud/cloudfunctions</code>目录下，目录结构如下：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>|——— cloudfunctions               云函数目录
|   │───common                    云函数公用模块目录 详情
|   |   └──hello-common           云函数公用模块
|   |      │──index.js            公用模块代码
|   |      └──package.json        公用模块package.json
|   │───uni-clientDB-actions      （推荐用数据库触发器替代action云函数）
|   │      └──new_action.js       clientDB action代码 详情
|   │───function-name             云函数目录
|   │     │──index.js             云函数代码
|   │     └──package.json         包含云函数的配置信息，如url化、定时设置、可用内存等内容 详情
|   └───object-name               云对象目录
|         │──index.obj.js         云对象代码
|         └──package.json         包含云对象的配置信息，可用内存等内容 详情
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>uniCloud响应体规范</p></blockquote><p><code>uniCloud响应体规范</code>（uniCloud response format），是DCloud制定的、服务器给客户端返回json数据的一种建议格式。云对象、clientDB、uni-id公共模块均支持此规范。</p><p><strong>由来</strong></p><p>uniCloud服务器给客户端返回的数据格式一般是json，但json的格式具体是什么没有约定。比如返回错误码，是叫<code>code</code>还是叫<code>errCode</code>？错误内容是<code>message</code>还是<code>errMsg</code>？内容的国际化如何处理？如果没有一套统一的格式，在客户端将无法编写有效的网络拦截器，无法统一处理错误。另外，如果不同的插件，云端返回的数据格式千差万别，那使用者整合这些插件也会非常麻烦。国际化更无法落地。</p><p>为此DCloud推出了<code>uniCloud响应体规范</code>。为了与uni-app前端的API错误回调风格统一，uniCloud响应体规范定义的云端返回信息（尤其是报错时）应包含<code>errCode</code>和<code>errMsg</code>。</p><ul><li>errCode</li></ul><p>errCode在成功时应返回数字<code>0</code>，失败时应返回一个以插件id开头的“字符串”，每个单词以连字符（<code>-</code>）分割。做出这样的规定是为了防止不同插件之间出现重复错误码。以<code>&#39;uni-id-account-banned&#39;</code>错误码为例，<code>uni-id</code>为插件id，<code>account-banned</code>为错误缩写。</p><ul><li>errMsg</li></ul><p>errMsg用于存放具体错误信息，包括展示给开发者、终端用户的错误信息</p><p>HBuilderX内使用代码块<code>returnu</code>可以快速输入以下代码（<code>HBuilderX 3.4.0</code>及以上版本）:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">return</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">errSubject</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// HBuilderX 3.6.10新增 统一错误主题（模块）名称，字符串类型，存在多级模块时使用&quot;::&quot;分割，即&quot;模块名称::二级模块名称&quot;</span>
	<span class="token literal-property property">errCode</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
	<span class="token literal-property property">errMsg</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-普通云函数创建使用" tabindex="-1"><a class="header-anchor" href="#_3-2-普通云函数创建使用" aria-hidden="true">#</a> 3.2 普通云函数创建使用</h3><p>callFunction方式云函数，也称之为普通云函数。</p><p>uni-app的前端代码，不再执行<code>uni.request</code>联网，而是通过<code>uniCloud.callFunction</code>调用云函数。</p><p>callFunction方式避免了服务器提供域名，不暴露固定ip，减少被攻击的风险。</p><p><code>uniCloud.callFunction</code>可以在uni-app前端执行，也可以在uniCloud云函数中执行。也就是前端和云端都可以调用另一个云函数。</p><p>客户端callFunction调用云函数时，云函数通过入参接收客户端数据，通过头信息上下文获取客户端信息，经过业务逻辑处理后给客户端返回结果。</p><p>假使客户端代码调用云函数<code>hellocf</code>，并传递了<code>{a:1,b:2}</code>的数据，</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 客户端调用云函数并传递参数</span>
uniCloud<span class="token punctuation">.</span><span class="token function">callFunction</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;hellocf&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">a</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">b</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>那么云函数侧的代码如下，将传入的两个参数求和并返回客户端，普通云函数返回给客户端的是json格式数据。返回结果包裹在<strong>result</strong>下。：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// hellocf云函数index.js入口文件代码</span>
<span class="token string">&#39;use strict&#39;</span><span class="token punctuation">;</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">main</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">//event为客户端上传的参数</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;event : &#39;</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>event<span class="token punctuation">.</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">errCode</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">errMsg</span> <span class="token operator">:</span> <span class="token string">&quot;参数a不能为空&quot;</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>event<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">errCode</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token literal-property property">errMsg</span> <span class="token operator">:</span> <span class="token string">&quot;参数b不能为空&quot;</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">const</span> c <span class="token operator">=</span> event<span class="token punctuation">.</span>a <span class="token operator">+</span> event<span class="token punctuation">.</span>b
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">errCode</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token literal-property property">errMsg</span> <span class="token operator">:</span> <span class="token string">&quot;参数a和b无法求和&quot;</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//返回数据给客户端</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token literal-property property">sum</span><span class="token operator">:</span>c<span class="token punctuation">,</span><span class="token literal-property property">errCode</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">errMsg</span> <span class="token operator">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 返回结果如下</span>
<span class="token comment">/*
{
	&quot;errCode&quot;: 0,
	&quot;errMsg&quot;: &quot;&quot;,
	&quot;header&quot;: {
		&quot;access-control-expose-headers&quot;: &quot;Date,x-fc-request-id,x-fc-error-type,x-fc-code-checksum,x-fc-invocation-duration,x-fc-max-memory-usage,x-fc-log-result,x-fc-invocation-code-version&quot;
		&quot;content-disposition&quot;: &quot;attachment&quot;
		&quot;content-length&quot;: &quot;38&quot;
		&quot;content-type&quot;: &quot;application/json&quot;
		&quot;date&quot;: &quot;Sat, 25 Jun 2022 19:28:34 GMT&quot;
		&quot;x-fc-code-checksum&quot;: &quot;92066386860027743&quot;
		&quot;x-fc-instance-id&quot;: &quot;c-62b761c4-5a85e238b3ce404c817d&quot;
		&quot;x-fc-invocation-duration&quot;: &quot;23&quot;
		&quot;x-fc-invocation-service-version&quot;: &quot;LATEST&quot;
		&quot;x-fc-max-memory-usage&quot;: &quot;66.61&quot;
		&quot;x-fc-request-id&quot;: &quot;80854b93-b0c7-43ab-ab16-9ee9f77ff41e&quot;
		&quot;x-serverless-request-id&quot;: &quot;ac1403831656185314624173902&quot;
		&quot;x-serverless-runtime-version&quot;: &quot;1.2.2&quot;
	}
	&quot;requestId&quot;: &quot;ac1403831656185314624173902&quot;
	&quot;result&quot;: {sum: 3}
	&quot;success&quot;: true
}
其中result是开发者云函数代码返回的数据，其余是云平台返回的。
注意：HBuilderX本地运行云函数时，如果没有系统错误，则只返回result，其他需要在云端运行云函数才会返回。
errCode为0时，success也是true。
	表示云函数在系统层面没有运行错误。可以正常返回result。前端callFunction会进入success回调
	如果开发者的业务有报错，可以在 result 里返回 errCode 和 errMsg。
errCode不为0时，success为false。
	表示云函数在系统层面报错了，比如联网失败、云函数超时、内存超限等错误。前端callFunction会进入fail回调
	发生系统错误时 result 里无法正常返回业务错误。errCode不为0时，还会返回errMsg。
requestId是云函数的请求id，线上运行时，可以在uniCloud web控制台的云函数日志中查看运行日志。
header是云厂商的一些信息，阿里云和腾讯云不同，上面示例代码是阿里云的header。
*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>云函数的传入参数有两个，一个是<code>event</code>对象，一个是<code>context</code>对象。</p><ul><li><code>event</code>指的是触发云函数的事件。当客户端调用云函数时，<code>event</code>就是客户端调用云函数时传入的参数。</li><li><code>context</code> 对象包含了本次请求的上下文，包括客户端的ip、ua、appId等信息，以及云函数的环境情况、调用来源source等信息。</li></ul><h3 id="_3-3-云对象" tabindex="-1"><a class="header-anchor" href="#_3-3-云对象" aria-hidden="true">#</a> 3.3 云对象</h3><h4 id="_3-3-1-背景和优势" tabindex="-1"><a class="header-anchor" href="#_3-3-1-背景和优势" aria-hidden="true">#</a> 3.3.1 背景和优势</h4><p>20年前，restful接口开发开始流行，服务器编写接口，客户端调用接口，传输json。</p><p>现在，替代restful的新模式来了。云对象，服务器编写API，客户端调用API，不再开发传输json的接口。思路更清晰、代码更精简。</p><h4 id="_3-3-2-示例" tabindex="-1"><a class="header-anchor" href="#_3-3-2-示例" aria-hidden="true">#</a> 3.3.2 示例</h4><p>比如服务端编写一个云对象todo，该对象有add、get、remove、update等方法。客户端的js则可以直接import这个todo云对象，直接调用add等方法。</p><p>服务器示例代码如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 云对象名：todo</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">title<span class="token punctuation">,</span> content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		title <span class="token operator">=</span> title<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		content <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>title <span class="token operator">||</span> <span class="token operator">!</span>content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">{</span>
				<span class="token literal-property property">errCode</span><span class="token operator">:</span> <span class="token string">&#39;INVALID_TODO&#39;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">errMsg</span><span class="token operator">:</span> <span class="token string">&#39;TODO标题或内容不可为空&#39;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// ...其他逻辑</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">errCode</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
			<span class="token literal-property property">errMsg</span><span class="token operator">:</span> <span class="token string">&#39;创建成功&#39;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后在客户端的js中，import这个todo对象，调用它的add方法</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> todo <span class="token operator">=</span> uniCloud<span class="token punctuation">.</span><span class="token function">importObject</span><span class="token punctuation">(</span><span class="token string">&#39;todo&#39;</span><span class="token punctuation">)</span> <span class="token comment">//第一步导入云对象</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">addTodo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> todo<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#39;title demo&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;content demo&#39;</span><span class="token punctuation">)</span> <span class="token comment">//导入云对象后就可以直接调用该对象的方法了，注意使用异步await</span>
		uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;创建成功&#39;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 符合uniCloud响应体规范，自动抛出此错误 </span>
		uni<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			<span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;创建失败&#39;</span><span class="token punctuation">,</span>
			<span class="token literal-property property">content</span><span class="token operator">:</span> e<span class="token punctuation">.</span>errMsg<span class="token punctuation">,</span>
			<span class="token literal-property property">showCancel</span><span class="token operator">:</span> <span class="token boolean">false</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>总结下云对象带来的好处：</p><ol><li>更清晰的逻辑</li><li>更精简的代码</li><li>更少的协作成本（以及矛盾~）</li><li>客户端调用时在ide里有完善的代码提示，方法参数均可提示。（传输json可没法在ide里提示）</li><li>默认支持<a href="https://uniapp.dcloud.net.cn/uniCloud/cf-functions#resformat" target="_blank" rel="noopener noreferrer">uniCloud响应体规范<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，方便错误拦截和统一处理</li></ol><h4 id="_3-3-3-客户端调用" tabindex="-1"><a class="header-anchor" href="#_3-3-3-客户端调用" aria-hidden="true">#</a> 3.3.3 客户端调用</h4><p>客户端通过<code>uniCloud.importObject</code>方法获取云对象的实例，并可以通过此实例调用云对象内的方法。用法如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> todo <span class="token operator">=</span> uniCloud<span class="token punctuation">.</span><span class="token function">importObject</span><span class="token punctuation">(</span><span class="token string">&#39;todo&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> todo<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#39;title demo&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;content demo&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>通过代码块<code>cco</code>可以快捷的输入以下代码：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> todo <span class="token operator">=</span> uniCloud<span class="token punctuation">.</span><span class="token function">importObject</span><span class="token punctuation">(</span><span class="token string">&#39;todo&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>实际业务中需要考虑错误捕获，调用方式有两种：</p><ol><li>try catch</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> todo <span class="token operator">=</span> uniCloud<span class="token punctuation">.</span><span class="token function">importObject</span><span class="token punctuation">(</span><span class="token string">&#39;todo&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> todo<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#39;title demo&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;content demo&#39;</span><span class="token punctuation">)</span> <span class="token comment">//导入云对象后就可以直接调用该对象的方法了，注意使用异步await</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>errCode<span class="token punctuation">)</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>then catch(promise写法)</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> todo <span class="token operator">=</span> uniCloud<span class="token punctuation">.</span><span class="token function">importObject</span><span class="token punctuation">(</span><span class="token string">&#39;todo&#39;</span><span class="token punctuation">)</span>
todo<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#39;title demo&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;content demo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>errCode<span class="token punctuation">)</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-云数据库" tabindex="-1"><a class="header-anchor" href="#_4-云数据库" aria-hidden="true">#</a> 4 云数据库</h2><h3 id="_4-1-基础概念" tabindex="-1"><a class="header-anchor" href="#_4-1-基础概念" aria-hidden="true">#</a> 4.1 基础概念</h3><p><code>uniCloud</code>提供了一个 JSON 格式的文档型数据库。顾名思义，数据库中的每条记录都是一个 JSON 格式的文档。</p><p>它是 nosql 非关系型数据库，如果您之前熟悉 sql 关系型数据库，那么两者概念对应关系如下表：</p><table><thead><tr><th style="text-align:left;">关系型</th><th style="text-align:left;">JSON 文档型</th></tr></thead><tbody><tr><td style="text-align:left;">数据库 database</td><td style="text-align:left;">数据库 database</td></tr><tr><td style="text-align:left;">表 table</td><td style="text-align:left;">集合 collection。但行业里也经常称之为“表”。无需特意区分</td></tr><tr><td style="text-align:left;">行 row</td><td style="text-align:left;">记录 record / doc</td></tr><tr><td style="text-align:left;">字段 column / field</td><td style="text-align:left;">字段 field</td></tr><tr><td style="text-align:left;">使用sql语法操作</td><td style="text-align:left;">使用MongoDB语法或jql语法操作</td></tr></tbody></table><ul><li>一个<code>uniCloud</code>服务空间，有且只有一个数据库；</li><li>一个数据库可以有多个表；</li><li>一个表可以有多个记录；</li><li>一个记录可以有多个字段。</li></ul><h3 id="_4-2-数据表的3个组成部分" tabindex="-1"><a class="header-anchor" href="#_4-2-数据表的3个组成部分" aria-hidden="true">#</a> 4.2 数据表的3个组成部分</h3><p>每个数据表，包含3个部分：</p><ul><li>data：数据内容</li><li>index：索引</li><li>schema：数据表格式定义</li></ul><p>在uniCloud的web控制台可以看到一个数据表的3部分内容。</p><h4 id="_4-2-1-data数据内容" tabindex="-1"><a class="header-anchor" href="#_4-2-1-data数据内容" aria-hidden="true">#</a> 4.2.1 data数据内容</h4><p>data，就是存放的数据记录(record)。里面是一条一条的json文档。</p><p>record可以增删改查、排序统计。如输入一个json</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;birth_year&quot;</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
    <span class="token property">&quot;tel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;13900000000&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zhangsan@zhangsan.com&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;intro&quot;</span><span class="token operator">:</span> <span class="token string">&quot;擅于学习，做事严谨&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建一条新记录，是不管在web控制台创建，还是通过API创建，每条记录都会自带一个<code>_id</code>字段用以作为该记录的唯一标志。</p><p><code>_id</code>字段是每个数据表默认自带且不可删除的字段。同时，它也是数据表的索引。</p><p>阿里云使用的是标准的mongoDB，<code>_id</code>是自增的，后创建的记录的<code>_id</code>总是大于先生成的<code>_id</code>。传统数据库的自然数自增字段在多物理机的大型数据库下很难保持同步，大型数据库均使用<code>_id</code>这种长度较长、不会重复且仍然保持自增规律的方式。腾讯云使用的是兼容mongoDB的自研数据库，<code>_id</code>并非自增。</p><p>插入/导入数据时也可以自行指定<code>_id</code>而不使用自动生成的<code>_id</code>，这样可以很方便的将其他数据库的数据迁移到uniCloud云数据库。</p><h4 id="_4-2-2-index数据库索引" tabindex="-1"><a class="header-anchor" href="#_4-2-2-index数据库索引" aria-hidden="true">#</a> 4.2.2 index数据库索引</h4><p>所谓索引，是指在数据表的众多字段中挑选一个或多个字段，让数据库引擎优先处理这些字段。</p><p>设置为索引的字段，在通过该字段查询(where)或排序(orderBy)时可以获得更快的查询速度。</p><p>但设置过多索引也不合适，会造成数据新增和删除变慢。新建的表，默认只有一个索引<code>_id</code>。</p><p>索引分唯一型和非唯一型。</p><ul><li><p>唯一型索引要求整个数据表多个记录的该字段的值不能重复。比如<code>_id</code>就是唯一型索引。</p></li><li><p>如果我们要根据name字段来查询，为了提升查询速度，此时可以把name字段设为非唯一索引。</p></li></ul><p><strong>注意</strong></p><ul><li>如果记录中已经存在多个记录某字段相同的情况，那么将该字段设为唯一型索引会失败。</li><li>如果已经设置某字段为唯一索引，在新增和修改记录时如果该字段的值之前在其他记录已存在，会失败。</li><li>假如记录中不存在某个字段，则对索引字段来说其值默认为 null，如果该索引字段设为唯一型索引，则不允许存在两个或以上的该字段为null或不存在该字段的记录。</li></ul><h4 id="_4-2-3-schema数据表格式定义" tabindex="-1"><a class="header-anchor" href="#_4-2-3-schema数据表格式定义" aria-hidden="true">#</a> 4.2.3 schema数据表格式定义</h4><p><code>DB Schema</code>是表结构描述。描述数据表有哪些字段、值域类型是什么、是否必填、数据操作权限等很多内容。</p><p>因为 MongoDB 的灵活性，理论上<code>DB Schema</code>不是必须的，使用传统 MongoDB API 操作数据库不需要<code>DB Schema</code>。但如果使用 JQL，那<code>DB Schema</code>就是必须的。</p><h3 id="_4-3-传统api操作数据库" tabindex="-1"><a class="header-anchor" href="#_4-3-传统api操作数据库" aria-hidden="true">#</a> 4.3 传统api操作数据库</h3><h4 id="_4-3-1-获取集合的引用" tabindex="-1"><a class="header-anchor" href="#_4-3-1-获取集合的引用" aria-hidden="true">#</a> 4.3.1 获取集合的引用</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> db <span class="token operator">=</span> uniCloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取 `user` 集合的引用</span>
<span class="token keyword">const</span> collection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>集合 Collection</p></blockquote><p>通过 <code>db.collection(name)</code> 可以获取指定集合的引用，在集合上可以进行以下操作</p><table><thead><tr><th>类型</th><th>接口</th><th>说明</th></tr></thead><tbody><tr><td>写</td><td>add</td><td>新增记录（触发请求）</td></tr><tr><td>计数</td><td>count</td><td>获取符合条件的记录条数</td></tr><tr><td>读</td><td>get</td><td>获取集合中的记录，如果有使用 where 语句定义查询条件，则会返回匹配结果集 (触发请求)</td></tr><tr><td>引用</td><td>doc</td><td>获取对该集合中指定 id 的记录的引用</td></tr><tr><td>查询条件</td><td>where</td><td>通过指定条件筛选出匹配的记录，可搭配查询指令（eq, gt, in, ...）使用</td></tr><tr><td></td><td>skip</td><td>跳过指定数量的文档，常用于分页，传入 offset</td></tr><tr><td></td><td>orderBy</td><td>排序方式</td></tr><tr><td></td><td>limit</td><td>返回的结果集(文档数量)的限制，有默认值和上限值</td></tr><tr><td></td><td>field</td><td>指定需要返回的字段</td></tr></tbody></table><p>查询及更新指令用于在 <code>where</code> 中指定字段需满足的条件，指令可通过 <code>db.command</code> 对象取得。</p><ol><li>查询筛选指令 Query Command，以下指令挂载在 <code>db.command</code> 下</li></ol><table><thead><tr><th>类型</th><th>接口</th><th>说明</th></tr></thead><tbody><tr><td>比较运算</td><td>eq</td><td>字段等于 ==</td></tr><tr><td></td><td>neq</td><td>字段不等于 !=</td></tr><tr><td></td><td>gt</td><td>字段大于 &gt;</td></tr><tr><td></td><td>gte</td><td>字段大于等于 &gt;=</td></tr><tr><td></td><td>lt</td><td>字段小于 &lt;</td></tr><tr><td></td><td>lte</td><td>字段小于等于 &lt;=</td></tr><tr><td></td><td>in</td><td>字段值在数组里</td></tr><tr><td></td><td>nin</td><td>字段值不在数组里</td></tr><tr><td>逻辑运算</td><td>and</td><td>表示需同时满足指定的所有条件</td></tr><tr><td></td><td>or</td><td>表示需同时满足指定条件中的至少一个</td></tr></tbody></table><ol><li>字段更新指令 Update Command，以下指令挂载在 <code>db.command</code> 下</li></ol><table><thead><tr><th>类型</th><th>接口</th><th>说明</th></tr></thead><tbody><tr><td>字段</td><td>set</td><td>设置字段值</td></tr><tr><td></td><td>remove</td><td>删除字段</td></tr><tr><td></td><td>inc</td><td>加一个数值，原子自增</td></tr><tr><td></td><td>mul</td><td>乘一个数值，原子自乘</td></tr><tr><td></td><td>push</td><td>数组类型字段追加尾元素，支持数组</td></tr><tr><td></td><td>pop</td><td>数组类型字段删除尾元素，支持数组</td></tr><tr><td></td><td>shift</td><td>数组类型字段删除头元素，支持数组</td></tr><tr><td></td><td>unshift</td><td>数组类型字段追加头元素，支持数组</td></tr></tbody></table><blockquote><p>记录 Record / Document</p></blockquote><p>通过 <code>db.collection(collectionName).doc(docId)</code> 可以获取指定集合上指定 _id 的记录的引用，在记录上可以进行以下操作</p><table><thead><tr><th>接口</th><th>说明</th><th></th></tr></thead><tbody><tr><td>写</td><td>update</td><td>局部更新记录(触发请求)只更新传入的字段。如果被更新的记录不存在，会直接返回更新失败</td></tr><tr><td></td><td>set</td><td>覆写记录;会删除操作的记录中的所有字段，创建传入的字段。如果操作的记录不存在，会自动创建新的记录</td></tr><tr><td></td><td>remove</td><td>删除记录(触发请求)</td></tr><tr><td>读</td><td>get</td><td>获取记录(触发请求)</td></tr></tbody></table><p><strong>doc(docId)方法的参数只能是字符串，即数据库默认的<code>_id</code>字段。</strong></p><p>如需要匹配多个<code>_id</code>的记录，应使用where方法。可以在<code>where</code>方法里用<code>in</code>指令匹配一个包含<code>_id</code>的数组。</p><h4 id="_4-3-2-添加数据" tabindex="-1"><a class="header-anchor" href="#_4-3-2-添加数据" aria-hidden="true">#</a> 4.3.2 添加数据</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 单条插入数据</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Ben&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 批量插入数据</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Alex&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Ben&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;John&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>响应参数</p><p>单条插入时</p><table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>id</td><td>String</td><td>插入记录的id</td></tr></tbody></table><p>批量插入时</p><table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>ids</td><td>Array</td><td>批量插入所有记录的id</td></tr></tbody></table><h4 id="_4-3-3-获取数据" tabindex="-1"><a class="header-anchor" href="#_4-3-3-获取数据" aria-hidden="true">#</a> 4.3.3 获取数据</h4><blockquote><p>获取查询数量</p></blockquote><p><code>collection.count()</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;goods&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">category</span><span class="token operator">:</span> <span class="token string">&#39;computer&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">memory</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意：</strong></p><ul><li>数据量很大的情况下，带条件运算count全表的性能会很差，尽量使用其他方式替代，比如新增一个字段专门用来存放总数。不加条件时count全表不存在性能问题。</li></ul><blockquote><p>设置记录数量</p></blockquote><p><code>collection.limit()</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 只返回第一条记录</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>注意</strong></p><ul><li>limit不设置的情况下默认返回100条数据；设置limit有最大值，腾讯云限制为最大1000条，阿里云限制为最大500条。</li></ul><blockquote><p>设置起始位置</p></blockquote><p><code>collection.skip(value)</code></p><p>跳过指定的位置，从位置之后返回数据</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>对结果排序</p></blockquote><p><code>collection.orderBy(field, orderType)</code> 升序(asc) 或 降序(desc)</p><p>如果需要对嵌套字段排序，需要用 &quot;点表示法&quot; 连接嵌套字段，比如 style.color 表示字段 style 里的嵌套字段 color。</p><p>同时也支持按多个字段排序，多次调用 orderBy 即可，多字段排序时的顺序会按照 orderBy 调用顺序先后对多个字段排序</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;asc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>注意</strong></p><ul><li>排序字段存在多个重复的值时排序后的分页结果，可能会出现某条记录在上一页出现又在下一页出现的情况。这时候可以通过指定额外的排序条件比如<code>.orderBy(&quot;name&quot;, &quot;asc&quot;).orderBy(&quot;_id&quot;, &quot;asc&quot;)</code>来规避这种情况。</li></ul><blockquote><p>指定返回字段</p></blockquote><p><code>collection.field()</code></p><p>从查询结果中，过滤掉不需要的字段，或者指定要返回的字段。使用示例</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>collection<span class="token punctuation">.</span><span class="token function">field</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string-property property">&#39;age&#39;</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//只返回age字段、_id字段，其他字段不返回</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>注意</strong></p><ul><li>field内指定是否返回某字段时，不可混用true/false。即{&#39;a&#39;: true, &#39;b&#39;: false}是一种错误的参数格式</li><li>只有使用{ &#39;_id&#39;: false }明确指定不要返回_id时才会不返回_id字段，否则_id字段一定会返回</li></ul><blockquote><p>添加查询条件</p></blockquote><p><code>collection.where()</code></p><p>设置过滤条件，where 可接收对象作为参数，表示筛选出拥有和传入对象相同的 key-value 的文档。比如筛选出所有类型为计算机的、内存为 8g 的商品：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;goods&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">category</span><span class="token operator">:</span> <span class="token string">&#39;computer&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">memory</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果要表达更复杂的查询，可使用<strong>高级查询指令</strong>(见4.3.1)</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> dbCmd <span class="token operator">=</span> db<span class="token punctuation">.</span>command <span class="token comment">// 取指令</span>
db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;goods&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">category</span><span class="token operator">:</span> <span class="token string">&#39;computer&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">memory</span><span class="token operator">:</span> dbCmd<span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">and</span><span class="token punctuation">(</span>dbCmd<span class="token punctuation">.</span><span class="token function">lt</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 表示大于 4 小于32</span>
      <span class="token comment">// 或者 dbCmd.and(dbCmd.gt(4), dbCmd.lt(32))</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>where</code> 还可以使用正则表达式来查询文档，比如一下示例查询所有<code>name</code>字段以ABC开头的用户</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">&#39;^ABC&#39;</span><span class="token punctuation">)</span>  <span class="token comment">// 或者 /^ABC/</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>按照数组内的值查询</strong></p><p>mongoDB内按照数组内的值查询可以使用多种写法，以下面的数据为例</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">arr</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;item-1&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;item-2&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token punctuation">{</span>
  <span class="token literal-property property">arr</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;item-3&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;item-4&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果想查询arr内第一个元素的name为item-1的记录可以使用如下写法</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string-property property">&#39;arr.0.name&#39;</span><span class="token operator">:</span> <span class="token string">&#39;item-1&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

res <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">arr</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;item-1&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;item-2&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果想查询arr内某个元素的name为item-1的记录（可以是数组内的任意一条name为item-1）可以使用如下写法</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string-property property">&#39;arr.name&#39;</span><span class="token operator">:</span> <span class="token string">&#39;item-1&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

res <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">arr</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;item-1&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;item-2&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-4-删除数据" tabindex="-1"><a class="header-anchor" href="#_4-3-4-删除数据" aria-hidden="true">#</a> 4.3.4 删除数据</h4><p><strong>方式1 通过指定文档ID删除</strong></p><p><code>collection.doc(_id).remove()</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 清理全部数据</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
res<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">document</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>方式2 条件查找文档然后直接批量删除</strong></p><p><code>collection.where().remove()</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 删除字段a的值大于2的文档</span>
<span class="token keyword">const</span> dbCmd <span class="token operator">=</span> db<span class="token punctuation">.</span>command
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> dbCmd<span class="token punctuation">.</span><span class="token function">gt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 清理全部数据</span>
<span class="token keyword">const</span> dbCmd <span class="token operator">=</span> db<span class="token punctuation">.</span>command
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">_id</span><span class="token operator">:</span> dbCmd<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>响应参数</p><table><thead><tr><th>字段</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>deleted</td><td>Number</td><td>否</td><td>删除的记录数量</td></tr></tbody></table><h4 id="_4-3-5-更新数据" tabindex="-1"><a class="header-anchor" href="#_4-3-5-更新数据" aria-hidden="true">#</a> 4.3.5 更新数据</h4><blockquote><p>更新指定文档</p></blockquote><p><strong>使用腾讯云时更新方法必须搭配doc、where方法使用</strong></p><p><code>collection.doc().update(Object data)</code></p><p><strong>响应参数</strong></p><table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>updated</td><td>Number</td><td>更新成功条数，数据更新前后没变化时会返回0</td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span><span class="token string">&#39;doc-id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Hey&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fav</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// 更新前</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;doc-id&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;count&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;fav&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;follow&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 更新后</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;doc-id&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hey&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;count&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;fav&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;follow&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>更新数组时，已数组下标作为key即可，比如以下示例将数组arr内下标为1的值修改为 uniCloud</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span><span class="token string">&#39;doc-id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">arr</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token number">1</span><span class="token operator">:</span> <span class="token string">&quot;uniCloud&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// 更新前</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;doc-id&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;arr&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// 更新后</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;doc-id&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;arr&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;uniCloud&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>更新文档，如果不存在则创建</p></blockquote><p><code>collection.doc().set()</code>，没有写的字段都会删掉</p><p>**注意：**此方法会覆写已有字段，需注意与<code>update</code>表现不同，比如以下示例执行<code>set</code>之后<code>follow</code>字段会被删除</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span><span class="token string">&#39;doc-id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Hey&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fav</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// 更新前</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;doc-id&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;count&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;fav&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">&quot;follow&quot;</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 更新后</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;doc-id&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hey&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;count&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;fav&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>批量更新文档</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>collection<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> dbCmd <span class="token operator">=</span> db<span class="token punctuation">.</span>command
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> collection<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> dbCmd<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&#39;hey&#39;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>更新并返回更新后的数据</p></blockquote><p>此接口仅会操作一条数据，有多条数据匹配的情况下会只更新匹配的第一条并返回</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> db <span class="token operator">=</span> uniCloud<span class="token punctuation">.</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">uid</span><span class="token operator">:</span> <span class="token string">&#39;1&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateAndReturn</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">score</span><span class="token operator">:</span> db<span class="token punctuation">.</span>command<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 更新前</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;xx&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">uid</span><span class="token operator">:</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token comment">// 更新后</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;xx&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">uid</span><span class="token operator">:</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span>

<span class="token comment">// 接口返回值</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">updated</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">doc</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;xx&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uid</span><span class="token operator">:</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意</strong></p><ul><li>使用updateAndReturn时，不可使用field方法</li><li>可以在事务中使用，可以使用<code>transaction.where().updateAndReturn()</code>以及<code>transaction.doc().updateAndReturn()</code></li><li>不同于update接口，此接口返回的updated不表示数据真的进行了更新</li><li>腾讯云暂不支持<code>doc().updateAndReturn()</code>的写法可以使用<code>where().updateAndReturn()</code>替代</li></ul><blockquote><p>更新数组内指定下标的元素</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;query&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span><span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 更新students[1]</span>
  <span class="token punctuation">[</span><span class="token string">&#39;students.&#39;</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;wang&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 更新前</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;students&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zhang&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;li&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// 更新后</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;students&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zhang&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wang&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>更新数组内匹配条件的元素</p></blockquote><p><strong>注意：只可确定数组内只会被匹配到一个的时候使用</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;query&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token string-property property">&#39;students.id&#39;</span><span class="token operator">:</span> <span class="token string">&#39;001&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 将students内id为001的name改为li，$代表where内匹配到的数组项的序号</span>
	<span class="token string-property property">&#39;students.$.name&#39;</span><span class="token operator">:</span> <span class="token string">&#39;li&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 更新前</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;students&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;001&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;zhang&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;002&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wang&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// 更新后</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;students&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;001&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;li&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;002&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;wang&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>更新操作符</p></blockquote><ul><li><strong>set</strong></li></ul><p>更新指令。用于设定字段等于指定值。这种方法相比传入纯 JS 对象的好处是能够指定字段等于一个对象：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> dbCmd <span class="token operator">=</span> db<span class="token punctuation">.</span>command
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;photo&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span><span class="token string">&#39;doc-id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> dbCmd<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">fav</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">follow</span><span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>inc</strong></li></ul><p>更新指令。用于指示字段自增某个值，这是个原子操作</p><p>在文章阅读数+1、收藏+1等很多场景会用到它。如给收藏的商品数量加一：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> dbCmd <span class="token operator">=</span> db<span class="token punctuation">.</span>command

<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;my-doc-id&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fav</span><span class="token operator">:</span> dbCmd<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> dbCmd <span class="token operator">=</span> db<span class="token punctuation">.</span>command

<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;my-doc-id&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fav</span><span class="token operator">:</span> dbCmd<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>mul</strong></li></ul><p>更新指令。用于指示字段自乘某个值。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> dbCmd <span class="token operator">=</span> db<span class="token punctuation">.</span>command

<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;my-doc-id&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fav</span><span class="token operator">:</span> dbCmd<span class="token punctuation">.</span><span class="token function">mul</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> dbCmd <span class="token operator">=</span> db<span class="token punctuation">.</span>command

<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token string">&#39;my-doc-id&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fav</span><span class="token operator">:</span> dbCmd<span class="token punctuation">.</span><span class="token function">mul</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>remove</strong></li></ul><p>更新指令。用于表示删除某个字段。如某人删除了自己一条商品评价中的评分：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> dbCmd <span class="token operator">=</span> db<span class="token punctuation">.</span>command
<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;comments&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span><span class="token string">&#39;comment-id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">rating</span><span class="token operator">:</span> dbCmd<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>push</strong></li></ul><p>向数组尾部追加元素，支持传入单个元素或数组</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> dbCmd <span class="token operator">=</span> db<span class="token punctuation">.</span>command

<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;comments&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span><span class="token string">&#39;comment-id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// users: dbCmd.push(&#39;aaa&#39;)</span>
  <span class="token literal-property property">users</span><span class="token operator">:</span> dbCmd<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;c&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;d&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>pop</strong></li></ul><p>删除数组尾部元素</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> dbCmd <span class="token operator">=</span> db<span class="token punctuation">.</span>command

<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;comments&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span><span class="token string">&#39;comment-id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">users</span><span class="token operator">:</span> dbCmd<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>unshift</strong></li></ul><p>向数组头部添加元素，支持传入单个元素或数组。使用同push</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> dbCmd <span class="token operator">=</span> db<span class="token punctuation">.</span>command

<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;comments&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span><span class="token string">&#39;comment-id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// users: dbCmd.push(&#39;aaa&#39;)</span>
  <span class="token literal-property property">users</span><span class="token operator">:</span> dbCmd<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;c&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;d&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>shift</strong></li></ul><p>删除数组头部元素。使用同pop</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> dbCmd <span class="token operator">=</span> db<span class="token punctuation">.</span>command

<span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;comments&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span><span class="token string">&#39;comment-id&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">users</span><span class="token operator">:</span> dbCmd<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4-db-schema" tabindex="-1"><a class="header-anchor" href="#_4-4-db-schema" aria-hidden="true">#</a> 4.4 DB Schema</h3><h4 id="_4-4-1-db-schema概述" tabindex="-1"><a class="header-anchor" href="#_4-4-1-db-schema概述" aria-hidden="true">#</a> 4.4.1 DB Schema概述</h4><p><code>DB Schema</code>是基于 JSON 格式定义的数据结构的规范。</p><p>每张表/集合，都有一个表名.schema.json的文件，来描述表的信息、字段的信息。客户端访问数据库必须要有schema开通权限。</p><p><code>DB Schema</code>有很多重要的作用：</p><ul><li>描述数据表结构。一目了然的阅读每个表、每个字段的用途。</li><li>设置字段的默认值(defaultValue/forceDefaultValue)，比如服务器当前时间、当前用户id等。</li><li>设定字段值域能接受的格式(validator)，比如数字、字符串、布尔值，是否可为空，还可以指定的数据要求的正则格式，不符合的格式无法入库。</li><li>设定字段之间的约束关系(fieldRules)，比如字段结束时间需要晚于字段开始时间。</li><li>设定多个表的关联关系，字段间映射关系(foreignKey)，将多个表按一个虚拟联表直接查询，大幅简化联表查询。</li><li>设定数据操作权限(permission)。什么样的角色可以读/写哪些数据，都可以在这里配置。</li><li>根据schema自动生成前端界面（schema2code），包括列表、详情、新建和编辑页面，自动处理校验规则。</li></ul><p>简单示例如下，字段可设置的属性见<a href="https://uniapp.dcloud.net.cn/uniCloud/schema.html" target="_blank" rel="noopener noreferrer">官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;bsonType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 固定节点</span>
	<span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;表的描述&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;birth_year&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tel&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 必填字段</span>
	<span class="token property">&quot;permission&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
		<span class="token property">&quot;read&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 前端非admin的读取记录权限控制。默认值是false。true/false或者表达式</span>
		<span class="token property">&quot;create&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 前端非admin的新增记录权限控制。默认值false，true/false或者表达式</span>
		<span class="token property">&quot;update&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 前端非admin的更新记录权限控制。默认值false。true/false或者表达式</span>
		<span class="token property">&quot;delete&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 前端非admin的删除记录权限控制。默认值false。true/false或者表达式</span>
		<span class="token property">&quot;count&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 前端非admin的求数权限控制。默认值是true。true/false或者表达式</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 表的字段清单</span>
		<span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 字段名称，每个表都会带有_id字段</span>
			<span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ID，系统自动生成&quot;</span>
			<span class="token comment">// 这里还有很多字段属性可以设置</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;bsonType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;姓名&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;trim&quot;</span><span class="token operator">:</span> <span class="token string">&quot;both&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;minLength&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
			<span class="token property">&quot;maxLength&quot;</span><span class="token operator">:</span> <span class="token number">17</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;birth_year&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;bsonType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;int&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;出生年份&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;minimum&quot;</span><span class="token operator">:</span> <span class="token number">1950</span><span class="token punctuation">,</span>
			<span class="token property">&quot;maximum&quot;</span><span class="token operator">:</span> <span class="token number">2020</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;tel&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;bsonType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;手机号码&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;pattern&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^\\+?[0-9-]{3,20}$&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;trim&quot;</span><span class="token operator">:</span> <span class="token string">&quot;both&quot;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;email&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;bsonType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;format&quot;</span><span class="token operator">:</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;trim&quot;</span><span class="token operator">:</span> <span class="token string">&quot;both&quot;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;bsonType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;地址&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;city&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token property">&quot;city&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token property">&quot;bsonType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
					<span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;城市&quot;</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token property">&quot;street&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
					<span class="token property">&quot;bsonType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
					<span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;街道&quot;</span><span class="token punctuation">,</span>
					<span class="token property">&quot;trim&quot;</span><span class="token operator">:</span> <span class="token string">&quot;both&quot;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;intro&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
			<span class="token property">&quot;bsonType&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;简介&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;trim&quot;</span><span class="token operator">:</span> <span class="token string">&quot;both&quot;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;fieldRules&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
		<span class="token comment">// 字段之间的约束关系。比如字段开始时间小于字段结束时间。也可以只校验一个字段。支持表达式</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-云存储" tabindex="-1"><a class="header-anchor" href="#_5-云存储" aria-hidden="true">#</a> 5 云存储</h2><h3 id="_5-1-概述" tabindex="-1"><a class="header-anchor" href="#_5-1-概述" aria-hidden="true">#</a> 5.1 概述</h3><p>开发者使用<code>uniCloud</code>的云存储，无需再像传统模式那样单独去购买存储空间、CDN映射、流量采购等；</p><p>云存储的上传方式有3种：</p><ol><li>web界面：即在https://unicloud.dcloud.net.cn/ web控制台，点击云存储，通过web界面进行文件上传。该管理界面同时提供了资源浏览、删除等操作界面。</li><li>客户端API或组件上传：在前端js中编写<code>uniCloud.uploadFile</code>，或者使用uni ui的<a href="https://ext.dcloud.net.cn/plugin?id=4079" target="_blank" rel="noopener noreferrer">FilePicker组件<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，文件选择+上传均封装完毕。</li><li>云函数上传文件到云存储：即在云函数js中编写<code>uniCloud.uploadFile</code></li></ol><h3 id="_5-2-客户端api" tabindex="-1"><a class="header-anchor" href="#_5-2-客户端api" aria-hidden="true">#</a> 5.2 客户端API</h3><p>在uni-app前端进行云存储的操作（不是在云函数里操作），包括在前端上传、删除文件。</p><h4 id="_5-2-1-uploadfile" tabindex="-1"><a class="header-anchor" href="#_5-2-1-uploadfile" aria-hidden="true">#</a> 5.2.1 uploadFile</h4><p>直接上传文件到云存储。客户端上传文件到云函数、云函数再上传文件到云存储，这样的过程会导致文件流量带宽耗费较大。所以一般上传文件都是客户端直传。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//前端代码</span>
uni<span class="token punctuation">.</span><span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> filePath <span class="token operator">=</span> res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token comment">//进行上传操作</span>

      <span class="token comment">// promise方式</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> uniCloud<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">filePath</span><span class="token operator">:</span> filePath<span class="token punctuation">,</span>
        <span class="token literal-property property">cloudPath</span><span class="token operator">:</span> <span class="token string">&#39;a.jpg&#39;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">onUploadProgress</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">progressEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>progressEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> percentCompleted <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>
            <span class="token punctuation">(</span>progressEvent<span class="token punctuation">.</span>loaded <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> progressEvent<span class="token punctuation">.</span>total
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// callback方式，与promise方式二选一即可</span>
      uniCloud<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">filePath</span><span class="token operator">:</span> filePath<span class="token punctuation">,</span>
        <span class="token literal-property property">cloudPath</span><span class="token operator">:</span> <span class="token string">&#39;a.jpg&#39;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">onUploadProgress</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">progressEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>progressEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> percentCompleted <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>
            <span class="token punctuation">(</span>progressEvent<span class="token punctuation">.</span>loaded <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">/</span> progressEvent<span class="token punctuation">.</span>total
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>响应参数</p><table><thead><tr><th style="text-align:center;">字段</th><th style="text-align:center;">类型</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">fileID</td><td style="text-align:center;">String</td><td style="text-align:center;">文件唯一 ID，用来访问文件，建议存储起来</td></tr><tr><td style="text-align:center;">requestId</td><td style="text-align:center;">String</td><td style="text-align:center;">请求序列号，用于错误排查</td></tr></tbody></table><h4 id="_5-2-2-gettempfileurl" tabindex="-1"><a class="header-anchor" href="#_5-2-2-gettempfileurl" aria-hidden="true">#</a> 5.2.2 getTempFileURL</h4><p>在云函数中，把文件的fileid转换为临时URL。临时URL有有效期限制，避免其他人获取URL后可以持续访问该文件。</p><p><strong>响应参数</strong></p><table><thead><tr><th style="text-align:center;">字段</th><th style="text-align:center;">类型</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">fileList</td><td style="text-align:center;">Array&lt; Object &gt;</td><td style="text-align:center;">存储下载链接的数组</td></tr><tr><td style="text-align:center;">requestId</td><td style="text-align:center;">String</td><td style="text-align:center;">请求序列号，用于错误排查</td></tr></tbody></table><p><strong>响应参数中的fileList</strong></p><table><thead><tr><th style="text-align:center;">字段</th><th style="text-align:center;">类型</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">fileID</td><td style="text-align:center;">String</td><td style="text-align:center;">文件 ID</td></tr><tr><td style="text-align:center;">tempFileURL</td><td style="text-align:center;">String</td><td style="text-align:center;">文件访问链接</td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 客户端获取临时文件示例源码</span>
<span class="token comment">// promise方式</span>
uniCloud<span class="token punctuation">.</span><span class="token function">getTempFileURL</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token literal-property property">fileList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;cloud://test-28farb/a.png&#39;</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// callback方式，与promise方式二选一</span>
uniCloud<span class="token punctuation">.</span><span class="token function">getTempFileURL</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">fileList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;cloud://test-28farb/a.png&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-2-3-getfileinfo" tabindex="-1"><a class="header-anchor" href="#_5-2-3-getfileinfo" aria-hidden="true">#</a> 5.2.3 getFileInfo</h4><p><strong>响应参数</strong></p><table><thead><tr><th style="text-align:center;">字段</th><th style="text-align:center;">类型</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">fileList</td><td style="text-align:center;">Array&lt; Object &gt;</td><td style="text-align:center;">存储下载链接的数组</td></tr></tbody></table><p><strong>响应参数中的fileList</strong></p><table><thead><tr><th style="text-align:center;">字段</th><th style="text-align:center;">类型</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">fileId</td><td style="text-align:center;">string</td><td style="text-align:center;">文件 ID（从文件url中解析出的id）</td></tr><tr><td style="text-align:center;">gmtCreate</td><td style="text-align:center;">number</td><td style="text-align:center;">文件上传时间（精确到秒的时间戳）</td></tr><tr><td style="text-align:center;">gmtModified</td><td style="text-align:center;">number</td><td style="text-align:center;">文件更改时间（精确到秒的时间戳）</td></tr><tr><td style="text-align:center;">name</td><td style="text-align:center;">string</td><td style="text-align:center;">文件原始名称</td></tr><tr><td style="text-align:center;">size</td><td style="text-align:center;">number</td><td style="text-align:center;">文件大小（Byte）</td></tr><tr><td style="text-align:center;">type</td><td style="text-align:center;">string</td><td style="text-align:center;">文件类型</td></tr><tr><td style="text-align:center;">url</td><td style="text-align:center;">string</td><td style="text-align:center;">文件cdn链接</td></tr></tbody></table><h4 id="_5-2-4-chooseanduploadfile" tabindex="-1"><a class="header-anchor" href="#_5-2-4-chooseanduploadfile" aria-hidden="true">#</a> 5.2.4 chooseAndUploadFile</h4><p>通过ui界面选择文件（图片/视频）并直接上传到云存储。</p><p>同时提供了选择回调事件，方便对选择后的图片进行压缩等二次处理，然后再上传。</p><blockquote><p>回调方法</p></blockquote><p><strong>onChooseFile(Object OnChooseFileRes)</strong></p><p>选择图片的回调事件。方便对选择后的图片进行压缩、裁剪等二次处理，然后再上传。</p><p>OnChooseFileRes结构如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">errMsg</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">tempFilePaths</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 临时文件路径数组，chooseVideo/chooseImage/chooseFile接口返回的tempFilePath组成的数组</span>
  <span class="token literal-property property">tempFiles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 临时文件组成的数组</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果onChooseFile回调有返回值，此返回值会用来替换实际选择的文件，用以上传。可以在此回调内对文件进行额外的处理，通过在onChooseFile内返回一个promise来阻塞上传，在此期间可以对文件进行额外处理。</p><p>例：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">cropImg</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> ext
    <span class="token keyword">let</span> filePathProcessed <span class="token operator">=</span> file<span class="token punctuation">.</span>path <span class="token comment">// 处理结果</span>
    <span class="token comment">// #ifdef H5</span>
    ext <span class="token operator">=</span> file<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">path</span><span class="token operator">:</span> filePathProcessed<span class="token punctuation">,</span>
      ext<span class="token punctuation">,</span>
      <span class="token literal-property property">fileType</span><span class="token operator">:</span> file<span class="token punctuation">.</span>fileType
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// #endif</span>
    <span class="token comment">// #ifndef H5</span>
    uni<span class="token punctuation">.</span><span class="token function">getImageInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">src</span><span class="token operator">:</span> file<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
      <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ext <span class="token operator">=</span> info<span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">path</span><span class="token operator">:</span> filePathProcessed<span class="token punctuation">,</span>
          ext<span class="token punctuation">,</span>
          <span class="token literal-property property">fileType</span><span class="token operator">:</span> file<span class="token punctuation">.</span>fileType
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg <span class="token operator">||</span> <span class="token string">&#39;未能获取图片类型&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// #endif</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

uniCloud<span class="token punctuation">.</span><span class="token function">chooseAndUploadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;image&#39;</span><span class="token punctuation">,</span>
  <span class="token function">onChooseFile</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> processAll <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> res<span class="token punctuation">.</span>tempFiles<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      processAll<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">cropImg</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFiles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>processAll<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fileList</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">tempFilePaths</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      result<span class="token punctuation">.</span>tempFiles <span class="token operator">=</span> fileList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fileItem<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        result<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fileItem<span class="token punctuation">.</span>path<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">path</span><span class="token operator">:</span> fileItem<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
          <span class="token literal-property property">cloudPath</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">&#39;.&#39;</span> <span class="token operator">+</span> fileItem<span class="token punctuation">.</span>ext<span class="token punctuation">,</span> <span class="token comment">// 云端路径，这里随便生成了一个</span>
          <span class="token literal-property property">fileType</span><span class="token operator">:</span> fileItem<span class="token punctuation">.</span>fileType
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> result
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>OnUploadProgress(Object OnUploadProgressRes)</strong></p><p>上传进度的回调</p><p>OnUploadProgressRes结构如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 触发此回调的文件序号</span>
  <span class="token literal-property property">loaded</span><span class="token operator">:</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token comment">// 已上传大小</span>
  <span class="token literal-property property">total</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token comment">// 总大小</span>
  <span class="token literal-property property">tempFilePath</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 本地临时文件路径</span>
  <span class="token literal-property property">tempFile</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 本地文件对象</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>chooseAndUploadFile响应参数</p></blockquote><p>成功回调内的响应参数形式如下</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">errMsg</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 错误信息</span>
  <span class="token literal-property property">tempFilePaths</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 本地临时文件路径组成的数组</span>
  <span class="token literal-property property">tempFiles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 文件对象数组，每项上都被追加了一个url属性，值为文件上传得到的fileID</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-云函数api" tabindex="-1"><a class="header-anchor" href="#_5-3-云函数api" aria-hidden="true">#</a> 5.3 云函数API</h3><p>在云函数中操作云存储文件（不是在前端），包括在云函数里上传、删除云存储文件。</p><h4 id="_5-3-1-unicloud-uploadfile" tabindex="-1"><a class="header-anchor" href="#_5-3-1-unicloud-uploadfile" aria-hidden="true">#</a> 5.3.1 uniCloud.uploadFile</h4><p><strong>云函数</strong>内上传文件至云存储。</p><p>如果是从客户端上传文件，一般不建议先把文件从客户端上传到云函数，再由云函数上传到云存储，而是建议客户端直传云存储。</p><p><strong>请求参数</strong></p><table><thead><tr><th>字段</th><th>类型</th><th>必填</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>cloudPath</td><td>string</td><td>是</td><td>-</td><td>使用腾讯云时，表示文件的绝对路径，包含文件名。使用阿里云时，<code>cloudPath</code>为云端文件名，传<code>cloudPathAsRealPath: true</code>可以让cloudPath作为文件存储路径</td></tr><tr><td>fileContent</td><td>-</td><td>是</td><td>-</td><td>文件内容，请看下方说明</td></tr><tr><td>cloudPathAsRealPath</td><td>Boolean</td><td>否</td><td>false</td><td>是否以<code>cloudPath</code>作为云端文件绝对路径</td></tr></tbody></table><p><strong>说明</strong></p><ul><li>腾讯云支持在fileContent内传<a href="https://nodejs.org/api/stream.html#stream_class_stream_readable" target="_blank" rel="noopener noreferrer">可读流<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 或buffer</li><li>阿里云支持在fileContent内传文件绝对路径或buffer</li></ul><p>响应参数</p><table><thead><tr><th>字段</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>fileID</td><td>fileID</td><td>是</td><td>文件唯一 ID，用来访问文件，建议存储起来。</td></tr><tr><td>requestId</td><td>string</td><td>否</td><td>请求序列号，用于错误排查。</td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 云函数上传文件示例代码</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> uniCloud<span class="token punctuation">.</span><span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">cloudPath</span><span class="token operator">:</span> <span class="token string">&quot;test-admin.jpeg&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">fileContent</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/cos.jpeg</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-3-2-unicloud-deletefile" tabindex="-1"><a class="header-anchor" href="#_5-3-2-unicloud-deletefile" aria-hidden="true">#</a> 5.3.2 uniCloud.deleteFile</h4><p><strong>云函数</strong>删除云存储文件。</p><p>删除云存储文件是高危操作，不建议在客户端操作，而建议在云函数中操作。</p><p><strong>响应参数</strong></p><table><thead><tr><th>字段</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>fileList</td><td>&lt; Array &gt;.object</td><td>否</td><td>删除结果组成的数组。</td></tr><tr><td>requestId</td><td>string</td><td>否</td><td>请求序列号，用于错误排查。</td></tr></tbody></table><p><strong>fileList字段</strong></p><table><thead><tr><th>字段</th><th>类型</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>fileID</td><td>string</td><td>是</td><td>文件 ID。</td></tr></tbody></table><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 云函数删除文件示例代码</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> uniCloud<span class="token punctuation">.</span><span class="token function">deleteFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">fileList</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;cloud://test-28farb/a.png&quot;</span> <span class="token comment">// 阿里云fileID是url形式，例：https://xxx.com/xxx.png</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1743760069@qq.com">liushun</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/home/tech/uni-app/" class="router-link-active" aria-label="Navigation"><!--[--><!--]--> Navigation <!--[--><!--]--></a></span><span class="next"><a href="/home/tech/uni-app/uniTips.html" class="" aria-label="uniapp开发tips"><!--[--><!--]--> uniapp开发tips <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/home/assets/app-753c81c9.js" defer></script>
  </body>
</html>
