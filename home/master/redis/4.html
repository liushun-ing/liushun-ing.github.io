<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.62">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/imgs/favicon.ico"><title>Redis原理 | 不愿飞的蜂鸟首页</title><meta name="description" content="Five的垃圾库">
    <link rel="preload" href="/home/assets/style-d11d67ee.css" as="style"><link rel="stylesheet" href="/home/assets/style-d11d67ee.css">
    <link rel="modulepreload" href="/home/assets/app-d0fb739e.js"><link rel="modulepreload" href="/home/assets/4.html-b5291636.js"><link rel="modulepreload" href="/home/assets/4.html-37db0907.js"><link rel="prefetch" href="/home/assets/index.html-5f18312a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-88b7806c.js" as="script"><link rel="prefetch" href="/home/assets/index.html-655005a5.js" as="script"><link rel="prefetch" href="/home/assets/index.html-93f12b24.js" as="script"><link rel="prefetch" href="/home/assets/1.html-b316c5ed.js" as="script"><link rel="prefetch" href="/home/assets/2.html-ac2ea519.js" as="script"><link rel="prefetch" href="/home/assets/3.html-a16fc765.js" as="script"><link rel="prefetch" href="/home/assets/4.html-798018cd.js" as="script"><link rel="prefetch" href="/home/assets/5.html-18ce25f4.js" as="script"><link rel="prefetch" href="/home/assets/6.html-f31143bd.js" as="script"><link rel="prefetch" href="/home/assets/index.html-d4d6df4d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b98c27b4.js" as="script"><link rel="prefetch" href="/home/assets/algorithms.html-f5b5ee0a.js" as="script"><link rel="prefetch" href="/home/assets/c__.html-05ab7a9e.js" as="script"><link rel="prefetch" href="/home/assets/graph.html-dab7b16e.js" as="script"><link rel="prefetch" href="/home/assets/leetcode.html-f105e9f1.js" as="script"><link rel="prefetch" href="/home/assets/other_tree.html-22fe33b0.js" as="script"><link rel="prefetch" href="/home/assets/sort_and_search.html-11f53bfb.js" as="script"><link rel="prefetch" href="/home/assets/string.html-e9db3916.js" as="script"><link rel="prefetch" href="/home/assets/tree.html-ec32110e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-99884eac.js" as="script"><link rel="prefetch" href="/home/assets/10.html-75dc6e9d.js" as="script"><link rel="prefetch" href="/home/assets/11.html-44ed8d03.js" as="script"><link rel="prefetch" href="/home/assets/12.html-1cafae42.js" as="script"><link rel="prefetch" href="/home/assets/13.html-cf9e5046.js" as="script"><link rel="prefetch" href="/home/assets/14.html-513b431e.js" as="script"><link rel="prefetch" href="/home/assets/2.html-094a87ee.js" as="script"><link rel="prefetch" href="/home/assets/3.html-4a8b2796.js" as="script"><link rel="prefetch" href="/home/assets/4.html-1f39f3b9.js" as="script"><link rel="prefetch" href="/home/assets/5.html-e78784fc.js" as="script"><link rel="prefetch" href="/home/assets/6.html-cc4acb22.js" as="script"><link rel="prefetch" href="/home/assets/7.html-ff096a2a.js" as="script"><link rel="prefetch" href="/home/assets/8.html-14b4319a.js" as="script"><link rel="prefetch" href="/home/assets/9.html-f1fd1f24.js" as="script"><link rel="prefetch" href="/home/assets/index.html-47fde470.js" as="script"><link rel="prefetch" href="/home/assets/1.html-769a7684.js" as="script"><link rel="prefetch" href="/home/assets/2.html-594984b8.js" as="script"><link rel="prefetch" href="/home/assets/3.html-5ac058a8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-8a655167.js" as="script"><link rel="prefetch" href="/home/assets/index.html-1bcb2be9.js" as="script"><link rel="prefetch" href="/home/assets/docker_tutorial.html-4f5d0900.js" as="script"><link rel="prefetch" href="/home/assets/firewall_tutorial.html-a1c0f732.js" as="script"><link rel="prefetch" href="/home/assets/mysql_tutorial.html-4c6ba5d6.js" as="script"><link rel="prefetch" href="/home/assets/nginx_tutorial.html-93df5119.js" as="script"><link rel="prefetch" href="/home/assets/other_tutorial.html-c3d0505a.js" as="script"><link rel="prefetch" href="/home/assets/1.html-51f0ec55.js" as="script"><link rel="prefetch" href="/home/assets/2.html-a59bf622.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b0e9f560.js" as="script"><link rel="prefetch" href="/home/assets/5.html-a4a0234f.js" as="script"><link rel="prefetch" href="/home/assets/6.html-d1f646bc.js" as="script"><link rel="prefetch" href="/home/assets/7.html-4bfc5de3.js" as="script"><link rel="prefetch" href="/home/assets/Mybatis.html-999b181b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3e3eac32.js" as="script"><link rel="prefetch" href="/home/assets/Spring.html-ebdaae63.js" as="script"><link rel="prefetch" href="/home/assets/SpringBoot.html-c1676d63.js" as="script"><link rel="prefetch" href="/home/assets/SpringMVC.html-7bf971fc.js" as="script"><link rel="prefetch" href="/home/assets/1.html-095f3a2d.js" as="script"><link rel="prefetch" href="/home/assets/2.html-820329b9.js" as="script"><link rel="prefetch" href="/home/assets/3.html-65fa04a9.js" as="script"><link rel="prefetch" href="/home/assets/4.html-6cc0fdbb.js" as="script"><link rel="prefetch" href="/home/assets/5.html-4382da55.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2c443520.js" as="script"><link rel="prefetch" href="/home/assets/index.html-0a2a0106.js" as="script"><link rel="prefetch" href="/home/assets/less.html-26b18828.js" as="script"><link rel="prefetch" href="/home/assets/sass.html-e33a9ecf.js" as="script"><link rel="prefetch" href="/home/assets/1.html-e6ed9dbf.js" as="script"><link rel="prefetch" href="/home/assets/2.html-76ba2e41.js" as="script"><link rel="prefetch" href="/home/assets/index.html-202d5f4b.js" as="script"><link rel="prefetch" href="/home/assets/1.html-c051337a.js" as="script"><link rel="prefetch" href="/home/assets/2.html-c475ae33.js" as="script"><link rel="prefetch" href="/home/assets/index.html-7a9eb86e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-2d63875b.js" as="script"><link rel="prefetch" href="/home/assets/2.html-96ffe2d7.js" as="script"><link rel="prefetch" href="/home/assets/3.html-164f28d8.js" as="script"><link rel="prefetch" href="/home/assets/4.html-770067b7.js" as="script"><link rel="prefetch" href="/home/assets/5.html-94e4a58f.js" as="script"><link rel="prefetch" href="/home/assets/6.html-5fbe2511.js" as="script"><link rel="prefetch" href="/home/assets/7.html-6aaf4692.js" as="script"><link rel="prefetch" href="/home/assets/8.html-6c442319.js" as="script"><link rel="prefetch" href="/home/assets/9.html-1a1241a0.js" as="script"><link rel="prefetch" href="/home/assets/index.html-ca14f1ca.js" as="script"><link rel="prefetch" href="/home/assets/new.html-f39ecd3a.js" as="script"><link rel="prefetch" href="/home/assets/1.html-f45e37f8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3b81aa58.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3505c412.js" as="script"><link rel="prefetch" href="/home/assets/uniCloud.html-d6f4a4e6.js" as="script"><link rel="prefetch" href="/home/assets/uniTips.html-c522b2d1.js" as="script"><link rel="prefetch" href="/home/assets/1.html-3be78b60.js" as="script"><link rel="prefetch" href="/home/assets/index.html-6602172a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-dcc009ab.js" as="script"><link rel="prefetch" href="/home/assets/api_tutorial.html-201e8b68.js" as="script"><link rel="prefetch" href="/home/assets/base_tutorial.html-553e9cd8.js" as="script"><link rel="prefetch" href="/home/assets/pinia.html-93944f84.js" as="script"><link rel="prefetch" href="/home/assets/vue2.html-396e5caf.js" as="script"><link rel="prefetch" href="/home/assets/vue3_1.html-a3f127a4.js" as="script"><link rel="prefetch" href="/home/assets/vue3_2.html-52a41818.js" as="script"><link rel="prefetch" href="/home/assets/1.html-6b5b0d34.js" as="script"><link rel="prefetch" href="/home/assets/index.html-f9a24ca8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-994c7095.js" as="script"><link rel="prefetch" href="/home/assets/base_concept.html-8c9eb618.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-6eb25c4d.js" as="script"><link rel="prefetch" href="/home/assets/pytorch_usage.html-12ebfb9e.js" as="script"><link rel="prefetch" href="/home/assets/23_Dec.html-b55b0d44.js" as="script"><link rel="prefetch" href="/home/assets/23_Nov.html-7f12af9c.js" as="script"><link rel="prefetch" href="/home/assets/24_Jan.html-aa29373f.js" as="script"><link rel="prefetch" href="/home/assets/index.html-cf670ace.js" as="script"><link rel="prefetch" href="/home/assets/index.html-e9115f16.js" as="script"><link rel="prefetch" href="/home/assets/compose.html-72dd1522.js" as="script"><link rel="prefetch" href="/home/assets/image_construct.html-803fa8bb.js" as="script"><link rel="prefetch" href="/home/assets/intro.html-c97d438d.js" as="script"><link rel="prefetch" href="/home/assets/framework.html-26732a5d.js" as="script"><link rel="prefetch" href="/home/assets/interview.html-c43e6b5a.js" as="script"><link rel="prefetch" href="/home/assets/javabase.html-4b7acc92.js" as="script"><link rel="prefetch" href="/home/assets/javacollection.html-7d0eec7c.js" as="script"><link rel="prefetch" href="/home/assets/javaio.html-2e0ce7a0.js" as="script"><link rel="prefetch" href="/home/assets/javajuc.html-e3adfcb3.js" as="script"><link rel="prefetch" href="/home/assets/project.html-ee5d4ecd.js" as="script"><link rel="prefetch" href="/home/assets/index.html-994e5971.js" as="script"><link rel="prefetch" href="/home/assets/account.html-f2972d26.js" as="script"><link rel="prefetch" href="/home/assets/block.html-a9d64f7a.js" as="script"><link rel="prefetch" href="/home/assets/consensus.html-4ef39eba.js" as="script"><link rel="prefetch" href="/home/assets/contract.html-ebb9a32c.js" as="script"><link rel="prefetch" href="/home/assets/crypto_base.html-6226e31f.js" as="script"><link rel="prefetch" href="/home/assets/erc20.html-9175e857.js" as="script"><link rel="prefetch" href="/home/assets/ethereum_base.html-ed8afc4d.js" as="script"><link rel="prefetch" href="/home/assets/evm.html-c6aa4ef2.js" as="script"><link rel="prefetch" href="/home/assets/gas.html-7e483dbf.js" as="script"><link rel="prefetch" href="/home/assets/go_ethereum.html-7454bd3e.js" as="script"><link rel="prefetch" href="/home/assets/hd_wallet.html-3b70c8a3.js" as="script"><link rel="prefetch" href="/home/assets/jsonrpc.html-4b92012b.js" as="script"><link rel="prefetch" href="/home/assets/leveldb.html-f6dcddfb.js" as="script"><link rel="prefetch" href="/home/assets/mev.html-51d6ba7a.js" as="script"><link rel="prefetch" href="/home/assets/mpt.html-78685936.js" as="script"><link rel="prefetch" href="/home/assets/node_client.html-1945c0e1.js" as="script"><link rel="prefetch" href="/home/assets/rlp.html-c63951dd.js" as="script"><link rel="prefetch" href="/home/assets/statedb.html-57e0e0ee.js" as="script"><link rel="prefetch" href="/home/assets/transaction.html-ea80179c.js" as="script"><link rel="prefetch" href="/home/assets/index.html-f56755d4.js" as="script"><link rel="prefetch" href="/home/assets/distributed.html-49751f7f.js" as="script"><link rel="prefetch" href="/home/assets/gin.html-f2404fb2.js" as="script"><link rel="prefetch" href="/home/assets/gorm_1.html-39a34dda.js" as="script"><link rel="prefetch" href="/home/assets/gorm_2.html-80ef27f4.js" as="script"><link rel="prefetch" href="/home/assets/goweb.html-4b38ecf5.js" as="script"><link rel="prefetch" href="/home/assets/protobuf.html-46891574.js" as="script"><link rel="prefetch" href="/home/assets/rpc.html-2433bbc8.js" as="script"><link rel="prefetch" href="/home/assets/1.html-f201c773.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3732bf90.js" as="script"><link rel="prefetch" href="/home/assets/1.html-8f3c150c.js" as="script"><link rel="prefetch" href="/home/assets/2.html-35ec231b.js" as="script"><link rel="prefetch" href="/home/assets/3.html-5d7e2173.js" as="script"><link rel="prefetch" href="/home/assets/4.html-b019902a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-dd915206.js" as="script"><link rel="prefetch" href="/home/assets/index.html-9e6553b4.js" as="script"><link rel="prefetch" href="/home/assets/mybatis.html-9fde4bbc.js" as="script"><link rel="prefetch" href="/home/assets/1.html-86ebf5bf.js" as="script"><link rel="prefetch" href="/home/assets/2.html-ef334cb2.js" as="script"><link rel="prefetch" href="/home/assets/index.html-beacf8a6.js" as="script"><link rel="prefetch" href="/home/assets/index.html-5747b02b.js" as="script"><link rel="prefetch" href="/home/assets/base_usage.html-313edb82.js" as="script"><link rel="prefetch" href="/home/assets/1.html-84171baf.js" as="script"><link rel="prefetch" href="/home/assets/2.html-96474bc6.js" as="script"><link rel="prefetch" href="/home/assets/3.html-20b1a547.js" as="script"><link rel="prefetch" href="/home/assets/index.html-9d407164.js" as="script"><link rel="prefetch" href="/home/assets/index.html-524f529c.js" as="script"><link rel="prefetch" href="/home/assets/jwt.html-c1c6066a.js" as="script"><link rel="prefetch" href="/home/assets/shiro.html-e4c32de8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-08bf43f7.js" as="script"><link rel="prefetch" href="/home/assets/nacos.html-ed2737e7.js" as="script"><link rel="prefetch" href="/home/assets/index.html-60425c3d.js" as="script"><link rel="prefetch" href="/home/assets/spring_annotation.html-3e4c4f76.js" as="script"><link rel="prefetch" href="/home/assets/springboot.html-dd3747fd.js" as="script"><link rel="prefetch" href="/home/assets/springboot_base.html-cd23c0a8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-dbf7dd00.js" as="script"><link rel="prefetch" href="/home/assets/java_usage.html-baf8cd68.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-5785b28e.js" as="script"><link rel="prefetch" href="/home/assets/system_usage.html-e9649787.js" as="script"><link rel="prefetch" href="/home/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b7d1ff5f.js" as="script"><link rel="prefetch" href="/home/assets/index.html-c8cadcaa.js" as="script"><link rel="prefetch" href="/home/assets/index.html-378527af.js" as="script"><link rel="prefetch" href="/home/assets/index.html-ffc2920c.js" as="script"><link rel="prefetch" href="/home/assets/1.html-83ca0d24.js" as="script"><link rel="prefetch" href="/home/assets/2.html-47e4430b.js" as="script"><link rel="prefetch" href="/home/assets/3.html-ba702658.js" as="script"><link rel="prefetch" href="/home/assets/4.html-4b578252.js" as="script"><link rel="prefetch" href="/home/assets/5.html-4eb6cef2.js" as="script"><link rel="prefetch" href="/home/assets/6.html-49e8277e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-675af4eb.js" as="script"><link rel="prefetch" href="/home/assets/index.html-fda1d318.js" as="script"><link rel="prefetch" href="/home/assets/algorithms.html-02ab0f11.js" as="script"><link rel="prefetch" href="/home/assets/c__.html-0388b98d.js" as="script"><link rel="prefetch" href="/home/assets/graph.html-1454207a.js" as="script"><link rel="prefetch" href="/home/assets/leetcode.html-f453452c.js" as="script"><link rel="prefetch" href="/home/assets/other_tree.html-e19dfd67.js" as="script"><link rel="prefetch" href="/home/assets/sort_and_search.html-f18f3cf1.js" as="script"><link rel="prefetch" href="/home/assets/string.html-dc686eaf.js" as="script"><link rel="prefetch" href="/home/assets/tree.html-37b1fb1d.js" as="script"><link rel="prefetch" href="/home/assets/1.html-35b5733a.js" as="script"><link rel="prefetch" href="/home/assets/10.html-da4609c2.js" as="script"><link rel="prefetch" href="/home/assets/11.html-e176c38b.js" as="script"><link rel="prefetch" href="/home/assets/12.html-3140c9f5.js" as="script"><link rel="prefetch" href="/home/assets/13.html-73309f73.js" as="script"><link rel="prefetch" href="/home/assets/14.html-0ffa754c.js" as="script"><link rel="prefetch" href="/home/assets/2.html-9fbd137e.js" as="script"><link rel="prefetch" href="/home/assets/3.html-fc81cc1f.js" as="script"><link rel="prefetch" href="/home/assets/4.html-07ff85db.js" as="script"><link rel="prefetch" href="/home/assets/5.html-bb32f8c0.js" as="script"><link rel="prefetch" href="/home/assets/6.html-694342af.js" as="script"><link rel="prefetch" href="/home/assets/7.html-f75a67dc.js" as="script"><link rel="prefetch" href="/home/assets/8.html-d9dbeabf.js" as="script"><link rel="prefetch" href="/home/assets/9.html-88bea7fb.js" as="script"><link rel="prefetch" href="/home/assets/index.html-79f3c0a1.js" as="script"><link rel="prefetch" href="/home/assets/1.html-418c49e9.js" as="script"><link rel="prefetch" href="/home/assets/2.html-60390063.js" as="script"><link rel="prefetch" href="/home/assets/3.html-ca17c76d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-61ce677d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-c0a3ded9.js" as="script"><link rel="prefetch" href="/home/assets/docker_tutorial.html-691eb99b.js" as="script"><link rel="prefetch" href="/home/assets/firewall_tutorial.html-1a8b3835.js" as="script"><link rel="prefetch" href="/home/assets/mysql_tutorial.html-084246aa.js" as="script"><link rel="prefetch" href="/home/assets/nginx_tutorial.html-01006f9d.js" as="script"><link rel="prefetch" href="/home/assets/other_tutorial.html-5e5c69bb.js" as="script"><link rel="prefetch" href="/home/assets/1.html-dc592415.js" as="script"><link rel="prefetch" href="/home/assets/2.html-8528c43b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-22a44181.js" as="script"><link rel="prefetch" href="/home/assets/5.html-29c21a8d.js" as="script"><link rel="prefetch" href="/home/assets/6.html-274e59ec.js" as="script"><link rel="prefetch" href="/home/assets/7.html-9c0804e5.js" as="script"><link rel="prefetch" href="/home/assets/Mybatis.html-5591de15.js" as="script"><link rel="prefetch" href="/home/assets/index.html-6f53fafd.js" as="script"><link rel="prefetch" href="/home/assets/Spring.html-7f7ebb6b.js" as="script"><link rel="prefetch" href="/home/assets/SpringBoot.html-1f5c0b63.js" as="script"><link rel="prefetch" href="/home/assets/SpringMVC.html-39ca0869.js" as="script"><link rel="prefetch" href="/home/assets/1.html-224bffbf.js" as="script"><link rel="prefetch" href="/home/assets/2.html-fdf39e45.js" as="script"><link rel="prefetch" href="/home/assets/3.html-70c98965.js" as="script"><link rel="prefetch" href="/home/assets/4.html-14606f1f.js" as="script"><link rel="prefetch" href="/home/assets/5.html-6164c1a9.js" as="script"><link rel="prefetch" href="/home/assets/index.html-bbfe5166.js" as="script"><link rel="prefetch" href="/home/assets/index.html-913b446d.js" as="script"><link rel="prefetch" href="/home/assets/less.html-1d8c1588.js" as="script"><link rel="prefetch" href="/home/assets/sass.html-2d7c64d5.js" as="script"><link rel="prefetch" href="/home/assets/1.html-b09078e6.js" as="script"><link rel="prefetch" href="/home/assets/2.html-4223cabe.js" as="script"><link rel="prefetch" href="/home/assets/index.html-0d2cbd38.js" as="script"><link rel="prefetch" href="/home/assets/1.html-df0ed93e.js" as="script"><link rel="prefetch" href="/home/assets/2.html-6a500c0c.js" as="script"><link rel="prefetch" href="/home/assets/index.html-12743cc1.js" as="script"><link rel="prefetch" href="/home/assets/1.html-73a877ca.js" as="script"><link rel="prefetch" href="/home/assets/2.html-a71e08ab.js" as="script"><link rel="prefetch" href="/home/assets/3.html-52dd3ee9.js" as="script"><link rel="prefetch" href="/home/assets/4.html-1b816d27.js" as="script"><link rel="prefetch" href="/home/assets/5.html-73d7dca6.js" as="script"><link rel="prefetch" href="/home/assets/6.html-fdbe69c1.js" as="script"><link rel="prefetch" href="/home/assets/7.html-68f29f5c.js" as="script"><link rel="prefetch" href="/home/assets/8.html-4c2e550e.js" as="script"><link rel="prefetch" href="/home/assets/9.html-f7d9641b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-adb3d00c.js" as="script"><link rel="prefetch" href="/home/assets/new.html-2d275568.js" as="script"><link rel="prefetch" href="/home/assets/1.html-622e9a86.js" as="script"><link rel="prefetch" href="/home/assets/index.html-409473ad.js" as="script"><link rel="prefetch" href="/home/assets/index.html-1de049be.js" as="script"><link rel="prefetch" href="/home/assets/uniCloud.html-87c62508.js" as="script"><link rel="prefetch" href="/home/assets/uniTips.html-bf95fd75.js" as="script"><link rel="prefetch" href="/home/assets/1.html-569a8ccc.js" as="script"><link rel="prefetch" href="/home/assets/index.html-564e311b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-0cb587a4.js" as="script"><link rel="prefetch" href="/home/assets/api_tutorial.html-f53cb5e1.js" as="script"><link rel="prefetch" href="/home/assets/base_tutorial.html-e0e96db2.js" as="script"><link rel="prefetch" href="/home/assets/pinia.html-4eeeee70.js" as="script"><link rel="prefetch" href="/home/assets/vue2.html-dcbeeb29.js" as="script"><link rel="prefetch" href="/home/assets/vue3_1.html-fb05b5d2.js" as="script"><link rel="prefetch" href="/home/assets/vue3_2.html-1a4e217d.js" as="script"><link rel="prefetch" href="/home/assets/1.html-1f985192.js" as="script"><link rel="prefetch" href="/home/assets/index.html-4bffd70e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-739a7033.js" as="script"><link rel="prefetch" href="/home/assets/base_concept.html-f3e74d27.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-67394e4b.js" as="script"><link rel="prefetch" href="/home/assets/pytorch_usage.html-230fb065.js" as="script"><link rel="prefetch" href="/home/assets/23_Dec.html-a3b18bd8.js" as="script"><link rel="prefetch" href="/home/assets/23_Nov.html-94f956f7.js" as="script"><link rel="prefetch" href="/home/assets/24_Jan.html-7ef9e2a6.js" as="script"><link rel="prefetch" href="/home/assets/index.html-08dd6790.js" as="script"><link rel="prefetch" href="/home/assets/index.html-70b492e2.js" as="script"><link rel="prefetch" href="/home/assets/compose.html-5596ce51.js" as="script"><link rel="prefetch" href="/home/assets/image_construct.html-64879f00.js" as="script"><link rel="prefetch" href="/home/assets/intro.html-3a3fdfe4.js" as="script"><link rel="prefetch" href="/home/assets/framework.html-3ebf5e0f.js" as="script"><link rel="prefetch" href="/home/assets/interview.html-ac77b4bc.js" as="script"><link rel="prefetch" href="/home/assets/javabase.html-f9f88df2.js" as="script"><link rel="prefetch" href="/home/assets/javacollection.html-50eecfc4.js" as="script"><link rel="prefetch" href="/home/assets/javaio.html-39a9e3b4.js" as="script"><link rel="prefetch" href="/home/assets/javajuc.html-41442a2d.js" as="script"><link rel="prefetch" href="/home/assets/project.html-66cc510d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b05cc5f6.js" as="script"><link rel="prefetch" href="/home/assets/account.html-b302d597.js" as="script"><link rel="prefetch" href="/home/assets/block.html-caa92423.js" as="script"><link rel="prefetch" href="/home/assets/consensus.html-efa1a0d1.js" as="script"><link rel="prefetch" href="/home/assets/contract.html-9e2e63c9.js" as="script"><link rel="prefetch" href="/home/assets/crypto_base.html-40e9a8ed.js" as="script"><link rel="prefetch" href="/home/assets/erc20.html-6ec66366.js" as="script"><link rel="prefetch" href="/home/assets/ethereum_base.html-e5be2fa0.js" as="script"><link rel="prefetch" href="/home/assets/evm.html-21220a18.js" as="script"><link rel="prefetch" href="/home/assets/gas.html-29379035.js" as="script"><link rel="prefetch" href="/home/assets/go_ethereum.html-76947cbb.js" as="script"><link rel="prefetch" href="/home/assets/hd_wallet.html-c3e48e6f.js" as="script"><link rel="prefetch" href="/home/assets/jsonrpc.html-c4e0e032.js" as="script"><link rel="prefetch" href="/home/assets/leveldb.html-0b6ae260.js" as="script"><link rel="prefetch" href="/home/assets/mev.html-a1612dc9.js" as="script"><link rel="prefetch" href="/home/assets/mpt.html-cbb946cc.js" as="script"><link rel="prefetch" href="/home/assets/node_client.html-383004c7.js" as="script"><link rel="prefetch" href="/home/assets/rlp.html-4483d701.js" as="script"><link rel="prefetch" href="/home/assets/statedb.html-62046284.js" as="script"><link rel="prefetch" href="/home/assets/transaction.html-62361bab.js" as="script"><link rel="prefetch" href="/home/assets/index.html-e12163a7.js" as="script"><link rel="prefetch" href="/home/assets/distributed.html-abe57b51.js" as="script"><link rel="prefetch" href="/home/assets/gin.html-147131d6.js" as="script"><link rel="prefetch" href="/home/assets/gorm_1.html-19410066.js" as="script"><link rel="prefetch" href="/home/assets/gorm_2.html-25e5c6de.js" as="script"><link rel="prefetch" href="/home/assets/goweb.html-249b20e2.js" as="script"><link rel="prefetch" href="/home/assets/protobuf.html-afd4494d.js" as="script"><link rel="prefetch" href="/home/assets/rpc.html-3f76520a.js" as="script"><link rel="prefetch" href="/home/assets/1.html-b5a489d3.js" as="script"><link rel="prefetch" href="/home/assets/index.html-e7967f6c.js" as="script"><link rel="prefetch" href="/home/assets/1.html-ebc117af.js" as="script"><link rel="prefetch" href="/home/assets/2.html-35dff22c.js" as="script"><link rel="prefetch" href="/home/assets/3.html-e7b7c2ed.js" as="script"><link rel="prefetch" href="/home/assets/4.html-10f0970a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-32eca92a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-974ed0b9.js" as="script"><link rel="prefetch" href="/home/assets/mybatis.html-b052e175.js" as="script"><link rel="prefetch" href="/home/assets/1.html-6d92fe42.js" as="script"><link rel="prefetch" href="/home/assets/2.html-6168978b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2ec9d03e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-78122f48.js" as="script"><link rel="prefetch" href="/home/assets/base_usage.html-03b451aa.js" as="script"><link rel="prefetch" href="/home/assets/1.html-aae1f376.js" as="script"><link rel="prefetch" href="/home/assets/2.html-003bead0.js" as="script"><link rel="prefetch" href="/home/assets/3.html-69cb408e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-238f64e5.js" as="script"><link rel="prefetch" href="/home/assets/index.html-8c33ef9b.js" as="script"><link rel="prefetch" href="/home/assets/jwt.html-e8f4b591.js" as="script"><link rel="prefetch" href="/home/assets/shiro.html-d2a58ccc.js" as="script"><link rel="prefetch" href="/home/assets/index.html-740382d2.js" as="script"><link rel="prefetch" href="/home/assets/nacos.html-8e5099ab.js" as="script"><link rel="prefetch" href="/home/assets/index.html-0015a5cf.js" as="script"><link rel="prefetch" href="/home/assets/spring_annotation.html-5f816670.js" as="script"><link rel="prefetch" href="/home/assets/springboot.html-08a42ce7.js" as="script"><link rel="prefetch" href="/home/assets/springboot_base.html-4837d146.js" as="script"><link rel="prefetch" href="/home/assets/index.html-38d161a5.js" as="script"><link rel="prefetch" href="/home/assets/java_usage.html-72662f9e.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-805178b1.js" as="script"><link rel="prefetch" href="/home/assets/system_usage.html-0765f410.js" as="script"><link rel="prefetch" href="/home/assets/404.html-876c68b2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/home/" class=""><!----><span class="site-name">不愿飞的蜂鸟首页</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Block Chain Internship</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/ethereum/" class="" aria-label="ethereum"><!--[--><!--]--> ethereum <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/docker/" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/golang/" class="" aria-label="golang"><!--[--><!--]--> golang <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Deep Learning</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/ubuntu/" class="" aria-label="Ubuntu"><!--[--><!--]--> Ubuntu <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/GNN/" class="" aria-label="GNN"><!--[--><!--]--> GNN <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/python/" class="" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java Engineering</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/spring/" class="" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/jvm/" class="" aria-label="JVM"><!--[--><!--]--> JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/redis/" class="router-link-active" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/juc/" class="" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/netty/" class="" aria-label="Netty"><!--[--><!--]--> Netty <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/security/" class="" aria-label="Security"><!--[--><!--]--> Security <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/service/" class="" aria-label="Service"><!--[--><!--]--> Service <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/mybatis/" class="" aria-label="MyBatis"><!--[--><!--]--> MyBatis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>foreground</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/js/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/typescript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/html_css/" class="" aria-label="HTML_CSS"><!--[--><!--]--> HTML_CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/less_sass/" class="" aria-label="Less_Sass"><!--[--><!--]--> Less_Sass <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/react/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>background</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/java/" class="" aria-label="JAVA"><!--[--><!--]--> JAVA <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>app.mp</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/miniProgram/" class="" aria-label="MiniProgram"><!--[--><!--]--> MiniProgram <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/uni-app/" class="" aria-label="uni-app"><!--[--><!--]--> uni-app <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>server</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/centos/" class="" aria-label="Centos"><!--[--><!--]--> Centos <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/course/operating_system/" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/computer_network/" class="" aria-label="计算机网络技术"><!--[--><!--]--> 计算机网络技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/datastructure_and_algorithm/" class="" aria-label="数据结构和算法"><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/liushun-ing" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Block Chain Internship</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/ethereum/" class="" aria-label="ethereum"><!--[--><!--]--> ethereum <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/docker/" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/golang/" class="" aria-label="golang"><!--[--><!--]--> golang <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Deep Learning</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/ubuntu/" class="" aria-label="Ubuntu"><!--[--><!--]--> Ubuntu <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/GNN/" class="" aria-label="GNN"><!--[--><!--]--> GNN <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/python/" class="" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java Engineering</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/spring/" class="" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/jvm/" class="" aria-label="JVM"><!--[--><!--]--> JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/redis/" class="router-link-active" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/juc/" class="" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/netty/" class="" aria-label="Netty"><!--[--><!--]--> Netty <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/security/" class="" aria-label="Security"><!--[--><!--]--> Security <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/service/" class="" aria-label="Service"><!--[--><!--]--> Service <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/mybatis/" class="" aria-label="MyBatis"><!--[--><!--]--> MyBatis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>foreground</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/js/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/typescript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/html_css/" class="" aria-label="HTML_CSS"><!--[--><!--]--> HTML_CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/less_sass/" class="" aria-label="Less_Sass"><!--[--><!--]--> Less_Sass <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/react/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>background</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/java/" class="" aria-label="JAVA"><!--[--><!--]--> JAVA <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>app.mp</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/miniProgram/" class="" aria-label="MiniProgram"><!--[--><!--]--> MiniProgram <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/uni-app/" class="" aria-label="uni-app"><!--[--><!--]--> uni-app <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>server</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/centos/" class="" aria-label="Centos"><!--[--><!--]--> Centos <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/course/operating_system/" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/computer_network/" class="" aria-label="计算机网络技术"><!--[--><!--]--> 计算机网络技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/datastructure_and_algorithm/" class="" aria-label="数据结构和算法"><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/liushun-ing" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">Redis <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/home/master/redis/" class="router-link-active sidebar-item" aria-label="Navigation"><!--[--><!--]--> Navigation <!--[--><!--]--></a><!----></li><li><a href="/home/master/redis/1.html" class="sidebar-item" aria-label="Redis基础"><!--[--><!--]--> Redis基础 <!--[--><!--]--></a><!----></li><li><a href="/home/master/redis/2.html" class="sidebar-item" aria-label="Redis实战"><!--[--><!--]--> Redis实战 <!--[--><!--]--></a><!----></li><li><a href="/home/master/redis/3.html" class="sidebar-item" aria-label="Redis高级"><!--[--><!--]--> Redis高级 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Redis原理"><!--[--><!--]--> Redis原理 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/redis/4.html#_1、redis数据结构" class="router-link-active router-link-exact-active sidebar-item" aria-label="1、Redis数据结构"><!--[--><!--]--> 1、Redis数据结构 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/redis/4.html#_1-1-redis数据结构-动态字符串" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1 Redis数据结构-动态字符串"><!--[--><!--]--> 1.1 Redis数据结构-动态字符串 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_1-2-redis数据结构-intset" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2 Redis数据结构-intset"><!--[--><!--]--> 1.2 Redis数据结构-intset <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_1-3-redis数据结构-dict" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.3 Redis数据结构-Dict"><!--[--><!--]--> 1.3 Redis数据结构-Dict <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_1-4-redis数据结构-ziplist" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.4 Redis数据结构-ZipList"><!--[--><!--]--> 1.4 Redis数据结构-ZipList <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_1-5-redis数据结构-ziplist的连锁更新问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.5 Redis数据结构-ZipList的连锁更新问题"><!--[--><!--]--> 1.5 Redis数据结构-ZipList的连锁更新问题 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_1-6-redis数据结构-quicklist" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.6 Redis数据结构-QuickList"><!--[--><!--]--> 1.6 Redis数据结构-QuickList <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_1-7-redis数据结构-skiplist" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.7 Redis数据结构-SkipList"><!--[--><!--]--> 1.7 Redis数据结构-SkipList <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_1-8-redis数据结构-redisobject" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.8 Redis数据结构-RedisObject"><!--[--><!--]--> 1.8 Redis数据结构-RedisObject <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_1-9-redis数据结构-string" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.9 Redis数据结构-String"><!--[--><!--]--> 1.9 Redis数据结构-String <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_2-0-redis数据结构-list" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.0 Redis数据结构-List"><!--[--><!--]--> 2.0 Redis数据结构-List <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_2-1-redis数据结构-set结构" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1 Redis数据结构-Set结构"><!--[--><!--]--> 2.1 Redis数据结构-Set结构 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_2-2-redis数据结构-zset" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2 Redis数据结构-ZSET"><!--[--><!--]--> 2.2 Redis数据结构-ZSET <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_2-3-redis数据结构-hash" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3 Redis数据结构-Hash"><!--[--><!--]--> 2.3 Redis数据结构-Hash <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/home/master/redis/4.html#_2、redis网络模型" class="router-link-active router-link-exact-active sidebar-item" aria-label="2、Redis网络模型"><!--[--><!--]--> 2、Redis网络模型 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/redis/4.html#_2-1-用户空间和内核态空间" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1 用户空间和内核态空间"><!--[--><!--]--> 2.1 用户空间和内核态空间 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_2-2-网络模型-阻塞io" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2.网络模型-阻塞IO"><!--[--><!--]--> 2.2.网络模型-阻塞IO <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_2-3-网络模型-非阻塞io" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3 网络模型-非阻塞IO"><!--[--><!--]--> 2.3 网络模型-非阻塞IO <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_2-4-网络模型-io多路复用" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4 网络模型-IO多路复用"><!--[--><!--]--> 2.4 网络模型-IO多路复用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_2-5-网络模型-io多路复用-select方式" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5 网络模型-IO多路复用-select方式"><!--[--><!--]--> 2.5 网络模型-IO多路复用-select方式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_2-6-网络模型-io多路复用模型-poll模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.6 网络模型-IO多路复用模型-poll模式"><!--[--><!--]--> 2.6 网络模型-IO多路复用模型-poll模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_2-7-网络模型-io多路复用模型-epoll函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.7 网络模型-IO多路复用模型-epoll函数"><!--[--><!--]--> 2.7 网络模型-IO多路复用模型-epoll函数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_2-8、网络模型-epoll中的et和lt" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.8、网络模型-epoll中的ET和LT"><!--[--><!--]--> 2.8、网络模型-epoll中的ET和LT <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_2-9-网络模型-基于epoll的服务器端流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.9 网络模型-基于epoll的服务器端流程"><!--[--><!--]--> 2.9 网络模型-基于epoll的服务器端流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_3-0-、网络模型-信号驱动" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.0 、网络模型-信号驱动"><!--[--><!--]--> 3.0 、网络模型-信号驱动 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_3-1-、网络模型-redis是单线程的吗-为什么使用单线程" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1 、网络模型-Redis是单线程的吗？为什么使用单线程"><!--[--><!--]--> 3.1 、网络模型-Redis是单线程的吗？为什么使用单线程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_3-2-、redis的单线程模型-redis单线程和多线程网络模型变更" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2 、Redis的单线程模型-Redis单线程和多线程网络模型变更"><!--[--><!--]--> 3.2 、Redis的单线程模型-Redis单线程和多线程网络模型变更 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/home/master/redis/4.html#_3、redis通信协议-resp协议" class="router-link-active router-link-exact-active sidebar-item" aria-label="3、Redis通信协议-RESP协议"><!--[--><!--]--> 3、Redis通信协议-RESP协议 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_4、redis内存回收" class="router-link-active router-link-exact-active sidebar-item" aria-label="4、Redis内存回收"><!--[--><!--]--> 4、Redis内存回收 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/redis/4.html#_4-1-过期key处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1. 过期key处理"><!--[--><!--]--> 4.1. 过期key处理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/redis/4.html#_4-2-内存淘汰策略" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2. 内存淘汰策略"><!--[--><!--]--> 4.2. 内存淘汰策略 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="redis原理" tabindex="-1"><a class="header-anchor" href="#redis原理" aria-hidden="true">#</a> Redis原理</h1><h2 id="_1、redis数据结构" tabindex="-1"><a class="header-anchor" href="#_1、redis数据结构" aria-hidden="true">#</a> 1、Redis数据结构</h2><h3 id="_1-1-redis数据结构-动态字符串" tabindex="-1"><a class="header-anchor" href="#_1-1-redis数据结构-动态字符串" aria-hidden="true">#</a> 1.1 Redis数据结构-动态字符串</h3><p>Redis中保存的Key是字符串，value往往是字符串或者字符串的集合。</p><p>不过Redis没有直接使用C语言中的字符串，因为C语言字符串存在很多问题： 获取字符串长度的需要通过运算 非二进制安全 不可修改 Redis构建了一种新的字符串结构，称为简单动态字符串（Simple Dynamic String），简称SDS。 例如，我们执行命令：<code>set name mike</code></p><p>那么Redis将在底层创建两个SDS，其中一个是包含“name”的SDS，另一个是包含“mike”的SDS。</p><p>Redis是C语言实现的，其中SDS是一个结构体，源码如下：</p><img src="/home/assets/1653984624671-ec19a7c6.png" alt="1653984624671" style="zoom:67%;"><p>例如，一个包含字符串“name”的sds结构如下：</p><img src="/home/assets/1653984648404-795ac893.png" alt="1653984648404" style="zoom:67%;"><p>SDS之所以叫做动态字符串，是因为它具备动态扩容的能力，例如一个内容为“hi”的SDS：</p><img src="/home/assets/1653984787383-579386ce.png" alt="1653984787383" style="zoom:50%;"><p>假如我们要给SDS追加一段字符串“,Amy”，这里首先会申请新内存空间：</p><p>如果新字符串小于1M，则新空间为扩展后字符串长度的两倍+1；</p><p>如果新字符串大于1M，则新空间为扩展后字符串长度+1M+1。称为内存预分配。</p><img src="/home/assets/1653984822363-16588594.png" alt="1653984822363" style="zoom:50%;"><img src="/home/assets/1653984838306-1fa71bf3.png" alt="1653984838306" style="zoom:67%;"><h3 id="_1-2-redis数据结构-intset" tabindex="-1"><a class="header-anchor" href="#_1-2-redis数据结构-intset" aria-hidden="true">#</a> 1.2 Redis数据结构-intset</h3><p>IntSet是Redis中set集合的一种实现方式，基于整数数组来实现，并且具备长度可变、有序等特征。 结构如下：</p><img src="/home/assets/1653984923322-ba59ddd8.png" alt="1653984923322" style="zoom:67%;"><p>其中的encoding包含三种模式，表示存储的整数大小不同：</p><img src="/home/assets/1653984942385-9bd2cbd4.png" alt="1653984942385" style="zoom:67%;"><img src="/home/assets/1653985149557-1c996f28.png" alt="1653985149557" style="zoom:50%;"><p>现在，数组中每个数字都在int16_t的范围内，因此采用的编码方式是INTSET_ENC_INT16，每部分占用的字节大小为： encoding：4字节 length：4字节 contents：2字节 * 3 = 6字节</p><img src="/home/assets/1653985197214-e1c19f3b.png" alt="1653985197214" style="zoom:50%;"><p>如果添加一个数字：50000，这个数字超出了int16_t的范围，intset会自动升级编码方式到合适的大小：</p><ul><li>升级编码为INTSET_ENC_INT32, 每个整数占4字节，并按照新的编码方式及元素个数扩容数组</li><li>倒序依次将数组中的元素拷贝到扩容后的正确位置</li><li>将待添加的元素放入数组末尾</li><li>最后，将inset的encoding属性改为INTSET_ENC_INT32，将length属性改为4</li></ul><img src="/home/assets/1653985276621-c9f567fc.png" alt="1653985276621" style="zoom:50%;"><p>小总结：</p><p>Intset可以看做是特殊的整数数组，具备一些特点：</p><ul><li>Redis会确保Intset中的元素唯一、有序</li><li>具备类型升级机制，可以节省内存空间</li><li>底层采用<strong>二分查找</strong>方式来查询</li></ul><h3 id="_1-3-redis数据结构-dict" tabindex="-1"><a class="header-anchor" href="#_1-3-redis数据结构-dict" aria-hidden="true">#</a> 1.3 Redis数据结构-Dict</h3><p>Redis是一个键值型（Key-Value Pair）的数据库，可以根据键实现快速的增删改查。键与值的映射关系通过Dict来实现的。</p><p>Dict由三部分组成，分别是：哈希表（DictHashTable）、哈希节点（DictEntry）、字典（Dict）</p><p><img src="/home/assets/1653985570612-7b3204c2.png" alt="1653985570612"></p><p>当我们向Dict添加键值对时，Redis首先根据key计算出hash值（h），然后利用 h &amp; sizemask来计算元素应该存储到数组中的哪个索引位置。</p><img src="/home/assets/1653985640422-a1b27530.png" alt="1653985640422" style="zoom:50%;"><p><strong>Dict的扩容</strong></p><p>Dict中的HashTable就是数组结合单向链表的实现，当集合中元素较多时，必然导致哈希冲突增多，链表过长，则查询效率会大大降低。 Dict在每次新增键值对时都会检查负载因子（LoadFactor = used/size） ，满足以下两种情况时会触发哈希表扩容： 哈希表的 LoadFactor &gt;= 1，并且服务器没有执行 BGSAVE 或者 BGREWRITEAOF 等后台进程； 哈希表的 LoadFactor &gt; 5 ；</p><img src="/home/assets/1653985716275-b853f3a6.png" alt="1653985716275" style="zoom:67%;"><p><strong>Dict的rehash</strong></p><p>不管是扩容还是收缩，必定会创建新的哈希表，导致哈希表的size和sizemask变化，而key的查询与sizemask有关。因此必须对哈希表中的每一个key重新计算索引，插入新的哈希表，这个过程称为rehash。过程是这样的：</p><ul><li><p>计算新hash表的realSize，值取决于当前要做的是扩容还是收缩：</p><ul><li>如果是扩容，则新size为第一个大于等于dict.ht[0].used + 1的2^n</li><li>如果是收缩，则新size为第一个大于等于dict.ht[0].used的2^n （不得小于4）</li></ul></li><li><p>按照新的realSize申请内存空间，创建dictht，并赋值给dict.ht[1]</p></li><li><p>设置dict.rehashidx = 0，标示开始rehash</p></li><li><p>将dict.ht[0]中的每一个dictEntry都rehash到dict.ht[1]</p></li><li><p>将dict.ht[1]赋值给dict.ht[0]，给dict.ht[1]初始化为空哈希表，释放原来的dict.ht[0]的内存</p></li><li><p>将rehashidx赋值为-1，代表rehash结束</p></li><li><p>（实际上不是一次性的，而是每次只转移与当前操作相关的dictEntry*中的一个，防止阻塞）在rehash过程中，新增操作，则直接写入ht[1]，查询、修改和删除则会在dict.ht[0]和dict.ht[1]依次查找并执行。这样可以确保ht[0]的数据只减不增，随着rehash最终为空</p></li></ul><p>整个过程可以描述成：</p><img src="/home/assets/1653985824540-ceada99a.png" alt="1653985824540" style="zoom:50%;"><p>小总结：</p><p>Dict的结构：</p><ul><li>类似java的HashTable，底层是数组加链表来解决哈希冲突</li><li>Dict包含两个哈希表，ht[0]平常用，ht[1]用来rehash</li></ul><p>Dict的伸缩：</p><ul><li>当LoadFactor大于5或者LoadFactor大于1并且没有子进程任务时，Dict扩容</li><li>当LoadFactor小于0.1时，Dict收缩</li><li>扩容大小为第一个大于等于used + 1的2^n</li><li>收缩大小为第一个大于等于used 的2^n</li><li>Dict采用渐进式rehash，每次访问Dict时执行一次rehash</li><li>rehash时ht[0]只减不增，新增操作只在ht[1]执行，其它操作在两个哈希表</li></ul><h3 id="_1-4-redis数据结构-ziplist" tabindex="-1"><a class="header-anchor" href="#_1-4-redis数据结构-ziplist" aria-hidden="true">#</a> 1.4 Redis数据结构-ZipList</h3><p>ZipList 是一种特殊的“双端链表” ，由一系列特殊编码的连续内存块组成。可以在任意一端进行压入/弹出操作, 并且该操作的时间复杂度为 O(1)。</p><img src="/home/assets/1653985987327-463e4da8.png" alt="1653985987327" style="zoom:67%;"><table><thead><tr><th><strong>属性</strong></th><th><strong>类型</strong></th><th><strong>长度</strong></th><th><strong>用途</strong></th></tr></thead><tbody><tr><td>zlbytes</td><td>uint32_t</td><td>4 字节</td><td>记录整个压缩列表占用的内存字节数</td></tr><tr><td>zltail</td><td>uint32_t</td><td>4 字节</td><td>记录压缩列表表尾节点距离压缩列表的起始地址有多少字节，通过这个偏移量，可以确定表尾节点的地址。</td></tr><tr><td>zllen</td><td>uint16_t</td><td>2 字节</td><td>记录了压缩列表包含的节点数量。 最大值为UINT16_MAX （65534），如果超过这个值，此处会记录为65535，但节点的真实数量需要遍历整个压缩列表才能计算得出。</td></tr><tr><td>entry</td><td>列表节点</td><td>不定</td><td>压缩列表包含的各个节点，节点的长度由节点保存的内容决定。</td></tr><tr><td>zlend</td><td>uint8_t</td><td>1 字节</td><td>特殊值 0xFF （十进制 255 ），用于标记压缩列表的末端。</td></tr></tbody></table><p><strong>ZipListEntry</strong></p><p>ZipList 中的Entry并不像普通链表那样记录前后节点的指针，因为记录两个指针要占用16个字节，浪费内存。而是采用了下面的结构：</p><p><img src="data:image/png;base64,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" alt="1653986055253"></p><ul><li><p>previous_entry_length：前一节点的长度，占1个或5个字节。</p><ul><li>如果前一节点的长度小于254字节，则采用1个字节来保存这个长度值</li><li>如果前一节点的长度大于254字节，则采用5个字节来保存这个长度值，第一个字节为0xfe，后四个字节才是真实长度数据</li></ul></li><li><p>encoding：编码属性，记录content的数据类型（字符串还是整数）以及长度，占用1个、2个或5个字节</p></li><li><p>contents：负责保存节点的数据，可以是字符串或整数</p></li></ul><p>ZipList中所有存储长度的数值均采用小端字节序，即低位字节在前，高位字节在后。例如：数值0x1234，采用小端字节序后实际存储值为：0x3412</p><p><strong>Encoding编码</strong></p><p>ZipListEntry中的encoding编码分为字符串和整数两种： 字符串：如果encoding是以“00”、“01”或者“10”开头，则证明content是字符串</p><table><thead><tr><th><strong>编码</strong></th><th><strong>编码长度</strong></th><th><strong>字符串大小</strong></th></tr></thead><tbody><tr><td>|00pppppp|</td><td>1 bytes</td><td>&lt;= 63 bytes</td></tr><tr><td>|01pppppp|qqqqqqqq|</td><td>2 bytes</td><td>&lt;= 16383 bytes</td></tr><tr><td>|10000000|qqqqqqqq|rrrrrrrr|ssssssss|tttttttt|</td><td>5 bytes</td><td>&lt;= 4294967295 bytes</td></tr></tbody></table><p>例如，我们要保存字符串：“ab”和 “bc”</p><p><img src="/home/assets/1653986172002-af97d509.png" alt="1653986172002"></p><ul><li>整数：如果encoding是以“11”开始，则证明content是整数，且encoding固定只占用1个字节</li></ul><table><thead><tr><th><strong>编码</strong></th><th><strong>编码长度</strong></th><th><strong>整数类型</strong></th></tr></thead><tbody><tr><td>11000000</td><td>1</td><td>int16_t（2 bytes）</td></tr><tr><td>11010000</td><td>1</td><td>int32_t（4 bytes）</td></tr><tr><td>11100000</td><td>1</td><td>int64_t（8 bytes）</td></tr><tr><td>11110000</td><td>1</td><td>24位有符整数(3 bytes)</td></tr><tr><td>11111110</td><td>1</td><td>8位有符整数(1 bytes)</td></tr><tr><td>1111xxxx</td><td>1</td><td>直接在xxxx位置保存数值，范围从0001~1101，减1后结果为实际值</td></tr></tbody></table><h3 id="_1-5-redis数据结构-ziplist的连锁更新问题" tabindex="-1"><a class="header-anchor" href="#_1-5-redis数据结构-ziplist的连锁更新问题" aria-hidden="true">#</a> 1.5 Redis数据结构-ZipList的连锁更新问题</h3><p>ZipList的每个Entry都包含previous_entry_length来记录上一个节点的大小，长度是1个或5个字节： 如果前一节点的长度小于254字节，则采用1个字节来保存这个长度值 如果前一节点的长度大于等于254字节，则采用5个字节来保存这个长度值，第一个字节为0xfe，后四个字节才是真实长度数据 现在，假设我们有N个连续的、长度为250~253字节之间的entry，因此entry的previous_entry_length属性用1个字节即可表示，如图所示：</p><p><img src="/home/assets/1653986328124-e28b51df.png" alt="1653986328124"></p><p>ZipList这种特殊情况下产生的连续多次空间扩展操作称之为连锁更新（Cascade Update）。新增、删除都可能导致连锁更新的发生。</p><p><strong>小总结：</strong></p><p><strong>ZipList特性：</strong></p><ul><li>压缩列表的可以看做一种连续内存空间的&quot;双向链表&quot;</li><li>列表的节点之间不是通过指针连接，而是记录上一节点和本节点长度来寻址，内存占用较低</li><li>如果列表数据过多，导致链表过长，可能影响查询性能</li><li>增或删较大数据时有可能发生连续更新问题</li></ul><h3 id="_1-6-redis数据结构-quicklist" tabindex="-1"><a class="header-anchor" href="#_1-6-redis数据结构-quicklist" aria-hidden="true">#</a> 1.6 Redis数据结构-QuickList</h3><p>问题1：ZipList虽然节省内存，但申请内存必须是连续空间，如果内存占用较多，申请内存效率很低。怎么办？</p><p>​ 答：为了缓解这个问题，我们必须限制ZipList的长度和entry大小。</p><p>问题2：但是我们要存储大量数据，超出了ZipList最佳的上限该怎么办？</p><p>​ 答：我们可以创建多个ZipList来分片存储数据。</p><p>问题3：数据拆分后比较分散，不方便管理和查找，这多个ZipList如何建立联系？</p><p>​ 答：Redis在3.2版本引入了新的数据结构QuickList，它是一个双端链表，只不过链表中的每个节点都是一个ZipList。</p><p><img src="/home/assets/1653986474927-733635e1.png" alt="1653986474927"></p><p>为了避免QuickList中的每个ZipList中entry过多，Redis提供了一个配置项：list-max-ziplist-size来限制。 如果值为正，则代表ZipList的允许的entry个数的最大值 如果值为负，则代表ZipList的最大内存大小，分5种情况：</p><ul><li>-1：每个ZipList的内存占用不能超过4kb</li><li>-2：每个ZipList的内存占用不能超过8kb，默认值</li><li>-3：每个ZipList的内存占用不能超过16kb</li><li>-4：每个ZipList的内存占用不能超过32kb</li><li>-5：每个ZipList的内存占用不能超过64kb</li></ul><p>以下是QuickList的和QuickListNode的结构源码：</p><img src="/home/assets/1653986667228-ce83ecb0.png" alt="1653986667228" style="zoom:67%;"><img src="/home/assets/1653986718554-1163ff60.png" alt="1653986718554" style="zoom:67%;"><p>总结：</p><p>QuickList的特点：</p><ul><li>是一个节点为ZipList的双端链表</li><li>节点采用ZipList，解决了传统链表的内存占用问题</li><li>控制了ZipList大小，解决连续内存空间申请效率问题</li><li>中间节点可以压缩，进一步节省了内存</li></ul><h3 id="_1-7-redis数据结构-skiplist" tabindex="-1"><a class="header-anchor" href="#_1-7-redis数据结构-skiplist" aria-hidden="true">#</a> 1.7 Redis数据结构-SkipList</h3><p>SkipList（跳表）首先是链表，但与传统链表相比有几点差异： 元素按照升序排列存储 节点可能包含多个指针，指针跨度不同。</p><img src="/home/assets/1653986771309-62609583.png" alt="1653986771309" style="zoom:50%;"><p><img src="/home/assets/1653986813240-e4d31613.png" alt="1653986813240"></p><img src="/home/assets/1653986877620-c9579610.png" alt="1653986877620" style="zoom:67%;"><p>小总结：</p><p>SkipList的特点：</p><ul><li>跳跃表是一个双向链表，每个节点都包含score和ele值</li><li>节点按照score值排序，score值一样则按照ele字典排序</li><li>每个节点都可以包含多层指针，层数是1到32之间的随机数</li><li>不同层指针到下一个节点的跨度不同，层级越高，跨度越大</li><li>增删改查效率与红黑树基本一致，实现却更简单</li></ul><h3 id="_1-8-redis数据结构-redisobject" tabindex="-1"><a class="header-anchor" href="#_1-8-redis数据结构-redisobject" aria-hidden="true">#</a> 1.8 Redis数据结构-RedisObject</h3><p>Redis中的任意数据类型的键和值都会被封装为一个RedisObject，也叫做Redis对象，源码如下：</p><p>1、什么是redisObject： 从Redis的使用者的角度来看，⼀个Redis节点包含多个database（非cluster模式下默认是16个，cluster模式下只能是1个），而一个database维护了从key space到object space的映射关系。这个映射关系的key是string类型，value可以是多种数据类型，比如：string, list, hash、set、sorted set等。 从Redis内部实现来看，database内的这个映射关系是用⼀个dict来维护的。dict的key固定用⼀种数据结构来表达，这就是动态字符串sds。而value则比较复杂，为了在同⼀个dict内能够存储不同类型的value，这就需要⼀个通用的数据结构，这个通用的数据结构就是robj，全名是redisObject。</p><img src="/home/assets/1653986956618-39ded1d1.png" alt="1653986956618" style="zoom:67%;"><p>Redis的编码方式</p><p>Redis中会根据存储的数据类型不同，选择不同的编码方式，共包含11种不同类型：</p><table><thead><tr><th><strong>编号</strong></th><th><strong>编码方式</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>0</td><td>OBJ_ENCODING_RAW</td><td>raw编码动态字符串</td></tr><tr><td>1</td><td>OBJ_ENCODING_INT</td><td>long类型的整数的字符串</td></tr><tr><td>2</td><td>OBJ_ENCODING_HT</td><td>hash表（字典dict）</td></tr><tr><td>3</td><td>OBJ_ENCODING_ZIPMAP</td><td>已废弃</td></tr><tr><td>4</td><td>OBJ_ENCODING_LINKEDLIST</td><td>双端链表</td></tr><tr><td>5</td><td>OBJ_ENCODING_ZIPLIST</td><td>压缩列表</td></tr><tr><td>6</td><td>OBJ_ENCODING_INTSET</td><td>整数集合</td></tr><tr><td>7</td><td>OBJ_ENCODING_SKIPLIST</td><td>跳表</td></tr><tr><td>8</td><td>OBJ_ENCODING_EMBSTR</td><td>embstr的动态字符串</td></tr><tr><td>9</td><td>OBJ_ENCODING_QUICKLIST</td><td>快速列表</td></tr><tr><td>10</td><td>OBJ_ENCODING_STREAM</td><td>Stream流</td></tr></tbody></table><p>五种数据结构</p><p>Redis中会根据存储的数据类型不同，选择不同的编码方式。每种数据类型的使用的编码方式如下：</p><table><thead><tr><th><strong>数据类型</strong></th><th><strong>编码方式</strong></th></tr></thead><tbody><tr><td>OBJ_STRING</td><td>int、embstr、raw</td></tr><tr><td>OBJ_LIST</td><td>LinkedList和ZipList(3.2以前)、QuickList（3.2以后）</td></tr><tr><td>OBJ_SET</td><td>intset、HT</td></tr><tr><td>OBJ_ZSET</td><td>ZipList、HT、SkipList</td></tr><tr><td>OBJ_HASH</td><td>ZipList、HT</td></tr></tbody></table><h3 id="_1-9-redis数据结构-string" tabindex="-1"><a class="header-anchor" href="#_1-9-redis数据结构-string" aria-hidden="true">#</a> 1.9 Redis数据结构-String</h3><p>String是Redis中最常见的数据存储类型：</p><p>其基本编码方式是RAW，基于简单动态字符串（SDS）实现，存储上限为512mb。</p><p>如果存储的SDS长度小于44字节，则会采用EMBSTR编码，此时object head与SDS是一段连续空间。申请内存时</p><p>只需要调用一次内存分配函数，效率更高。</p><p>（1）底层实现方式：动态字符串sds 或者 long String的内部存储结构⼀般是sds（Simple Dynamic String，可以动态扩展内存），如果存储的字符串是整数值，并且大小在LONG_MAX范围内，则会采用INT编码：直接将数据保存在RedisObject的ptr指针位置（刚好8字节），不再需要SDS了。</p><img src="/home/assets/1653987202522-827dca21.png" alt="1653987202522" style="zoom:67%;"><p>确切地说，String在Redis中是⽤⼀个robj来表示的。用来表示String的robj可能编码成3种内部表⽰：OBJ_ENCODING_RAW，OBJ_ENCODING_EMBSTR，OBJ_ENCODING_INT。</p><p>其中前两种编码使用的是sds来存储，最后⼀种OBJ_ENCODING_INT编码直接把string存成了long型。 在对string进行incr, decr等操作的时候，如果它内部是OBJ_ENCODING_INT编码，那么可以直接行加减操作；如果它内部是OBJ_ENCODING_RAW或OBJ_ENCODING_EMBSTR编码，那么Redis会先试图把sds存储的字符串转成long型，如果能转成功，再进行加减操作。对⼀个内部表示成long型的string执行append, setbit, getrange这些命令，针对的仍然是string的值（即十进制表示的字符串），而不是针对内部表示的long型进行操作。</p><h3 id="_2-0-redis数据结构-list" tabindex="-1"><a class="header-anchor" href="#_2-0-redis数据结构-list" aria-hidden="true">#</a> 2.0 Redis数据结构-List</h3><p>Redis的List类型可以从首、尾操作列表中的元素</p><p>哪一个数据结构能满足上述特征？</p><ul><li>LinkedList ：普通链表，可以从双端访问，内存占用较高，内存碎片较多</li><li>ZipList ：压缩列表，可以从双端访问，内存占用低，存储上限低</li><li>QuickList：LinkedList + ZipList，可以从双端访问，内存占用较低，包含多个ZipList，存储上限高</li></ul><p>在3.2版本之前，Redis采用ZipList和LinkedList来实现List，当元素数量小于512并且元素大小小于64字节时采用ZipList编码，超过则采用LinkedList编码。</p><p>在3.2版本之后，Redis统一采用QuickList来实现List：</p><img src="/home/assets/1653987313461-738ca866.png" alt="1653987313461" style="zoom:67%;"><h3 id="_2-1-redis数据结构-set结构" tabindex="-1"><a class="header-anchor" href="#_2-1-redis数据结构-set结构" aria-hidden="true">#</a> 2.1 Redis数据结构-Set结构</h3><p>Set是Redis中的单列集合，满足下列特点：</p><ul><li>不保证有序性</li><li>保证元素唯一</li><li>求交集、并集、差集</li></ul><p>可以看出，Set对查询元素的效率要求非常高，思考一下，什么样的数据结构可以满足？ HashTable，也就是Redis中的Dict，不过Dict是双列集合（可以存键、值对）</p><p>Set是Redis中的集合，不一定确保元素有序，可以满足元素唯一、查询效率要求极高。 为了查询效率和唯一性，set采用HT编码（Dict）。Dict中的key用来存储元素，value统一为null。 当存储的所有数据都是整数，并且元素数量不超过set-max-intset-entries时，Set会采用IntSet编码，以节省内存</p><p>结构如下：</p><p>​ <img src="/home/assets/1653987454403-8011d561.png" alt="1653987454403" style="zoom:67%;"></p><h3 id="_2-2-redis数据结构-zset" tabindex="-1"><a class="header-anchor" href="#_2-2-redis数据结构-zset" aria-hidden="true">#</a> 2.2 Redis数据结构-ZSET</h3><p>ZSet也就是SortedSet，其中每一个元素都需要指定一个score值和member值：</p><ul><li>可以根据score值排序后</li><li>member必须唯一</li><li>可以根据member查询分数</li></ul><p>因此，zset底层数据结构必须满足键值存储、键必须唯一、可排序这几个需求。哪种编码结构可以满足？</p><ul><li>SkipList：可以排序，并且可以同时存储score和ele值（member）</li><li>HT（Dict）：可以键值存储，并且可以根据key找value</li></ul><img src="/home/assets/1653992121692-43a0b029.png" alt="1653992121692" style="zoom:67%;"><img src="/home/assets/1653992172526-a2898e79.png" alt="1653992172526" style="zoom:67%;"><p>当元素数量不多时，HT和SkipList的优势不明显，而且更耗内存。因此zset还会采用ZipList结构来节省内存，不过需要同时满足两个条件：</p><ul><li>元素数量小于zset_max_ziplist_entries，默认值128</li><li>每个元素都小于zset_max_ziplist_value字节，默认值64</li></ul><p>ziplist本身没有排序功能，而且没有键值对的概念，因此需要有zset通过编码实现：</p><ul><li>ZipList是连续内存，因此score和element是紧挨在一起的两个entry， element在前，score在后</li><li>score越小越接近队首，score越大越接近队尾，按照score值升序排列</li></ul><img src="/home/assets/1653992299740-db3e6952.png" alt="1653992299740" style="zoom:67%;"><h3 id="_2-3-redis数据结构-hash" tabindex="-1"><a class="header-anchor" href="#_2-3-redis数据结构-hash" aria-hidden="true">#</a> 2.3 Redis数据结构-Hash</h3><p>Hash结构与Redis中的Zset非常类似：</p><ul><li>都是键值存储</li><li>都需求根据键获取值</li><li>键必须唯一</li></ul><p>区别如下：</p><ul><li>zset的键是member，值是score；hash的键和值都是任意值</li><li>zset要根据score排序；hash则无需排序</li></ul><p>（1）底层实现方式：压缩列表ziplist 或者 字典dict 当Hash中数据项比较少的情况下，Hash底层才用压缩列表ziplist进⾏存储数据，随着数据的增加，底层的ziplist就可能会转成dict，具体配置如下：</p><ul><li><p>hash-max-ziplist-entries 512</p></li><li><p>hash-max-ziplist-value 64</p></li></ul><p>当满足上面两个条件其中之⼀的时候，Redis就使用dict字典来实现hash。 Redis的hash之所以这样设计，是因为当ziplist变得很大的时候，它有如下几个缺点：</p><ul><li>每次插入或修改引发的realloc操作会有更大的概率造成内存拷贝，从而降低性能。</li><li>⼀旦发生内存拷贝，内存拷贝的成本也相应增加，因为要拷贝更⼤的⼀块数据。</li><li>当ziplist数据项过多的时候，在它上面查找指定的数据项就会性能变得很低，因为ziplist上的查找需要进行遍历。</li></ul><p>总之，ziplist本来就设计为各个数据项挨在⼀起组成连续的内存空间，这种结构并不擅长做修改操作。⼀旦数据发生改动，就会引发内存realloc，可能导致内存拷贝。</p><p>因此，Hash底层采用的编码与Zset也基本一致，只需要把排序有关的SkipList去掉即可：</p><p>Hash结构默认采用ZipList编码，用以节省内存。 ZipList中相邻的两个entry 分别保存field和value</p><p>当数据量较大时，Hash结构会转为HT编码，也就是Dict，触发条件有两个：</p><ul><li>ZipList中的元素数量超过了hash-max-ziplist-entries（默认512）</li><li>ZipList中的任意entry大小超过了hash-max-ziplist-value（默认64字节）</li></ul><p><img src="/home/assets/1653992413406-bee7d398.png" alt="1653992413406"></p><h2 id="_2、redis网络模型" tabindex="-1"><a class="header-anchor" href="#_2、redis网络模型" aria-hidden="true">#</a> 2、Redis网络模型</h2><h3 id="_2-1-用户空间和内核态空间" tabindex="-1"><a class="header-anchor" href="#_2-1-用户空间和内核态空间" aria-hidden="true">#</a> 2.1 用户空间和内核态空间</h3><p>ubuntu和Centos 都是Linux的发行版，任何Linux发行版，其系统内核都是Linux。应用都需要通过Linux内核与硬件交互</p><p>计算机硬件包括，如cpu，内存，网卡等等，内核（通过寻址空间）可以操作硬件的，但是内核需要不同设备的驱动，有了这些驱动，内核就可以去对计算机硬件去进行 内存管理，文件系统的管理，进程的管理等等</p><img src="/home/assets/1653896065386-5f2d9e94.png" alt="1653896065386" style="zoom:40%;"><p>进程的寻址空间划分成两部分：<strong>内核空间、用户空间</strong></p><p>应用程序和内核空间，都没有办法直接访问物理内存，而是通过分配一些虚拟内存映射到物理内存中，内核和应用程序去访问虚拟内存时，需要一个虚拟地址，这个地址是一个无符号的整数，一个32位的操作系统，带宽是32，虚拟地址就是2的32次方，也就是说寻址的范围就是0~2的32次方， 这片寻址空间对应的就是2的32个字节，就是4GB，这个4GB，会有3个GB分给用户空间，会有1GB给内核系统</p><img src="/home/assets/1653896377259-aa8fe1c0.png" alt="1653896377259" style="zoom:50%;"><p>在linux中，他们权限分成两个等级，0和3，用户空间只能执行受限的命令（Ring3），而且不能直接调用系统资源，必须通过内核提供的接口来访问。内核空间可以执行特权命令（Ring0），调用一切系统资源。一般情况下，用户的操作运行在用户空间，而内核运行的数据在内核空间，如果一个应用程序需要去调用一些特权资源，去调用一些内核空间的操作，此时需要在用户态和内核态之间进行切换。</p><p>比如：</p><p>Linux系统为了提高IO效率，会在用户空间和内核空间都加入缓冲区：写数据时，要把用户缓冲数据拷贝到内核缓冲区，然后写入设备；读数据时，要从设备读取数据到内核缓冲区，然后拷贝到用户缓冲区</p><p>针对这个操作：用户在写读数据时，会去向内核态申请，想要读取内核的数据，而内核数据要等待驱动程序从硬件上读取数据，当从磁盘上加载到数据之后，内核会将数据写入到内核的缓冲区中，然后再拷贝到用户态的buffer中，然后再返回给应用程序，整体而言，速度慢，为了加速，希望read和wait for data最好不要等待，或者时间尽量的短。</p><img src="/home/assets/1653896687354-92c69283.png" alt="1653896687354" style="zoom:50%;"><h3 id="_2-2-网络模型-阻塞io" tabindex="-1"><a class="header-anchor" href="#_2-2-网络模型-阻塞io" aria-hidden="true">#</a> 2.2.网络模型-阻塞IO</h3><p>在《UNIX网络编程》一书中，总结归纳了5种IO模型：</p><ul><li>阻塞IO（Blocking IO）</li><li>非阻塞IO（Nonblocking IO）</li><li>IO多路复用（IO Multiplexing）</li><li>信号驱动IO（Signal Driven IO）</li><li>异步IO（Asynchronous IO）</li></ul><p>用户去读取数据时，会去先发起recvform一个命令，去尝试从内核上加载数据，如果内核没有数据，那么用户就会等待，此时内核会去从硬件上读取数据，内核读取数据之后，会把数据拷贝到用户态，并且返回ok，整个过程，都是阻塞等待的，这就是阻塞IO</p><p>阶段一：用户进程尝试读取数据（比如网卡数据），此时数据尚未到达，内核需要等待数据，此时用户进程也处于阻塞状态</p><p>阶段二：数据到达并拷贝到内核缓冲区，代表已就绪，将内核数据拷贝到用户缓冲区，拷贝过程中，用户进程依然阻塞等待，拷贝完成，用户进程解除阻塞，处理数据</p><p>可以看到，阻塞IO模型中，用户进程在两个阶段都是阻塞状态。</p><img src="/home/assets/1653897270074-70508d0e.png" alt="1653897270074" style="zoom:50%;"><h3 id="_2-3-网络模型-非阻塞io" tabindex="-1"><a class="header-anchor" href="#_2-3-网络模型-非阻塞io" aria-hidden="true">#</a> 2.3 网络模型-非阻塞IO</h3><p>顾名思义，非阻塞IO的recvfrom操作会立即返回结果而不是阻塞用户进程。</p><p>可以看到，非阻塞IO模型中，用户进程在第一个阶段是非阻塞，第二个阶段是阻塞状态。虽然是非阻塞，但性能并没有得到提高。而且忙等机制会导致CPU空转，CPU使用率暴增。</p><img src="/home/assets/1653897490116-cef1f821.png" alt="1653897490116" style="zoom:50%;"><h3 id="_2-4-网络模型-io多路复用" tabindex="-1"><a class="header-anchor" href="#_2-4-网络模型-io多路复用" aria-hidden="true">#</a> 2.4 网络模型-IO多路复用</h3><p>无论是阻塞IO还是非阻塞IO，用户应用在一阶段都需要调用recvfrom来获取数据，差别在于无数据时的处理方案：</p><ul><li>如果调用recvfrom时，恰好没有数据，阻塞IO会使CPU阻塞，非阻塞IO使CPU空转，都不能充分发挥CPU的作用。</li><li>如果调用recvfrom时，恰好有数据，则用户进程可以直接进入第二阶段，读取并处理数据</li></ul><p>而在单线程情况下，只能依次处理IO事件，如果正在处理的IO事件恰好未就绪（数据不可读或不可写），线程就会被阻塞，所有IO事件都必须等待，性能自然会很差。</p><p>问题：用户进程如何知道内核中数据是否就绪呢？</p><p>这个问题的解决依赖于文件描述符（File Descriptor）：简称FD，是一个从0 开始的无符号整数，用来关联Linux中的一个文件。在Linux中，一切皆文件，例如常规文件、视频、硬件设备等，也包括网络套接字（Socket）。</p><p>通过FD，网络模型可以利用一个线程监听多个FD，并在某个FD可读、可写时得到通知，从而避免无效的等待，充分利用CPU资源。</p><p>阶段一：用户进程调用select，指定要监听的FD集合，内核监听FD对应的多个socket，任意一个或多个socket数据就绪则返回readable，此过程中用户进程阻塞</p><p>阶段二：用户进程找到就绪的socket，依次调用recvfrom读取数据，内核将数据拷贝到用户空间，用户进程处理数据</p><p>用IO复用模式，可以确保去读数据的时候，数据是一定存在的，他的效率比原来的阻塞IO和非阻塞IO性能都要高</p><img src="/home/assets/1653898691736-595e7808.png" alt="1653898691736" style="zoom:50%;"><p>IO多路复用是利用单个线程来同时监听多个FD，并在某个FD可读、可写时得到通知，从而避免无效的等待，充分利用CPU资源。不过监听FD的方式、通知的方式又有多种实现，常见的有：</p><ul><li>select</li><li>poll</li><li>epoll</li></ul><h3 id="_2-5-网络模型-io多路复用-select方式" tabindex="-1"><a class="header-anchor" href="#_2-5-网络模型-io多路复用-select方式" aria-hidden="true">#</a> 2.5 网络模型-IO多路复用-select方式</h3><p>select是Linux最早是由的I/O多路复用技术：</p><p>比如要监听的数据，是1,2,5三个数据，此时会执行select函数，然后将整个fd发给内核态，内核态会去遍历用户态传递过来的数据，如果发现这里边数据都没有就绪，就休眠，直到有数据准备好时，就会被唤醒，唤醒之后，再次遍历一遍，看看谁准备好了，然后再处理掉没有准备好的数据，最后再将这个FD集合写回到用户态中去，此时用户态就知道有人准备好了，但是对于用户态而言，并不知道谁处理好了，所以用户态也需要去进行遍历，然后找到对应准备好数据的节点，再去发起读请求，我们会发现，这种模式下他虽然比阻塞IO和非阻塞IO好，但是依然有些麻烦的事情， 比如说频繁的传递fd集合，频繁的去遍历FD等问题</p><img src="/home/assets/1653900022580-36094a7b.png" alt="1653900022580" style="zoom:67%;"><h3 id="_2-6-网络模型-io多路复用模型-poll模式" tabindex="-1"><a class="header-anchor" href="#_2-6-网络模型-io多路复用模型-poll模式" aria-hidden="true">#</a> 2.6 网络模型-IO多路复用模型-poll模式</h3><p>poll模式对select模式做了简单改进，但性能提升不明显，部分关键代码如下：</p><p>IO流程：</p><ul><li>创建pollfd数组，向其中添加关注的fd信息，数组大小自定义</li><li>调用poll函数，将pollfd数组拷贝到内核空间，转链表存储，无上限</li><li>内核遍历fd，判断是否就绪</li><li>数据就绪或超时后，拷贝pollfd数组到用户空间，返回就绪fd数量n</li><li>用户进程判断n是否大于0,大于0则遍历pollfd数组，找到就绪的fd</li></ul><p><strong>与select对比：</strong></p><ul><li>select模式中的fd_set大小固定为1024，而pollfd在内核中采用链表，理论上无上限</li><li>监听FD越多，每次遍历消耗时间也越久，性能反而会下降</li></ul><h3 id="_2-7-网络模型-io多路复用模型-epoll函数" tabindex="-1"><a class="header-anchor" href="#_2-7-网络模型-io多路复用模型-epoll函数" aria-hidden="true">#</a> 2.7 网络模型-IO多路复用模型-epoll函数</h3><p>epoll模式是对select和poll的改进，它提供了三个函数：</p><p>1、epoll_create函数，内部包含两个东西</p><ol><li>红黑树-&gt; 记录的事要监听的FD</li><li>一个是链表-&gt;记录的是就绪的FD</li></ol><p>2、紧接着调用epoll_ctl操作，将要监听的数据添加到红黑树上去，并且给每个fd设置一个监听函数，这个函数会在fd数据就绪时触发，把fd数据添加到list_head中去</p><p>3、调用epoll_wait函数就去等待，在用户态创建一个空的events数组，当就绪之后，回调函数会把数据添加到list_head中去，当调用这个函数的时候，会去检查list_head，这个过程可配置等待时间，可以等一定时间，也可以一直等， 如果在此过程中，检查到了list_head中有数据添加到链表中，此时将数据放入到events数组中，并且返回对应的操作的数量，用户态收到响应后，从events中拿到对应准备好的数据的节点，再去调用方法去拿数据。</p><p>小总结：</p><p>select模式存在的三个问题：</p><ul><li>能监听的FD最大不超过1024</li><li>每次select都需要把所有要监听的FD都拷贝到内核空间</li><li>每次都要遍历所有FD来判断就绪状态</li></ul><p>poll模式的问题：</p><ul><li>poll利用链表解决了select中监听FD上限的问题，但依然要遍历所有FD，如果监听较多，性能会下降</li></ul><p>epoll模式中如何解决这些问题的？</p><ul><li>基于epoll实例中的红黑树保存要监听的FD，理论上无上限，而且增删改查效率都非常高</li><li>每个FD只需要执行一次epoll_ctl添加到红黑树，以后每次epol_wait无需传递任何参数，无需重复拷贝FD到内核空间</li><li>利用ep_poll_callback机制来监听FD状态，无需遍历所有FD，因此性能不会随监听的FD数量增多而下降</li></ul><h3 id="_2-8、网络模型-epoll中的et和lt" tabindex="-1"><a class="header-anchor" href="#_2-8、网络模型-epoll中的et和lt" aria-hidden="true">#</a> 2.8、网络模型-epoll中的ET和LT</h3><p>当FD有数据可读时，我们调用epoll_wait（或者select、poll）可以得到通知。但是事件通知的模式有两种：</p><ul><li>LevelTriggered：简称LT，也叫做水平触发。只要某个FD中有数据可读，每次调用epoll_wait都会得到通知。</li><li>EdgeTriggered：简称ET，也叫做边沿触发。只有在某个FD有状态变化时，调用epoll_wait才会被通知。</li></ul><p>举个栗子：</p><ul><li>假设一个客户端socket对应的FD已经注册到了epoll实例中</li><li>客户端socket发送了2kb的数据</li><li>服务端调用epoll_wait，得到通知说FD就绪</li><li>服务端从FD读取了1kb数据回到步骤3（再次调用epoll_wait，形成循环）</li></ul><p>结论</p><p>如果我们采用LT模式，因为FD中仍有1kb数据，则第⑤步依然会返回结果，并且得到通知 如果我们采用ET模式，因为第③步已经消费了FD可读事件，第⑤步FD状态没有变化，因此epoll_wait不会返回，数据无法读取，客户端响应超时。</p><h3 id="_2-9-网络模型-基于epoll的服务器端流程" tabindex="-1"><a class="header-anchor" href="#_2-9-网络模型-基于epoll的服务器端流程" aria-hidden="true">#</a> 2.9 网络模型-基于epoll的服务器端流程</h3><p><img src="/home/assets/1653902845082-ebaca184.png" alt="1653902845082"></p><h3 id="_3-0-、网络模型-信号驱动" tabindex="-1"><a class="header-anchor" href="#_3-0-、网络模型-信号驱动" aria-hidden="true">#</a> 3.0 、网络模型-信号驱动</h3><p>信号驱动IO是与内核建立SIGIO的信号关联并设置回调，当内核有FD就绪时，会发出SIGIO信号通知用户，期间用户应用可以执行其它业务，无需阻塞等待。</p><p>阶段一：用户进程调用sigaction，注册信号处理函数；内核返回成功，开始监听FD；用户进程不阻塞等待，可以执行其它业务；当内核数据就绪后，回调用户进程的SIGIO处理函数</p><p>阶段二：收到SIGIO回调信号；调用recvfrom，读取；内核将数据拷贝到用户空间；用户进程处理数据</p><img src="/home/assets/1653911776583-6282afd4.png" alt="1653911776583" style="zoom:50%;"><p>当有大量IO操作时，信号较多，SIGIO处理函数不能及时处理可能导致信号队列溢出，而且内核空间与用户空间的频繁信号交互性能也较低。</p><h4 id="_3-0-1-异步io" tabindex="-1"><a class="header-anchor" href="#_3-0-1-异步io" aria-hidden="true">#</a> 3.0.1 异步IO</h4><p>这种方式，不仅仅是用户态在试图读取数据后，不阻塞，而且当内核的数据准备完成后，也不会阻塞</p><p>他会由内核将所有数据处理完成后，由内核将数据写入到用户态中，然后才算完成，所以性能极高，不会有任何阻塞，全部都由内核完成，可以看到，异步IO模型中，用户进程在两个阶段都是非阻塞状态。</p><img src="/home/assets/1653911877542-457f8c56.png" alt="1653911877542" style="zoom:50%;"><h4 id="_3-0-2-对比" tabindex="-1"><a class="header-anchor" href="#_3-0-2-对比" aria-hidden="true">#</a> 3.0.2 对比</h4><p>最后用一幅图，来说明他们之间的区别</p><img src="/home/assets/1653912219712-4bd9bafe.png" alt="1653912219712" style="zoom:50%;"><h3 id="_3-1-、网络模型-redis是单线程的吗-为什么使用单线程" tabindex="-1"><a class="header-anchor" href="#_3-1-、网络模型-redis是单线程的吗-为什么使用单线程" aria-hidden="true">#</a> 3.1 、网络模型-Redis是单线程的吗？为什么使用单线程</h3><p><strong>Redis到底是单线程还是多线程？</strong></p><ul><li>如果仅仅聊Redis的核心业务部分（命令处理），答案是单线程</li><li>如果是聊整个Redis，那么答案就是多线程</li></ul><p>在Redis版本迭代过程中，在两个重要的时间节点上引入了多线程的支持：</p><ul><li>Redis v4.0：引入多线程异步处理一些耗时较旧的任务，例如异步删除命令unlink</li><li>Redis v6.0：在核心网络模型中引入多线程，进一步提高对于多核CPU的利用率</li></ul><p>因此，对于Redis的核心网络模型，在Redis 6.0之前确实都是单线程。是利用epoll（Linux系统）这样的IO多路复用技术在事件循环中不断处理客户端情况。</p><p><strong>为什么Redis要选择单线程？</strong></p><ul><li>抛开持久化不谈，Redis是纯 内存操作，执行速度非常快，它的性能瓶颈是网络延迟而不是执行速度，因此多线程并不会带来巨大的性能提升。</li><li>多线程会导致过多的上下文切换，带来不必要的开销</li><li>引入多线程会面临线程安全问题，必然要引入线程锁这样的安全手段，实现复杂度增高，而且性能也会大打折扣</li></ul><h3 id="_3-2-、redis的单线程模型-redis单线程和多线程网络模型变更" tabindex="-1"><a class="header-anchor" href="#_3-2-、redis的单线程模型-redis单线程和多线程网络模型变更" aria-hidden="true">#</a> 3.2 、Redis的单线程模型-Redis单线程和多线程网络模型变更</h3><p>多线程主要用在连接应答和命令请求和命令恢复等网络IO上，处理执行命令仍然是单线程</p><p><img src="/home/assets/1653982278727-48ee8000.png" alt="1653982278727"></p><h2 id="_3、redis通信协议-resp协议" tabindex="-1"><a class="header-anchor" href="#_3、redis通信协议-resp协议" aria-hidden="true">#</a> 3、Redis通信协议-RESP协议</h2><p>Redis是一个CS架构的软件，通信一般分两步（不包括pipeline和PubSub）：</p><ol><li><p>客户端（client）向服务端（server）发送一条命令</p></li><li><p>服务端解析并执行命令，返回响应结果给客户端</p></li></ol><p>因此客户端发送命令的格式、服务端响应结果的格式必须有一个规范，这个规范就是通信协议。</p><p>而在Redis中采用的是RESP（Redis Serialization Protocol）协议：</p><ul><li><p>Redis 1.2版本引入了RESP协议</p></li><li><p>Redis 2.0版本中成为与Redis服务端通信的标准，称为RESP2</p></li><li><p>Redis 6.0版本中，从RESP2升级到了RESP3协议，增加了更多数据类型并且支持6.0的新特性--客户端缓存</p></li></ul><p>但目前，默认使用的依然是RESP2协议（以下简称RESP）。</p><p>在RESP中，通过首字节的字符来区分不同数据类型，常用的数据类型包括5种：</p><ul><li><p>单行字符串：首字节是 ‘+’ ，后面跟上单行字符串，以CRLF（ &quot;\r\n&quot; ）结尾。例如返回&quot;OK&quot;： &quot;+OK\r\n&quot;</p></li><li><p>错误（Errors）：首字节是 ‘-’ ，与单行字符串格式一样，只是字符串是异常信息，例如：&quot;-Error message\r\n&quot;</p></li><li><p>数值：首字节是 ‘:’ ，后面跟上数字格式的字符串，以CRLF结尾。例如：&quot;:10\r\n&quot;</p></li><li><p>多行字符串：首字节是 ‘$’ ，表示二进制安全的字符串，最大支持512MB：</p><ul><li><p>如果大小为0，则代表空字符串：&quot;$0\r\n\r\n&quot;</p></li><li><p>如果大小为-1，则代表不存在：&quot;$-1\r\n&quot;</p></li></ul></li><li><p>数组：首字节是 ‘*’，后面跟上数组元素个数，再跟上元素，元素数据类型不限:</p></li></ul><img src="/home/assets/1653982993020-a90fd7e9.png" alt="1653982993020" style="zoom:50%;"><h2 id="_4、redis内存回收" tabindex="-1"><a class="header-anchor" href="#_4、redis内存回收" aria-hidden="true">#</a> 4、Redis内存回收</h2><h3 id="_4-1-过期key处理" tabindex="-1"><a class="header-anchor" href="#_4-1-过期key处理" aria-hidden="true">#</a> 4.1. 过期key处理</h3><p>Redis之所以性能强，最主要的原因就是基于内存存储。然而单节点的Redis其内存大小不宜过大，会影响持久化或主从同步性能。 我可以通过修改配置文件来设置Redis的最大内存：</p><p><img src="/home/assets/1653983341150-ac269a35.png" alt="1653983341150"></p><p>当内存使用达到上限时，Redis提供了一些策略实现内存回收：内存过期策略</p><p>Redis本身是一个典型的key-value内存存储数据库，因此所有的key、value都保存在之前学习过的Dict结构中。不过在其database结构体中，有两个Dict：一个用来记录key-value；另一个用来记录key-TTL。</p><img src="/home/assets/1653983423128-24294c84.png" alt="1653983423128" style="zoom:67%;"><img src="/home/assets/1653983606531-4492a5e4.png" alt="1653983606531" style="zoom:50%;"><p>这里有两个问题需要我们思考： Redis是如何知道一个key是否过期呢？</p><p>利用两个Dict分别记录key-value对及key-ttl对，是不是TTL到期就立即删除了呢？</p><p><strong>惰性删除</strong></p><p>惰性删除：在访问一个key的时候，检查该key的存活时间，如果已经过期才执行删除。</p><p><strong>周期删除</strong></p><p>周期删除：通过一个定时任务，周期性的抽样部分过期的key，然后执行删除。执行周期有两种：</p><ul><li>Redis服务初始化函数initServer()中设置定时任务，按照server.hz的频率来执行过期key清理，模式为SLOW</li><li>Redis的每个事件循环前会调用beforeSleep()函数，执行过期key清理，模式为FAST</li></ul><p>SLOW模式规则：</p><ul><li>执行频率受server.hz影响，默认为10，即每秒执行10次，每个执行周期100ms。</li><li>执行清理耗时不超过一次执行周期的25%.默认slow模式耗时不超过25ms</li><li>逐个遍历db，逐个遍历db中的bucket，抽取20个key判断是否过期</li><li>如果没达到时间上限（25ms）并且过期key比例大于10%，再进行一次抽样，否则结束</li></ul><p>FAST模式规则（过期key比例小于10%不执行 ）：</p><ul><li>执行频率受beforeSleep()调用频率影响，但两次FAST模式间隔不低于2ms</li><li>执行清理耗时不超过1ms</li><li>逐个遍历db，逐个遍历db中的bucket，抽取20个key判断是否过期</li><li>如果没达到时间上限（1ms）并且过期key比例大于10%，再进行一次抽样，否则结束</li></ul><h3 id="_4-2-内存淘汰策略" tabindex="-1"><a class="header-anchor" href="#_4-2-内存淘汰策略" aria-hidden="true">#</a> 4.2. 内存淘汰策略</h3><p>内存淘汰：就是当Redis内存使用达到设置的上限时，主动挑选部分key删除以释放更多内存的流程。Redis会在处理客户端命令的方法processCommand()中尝试做内存淘汰：</p><img src="/home/assets/1653983978671-635cddb3.png" alt="1653983978671" style="zoom:67%;"><p>淘汰策略</p><p>Redis支持8种不同策略来选择要删除的key：</p><ul><li>noeviction： 不淘汰任何key，但是内存满时不允许写入新数据，默认就是这种策略。</li><li>volatile-ttl： 对设置了TTL的key，比较key的剩余TTL值，TTL越小越先被淘汰</li><li>allkeys-random：对全体key ，随机进行淘汰。也就是直接从db-&gt;dict中随机挑选</li><li>volatile-random：对设置了TTL的key ，随机进行淘汰。也就是从db-&gt;expires中随机挑选。</li><li>allkeys-lru： 对全体key，基于LRU算法进行淘汰</li><li>volatile-lru： 对设置了TTL的key，基于LRU算法进行淘汰</li><li>allkeys-lfu： 对全体key，基于LFU算法进行淘汰</li><li>volatile-lfu： 对设置了TTL的key，基于LFI算法进行淘汰 比较容易混淆的有两个： <ul><li>LRU（Least Recently Used），最少最近使用。用当前时间减去最后一次访问时间，这个值越大则淘汰优先级越高。</li><li>LFU（Least Frequently Used），最少频率使用。会统计每个key的访问频率，值越小淘汰优先级越高。</li></ul></li></ul><p>Redis的数据都会被封装为RedisObject结构：</p><p><img src="/home/assets/1653984029506-e78b907c.png" alt="1653984029506"></p><p>LFU的访问次数之所以叫做逻辑访问次数（随着访问次数增长，+1概率越来越小，以保证不会增长太快），是因为并不是每次key被访问都计数，而是通过运算：</p><ul><li>生成0~1之间的随机数R</li><li>计算 (旧次数 * lfu_log_factor + 1)，记录为P</li><li>如果 R &lt; P ，则计数器 + 1，且最大不超过255</li><li>访问次数会随时间衰减，距离上一次访问时间每隔 lfu_decay_time 分钟，计数器 -1</li></ul><img src="/home/assets/1653984085095-47319d1e.png" alt="1653984085095" style="zoom:67%;"></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1743760069@qq.com">liushun</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 1743760069@qq.com">liushun-ing</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/home/master/redis/3.html" class="" aria-label="Redis高级"><!--[--><!--]--> Redis高级 <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/home/assets/app-d0fb739e.js" defer></script>
  </body>
</html>
