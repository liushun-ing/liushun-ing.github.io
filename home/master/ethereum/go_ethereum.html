<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.62">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/imgs/favicon.ico"><title>Go Ehthereum编程 | 不愿飞的蜂鸟首页</title><meta name="description" content="Five的垃圾库">
    <link rel="preload" href="/home/assets/style-d11d67ee.css" as="style"><link rel="stylesheet" href="/home/assets/style-d11d67ee.css">
    <link rel="modulepreload" href="/home/assets/app-3a70664a.js"><link rel="modulepreload" href="/home/assets/go_ethereum.html-bd351492.js"><link rel="modulepreload" href="/home/assets/go_ethereum.html-d7d46040.js"><link rel="prefetch" href="/home/assets/index.html-5f18312a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-88b7806c.js" as="script"><link rel="prefetch" href="/home/assets/index.html-285dc5e2.js" as="script"><link rel="prefetch" href="/home/assets/index.html-655005a5.js" as="script"><link rel="prefetch" href="/home/assets/1.html-b316c5ed.js" as="script"><link rel="prefetch" href="/home/assets/2.html-ac2ea519.js" as="script"><link rel="prefetch" href="/home/assets/3.html-a16fc765.js" as="script"><link rel="prefetch" href="/home/assets/4.html-798018cd.js" as="script"><link rel="prefetch" href="/home/assets/5.html-18ce25f4.js" as="script"><link rel="prefetch" href="/home/assets/6.html-f31143bd.js" as="script"><link rel="prefetch" href="/home/assets/index.html-d4d6df4d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b98c27b4.js" as="script"><link rel="prefetch" href="/home/assets/algorithms.html-f5b5ee0a.js" as="script"><link rel="prefetch" href="/home/assets/c__.html-05ab7a9e.js" as="script"><link rel="prefetch" href="/home/assets/graph.html-dab7b16e.js" as="script"><link rel="prefetch" href="/home/assets/leetcode.html-f105e9f1.js" as="script"><link rel="prefetch" href="/home/assets/other_tree.html-22fe33b0.js" as="script"><link rel="prefetch" href="/home/assets/sort_and_search.html-11f53bfb.js" as="script"><link rel="prefetch" href="/home/assets/string.html-e9db3916.js" as="script"><link rel="prefetch" href="/home/assets/tree.html-ec32110e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-99884eac.js" as="script"><link rel="prefetch" href="/home/assets/10.html-75dc6e9d.js" as="script"><link rel="prefetch" href="/home/assets/11.html-44ed8d03.js" as="script"><link rel="prefetch" href="/home/assets/12.html-1cafae42.js" as="script"><link rel="prefetch" href="/home/assets/13.html-cf9e5046.js" as="script"><link rel="prefetch" href="/home/assets/14.html-513b431e.js" as="script"><link rel="prefetch" href="/home/assets/2.html-094a87ee.js" as="script"><link rel="prefetch" href="/home/assets/3.html-4a8b2796.js" as="script"><link rel="prefetch" href="/home/assets/4.html-1f39f3b9.js" as="script"><link rel="prefetch" href="/home/assets/5.html-e78784fc.js" as="script"><link rel="prefetch" href="/home/assets/6.html-cc4acb22.js" as="script"><link rel="prefetch" href="/home/assets/7.html-ff096a2a.js" as="script"><link rel="prefetch" href="/home/assets/8.html-14b4319a.js" as="script"><link rel="prefetch" href="/home/assets/9.html-f1fd1f24.js" as="script"><link rel="prefetch" href="/home/assets/index.html-47fde470.js" as="script"><link rel="prefetch" href="/home/assets/1.html-769a7684.js" as="script"><link rel="prefetch" href="/home/assets/2.html-594984b8.js" as="script"><link rel="prefetch" href="/home/assets/3.html-5ac058a8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-8a655167.js" as="script"><link rel="prefetch" href="/home/assets/index.html-994c7095.js" as="script"><link rel="prefetch" href="/home/assets/base_concept.html-8c9eb618.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-6eb25c4d.js" as="script"><link rel="prefetch" href="/home/assets/pytorch_usage.html-12ebfb9e.js" as="script"><link rel="prefetch" href="/home/assets/23_Dec.html-b55b0d44.js" as="script"><link rel="prefetch" href="/home/assets/23_Nov.html-7f12af9c.js" as="script"><link rel="prefetch" href="/home/assets/24_Jan.html-aa29373f.js" as="script"><link rel="prefetch" href="/home/assets/index.html-cf670ace.js" as="script"><link rel="prefetch" href="/home/assets/index.html-e9115f16.js" as="script"><link rel="prefetch" href="/home/assets/compose.html-72dd1522.js" as="script"><link rel="prefetch" href="/home/assets/image_construct.html-803fa8bb.js" as="script"><link rel="prefetch" href="/home/assets/intro.html-c97d438d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-f811e8dd.js" as="script"><link rel="prefetch" href="/home/assets/account.html-47f502bc.js" as="script"><link rel="prefetch" href="/home/assets/block.html-31e7ef19.js" as="script"><link rel="prefetch" href="/home/assets/consensus.html-30907298.js" as="script"><link rel="prefetch" href="/home/assets/contract.html-e2491594.js" as="script"><link rel="prefetch" href="/home/assets/crypto_base.html-b0adac25.js" as="script"><link rel="prefetch" href="/home/assets/erc20.html-09072934.js" as="script"><link rel="prefetch" href="/home/assets/ethereum_base.html-797620fb.js" as="script"><link rel="prefetch" href="/home/assets/evm.html-5610d382.js" as="script"><link rel="prefetch" href="/home/assets/gas.html-b053b8b6.js" as="script"><link rel="prefetch" href="/home/assets/hd_wallet.html-ae0be758.js" as="script"><link rel="prefetch" href="/home/assets/jsonrpc.html-90b3a2c8.js" as="script"><link rel="prefetch" href="/home/assets/leveldb.html-605fbfc4.js" as="script"><link rel="prefetch" href="/home/assets/mpt.html-9189c5ca.js" as="script"><link rel="prefetch" href="/home/assets/node_client.html-89389d22.js" as="script"><link rel="prefetch" href="/home/assets/rlp.html-1b7293ff.js" as="script"><link rel="prefetch" href="/home/assets/statedb.html-4d248f7e.js" as="script"><link rel="prefetch" href="/home/assets/transaction.html-73fe59ae.js" as="script"><link rel="prefetch" href="/home/assets/index.html-f56755d4.js" as="script"><link rel="prefetch" href="/home/assets/gin.html-c35ac778.js" as="script"><link rel="prefetch" href="/home/assets/gorm.html-9463b0eb.js" as="script"><link rel="prefetch" href="/home/assets/protobuf.html-74f689e2.js" as="script"><link rel="prefetch" href="/home/assets/rpc.html-52462055.js" as="script"><link rel="prefetch" href="/home/assets/framework.html-26732a5d.js" as="script"><link rel="prefetch" href="/home/assets/interview.html-c43e6b5a.js" as="script"><link rel="prefetch" href="/home/assets/javabase.html-4b7acc92.js" as="script"><link rel="prefetch" href="/home/assets/javacollection.html-7d0eec7c.js" as="script"><link rel="prefetch" href="/home/assets/javaio.html-2e0ce7a0.js" as="script"><link rel="prefetch" href="/home/assets/javajuc.html-e3adfcb3.js" as="script"><link rel="prefetch" href="/home/assets/project.html-ee5d4ecd.js" as="script"><link rel="prefetch" href="/home/assets/1.html-8f3c150c.js" as="script"><link rel="prefetch" href="/home/assets/2.html-35ec231b.js" as="script"><link rel="prefetch" href="/home/assets/3.html-5d7e2173.js" as="script"><link rel="prefetch" href="/home/assets/4.html-b019902a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-dd915206.js" as="script"><link rel="prefetch" href="/home/assets/1.html-f201c773.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3732bf90.js" as="script"><link rel="prefetch" href="/home/assets/index.html-9e6553b4.js" as="script"><link rel="prefetch" href="/home/assets/mybatis.html-9fde4bbc.js" as="script"><link rel="prefetch" href="/home/assets/1.html-86ebf5bf.js" as="script"><link rel="prefetch" href="/home/assets/2.html-ef334cb2.js" as="script"><link rel="prefetch" href="/home/assets/index.html-beacf8a6.js" as="script"><link rel="prefetch" href="/home/assets/index.html-5747b02b.js" as="script"><link rel="prefetch" href="/home/assets/base_usage.html-313edb82.js" as="script"><link rel="prefetch" href="/home/assets/1.html-84171baf.js" as="script"><link rel="prefetch" href="/home/assets/2.html-96474bc6.js" as="script"><link rel="prefetch" href="/home/assets/3.html-20b1a547.js" as="script"><link rel="prefetch" href="/home/assets/4.html-37db0907.js" as="script"><link rel="prefetch" href="/home/assets/index.html-9d407164.js" as="script"><link rel="prefetch" href="/home/assets/index.html-524f529c.js" as="script"><link rel="prefetch" href="/home/assets/jwt.html-c1c6066a.js" as="script"><link rel="prefetch" href="/home/assets/shiro.html-e4c32de8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-08bf43f7.js" as="script"><link rel="prefetch" href="/home/assets/nacos.html-ed2737e7.js" as="script"><link rel="prefetch" href="/home/assets/index.html-60425c3d.js" as="script"><link rel="prefetch" href="/home/assets/spring_annotation.html-3e4c4f76.js" as="script"><link rel="prefetch" href="/home/assets/springboot.html-dd3747fd.js" as="script"><link rel="prefetch" href="/home/assets/springboot_base.html-cd23c0a8.js" as="script"><link rel="prefetch" href="/home/assets/1.html-51f0ec55.js" as="script"><link rel="prefetch" href="/home/assets/2.html-a59bf622.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b0e9f560.js" as="script"><link rel="prefetch" href="/home/assets/index.html-1bcb2be9.js" as="script"><link rel="prefetch" href="/home/assets/docker_tutorial.html-4f5d0900.js" as="script"><link rel="prefetch" href="/home/assets/firewall_tutorial.html-a1c0f732.js" as="script"><link rel="prefetch" href="/home/assets/mysql_tutorial.html-4c6ba5d6.js" as="script"><link rel="prefetch" href="/home/assets/nginx_tutorial.html-93df5119.js" as="script"><link rel="prefetch" href="/home/assets/other_tutorial.html-c3d0505a.js" as="script"><link rel="prefetch" href="/home/assets/5.html-a4a0234f.js" as="script"><link rel="prefetch" href="/home/assets/6.html-d1f646bc.js" as="script"><link rel="prefetch" href="/home/assets/7.html-4bfc5de3.js" as="script"><link rel="prefetch" href="/home/assets/Mybatis.html-999b181b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3e3eac32.js" as="script"><link rel="prefetch" href="/home/assets/Spring.html-ebdaae63.js" as="script"><link rel="prefetch" href="/home/assets/SpringBoot.html-c1676d63.js" as="script"><link rel="prefetch" href="/home/assets/SpringMVC.html-7bf971fc.js" as="script"><link rel="prefetch" href="/home/assets/index.html-dbf7dd00.js" as="script"><link rel="prefetch" href="/home/assets/java_usage.html-baf8cd68.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-5785b28e.js" as="script"><link rel="prefetch" href="/home/assets/system_usage.html-e9649787.js" as="script"><link rel="prefetch" href="/home/assets/1.html-095f3a2d.js" as="script"><link rel="prefetch" href="/home/assets/2.html-820329b9.js" as="script"><link rel="prefetch" href="/home/assets/3.html-65fa04a9.js" as="script"><link rel="prefetch" href="/home/assets/4.html-6cc0fdbb.js" as="script"><link rel="prefetch" href="/home/assets/5.html-4382da55.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2c443520.js" as="script"><link rel="prefetch" href="/home/assets/index.html-0a2a0106.js" as="script"><link rel="prefetch" href="/home/assets/less.html-26b18828.js" as="script"><link rel="prefetch" href="/home/assets/sass.html-e33a9ecf.js" as="script"><link rel="prefetch" href="/home/assets/1.html-e6ed9dbf.js" as="script"><link rel="prefetch" href="/home/assets/2.html-76ba2e41.js" as="script"><link rel="prefetch" href="/home/assets/index.html-202d5f4b.js" as="script"><link rel="prefetch" href="/home/assets/1.html-c051337a.js" as="script"><link rel="prefetch" href="/home/assets/2.html-c475ae33.js" as="script"><link rel="prefetch" href="/home/assets/index.html-7a9eb86e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-2d63875b.js" as="script"><link rel="prefetch" href="/home/assets/2.html-96ffe2d7.js" as="script"><link rel="prefetch" href="/home/assets/3.html-164f28d8.js" as="script"><link rel="prefetch" href="/home/assets/4.html-770067b7.js" as="script"><link rel="prefetch" href="/home/assets/5.html-94e4a58f.js" as="script"><link rel="prefetch" href="/home/assets/6.html-5fbe2511.js" as="script"><link rel="prefetch" href="/home/assets/7.html-6aaf4692.js" as="script"><link rel="prefetch" href="/home/assets/8.html-6c442319.js" as="script"><link rel="prefetch" href="/home/assets/9.html-1a1241a0.js" as="script"><link rel="prefetch" href="/home/assets/index.html-ca14f1ca.js" as="script"><link rel="prefetch" href="/home/assets/new.html-f39ecd3a.js" as="script"><link rel="prefetch" href="/home/assets/1.html-f45e37f8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3b81aa58.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3505c412.js" as="script"><link rel="prefetch" href="/home/assets/uniCloud.html-d6f4a4e6.js" as="script"><link rel="prefetch" href="/home/assets/uniTips.html-c522b2d1.js" as="script"><link rel="prefetch" href="/home/assets/1.html-3be78b60.js" as="script"><link rel="prefetch" href="/home/assets/index.html-6602172a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-dcc009ab.js" as="script"><link rel="prefetch" href="/home/assets/api_tutorial.html-201e8b68.js" as="script"><link rel="prefetch" href="/home/assets/base_tutorial.html-553e9cd8.js" as="script"><link rel="prefetch" href="/home/assets/pinia.html-93944f84.js" as="script"><link rel="prefetch" href="/home/assets/vue2.html-396e5caf.js" as="script"><link rel="prefetch" href="/home/assets/vue3_1.html-a3f127a4.js" as="script"><link rel="prefetch" href="/home/assets/vue3_2.html-52a41818.js" as="script"><link rel="prefetch" href="/home/assets/1.html-6b5b0d34.js" as="script"><link rel="prefetch" href="/home/assets/index.html-f9a24ca8.js" as="script"><link rel="prefetch" href="/home/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-9b4d925d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2af3afcf.js" as="script"><link rel="prefetch" href="/home/assets/index.html-57638329.js" as="script"><link rel="prefetch" href="/home/assets/index.html-8b580085.js" as="script"><link rel="prefetch" href="/home/assets/1.html-e8d8aca8.js" as="script"><link rel="prefetch" href="/home/assets/2.html-36b45dd1.js" as="script"><link rel="prefetch" href="/home/assets/3.html-d7effbec.js" as="script"><link rel="prefetch" href="/home/assets/4.html-d5d6d70e.js" as="script"><link rel="prefetch" href="/home/assets/5.html-7942d082.js" as="script"><link rel="prefetch" href="/home/assets/6.html-a17cc6ec.js" as="script"><link rel="prefetch" href="/home/assets/index.html-262af02b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-80787449.js" as="script"><link rel="prefetch" href="/home/assets/algorithms.html-f54eed98.js" as="script"><link rel="prefetch" href="/home/assets/c__.html-606e9969.js" as="script"><link rel="prefetch" href="/home/assets/graph.html-d8e4cbb7.js" as="script"><link rel="prefetch" href="/home/assets/leetcode.html-0db8e5e1.js" as="script"><link rel="prefetch" href="/home/assets/other_tree.html-7d5c4855.js" as="script"><link rel="prefetch" href="/home/assets/sort_and_search.html-8b531def.js" as="script"><link rel="prefetch" href="/home/assets/string.html-a2554467.js" as="script"><link rel="prefetch" href="/home/assets/tree.html-4e44d7e4.js" as="script"><link rel="prefetch" href="/home/assets/1.html-fbdbfb34.js" as="script"><link rel="prefetch" href="/home/assets/10.html-dc7e2f1e.js" as="script"><link rel="prefetch" href="/home/assets/11.html-b6827ab9.js" as="script"><link rel="prefetch" href="/home/assets/12.html-d5ab9c33.js" as="script"><link rel="prefetch" href="/home/assets/13.html-ca92b990.js" as="script"><link rel="prefetch" href="/home/assets/14.html-e71ea19b.js" as="script"><link rel="prefetch" href="/home/assets/2.html-6d0ee1cc.js" as="script"><link rel="prefetch" href="/home/assets/3.html-9eba99ff.js" as="script"><link rel="prefetch" href="/home/assets/4.html-3cd26ba5.js" as="script"><link rel="prefetch" href="/home/assets/5.html-f27ba796.js" as="script"><link rel="prefetch" href="/home/assets/6.html-84c6c23a.js" as="script"><link rel="prefetch" href="/home/assets/7.html-afb93339.js" as="script"><link rel="prefetch" href="/home/assets/8.html-96a07621.js" as="script"><link rel="prefetch" href="/home/assets/9.html-2b3686b0.js" as="script"><link rel="prefetch" href="/home/assets/index.html-407c7ee0.js" as="script"><link rel="prefetch" href="/home/assets/1.html-bd9ab95c.js" as="script"><link rel="prefetch" href="/home/assets/2.html-245204fb.js" as="script"><link rel="prefetch" href="/home/assets/3.html-fa2834dd.js" as="script"><link rel="prefetch" href="/home/assets/index.html-c994da2c.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2b9ac6e4.js" as="script"><link rel="prefetch" href="/home/assets/base_concept.html-f98a981e.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-63464a84.js" as="script"><link rel="prefetch" href="/home/assets/pytorch_usage.html-feffea21.js" as="script"><link rel="prefetch" href="/home/assets/23_Dec.html-26ce4183.js" as="script"><link rel="prefetch" href="/home/assets/23_Nov.html-c5bd0842.js" as="script"><link rel="prefetch" href="/home/assets/24_Jan.html-a890e34d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-15d9862b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-611c0903.js" as="script"><link rel="prefetch" href="/home/assets/compose.html-3bd1b8d2.js" as="script"><link rel="prefetch" href="/home/assets/image_construct.html-edc09f46.js" as="script"><link rel="prefetch" href="/home/assets/intro.html-8f90a7eb.js" as="script"><link rel="prefetch" href="/home/assets/index.html-4da6dbc2.js" as="script"><link rel="prefetch" href="/home/assets/account.html-5d67a23a.js" as="script"><link rel="prefetch" href="/home/assets/block.html-ff648911.js" as="script"><link rel="prefetch" href="/home/assets/consensus.html-de3babe3.js" as="script"><link rel="prefetch" href="/home/assets/contract.html-debeab37.js" as="script"><link rel="prefetch" href="/home/assets/crypto_base.html-3689ede5.js" as="script"><link rel="prefetch" href="/home/assets/erc20.html-e73c92d7.js" as="script"><link rel="prefetch" href="/home/assets/ethereum_base.html-d7bb5fd2.js" as="script"><link rel="prefetch" href="/home/assets/evm.html-b75a8509.js" as="script"><link rel="prefetch" href="/home/assets/gas.html-0dd479f6.js" as="script"><link rel="prefetch" href="/home/assets/hd_wallet.html-7bd3f780.js" as="script"><link rel="prefetch" href="/home/assets/jsonrpc.html-8c3b2d3e.js" as="script"><link rel="prefetch" href="/home/assets/leveldb.html-5b59fc13.js" as="script"><link rel="prefetch" href="/home/assets/mpt.html-77a2dde4.js" as="script"><link rel="prefetch" href="/home/assets/node_client.html-64118a95.js" as="script"><link rel="prefetch" href="/home/assets/rlp.html-7c02d952.js" as="script"><link rel="prefetch" href="/home/assets/statedb.html-740923d7.js" as="script"><link rel="prefetch" href="/home/assets/transaction.html-48b8aa68.js" as="script"><link rel="prefetch" href="/home/assets/index.html-640c42f5.js" as="script"><link rel="prefetch" href="/home/assets/gin.html-22881da1.js" as="script"><link rel="prefetch" href="/home/assets/gorm.html-e0521735.js" as="script"><link rel="prefetch" href="/home/assets/protobuf.html-c844c72e.js" as="script"><link rel="prefetch" href="/home/assets/rpc.html-5b585575.js" as="script"><link rel="prefetch" href="/home/assets/framework.html-22e12347.js" as="script"><link rel="prefetch" href="/home/assets/interview.html-7021ed57.js" as="script"><link rel="prefetch" href="/home/assets/javabase.html-e8179932.js" as="script"><link rel="prefetch" href="/home/assets/javacollection.html-0a35154a.js" as="script"><link rel="prefetch" href="/home/assets/javaio.html-ed664def.js" as="script"><link rel="prefetch" href="/home/assets/javajuc.html-51987aa3.js" as="script"><link rel="prefetch" href="/home/assets/project.html-ddfb3f6e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-a523fc37.js" as="script"><link rel="prefetch" href="/home/assets/2.html-20d25a6e.js" as="script"><link rel="prefetch" href="/home/assets/3.html-e63956a6.js" as="script"><link rel="prefetch" href="/home/assets/4.html-fc334b77.js" as="script"><link rel="prefetch" href="/home/assets/index.html-5d71a11d.js" as="script"><link rel="prefetch" href="/home/assets/1.html-23c3ea38.js" as="script"><link rel="prefetch" href="/home/assets/index.html-7e8d1624.js" as="script"><link rel="prefetch" href="/home/assets/index.html-7e11df11.js" as="script"><link rel="prefetch" href="/home/assets/mybatis.html-825ab04e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-a9666f58.js" as="script"><link rel="prefetch" href="/home/assets/2.html-26e260ec.js" as="script"><link rel="prefetch" href="/home/assets/index.html-d796efe6.js" as="script"><link rel="prefetch" href="/home/assets/index.html-d8d4f6f6.js" as="script"><link rel="prefetch" href="/home/assets/base_usage.html-b8e182a8.js" as="script"><link rel="prefetch" href="/home/assets/1.html-604a37ca.js" as="script"><link rel="prefetch" href="/home/assets/2.html-9e4a4327.js" as="script"><link rel="prefetch" href="/home/assets/3.html-fb8c898d.js" as="script"><link rel="prefetch" href="/home/assets/4.html-a9b26791.js" as="script"><link rel="prefetch" href="/home/assets/index.html-1401cb8d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-be1e749e.js" as="script"><link rel="prefetch" href="/home/assets/jwt.html-d0cb61f7.js" as="script"><link rel="prefetch" href="/home/assets/shiro.html-887d0aef.js" as="script"><link rel="prefetch" href="/home/assets/index.html-f15351b4.js" as="script"><link rel="prefetch" href="/home/assets/nacos.html-4438a4e6.js" as="script"><link rel="prefetch" href="/home/assets/index.html-40ad6875.js" as="script"><link rel="prefetch" href="/home/assets/spring_annotation.html-1cf9840c.js" as="script"><link rel="prefetch" href="/home/assets/springboot.html-2ed7bd36.js" as="script"><link rel="prefetch" href="/home/assets/springboot_base.html-6d19cce2.js" as="script"><link rel="prefetch" href="/home/assets/1.html-d5bcd872.js" as="script"><link rel="prefetch" href="/home/assets/2.html-1e1fd4b5.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b2f35ca9.js" as="script"><link rel="prefetch" href="/home/assets/index.html-9bdd8dbd.js" as="script"><link rel="prefetch" href="/home/assets/docker_tutorial.html-8a4930d7.js" as="script"><link rel="prefetch" href="/home/assets/firewall_tutorial.html-f5fa2d5a.js" as="script"><link rel="prefetch" href="/home/assets/mysql_tutorial.html-a5c6ec7b.js" as="script"><link rel="prefetch" href="/home/assets/nginx_tutorial.html-32b57399.js" as="script"><link rel="prefetch" href="/home/assets/other_tutorial.html-557e1a8b.js" as="script"><link rel="prefetch" href="/home/assets/5.html-4f7fc13e.js" as="script"><link rel="prefetch" href="/home/assets/6.html-2391a5d5.js" as="script"><link rel="prefetch" href="/home/assets/7.html-9b82e387.js" as="script"><link rel="prefetch" href="/home/assets/Mybatis.html-3a03dd97.js" as="script"><link rel="prefetch" href="/home/assets/index.html-522942af.js" as="script"><link rel="prefetch" href="/home/assets/Spring.html-892483bf.js" as="script"><link rel="prefetch" href="/home/assets/SpringBoot.html-f740ac7a.js" as="script"><link rel="prefetch" href="/home/assets/SpringMVC.html-b64a4e80.js" as="script"><link rel="prefetch" href="/home/assets/index.html-7374bc53.js" as="script"><link rel="prefetch" href="/home/assets/java_usage.html-72cb660f.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-9f68b6c8.js" as="script"><link rel="prefetch" href="/home/assets/system_usage.html-da98c24b.js" as="script"><link rel="prefetch" href="/home/assets/1.html-e63a930c.js" as="script"><link rel="prefetch" href="/home/assets/2.html-a19e1033.js" as="script"><link rel="prefetch" href="/home/assets/3.html-b4fa556d.js" as="script"><link rel="prefetch" href="/home/assets/4.html-1cd1dada.js" as="script"><link rel="prefetch" href="/home/assets/5.html-d35adac3.js" as="script"><link rel="prefetch" href="/home/assets/index.html-ca8a4979.js" as="script"><link rel="prefetch" href="/home/assets/index.html-df4c04c6.js" as="script"><link rel="prefetch" href="/home/assets/less.html-5811967b.js" as="script"><link rel="prefetch" href="/home/assets/sass.html-b98fcef1.js" as="script"><link rel="prefetch" href="/home/assets/1.html-c676fb63.js" as="script"><link rel="prefetch" href="/home/assets/2.html-cc1f9274.js" as="script"><link rel="prefetch" href="/home/assets/index.html-0515b598.js" as="script"><link rel="prefetch" href="/home/assets/1.html-791a1ba1.js" as="script"><link rel="prefetch" href="/home/assets/2.html-f771134f.js" as="script"><link rel="prefetch" href="/home/assets/index.html-122e26fe.js" as="script"><link rel="prefetch" href="/home/assets/1.html-f8817a50.js" as="script"><link rel="prefetch" href="/home/assets/2.html-36fea40d.js" as="script"><link rel="prefetch" href="/home/assets/3.html-32d5cf91.js" as="script"><link rel="prefetch" href="/home/assets/4.html-4f62a5c2.js" as="script"><link rel="prefetch" href="/home/assets/5.html-d8b13a1d.js" as="script"><link rel="prefetch" href="/home/assets/6.html-647e52ef.js" as="script"><link rel="prefetch" href="/home/assets/7.html-c36bf029.js" as="script"><link rel="prefetch" href="/home/assets/8.html-4e951ab9.js" as="script"><link rel="prefetch" href="/home/assets/9.html-35d8d370.js" as="script"><link rel="prefetch" href="/home/assets/index.html-179b321e.js" as="script"><link rel="prefetch" href="/home/assets/new.html-f6bcdc73.js" as="script"><link rel="prefetch" href="/home/assets/1.html-d263c7ec.js" as="script"><link rel="prefetch" href="/home/assets/index.html-80f9fdb8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-a1d317c2.js" as="script"><link rel="prefetch" href="/home/assets/uniCloud.html-362e1d97.js" as="script"><link rel="prefetch" href="/home/assets/uniTips.html-ec2b22ef.js" as="script"><link rel="prefetch" href="/home/assets/1.html-58ff7725.js" as="script"><link rel="prefetch" href="/home/assets/index.html-802c93cf.js" as="script"><link rel="prefetch" href="/home/assets/index.html-a09eb31a.js" as="script"><link rel="prefetch" href="/home/assets/api_tutorial.html-9de8d514.js" as="script"><link rel="prefetch" href="/home/assets/base_tutorial.html-f5bc1444.js" as="script"><link rel="prefetch" href="/home/assets/pinia.html-ea8bd9ca.js" as="script"><link rel="prefetch" href="/home/assets/vue2.html-e734a52c.js" as="script"><link rel="prefetch" href="/home/assets/vue3_1.html-7fc27886.js" as="script"><link rel="prefetch" href="/home/assets/vue3_2.html-c62cad02.js" as="script"><link rel="prefetch" href="/home/assets/1.html-afafa13a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-bce97bea.js" as="script"><link rel="prefetch" href="/home/assets/404.html-6b1a943c.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/home/" class=""><!----><span class="site-name">不愿飞的蜂鸟首页</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Block Chain Internship</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/ethereum/" class="router-link-active" aria-label="ethereum"><!--[--><!--]--> ethereum <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/docker/" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/golang/" class="" aria-label="golang"><!--[--><!--]--> golang <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Deep Learning</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/ubuntu/" class="" aria-label="Ubuntu"><!--[--><!--]--> Ubuntu <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/GNN/" class="" aria-label="GNN"><!--[--><!--]--> GNN <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/python/" class="" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java Engineering</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/spring/" class="" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/jvm/" class="" aria-label="JVM"><!--[--><!--]--> JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/redis/" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/juc/" class="" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/netty/" class="" aria-label="Netty"><!--[--><!--]--> Netty <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/security/" class="" aria-label="Security"><!--[--><!--]--> Security <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/service/" class="" aria-label="Service"><!--[--><!--]--> Service <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/mybatis/" class="" aria-label="MyBatis"><!--[--><!--]--> MyBatis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>foreground</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/js/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/typescript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/html_css/" class="" aria-label="HTML_CSS"><!--[--><!--]--> HTML_CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/less_sass/" class="" aria-label="Less_Sass"><!--[--><!--]--> Less_Sass <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/react/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>background</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/java/" class="" aria-label="JAVA"><!--[--><!--]--> JAVA <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>app.mp</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/miniProgram/" class="" aria-label="MiniProgram"><!--[--><!--]--> MiniProgram <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/uni-app/" class="" aria-label="uni-app"><!--[--><!--]--> uni-app <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>server</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/centos/" class="" aria-label="Centos"><!--[--><!--]--> Centos <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/course/operating_system/" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/computer_network/" class="" aria-label="计算机网络技术"><!--[--><!--]--> 计算机网络技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/datastructure_and_algorithm/" class="" aria-label="数据结构和算法"><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/liushun-ing" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Block Chain Internship</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/ethereum/" class="router-link-active" aria-label="ethereum"><!--[--><!--]--> ethereum <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/docker/" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/golang/" class="" aria-label="golang"><!--[--><!--]--> golang <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Deep Learning</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/ubuntu/" class="" aria-label="Ubuntu"><!--[--><!--]--> Ubuntu <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/GNN/" class="" aria-label="GNN"><!--[--><!--]--> GNN <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/python/" class="" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java Engineering</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/spring/" class="" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/jvm/" class="" aria-label="JVM"><!--[--><!--]--> JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/redis/" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/juc/" class="" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/netty/" class="" aria-label="Netty"><!--[--><!--]--> Netty <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/security/" class="" aria-label="Security"><!--[--><!--]--> Security <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/service/" class="" aria-label="Service"><!--[--><!--]--> Service <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/mybatis/" class="" aria-label="MyBatis"><!--[--><!--]--> MyBatis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five技术"><span class="title">Five技术</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>foreground</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/js/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/typescript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/html_css/" class="" aria-label="HTML_CSS"><!--[--><!--]--> HTML_CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/less_sass/" class="" aria-label="Less_Sass"><!--[--><!--]--> Less_Sass <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/react/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>background</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/java/" class="" aria-label="JAVA"><!--[--><!--]--> JAVA <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>app.mp</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/miniProgram/" class="" aria-label="MiniProgram"><!--[--><!--]--> MiniProgram <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/uni-app/" class="" aria-label="uni-app"><!--[--><!--]--> uni-app <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>server</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/centos/" class="" aria-label="Centos"><!--[--><!--]--> Centos <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five课程"><span class="title">Five课程</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/course/operating_system/" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/computer_network/" class="" aria-label="计算机网络技术"><!--[--><!--]--> 计算机网络技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/datastructure_and_algorithm/" class="" aria-label="数据结构和算法"><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/liushun-ing" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">Ethereum <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/home/master/ethereum/" class="router-link-active sidebar-item" aria-label="Navigation"><!--[--><!--]--> Navigation <!--[--><!--]--></a><!----></li><li><a href="/home/master/ethereum/account.html" class="sidebar-item" aria-label="以太坊账户"><!--[--><!--]--> 以太坊账户 <!--[--><!--]--></a><!----></li><li><a href="/home/master/ethereum/block.html" class="sidebar-item" aria-label="区块"><!--[--><!--]--> 区块 <!--[--><!--]--></a><!----></li><li><a href="/home/master/ethereum/consensus.html" class="sidebar-item" aria-label="Consensus共识机制"><!--[--><!--]--> Consensus共识机制 <!--[--><!--]--></a><!----></li><li><a href="/home/master/ethereum/contract.html" class="sidebar-item" aria-label="智能合约"><!--[--><!--]--> 智能合约 <!--[--><!--]--></a><!----></li><li><a href="/home/master/ethereum/crypto_base.html" class="sidebar-item" aria-label="区块链中的密码学"><!--[--><!--]--> 区块链中的密码学 <!--[--><!--]--></a><!----></li><li><a href="/home/master/ethereum/ethereum_base.html" class="sidebar-item" aria-label="以太坊基础"><!--[--><!--]--> 以太坊基础 <!--[--><!--]--></a><!----></li><li><a href="/home/master/ethereum/evm.html" class="sidebar-item" aria-label="以太坊虚拟机EVM"><!--[--><!--]--> 以太坊虚拟机EVM <!--[--><!--]--></a><!----></li><li><a href="/home/master/ethereum/gas.html" class="sidebar-item" aria-label="Gas 燃料和费用"><!--[--><!--]--> Gas 燃料和费用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Go Ehthereum编程"><!--[--><!--]--> Go Ehthereum编程 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#geth-创建客户端" class="router-link-active router-link-exact-active sidebar-item" aria-label="geth 创建客户端"><!--[--><!--]--> geth 创建客户端 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#账户" class="router-link-active router-link-exact-active sidebar-item" aria-label="账户"><!--[--><!--]--> 账户 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#获取账户余额" class="router-link-active router-link-exact-active sidebar-item" aria-label="获取账户余额"><!--[--><!--]--> 获取账户余额 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#手动生成新钱包-账户" class="router-link-active router-link-exact-active sidebar-item" aria-label="手动生成新钱包（账户）"><!--[--><!--]--> 手动生成新钱包（账户） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#keystore密钥库" class="router-link-active router-link-exact-active sidebar-item" aria-label="keyStore密钥库"><!--[--><!--]--> keyStore密钥库 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#地址验证-账户类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="地址验证，账户类型"><!--[--><!--]--> 地址验证，账户类型 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#交易" class="router-link-active router-link-exact-active sidebar-item" aria-label="交易"><!--[--><!--]--> 交易 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#查询区块" class="router-link-active router-link-exact-active sidebar-item" aria-label="查询区块"><!--[--><!--]--> 查询区块 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#查询交易" class="router-link-active router-link-exact-active sidebar-item" aria-label="查询交易"><!--[--><!--]--> 查询交易 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#查询交易收据" class="router-link-active router-link-exact-active sidebar-item" aria-label="查询交易收据"><!--[--><!--]--> 查询交易收据 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#eth-转账" class="router-link-active router-link-exact-active sidebar-item" aria-label="ETH 转账"><!--[--><!--]--> ETH 转账 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#代币转账" class="router-link-active router-link-exact-active sidebar-item" aria-label="代币转账"><!--[--><!--]--> 代币转账 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#监听新区块" class="router-link-active router-link-exact-active sidebar-item" aria-label="监听新区块"><!--[--><!--]--> 监听新区块 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#裸交易raw-transaction" class="router-link-active router-link-exact-active sidebar-item" aria-label="裸交易Raw Transaction"><!--[--><!--]--> 裸交易Raw Transaction <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#智能合约" class="router-link-active router-link-exact-active sidebar-item" aria-label="智能合约"><!--[--><!--]--> 智能合约 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#编译和-abi" class="router-link-active router-link-exact-active sidebar-item" aria-label="编译和 ABI"><!--[--><!--]--> 编译和 ABI <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#部署智能合约" class="router-link-active router-link-exact-active sidebar-item" aria-label="部署智能合约"><!--[--><!--]--> 部署智能合约 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#加载智能合约" class="router-link-active router-link-exact-active sidebar-item" aria-label="加载智能合约"><!--[--><!--]--> 加载智能合约 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#写智能合约" class="router-link-active router-link-exact-active sidebar-item" aria-label="写智能合约"><!--[--><!--]--> 写智能合约 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#读智能合约二进制码" class="router-link-active router-link-exact-active sidebar-item" aria-label="读智能合约二进制码"><!--[--><!--]--> 读智能合约二进制码 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#事件日志" class="router-link-active router-link-exact-active sidebar-item" aria-label="事件日志"><!--[--><!--]--> 事件日志 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#监听事件日志" class="router-link-active router-link-exact-active sidebar-item" aria-label="监听事件日志"><!--[--><!--]--> 监听事件日志 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#读取事件日志" class="router-link-active router-link-exact-active sidebar-item" aria-label="读取事件日志"><!--[--><!--]--> 读取事件日志 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#签名" class="router-link-active router-link-exact-active sidebar-item" aria-label="签名"><!--[--><!--]--> 签名 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#生成签名" class="router-link-active router-link-exact-active sidebar-item" aria-label="生成签名"><!--[--><!--]--> 生成签名 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/ethereum/go_ethereum.html#验证签名" class="router-link-active router-link-exact-active sidebar-item" aria-label="验证签名"><!--[--><!--]--> 验证签名 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/home/master/ethereum/hd_wallet.html" class="sidebar-item" aria-label="分层确定性钱包HD-Wallet"><!--[--><!--]--> 分层确定性钱包HD-Wallet <!--[--><!--]--></a><!----></li><li><a href="/home/master/ethereum/jsonrpc.html" class="sidebar-item" aria-label="JSON-RPC API"><!--[--><!--]--> JSON-RPC API <!--[--><!--]--></a><!----></li><li><a href="/home/master/ethereum/mpt.html" class="sidebar-item" aria-label="MPT默克尔压缩前缀树"><!--[--><!--]--> MPT默克尔压缩前缀树 <!--[--><!--]--></a><!----></li><li><a href="/home/master/ethereum/node_client.html" class="sidebar-item" aria-label="节点和客户端"><!--[--><!--]--> 节点和客户端 <!--[--><!--]--></a><!----></li><li><a href="/home/master/ethereum/rlp.html" class="sidebar-item" aria-label="RLP编码"><!--[--><!--]--> RLP编码 <!--[--><!--]--></a><!----></li><li><a href="/home/master/ethereum/statedb.html" class="sidebar-item" aria-label="StateDB 状态机"><!--[--><!--]--> StateDB 状态机 <!--[--><!--]--></a><!----></li><li><a href="/home/master/ethereum/transaction.html" class="sidebar-item" aria-label="以太坊交易"><!--[--><!--]--> 以太坊交易 <!--[--><!--]--></a><!----></li><li><a href="/home/master/ethereum/leveldb.html" class="sidebar-item" aria-label="LevelDB"><!--[--><!--]--> LevelDB <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="go-ehthereum编程" tabindex="-1"><a class="header-anchor" href="#go-ehthereum编程" aria-hidden="true">#</a> Go Ehthereum编程</h1><p>Go-ethereum，也被简称为Geth，是最流行的以太坊客户端（go 的官方以太坊实现）。因为它是用Go开发的，当使用Golang开发应用程序时，Geth提供了读写区块链的一切功能。</p><h2 id="geth-创建客户端" tabindex="-1"><a class="header-anchor" href="#geth-创建客户端" aria-hidden="true">#</a> geth 创建客户端</h2><p>客户端是以太坊网络的入口。客户端需要广播交易和读取区块链数据。</p><p>用Go初始化以太坊客户端是和区块链交互所需的基本步骤。首先，导入go-etherem的<code>ethclient</code>包并通过调用接收区块链服务提供者URL的<code>Dial</code>来初始化它。</p><p>若没有现有以太坊客户端，可以连接到infura网关。Infura管理着一批安全，可靠，可扩展的以太坊[geth和parity]节点。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>client<span class="token punctuation">,</span> err <span class="token operator">:=</span> ethclient<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">&quot;https://cloudflare-eth.com&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//client, err := ethclient.Dial(&quot;http://16.63.39.133:30303&quot;)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
	log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Connected to Ethereum client&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 获取最新区块号</span>
header<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">HeaderByNumber</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to get latest block header: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Latest block number:&quot;</span><span class="token punctuation">,</span> header<span class="token punctuation">.</span>Number<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里也可以 dial 任何一个本地或远程以太坊节点的 IP 和端口（也就是任何一个公开的以太坊全节点），但是需要确保节点已正确配置并启用了 HTTP 或 WebSocket 接口。可以选择运行自己的全节点或使用第三方服务，如Infura或Alchemy。</p><h2 id="账户" tabindex="-1"><a class="header-anchor" href="#账户" aria-hidden="true">#</a> 账户</h2><p>以太坊上的账户要么是钱包地址要么是智能合约地址，是一个 160 位的字符串，转换为 16 进制就是 40 位的字符串，比如<code>0x9029A66890306B1811e66B968C35d2F13e8E38C6</code>。它们用于将ETH发送到另一个用户，并且还用于在需要和区块链交互时指一个智能合约。它们是唯一的，且是从私钥导出的。</p><p>要使用go-ethereum的账户地址，您必须先将它们转化为go-ethereum中的<code>common.Address</code>类型。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>account <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">HexToAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0x9029A66890306B1811e66B968C35d2F13e8E38C6&quot;</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;account address:&quot;</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>account<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>account<span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>account<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>type Address [20]byte</code> ：一个 address 其实就是 20 字节的 byte（160bit）。</p><h3 id="获取账户余额" tabindex="-1"><a class="header-anchor" href="#获取账户余额" aria-hidden="true">#</a> 获取账户余额</h3><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// 获取最新区块的账户余额</span>
balance<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">BalanceAt</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> account<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token keyword">return</span>
<span class="token punctuation">}</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;most recently wei:&quot;</span><span class="token punctuation">,</span> balance<span class="token punctuation">)</span>

<span class="token comment">// 获取指定区块的账户余额</span>
blockNumber <span class="token operator">:=</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span><span class="token number">20319544</span><span class="token punctuation">)</span>
balance1<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">BalanceAt</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> account<span class="token punctuation">,</span> blockNumber<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;block wei&quot;</span><span class="token punctuation">,</span> blockNumber<span class="token punctuation">,</span> balance1<span class="token punctuation">)</span>

<span class="token comment">// 将以 wei 为单位的余额转换为 eth，也就是除 1^18</span>
fBalance <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span>Float<span class="token punctuation">)</span>
fBalance<span class="token punctuation">.</span><span class="token function">SetString</span><span class="token punctuation">(</span>balance<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ethValue <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span>Float<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Quo</span><span class="token punctuation">(</span>fBalance<span class="token punctuation">,</span> big<span class="token punctuation">.</span><span class="token function">NewFloat</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">Pow10</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;eth value:&quot;</span><span class="token punctuation">,</span> ethValue<span class="token punctuation">)</span>

<span class="token comment">// 获取账户的待处理的余额</span>
pendingBalanceAt<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">PendingBalanceAt</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> account<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;pending balance at (wei)&quot;</span><span class="token punctuation">,</span> pendingBalanceAt<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>待处理的账户余额（也称为潜在余额、预测余额或挂起余额）是指在某些交易正在进行、等待确认或尚未被包含在区块中时，账户的余额在未来的某个时间点可能会是多少。它考虑了已经提交但尚未被确认的交易。</p><p><strong>理解待处理余额</strong>：其实就是真正还剩多少没有用作交易的。</p><p><strong>1. 已提交但未确认的交易</strong></p><p>当你提交一笔交易到以太坊网络，但交易还没有被矿工打包到区块中确认时，交易处于“待处理”状态。此时，交易的影响尚未反映在账户的当前余额中，但它会影响未来的余额。</p><p><strong>2. 示例场景</strong></p><p>假设你有一个账户余额为5 ETH，并提交了一笔发送3 ETH的交易。此时：</p><ul><li><strong>当前余额</strong>：5 ETH（因为交易尚未确认）</li><li><strong>待处理余额</strong>：2 ETH（如果交易被确认后）</li></ul><h3 id="手动生成新钱包-账户" tabindex="-1"><a class="header-anchor" href="#手动生成新钱包-账户" aria-hidden="true">#</a> 手动生成新钱包（账户）</h3><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// 生成随机私钥</span>
privateKey<span class="token punctuation">,</span> err <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">GenerateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;privateKey&quot;</span><span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span>

<span class="token comment">// 使用FromECDSA方法将其转换为字节</span>
keyBytes <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">FromECDSA</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;keyBytes&quot;</span><span class="token punctuation">,</span> keyBytes<span class="token punctuation">)</span>

<span class="token comment">// 转换为十六进制字符串，然后我们在十六进制编码之后删除“0x”。</span>
<span class="token comment">// ******这就是用于签署交易的私钥******</span>
keyHexString <span class="token operator">:=</span> hexutil<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>keyBytes<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;keyHexString&quot;</span><span class="token punctuation">,</span> keyHexString<span class="token punctuation">)</span>

<span class="token comment">// 重新得到私钥，记住不需要 0x 前缀</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>crypto<span class="token punctuation">.</span><span class="token function">HexToECDSA</span><span class="token punctuation">(</span>keyHexString<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 公钥是从私钥派生的</span>
publicKey <span class="token operator">:=</span> privateKey<span class="token punctuation">.</span><span class="token function">Public</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;publicKey&quot;</span><span class="token punctuation">,</span> publicKey<span class="token punctuation">)</span>
publicKeyECDSA<span class="token punctuation">,</span> ok <span class="token operator">:=</span> publicKey<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>ecdsa<span class="token punctuation">.</span>PublicKey<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;cannot assert type: publicKey is not of type *ecdsa.PublicKey&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 将其转换为十六进制，我们剥离了0x和前2个字符04，它始终是EC前缀，不是必需的。</span>
publicBytes <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">FromECDSAPub</span><span class="token punctuation">(</span>publicKeyECDSA<span class="token punctuation">)</span>
publicHexString <span class="token operator">:=</span> hexutil<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>publicBytes<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;publicHexString&quot;</span><span class="token punctuation">,</span> publicHexString<span class="token punctuation">)</span>

<span class="token comment">// 公共地址其实就是公钥的Keccak-256哈希，然后我们取最后40个字符（20个字节）并用“0x”作为前缀 一共 160 位</span>
publicAddress <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">PubkeyToAddress</span><span class="token punctuation">(</span><span class="token operator">*</span>publicKeyECDSA<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;publicAddress&quot;</span><span class="token punctuation">,</span> publicAddress<span class="token punctuation">)</span>

<span class="token comment">// 手动转换</span>
hash <span class="token operator">:=</span> sha3<span class="token punctuation">.</span><span class="token function">NewLegacyKeccak256</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
hash<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>publicBytes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
publicAddressByHandler <span class="token operator">:=</span> hexutil<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>hash<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;publicAddressByHandler&quot;</span><span class="token punctuation">,</span> publicAddressByHandler<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样，需要我们手动保存好公私钥。有<code>crypto.HexToECDSA()</code>方法帮助我们从一个十六进制字符串重新得到 privateKey。或者<code>crypto.ToECDSA()</code>从一个字节数组得到私钥。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>privateKey<span class="token punctuation">,</span> err <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">HexToECDSA</span><span class="token punctuation">(</span><span class="token string">&quot;fad9c8855b740a0b7ed4c221dbad0f33a83a49cad6b3fe8d5817ac83d38b6a19&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="keystore密钥库" tabindex="-1"><a class="header-anchor" href="#keystore密钥库" aria-hidden="true">#</a> keyStore密钥库</h3><p>上面手动生成，转换，保存过于复杂了。于是就有了密钥库帮助我们生成公私钥，并保存到文件中，并提供了一些 api 帮助我们使用公私钥。</p><p>keystore是一个包含经过加密了的钱包私钥。go-ethereum中的keystore，每个文件只能包含一个钱包密钥对。调用<code>NewKeyStore</code>生成keystore，给它提供保存keystore的目录路径。然后，调用<code>NewAccount</code>方法创建新的钱包，并给它传入一个用于加密的口令。每次调用<code>NewAccount</code>，它将在磁盘上生成新的keystore文件。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">createKs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ks <span class="token operator">:=</span> keystore<span class="token punctuation">.</span><span class="token function">NewKeyStore</span><span class="token punctuation">(</span><span class="token string">&quot;./tmp&quot;</span><span class="token punctuation">,</span> keystore<span class="token punctuation">.</span>StandardScryptN<span class="token punctuation">,</span> keystore<span class="token punctuation">.</span>StandardScryptP<span class="token punctuation">)</span>
    password <span class="token operator">:=</span> <span class="token string">&quot;secret&quot;</span>
    account<span class="token punctuation">,</span> err <span class="token operator">:=</span> ks<span class="token punctuation">.</span><span class="token function">NewAccount</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>account<span class="token punctuation">.</span>Address<span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0x20F8D42FB0F667F2E53930fed426f225752453b3</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">importKs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    file <span class="token operator">:=</span> <span class="token string">&quot;./tmp/UTC--2018-07-04T09-58-30.122808598Z--20f8d42fb0f667f2e53930fed426f225752453b3&quot;</span>
    ks <span class="token operator">:=</span> keystore<span class="token punctuation">.</span><span class="token function">NewKeyStore</span><span class="token punctuation">(</span><span class="token string">&quot;./tmp&quot;</span><span class="token punctuation">,</span> keystore<span class="token punctuation">.</span>StandardScryptN<span class="token punctuation">,</span> keystore<span class="token punctuation">.</span>StandardScryptP<span class="token punctuation">)</span>
    jsonBytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
      log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    password <span class="token operator">:=</span> <span class="token string">&quot;secret&quot;</span>
  	<span class="token comment">// 第二个参数是用于加密私钥的口令。第三个参数是指定一个新的加密口令,他将生成新keystore文件，两个文件其实是一样的，所以需要删除一个</span>
    account<span class="token punctuation">,</span> err <span class="token operator">:=</span> ks<span class="token punctuation">.</span><span class="token function">Import</span><span class="token punctuation">(</span>jsonBytes<span class="token punctuation">,</span> password<span class="token punctuation">,</span> password<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>account<span class="token punctuation">.</span>Address<span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0x20F8D42FB0F667F2E53930fed426f225752453b3</span>

    <span class="token keyword">if</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样我们可以直接拿到 account，而不需要从私钥得到公钥，再从公钥进行 hash 然后截取得到地址</p><p>此外，如果需要使用私钥签名，他也提供了<code>ks.SignTx()</code>等api 进行签名，不需要我们得到具体的私钥进行签名，如<code>types.SignTx(tx, types.LatestSignerForChainID(chainId), privateKey)</code>。</p><h3 id="地址验证-账户类型" tabindex="-1"><a class="header-anchor" href="#地址验证-账户类型" aria-hidden="true">#</a> 地址验证，账户类型</h3><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// 使用正则验证一个地址是否合法</span>
re <span class="token operator">:=</span> regexp<span class="token punctuation">.</span><span class="token function">MustCompile</span><span class="token punctuation">(</span><span class="token string">&quot;^0x[0-9a-fA-F]{40}$&quot;</span><span class="token punctuation">)</span>

fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;is valid: %v\n&quot;</span><span class="token punctuation">,</span> re<span class="token punctuation">.</span><span class="token function">MatchString</span><span class="token punctuation">(</span><span class="token string">&quot;0x323b5d4c32345ced77393b3530b1eed0f346429d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 连接 Infura 第三方服务</span>
client<span class="token punctuation">,</span> err <span class="token operator">:=</span> ethclient<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">&quot;https://cloudflare-eth.com&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 判断一个地址时都是智能合约地址 CA合约账户：若在该地址存储了字节码，该地址是智能合约</span>
address <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">HexToAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0xe41d2489571d322189246dafa5ebde1f4699f498&quot;</span><span class="token punctuation">)</span>
byteCode<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">CodeAt</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> address<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// nil is the latest block</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

isContract <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>byteCode<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>

fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;isContract: %v\n&quot;</span><span class="token punctuation">,</span> isContract<span class="token punctuation">)</span>
<span class="token comment">// 判断一个地址是否是账户地址 EOA以太坊外部账户</span>
address1 <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">HexToAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0x8e215d06ea7ec1fdb4fc5fd21768f4b34ee92ef4&quot;</span><span class="token punctuation">)</span>
byteCode1<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">CodeAt</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> address1<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// nil is the latest block</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

isContract1 <span class="token operator">:=</span> <span class="token function">len</span><span class="token punctuation">(</span>byteCode1<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span>

fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;isContract1: %v\n&quot;</span><span class="token punctuation">,</span> isContract1<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在以太坊中，账户拥有4个字段：{nonce,balance,codeHash,StorageRoot}。</p><p>一共分为2种账户：外部账户、合约账户。</p><p>外部账户，Externally Owned Accounts，简称EOA，它拥有私钥，其codeHash为空。</p><p>合约账户，Contact Account，简称CA，它没有私钥，其codeHash非空。</p><h2 id="交易" tabindex="-1"><a class="header-anchor" href="#交易" aria-hidden="true">#</a> 交易</h2><h3 id="查询区块" tabindex="-1"><a class="header-anchor" href="#查询区块" aria-hidden="true">#</a> 查询区块</h3><h4 id="区块头" tabindex="-1"><a class="header-anchor" href="#区块头" aria-hidden="true">#</a> 区块头</h4><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">test1</span><span class="token punctuation">(</span>client <span class="token operator">*</span>ethclient<span class="token punctuation">.</span>Client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	header<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">HeaderByNumber</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span>Number<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="整个区块" tabindex="-1"><a class="header-anchor" href="#整个区块" aria-hidden="true">#</a> 整个区块</h4><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// 获取指定区</span>
blockNumber <span class="token operator">:=</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span><span class="token number">20317184</span><span class="token punctuation">)</span>
block<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">BlockByNumber</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> blockNumber<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>block<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Uint64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span><span class="token function">Time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span><span class="token function">Difficulty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Uint64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span><span class="token function">Transactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span><span class="token function">GasLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span><span class="token function">GasUsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询交易" tabindex="-1"><a class="header-anchor" href="#查询交易" aria-hidden="true">#</a> 查询交易</h3><blockquote><p>已有块</p><p>block.Transactions()</p></blockquote><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// 获取交易数目</span>
count<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">TransactionCount</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> block<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
<span class="token comment">// 拿到块， 遍历块中所有交易</span>
<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> tx <span class="token operator">:=</span> <span class="token keyword">range</span> block<span class="token punctuation">.</span><span class="token function">Transactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;hash&quot;</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;gas limit&quot;</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">Gas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;gas price&quot;</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">GasPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Uint64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">Nonce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">Data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;to&quot;</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">To</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// 发送方地址需要另外获取, 新版 api 如下：</span>
  <span class="token comment">//chainId, err := client.NetworkID(context.Background())</span>
  <span class="token comment">//if err != nil {</span>
  <span class="token comment">//	log.Fatal(err)</span>
  <span class="token comment">//}</span>
  <span class="token keyword">if</span> from<span class="token punctuation">,</span> err <span class="token operator">:=</span> types<span class="token punctuation">.</span><span class="token function">Sender</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">LatestSignerForChainID</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span><span class="token function">ChainId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tx<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;from&quot;</span><span class="token punctuation">,</span> from<span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 获取收据</span>
  receipt<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">TransactionReceipt</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>receipt<span class="token punctuation">.</span>Status<span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>receipt<span class="token punctuation">.</span>Logs<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>直接通过 client 获取，只需要传入区块地址即可</p><p>client.TransactionInBlock(context.Background(), blockHash, idx)</p></blockquote><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>blockHash <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">HexToHash</span><span class="token punctuation">(</span><span class="token string">&quot;0x363e7fb967ebb8547b15d8ece12ab50def79e6e71fbfb41e2236699d672c4b10&quot;</span><span class="token punctuation">)</span>
count<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">TransactionCount</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> blockHash<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
count <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">for</span> idx <span class="token operator">:=</span> <span class="token function">uint</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> idx <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> idx<span class="token operator">++</span> <span class="token punctuation">{</span>
  tx<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">TransactionInBlock</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> blockHash<span class="token punctuation">,</span> idx<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

txHash <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">HexToHash</span><span class="token punctuation">(</span><span class="token string">&quot;0x30427eadc4428fde98c664e5d127112d4cb80b587079445b2f9bb9aa30978321&quot;</span><span class="token punctuation">)</span>
tx<span class="token punctuation">,</span> isPending<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">TransactionByHash</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> txHash<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>isPending<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询交易收据" tabindex="-1"><a class="header-anchor" href="#查询交易收据" aria-hidden="true">#</a> 查询交易收据</h3><p>是用水龙头（<a href="https://faucets.chain.link/" target="_blank" rel="noopener noreferrer">免费水龙头<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>）在自己的测试网络账户上拿到了0.1个以太币，现在查询余额和该交易的收据信息</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>client<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> ethclient<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">&quot;https://sepolia.infura.io/v3/d481f2467f41493c9d699a59f6e03213&quot;</span><span class="token punctuation">)</span>

address <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">HexToAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0x43DdA9d1Ac023bd3593Dff5A1A677247Bb98fE11&quot;</span><span class="token punctuation">)</span>

balanceAt<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">BalanceAt</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> address<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span>
<span class="token punctuation">}</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;balanceAt:&quot;</span><span class="token punctuation">,</span> balanceAt<span class="token punctuation">)</span>

hash <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">HexToHash</span><span class="token punctuation">(</span><span class="token string">&quot;0xb7ffa3dfe9116175b3a4e20e704370059e49d9cd7f242e6d70a5f48386ebda14&quot;</span><span class="token punctuation">)</span>

receipt<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">TransactionReceipt</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hash<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span>
<span class="token punctuation">}</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;receipt:&quot;</span><span class="token punctuation">,</span> receipt<span class="token punctuation">)</span>
<span class="token comment">/*
receipt: &amp;{2 [] 1 12536552 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [] 0xb7ffa3dfe9116175b3a4e20e704370059e49d9cd7f242e6d70a5f48386ebda14 0x0000000000000000000000000000000000000000 21000 9144234 0 &lt;nil&gt; 0xaa9438ee11b6f4ef3e7c925e70140c7be3788df4a93751f56ad7344e446def00 6331009 100}
有挺多数据是交易中的信息，还有一些特有的必入status，type，logs等
*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/home/assets/sample-be6a8643.png" alt="screenshot2024-07-18 11.41.32" style="zoom:50%;"><h3 id="eth-转账" tabindex="-1"><a class="header-anchor" href="#eth-转账" aria-hidden="true">#</a> ETH 转账</h3><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// 得到私钥</span>
privateKey<span class="token punctuation">,</span> err <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">HexToECDSA</span><span class="token punctuation">(</span><span class="token string">&quot;fad9c8855b740a0b7ed4c221dbad0f33a83a49cad6b3fe8d5817ac83d38b6a19&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 手动从私钥得到公钥，然后计算 hash 得到地址</span>
publicKey <span class="token operator">:=</span> privateKey<span class="token punctuation">.</span><span class="token function">Public</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
publicKeyECDSA<span class="token punctuation">,</span> ok <span class="token operator">:=</span> publicKey<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>ecdsa<span class="token punctuation">.</span>PublicKey<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;cannot assert type: publicKey is not of type *ecdsa.PublicKey&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

fromAddress <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">PubkeyToAddress</span><span class="token punctuation">(</span><span class="token operator">*</span>publicKeyECDSA<span class="token punctuation">)</span>
<span class="token comment">// 自动获取当前的 nouce，也就是该用户当前交易数 + 1</span>
nonce<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">PendingNonceAt</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fromAddress<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 构造 transaction 交易对象</span>
value <span class="token operator">:=</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span><span class="token number">1000000000000000000</span><span class="token punctuation">)</span> <span class="token comment">// in wei (1 eth)</span>
gasLimit <span class="token operator">:=</span> <span class="token function">uint64</span><span class="token punctuation">(</span><span class="token number">21000</span><span class="token punctuation">)</span>                <span class="token comment">// in units</span>
<span class="token comment">// 获取当前系统推荐的 gasPrice</span>
gasPrice<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">SuggestGasPrice</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
toAddress <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">HexToAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0x4592d8f8d7b001e72cb26a73e4fa1806a51ac79d&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// New transaction 新的 api</span>
tx <span class="token operator">:=</span> types<span class="token punctuation">.</span><span class="token function">NewTx</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>types<span class="token punctuation">.</span>LegacyTx<span class="token punctuation">{</span>
  Nonce<span class="token punctuation">:</span>    nonce<span class="token punctuation">,</span>
  GasPrice<span class="token punctuation">:</span> gasPrice<span class="token punctuation">,</span>
  Gas<span class="token punctuation">:</span>      gasLimit<span class="token punctuation">,</span>
  To<span class="token punctuation">:</span>       <span class="token operator">&amp;</span>tokenAddress<span class="token punctuation">,</span>
  Value<span class="token punctuation">:</span>    value<span class="token punctuation">,</span>
  Data<span class="token punctuation">:</span>     <span class="token boolean">nil</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 使用发件人的私钥对 tx 进行签名</span>
chainId<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">NetworkID</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
signedTx<span class="token punctuation">,</span> err <span class="token operator">:=</span> types<span class="token punctuation">.</span><span class="token function">SignTx</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> types<span class="token punctuation">.</span><span class="token function">LatestSignerForChainID</span><span class="token punctuation">(</span>chainId<span class="token punctuation">)</span><span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">SendTransaction</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> signedTx<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;tx sent: %s&quot;</span><span class="token punctuation">,</span> signedTx<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="代币转账" tabindex="-1"><a class="header-anchor" href="#代币转账" aria-hidden="true">#</a> 代币转账</h3><p>和 ETH 不同的地方：</p><ul><li>交易的 to 方变成了调用的合约地址</li><li>gasLimit 需要考虑智能合约执行的 gas 消耗，可以通过调用 <code>client.EstimateGas</code> 得到估算上限</li><li>需要构建 data 参数</li></ul><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>privateKey<span class="token punctuation">,</span> err <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">HexToECDSA</span><span class="token punctuation">(</span><span class="token string">&quot;fad9c8855b740a0b7ed4c221dbad0f33a83a49cad6b3fe8d5817ac83d38b6a19&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

publicKey <span class="token operator">:=</span> privateKey<span class="token punctuation">.</span><span class="token function">Public</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
publicKeyECDSA<span class="token punctuation">,</span> ok <span class="token operator">:=</span> publicKey<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>ecdsa<span class="token punctuation">.</span>PublicKey<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;error casting public key to ECDSA&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fromAddress <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">PubkeyToAddress</span><span class="token punctuation">(</span><span class="token operator">*</span>publicKeyECDSA<span class="token punctuation">)</span>
nonce<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">PendingNonceAt</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fromAddress<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
value <span class="token operator">:=</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 代币传输不需要传输ETH，因此将交易“值”设置为“0”</span>
<span class="token comment">// 硬编码 gasPrice 不好，时常会有波动</span>
<span class="token comment">// gasPrice := big.NewInt(int64(math.Pow(3, 10)))</span>
gasPrice<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">SuggestGasPrice</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 合约地址</span>
tokenAddress <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">HexToAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0x28b149020d2152179873ec60bed6bf7cd705775d&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 以上的操作都和 ETH 转账类似</span>

<span class="token comment">// 下面需要构建交易的 data 部分。</span>
<span class="token comment">// 函数选择器 函数名的keccak-256哈希来检索方法ID</span>
transferFnSignature <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;transfer(address,uint256&quot;</span><span class="token punctuation">)</span>
hash <span class="token operator">:=</span> sha3<span class="token punctuation">.</span><span class="token function">NewLegacyKeccak256</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
hash<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>transferFnSignature<span class="token punctuation">)</span>
methodID <span class="token operator">:=</span> hash<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token comment">// 只取前四个字节即可</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;methodID&quot;</span><span class="token punctuation">,</span> hexutil<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>methodID<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 然后是两个参数</span>
<span class="token comment">// 两个数据都需要构建成 16 进制的 32 字节大小，不够的用 0 填充</span>
<span class="token comment">// 代币接收地址</span>
toAddress <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">HexToAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0x4592d8f8d7b001e72cb26a73e4fa1806a51ac79d&quot;</span><span class="token punctuation">)</span>
paddedAddress <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">LeftPadBytes</span><span class="token punctuation">(</span>tokenAddress<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;paddedAddress&quot;</span><span class="token punctuation">,</span> hexutil<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>paddedAddress<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 转账金额</span>
amount <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>big<span class="token punctuation">.</span>Int<span class="token punctuation">)</span>
amount<span class="token punctuation">.</span><span class="token function">SetString</span><span class="token punctuation">(</span><span class="token string">&quot;1000000000000000000000&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
paddedAmount <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">LeftPadBytes</span><span class="token punctuation">(</span>amount<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;paddedAmount&quot;</span><span class="token punctuation">,</span> hexutil<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>paddedAmount<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 构建 data 的字节切片对象</span>
<span class="token keyword">var</span> data <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span>
data <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> methodID<span class="token operator">...</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> paddedAddress<span class="token operator">...</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> paddedAmount<span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token comment">// 燃气上限制将取决于交易数据的大小和智能合约必须执行的计算步骤。 幸运的是，客户端提供了EstimateGas方法，它可以为我们估算所需的燃气量。 这个函数从ethereum包中获取CallMsg结构，我们在其中指定数据和地址。 它将返回我们估算的完成交易所需的估计燃气上限。</span>
gasLimit<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">EstimateGas</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ethereum<span class="token punctuation">.</span>CallMsg<span class="token punctuation">{</span>
  To<span class="token punctuation">:</span>   <span class="token operator">&amp;</span>toAddress<span class="token punctuation">,</span>
  Data<span class="token punctuation">:</span> data<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;gasLimit&quot;</span><span class="token punctuation">,</span> gasLimit<span class="token punctuation">)</span>

<span class="token comment">// New transaction 新的 api</span>
tx <span class="token operator">:=</span> types<span class="token punctuation">.</span><span class="token function">NewTx</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>types<span class="token punctuation">.</span>LegacyTx<span class="token punctuation">{</span>
  Nonce<span class="token punctuation">:</span>    nonce<span class="token punctuation">,</span>
  GasPrice<span class="token punctuation">:</span> gasPrice<span class="token punctuation">,</span>
  Gas<span class="token punctuation">:</span>      gasLimit<span class="token punctuation">,</span>
  To<span class="token punctuation">:</span>       <span class="token operator">&amp;</span>tokenAddress<span class="token punctuation">,</span>
  Value<span class="token punctuation">:</span>    value<span class="token punctuation">,</span>
  Data<span class="token punctuation">:</span>     data<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 使用发件人的私钥对 tx 进行签名</span>
chainId<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">NetworkID</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 签名 hash</span>
signedTx<span class="token punctuation">,</span> err <span class="token operator">:=</span> types<span class="token punctuation">.</span><span class="token function">SignTx</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> types<span class="token punctuation">.</span><span class="token function">LatestSignerForChainID</span><span class="token punctuation">(</span>chainId<span class="token punctuation">)</span><span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%v&quot;</span><span class="token punctuation">,</span> signedTx<span class="token punctuation">)</span>
<span class="token comment">// 广播交易</span>
err <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">SendTransaction</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> signedTx<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;signedTx send&quot;</span><span class="token punctuation">,</span> signedTx<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="监听新区块" tabindex="-1"><a class="header-anchor" href="#监听新区块" aria-hidden="true">#</a> 监听新区块</h3><p>这里选择的服务提供商是<a href="https://app.infura.io/key/d481f2467f41493c9d699a59f6e03213/active-endpoints" target="_blank" rel="noopener noreferrer">infura<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>主网的一直连不上，测试网的可以</p><p>注意使用的是 wss 也就是 websocket 服务</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 订阅新块的产生，需要有以太坊服务提供商提供接口</span>
    client<span class="token punctuation">,</span> err <span class="token operator">:=</span> ethclient<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">&quot;wss://sepolia.infura.io/ws/v3/your-api-key&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
       log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    headers <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token operator">*</span>types<span class="token punctuation">.</span>Header<span class="token punctuation">)</span>

    sub<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">SubscribeNewHead</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> headers<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
       log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">{</span>
       <span class="token keyword">select</span> <span class="token punctuation">{</span>
       <span class="token keyword">case</span> err <span class="token operator">:=</span> <span class="token operator">&lt;-</span>sub<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
          log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
       <span class="token keyword">case</span> header <span class="token operator">:=</span> <span class="token operator">&lt;-</span>headers<span class="token punctuation">:</span>
          fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          block<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">BlockByHash</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> header<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
             log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Uint64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>block<span class="token punctuation">.</span><span class="token function">Transactions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="裸交易raw-transaction" tabindex="-1"><a class="header-anchor" href="#裸交易raw-transaction" aria-hidden="true">#</a> 裸交易Raw Transaction</h3><p>这是在告诉我们怎么从一个已签名的 transaction 得到他的 rlp 编码字符串，然后再怎么反序列化为一个 transaction 对象。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// 假设我们已经得到了一个已签名的 transaction</span>
<span class="token comment">// 交易的原始字节数据，新 api 调用 EncodeIndex，即可将其序列化为 RLP 编码的字节数据</span>
ts <span class="token operator">:=</span> types<span class="token punctuation">.</span>Transactions<span class="token punctuation">{</span>signedTx<span class="token punctuation">}</span>
b <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span>Buffer<span class="token punctuation">)</span>
ts<span class="token punctuation">.</span><span class="token function">EncodeIndex</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
rawTxBytes <span class="token operator">:=</span> b<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 然后可以反序列化为交易对象</span>
tx <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">)</span>
err <span class="token operator">=</span> rlp<span class="token punctuation">.</span><span class="token function">DecodeBytes</span><span class="token punctuation">(</span>rawTxBytes<span class="token punctuation">,</span> tx<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 这样打印的数据和 signedTx 一样</span>
<span class="token comment">// 字节数组也可以转换为 16 进制字符串</span>
rawTxHex <span class="token operator">:=</span> hexutil<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>rawTxBytes<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;rawTxHex&quot;</span><span class="token punctuation">,</span> rawTxHex<span class="token punctuation">)</span>
<span class="token comment">// or hex.EncodeToString()</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>之后，同样可以使用 <code>client.SendTransaction(context.Background(), tx)</code> 广播交易。</p><h2 id="智能合约" tabindex="-1"><a class="header-anchor" href="#智能合约" aria-hidden="true">#</a> 智能合约</h2><h3 id="编译和-abi" tabindex="-1"><a class="header-anchor" href="#编译和-abi" aria-hidden="true">#</a> 编译和 ABI</h3><p>与智能合约交互，我们要先生成相应智能合约的应用二进制接口ABI(application binary interface)，并把ABI编译成我们可以在Go应用中调用的格式（也就是生成合约对象的 go 文件，可以根据这个生成合约实例 instance）。</p><p>安装 solidity 编译器 sloc</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>brew update <span class="token comment"># 可选，不知道为啥，执行不成功</span>
brew tap ethereum/ethereum
brew <span class="token function">install</span> solidity
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装<code>abigen</code>工具，来从solidity智能合约生成ABI。假设已经在计算机上设置了Go，只需运行以下命令即可安装<code>abigen</code>工具。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>go get <span class="token parameter variable">-u</span> github.com/ethereum/go-ethereum <span class="token comment"># 安装好 geth 库</span>
<span class="token builtin class-name">cd</span> <span class="token variable">$GOPATH</span>/pkg/mod/github.com/ethereum/go-ethereum@v1.14.7 <span class="token comment"># 这里不一定是这个地址，需要换成自己的</span>
<span class="token function">make</span>
<span class="token function">make</span> devtools
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后生成 ABI 文件和 bin 文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>solc <span class="token parameter variable">--abi</span> <span class="token parameter variable">--bin</span> <span class="token parameter variable">-o</span> ./build Store.sol <span class="token comment"># 输出到 build 目录</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>不知道为啥他自动生成的abi 文件和 bin 文件叫 HelloWorld，抽象了，==还没找到怎么重命名==</p><p>然后根据这两个文件，生成 go 文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>abigen <span class="token parameter variable">--bin</span><span class="token operator">=</span>./build/HelloWorld.bin <span class="token parameter variable">--abi</span><span class="token operator">=</span>./build/HelloWorld.abi <span class="token parameter variable">--pkg</span><span class="token operator">=</span>store <span class="token parameter variable">--out</span><span class="token operator">=</span>store.go  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>新文件将包含我们可以用来与Go应用程序中的智能合约进行交互的所有可用方法，包括deploy方法。</p><h3 id="部署智能合约" tabindex="-1"><a class="header-anchor" href="#部署智能合约" aria-hidden="true">#</a> 部署智能合约</h3><p>部署智能合约需要有账号，并且账号上还要有以太币才行</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>client<span class="token punctuation">,</span> err <span class="token operator">:=</span> ethclient<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">&quot;https://cloudflare-eth.com&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 根据私钥得到地址</span>
privateKey<span class="token punctuation">,</span> err <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">HexToECDSA</span><span class="token punctuation">(</span><span class="token string">&quot;fad9c8855b740a0b7ed4c221dbad0f33a83a49cad6b3fe8d5817ac83d38b6a19&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
publicKey <span class="token operator">:=</span> privateKey<span class="token punctuation">.</span><span class="token function">Public</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
publicKeyECDSA<span class="token punctuation">,</span> ok <span class="token operator">:=</span> publicKey<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>ecdsa<span class="token punctuation">.</span>PublicKey<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;cannot assert type: publicKey is not of type *ecdsa.PublicKey&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fromAddress <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">PubkeyToAddress</span><span class="token punctuation">(</span><span class="token operator">*</span>publicKeyECDSA<span class="token punctuation">)</span>

nonce<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">PendingNonceAt</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> fromAddress<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
gasPrice<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">SuggestGasPrice</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
chainId<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">NetworkID</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 创建一个有配置密匙的交易发送器(tansactor)</span>
auth<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> bind<span class="token punctuation">.</span><span class="token function">NewKeyedTransactorWithChainID</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">,</span> chainId<span class="token punctuation">)</span>
auth<span class="token punctuation">.</span>Nonce <span class="token operator">=</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>nonce<span class="token punctuation">)</span><span class="token punctuation">)</span>
auth<span class="token punctuation">.</span>Value <span class="token operator">=</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>     <span class="token comment">// in wei</span>
auth<span class="token punctuation">.</span>GasLimit <span class="token operator">=</span> <span class="token function">uint64</span><span class="token punctuation">(</span><span class="token number">300000</span><span class="token punctuation">)</span> <span class="token comment">// in units</span>
auth<span class="token punctuation">.</span>GasPrice <span class="token operator">=</span> gasPrice

input <span class="token operator">:=</span> <span class="token string">&quot;1.0&quot;</span> <span class="token comment">// 合约的初始数据 </span>
<span class="token comment">// instance 是生成的合约实例 Deployxxx,后面生成合约 go 文件时指定的名字</span>
address<span class="token punctuation">,</span> tx<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> err <span class="token operator">:=</span> store<span class="token punctuation">.</span><span class="token function">DeployStore</span><span class="token punctuation">(</span>auth<span class="token punctuation">,</span> client<span class="token punctuation">,</span> input<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">// 生成的智能合约的地址</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 生成的交易</span>

<span class="token boolean">_</span> <span class="token operator">=</span> instance
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="加载智能合约" tabindex="-1"><a class="header-anchor" href="#加载智能合约" aria-hidden="true">#</a> 加载智能合约</h3><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>address <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">HexToAddress</span><span class="token punctuation">(</span><span class="token string">&quot;合约地址&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 0x1111...</span>
<span class="token comment">// Newxxx,后面生成合约 go 文件时指定的名字</span>
instance<span class="token punctuation">,</span> err <span class="token operator">:=</span> store<span class="token punctuation">.</span><span class="token function">NewStore</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> client<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实际上，我们只需要有 abi 和 bin 文件，即可生成 go 文件，并从以太坊得到 instance（可以从以太坊上找一个智能合约（比如<a href="https://etherscan.io/address/0x1111111254eeb25477b68fb85ed929f73a960582#code" target="_blank" rel="noopener noreferrer">这个<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>），然后赋值他的abi 文件（Contract ABI字段，可以认为是接口说明文档）和 bin 文件（Contract Creation Code字段，这个是执行指令的编码）内容即可）</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>client<span class="token punctuation">,</span> err <span class="token operator">:=</span> ethclient<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">&quot;https://cloudflare-eth.com&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

address <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">HexToAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0x1111111254EEB25477B68fb85Ed929f73A960582&quot;</span><span class="token punctuation">)</span>

balanceAt<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">BalanceAt</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> address<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>balanceAt<span class="token punctuation">)</span>
instance<span class="token punctuation">,</span> err <span class="token operator">:=</span> a<span class="token punctuation">.</span><span class="token function">NewA</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> client<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>ACaller<span class="token punctuation">)</span>
<span class="token comment">/*
输出如下：确实可以生成实例，并拿到合约上的内容
1
&amp;{ {0x14000358a08} {0x14000358a08} {0x14000358a08} }
{0x14000358a08}
*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="写智能合约" tabindex="-1"><a class="header-anchor" href="#写智能合约" aria-hidden="true">#</a> 写智能合约</h3><p>上面我们可以读取合约的一些公共值，也就是不需要私钥签名就能读的值，如果要对合约进行写操作（调用智能合约做事情），我们就需要用到私钥了</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>auth<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> bind<span class="token punctuation">.</span><span class="token function">NewKeyedTransactorWithChainID</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">,</span> chainId<span class="token punctuation">)</span>
auth<span class="token punctuation">.</span>Nonce <span class="token operator">=</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>nonce<span class="token punctuation">)</span><span class="token punctuation">)</span>
auth<span class="token punctuation">.</span>Value <span class="token operator">=</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>     <span class="token comment">// in wei</span>
auth<span class="token punctuation">.</span>GasLimit <span class="token operator">=</span> <span class="token function">uint64</span><span class="token punctuation">(</span><span class="token number">300000</span><span class="token punctuation">)</span> <span class="token comment">// in units</span>
auth<span class="token punctuation">.</span>GasPrice <span class="token operator">=</span> gasPrice

message<span class="token punctuation">,</span> err <span class="token operator">:=</span> instance<span class="token punctuation">.</span><span class="token function">Destroy</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 生成的 go 源码如下</span>
<span class="token comment">// Destroy is a paid mutator transaction binding the contract method 0x83197ef0.</span>
<span class="token comment">//</span>
<span class="token comment">// Solidity: function destroy() returns()</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>_A <span class="token operator">*</span>ATransactor<span class="token punctuation">)</span> <span class="token function">Destroy</span><span class="token punctuation">(</span>opts <span class="token operator">*</span>bind<span class="token punctuation">.</span>TransactOpts<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>types<span class="token punctuation">.</span>Transaction<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> _A<span class="token punctuation">.</span>contract<span class="token punctuation">.</span><span class="token function">Transact</span><span class="token punctuation">(</span>opts<span class="token punctuation">,</span> <span class="token string">&quot;destroy&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这些合约的方法第一个参数都是需要传递一个<code>*TransactOpts</code>对象，TransactOpts is the collection of authorization data required to create a valid Ethereum transaction.。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> TransactOpts <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    From      common<span class="token punctuation">.</span>Address
    Nonce     <span class="token operator">*</span>big<span class="token punctuation">.</span>Int
    Signer    SignerFn
    Value     <span class="token operator">*</span>big<span class="token punctuation">.</span>Int
    GasPrice  <span class="token operator">*</span>big<span class="token punctuation">.</span>Int
    GasFeeCap <span class="token operator">*</span>big<span class="token punctuation">.</span>Int
    GasTipCap <span class="token operator">*</span>big<span class="token punctuation">.</span>Int
    GasLimit  <span class="token builtin">uint64</span>
    Context   context<span class="token punctuation">.</span>Context
    NoSend    <span class="token builtin">bool</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>这实际上就是发生了一个智能合约调用的交易。调用的这些函数在幕后将使用它的参数对此函数调用进行编码，将其设置为事务的<code>data</code>属性，并使用私钥对其进行签名。 结果将是一个已签名的事务对象。然后叫交易广播出去。</strong></p><h3 id="读智能合约二进制码" tabindex="-1"><a class="header-anchor" href="#读智能合约二进制码" aria-hidden="true">#</a> 读智能合约二进制码</h3><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>bytecode<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">CodeAt</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> contractAddress<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// nil is latest block</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>hex<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>bytecode<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>打印的结果将和以太坊浏览器etherscan上的 Deployed Bytecode 字段相同，只不过没有 0x 前缀。</p><p><strong>这个是对代码本身进行了编码</strong></p><h2 id="事件日志" tabindex="-1"><a class="header-anchor" href="#事件日志" aria-hidden="true">#</a> 事件日志</h2><p>事件有方法执行时调用 emit 产生。如</p><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token keyword">contract</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>
    <span class="token comment">// 事件定义中包含两个 indexed 参数</span>
    <span class="token keyword">event</span> <span class="token function">Transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">indexed</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token builtin">address</span> <span class="token keyword">indexed</span> to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span> _to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> _value<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token comment">// 一些转账逻辑</span>
        <span class="token comment">// ...</span>
        <span class="token comment">// 发布日志事件</span>
        <span class="token keyword">emit</span> <span class="token function">Transfer</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> _to<span class="token punctuation">,</span> _value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>智能合约具有在执行期间“发出”事件的能力</strong>。 事件在以太坊中也称为“日志”。 事件的输出存储在日志部分下的事务处理中。 事件已经在以太坊智能合约中被广泛使用，以便在发生相对重要的动作时记录，特别是在代币合约（即ERC-20）中，以指示代币转账已经发生。 这些部分将引导您完成从区块链中读取事件以及订阅事件的过程，以便交易事务被矿工打包入块的时候及时收到通知。</p><h3 id="监听事件日志" tabindex="-1"><a class="header-anchor" href="#监听事件日志" aria-hidden="true">#</a> 监听事件日志</h3><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>client<span class="token punctuation">,</span> err <span class="token operator">:=</span> ethclient<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">&quot;wss://sepolia.infura.io/ws/v3/d481f2467f41493c9d699a59f6e03213&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

contractAddress <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">HexToAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0x2a0f1C1cE263202f629bF41FA7Caa3D5F8FD52C4&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 创建筛选查询</span>
query <span class="token operator">:=</span> ethereum<span class="token punctuation">.</span>FilterQuery<span class="token punctuation">{</span>
    Addresses<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>common<span class="token punctuation">.</span>Address<span class="token punctuation">{</span>contractAddress<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

logs <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> types<span class="token punctuation">.</span>Log<span class="token punctuation">)</span>
sub<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">SubscribeFilterLogs</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query<span class="token punctuation">,</span> logs<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">{</span>
    <span class="token keyword">select</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> err <span class="token operator">:=</span> <span class="token operator">&lt;-</span>sub<span class="token punctuation">.</span><span class="token function">Err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
       log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">case</span> vLog <span class="token operator">:=</span> <span class="token operator">&lt;-</span>logs<span class="token punctuation">:</span>
       fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;logs: %v\n&quot;</span><span class="token punctuation">,</span> vLog<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样好像不可以在设置多余的筛选条件，试了一下没成功。（傻逼了，这是订阅事件，他会传过来订阅之后的新事件，这样增加新条件肯定没用）</p><h3 id="读取事件日志" tabindex="-1"><a class="header-anchor" href="#读取事件日志" aria-hidden="true">#</a> 读取事件日志</h3><p>智能合约可以可选地释放“事件”，其作为交易收据的一部分存储日志。通过构建过滤查询FilterQuery即可</p><p>可选地筛选条件如下：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> FilterQuery <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    BlockHash <span class="token operator">*</span>common<span class="token punctuation">.</span>Hash
    FromBlock <span class="token operator">*</span>big<span class="token punctuation">.</span>Int
    ToBlock   <span class="token operator">*</span>big<span class="token punctuation">.</span>Int
    Addresses <span class="token punctuation">[</span><span class="token punctuation">]</span>common<span class="token punctuation">.</span>Address
    Topics    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span>common<span class="token punctuation">.</span>Hash
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例代码如下：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>client<span class="token punctuation">,</span> err <span class="token operator">:=</span> ethclient<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">&quot;wss://sepolia.infura.io/ws/v3/d481f2467f41493c9d699a59f6e03213&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

contractAddress <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">HexToAddress</span><span class="token punctuation">(</span><span class="token string">&quot;0x2a0f1C1cE263202f629bF41FA7Caa3D5F8FD52C4&quot;</span><span class="token punctuation">)</span>
query <span class="token operator">:=</span> ethereum<span class="token punctuation">.</span>FilterQuery<span class="token punctuation">{</span>
    FromBlock<span class="token punctuation">:</span> big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span><span class="token number">6154872</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ToBlock<span class="token punctuation">:</span>   big<span class="token punctuation">.</span><span class="token function">NewInt</span><span class="token punctuation">(</span><span class="token number">6154880</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//BlockHash: (*common.Hash)(common.Hex2Bytes(&quot;8e291243080ce85fe9e93d89935021eb116a13c0e902bbcb7f99a87f13a2f07d&quot;)),</span>
    Addresses<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>common<span class="token punctuation">.</span>Address<span class="token punctuation">{</span>contractAddress<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// 接收我们的查询并将返回所有的匹配事件日志,返回的所有日志将是ABI编码,需要解码</span>
logs<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">FilterLogs</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 新 api，拿到 contractAbi 对象</span>
contractAbi<span class="token punctuation">,</span> err <span class="token operator">:=</span> a<span class="token punctuation">.</span>AMetaData<span class="token punctuation">.</span><span class="token function">GetAbi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> vLog <span class="token operator">:=</span> <span class="token keyword">range</span> logs <span class="token punctuation">{</span>
    <span class="token comment">//fmt.Println(vLog)</span>
    event<span class="token punctuation">,</span> err <span class="token operator">:=</span> contractAbi<span class="token punctuation">.</span><span class="token function">Unpack</span><span class="token punctuation">(</span><span class="token string">&quot;Transfer&quot;</span><span class="token punctuation">,</span> vLog<span class="token punctuation">.</span>Data<span class="token punctuation">)</span> <span class="token comment">// mint没有非 indexed 参数，所以解析出来为空</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
       log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此外，日志结构体包含附加信息，例如，区块摘要，区块号和交易摘要。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>vLog<span class="token punctuation">.</span>BlockHash<span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>vLog<span class="token punctuation">.</span>BlockNumber<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>vLog<span class="token punctuation">.</span>TxHash<span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>若solidity事件包含<code>indexed</code>事件类型比如<code>event Transfer(address indexed from, address indexed to, uint256 indexed tokenId);包含了 indexed关键字，所有这些数据都成了 topics，而不是数据属性</code>，那么它们将成为<em>主题</em>而不是日志的数据属性的一部分。在solidity中最多只能有4个主题，但只有3个可索引的事件类型。第一个主题总是事件的签名。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> vLog <span class="token operator">:=</span> <span class="token keyword">range</span> logs <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;------&quot;</span><span class="token punctuation">)</span>
  <span class="token comment">//fmt.Println(vLog)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>vLog<span class="token punctuation">.</span>BlockHash<span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>vLog<span class="token punctuation">.</span>BlockNumber<span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>vLog<span class="token punctuation">.</span>TxHash<span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  event<span class="token punctuation">,</span> err <span class="token operator">:=</span> contractAbi<span class="token punctuation">.</span><span class="token function">Unpack</span><span class="token punctuation">(</span><span class="token string">&quot;Transfer&quot;</span><span class="token punctuation">,</span> vLog<span class="token punctuation">.</span>Data<span class="token punctuation">)</span> 
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token comment">// 为空切片</span>
  <span class="token comment">// 拿到 topic</span>
  <span class="token keyword">var</span> topics <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token builtin">string</span>
  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> vLog<span class="token punctuation">.</span>Topics <span class="token punctuation">{</span>
    topics<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> vLog<span class="token punctuation">.</span>Topics<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 有值</span>
  <span class="token punctuation">}</span>

  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>topics<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
eventSignature <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;Transfer(address,address,uint256)&quot;</span><span class="token punctuation">)</span>
hash <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">Keccak256Hash</span><span class="token punctuation">(</span>eventSignature<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>hash<span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 这个值要和 topics[0] 一样</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到展示的数据和我们刚刚的分析是相匹配的，包含四个 topics</p><p><img src="/home/assets/log-32f9c016.png" alt="screenshot2024-07-17 20.34.10"></p><p>比如换一个存在非 indexed 参数的<a href="https://sepolia.etherscan.io/address/0x4eb6fc083d36d1986fbd75960c9796e019faf9b1" target="_blank" rel="noopener noreferrer">合约<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，复制他的 abi 文件和 bin 文件内容（如果只是单纯拿日志，是不需要 bin 文件的），然后 abigen 得到 go 文件，执行下面代码：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> vLog <span class="token operator">:=</span> <span class="token keyword">range</span> logs <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;------&quot;</span><span class="token punctuation">)</span>
  <span class="token comment">//fmt.Println(vLog)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>vLog<span class="token punctuation">.</span>BlockHash<span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>vLog<span class="token punctuation">.</span>BlockNumber<span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>vLog<span class="token punctuation">.</span>TxHash<span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  event<span class="token punctuation">,</span> err <span class="token operator">:=</span> contractAbi<span class="token punctuation">.</span><span class="token function">Unpack</span><span class="token punctuation">(</span><span class="token string">&quot;BaseFeeSet&quot;</span><span class="token punctuation">,</span> vLog<span class="token punctuation">.</span>Data<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token comment">// 输出 [5530644056 17178 6330580]</span>

  <span class="token keyword">var</span> topics <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token builtin">string</span>
  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token keyword">range</span> vLog<span class="token punctuation">.</span>Topics <span class="token punctuation">{</span>
    topics<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> vLog<span class="token punctuation">.</span>Topics<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 这里是没有值的</span>
  <span class="token punctuation">}</span>

  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>topics<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 输出0xbf196ae13d7650b1569b5c3bb40881e2957133d004550afdaeb372b8163ea1b9</span>
<span class="token punctuation">}</span>
eventSignature <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;BaseFeeSet(int256,uint256,uint256)&quot;</span><span class="token punctuation">)</span>
hash <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">Keccak256Hash</span><span class="token punctuation">(</span>eventSignature<span class="token punctuation">)</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>hash<span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 输出0xbf196ae13d7650b1569b5c3bb40881e2957133d004550afdaeb372b8163ea1b9</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/home/assets/nonindexed-20be387d.png" alt="screenshot2024-07-18 09.46.43"></p><p>以上的输出都是对的上的。</p><h2 id="签名" tabindex="-1"><a class="header-anchor" href="#签名" aria-hidden="true">#</a> 签名</h2><p>数字签名允许不可否认性，因为这意味着签署消息的人必须拥有私钥，来证明消息是真实的。 任何人都可以验证消息的真实性，只要它们具有原始数据的散列和签名者的公钥即可。</p><h3 id="生成签名" tabindex="-1"><a class="header-anchor" href="#生成签名" aria-hidden="true">#</a> 生成签名</h3><p>用于生成签名的组件是：签名者私钥，以及将要签名的数据的哈希。 只要输出为32字节，就可以使用任何哈希算法。 以太坊常用Keccak-256作为哈希算法</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	privateKey<span class="token punctuation">,</span> err <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">HexToECDSA</span><span class="token punctuation">(</span><span class="token string">&quot;fad9c8855b740a0b7ed4c221dbad0f33a83a49cad6b3fe8d5817ac83d38b6a19&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;privateKey&quot;</span><span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span>

	data <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
	hash <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span>crypto<span class="token punctuation">.</span><span class="token function">Keccak256</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 类转转换</span>
	hashedData <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">Keccak256Hash</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// 直接帮我们转换了</span>

	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>hash<span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0x1c8aff950685c2ed4bc3174f3472287b56d9517b9c948127319a09a7a36deac8</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>hashedData<span class="token punctuation">.</span><span class="token function">Hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0x1c8aff950685c2ed4bc3174f3472287b56d9517b9c948127319a09a7a36deac8</span>

	signature<span class="token punctuation">,</span> err <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>hash<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span> <span class="token comment">// hash 后的数据的字节</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;signature&quot;</span><span class="token punctuation">,</span> hex<span class="token punctuation">.</span><span class="token function">EncodeToString</span><span class="token punctuation">(</span>signature<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 没有 0x 前缀</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;signature&quot;</span><span class="token punctuation">,</span> hexutil<span class="token punctuation">.</span><span class="token function">Encode</span><span class="token punctuation">(</span>signature<span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment">// 有 0x 前缀</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意交易的签名调用的是<code>types.SignTx</code>，简单的对数据签名是调用的<code>crypto.Sign</code>。实际上<code>types.SignTx</code>底层也是调用<code>crypto.Sign</code>对数据进行签名，只不过他需要重新生成一个交易对象，给他里面的<code>r, s, v</code>赋值</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">SignTx</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>Transaction<span class="token punctuation">,</span> s Signer<span class="token punctuation">,</span> prv <span class="token operator">*</span>ecdsa<span class="token punctuation">.</span>PrivateKey<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Transaction<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	h <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
	sig<span class="token punctuation">,</span> err <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>h<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> prv<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> tx<span class="token punctuation">.</span><span class="token function">WithSignature</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> sig<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>tx <span class="token operator">*</span>Transaction<span class="token punctuation">)</span> <span class="token function">WithSignature</span><span class="token punctuation">(</span>signer Signer<span class="token punctuation">,</span> sig <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Transaction<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	r<span class="token punctuation">,</span> s<span class="token punctuation">,</span> v<span class="token punctuation">,</span> err <span class="token operator">:=</span> signer<span class="token punctuation">.</span><span class="token function">SignatureValues</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span> sig<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> r <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> s <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">||</span> v <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;%w: r: %s, s: %s, v: %s&quot;</span><span class="token punctuation">,</span> ErrInvalidSig<span class="token punctuation">,</span> r<span class="token punctuation">,</span> s<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	cpy <span class="token operator">:=</span> tx<span class="token punctuation">.</span>inner<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	cpy<span class="token punctuation">.</span><span class="token function">setSignatureValues</span><span class="token punctuation">(</span>signer<span class="token punctuation">.</span><span class="token function">ChainID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v<span class="token punctuation">,</span> r<span class="token punctuation">,</span> s<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>Transaction<span class="token punctuation">{</span>inner<span class="token punctuation">:</span> cpy<span class="token punctuation">,</span> time<span class="token punctuation">:</span> tx<span class="token punctuation">.</span>time<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="验证签名" tabindex="-1"><a class="header-anchor" href="#验证签名" aria-hidden="true">#</a> 验证签名</h3><ul><li>使用数据编码后的 hash 的字节数据和签名后的字节数据可以恢复出公钥</li><li>然后使用私钥得到公钥，对比公钥是否相等就行</li></ul><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    privateKey<span class="token punctuation">,</span> err <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">HexToECDSA</span><span class="token punctuation">(</span><span class="token string">&quot;fad9c8855b740a0b7ed4c221dbad0f33a83a49cad6b3fe8d5817ac83d38b6a19&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
       log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 得到公钥</span>
    publicKey <span class="token operator">:=</span> privateKey<span class="token punctuation">.</span><span class="token function">Public</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>ecdsa<span class="token punctuation">.</span>PublicKey<span class="token punctuation">)</span>
    publicKeyBytes <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">FromECDSAPub</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span>
    <span class="token comment">// 数据</span>
    data <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
    hash <span class="token operator">:=</span> common<span class="token punctuation">.</span><span class="token function">Hash</span><span class="token punctuation">(</span>crypto<span class="token punctuation">.</span><span class="token function">Keccak256</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// 签名后的数据</span>
    <span class="token comment">// The produced signature is in the [R || S || V] format where V is 0 or 1. 包含三个数据</span>
    signature<span class="token punctuation">,</span> err <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>hash<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> privateKey<span class="token punctuation">)</span>
    <span class="token comment">// 恢复公钥</span>
    <span class="token comment">// 直接返回 bytes</span>
    recoverPublicKeyBytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">Ecrecover</span><span class="token punctuation">(</span>hash<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> signature<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    isVerified <span class="token operator">:=</span> bytes<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>publicKeyBytes<span class="token punctuation">,</span> recoverPublicKeyBytes<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;isVerified&quot;</span><span class="token punctuation">,</span> isVerified<span class="token punctuation">)</span>

    <span class="token comment">// 返回 *ecdsa.PublicKey</span>
    recoverPublicKey<span class="token punctuation">,</span> err <span class="token operator">:=</span> crypto<span class="token punctuation">.</span><span class="token function">SigToPub</span><span class="token punctuation">(</span>hash<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> signature<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    recoverPublicKeyBytes <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">FromECDSAPub</span><span class="token punctuation">(</span>recoverPublicKey<span class="token punctuation">)</span>
    isVerified <span class="token operator">=</span> bytes<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>publicKeyBytes<span class="token punctuation">,</span> recoverPublicKeyBytes<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;isVerified&quot;</span><span class="token punctuation">,</span> isVerified<span class="token punctuation">)</span>

    <span class="token comment">// 直接验证</span>
    <span class="token comment">// 删除 signature 的最后一个字节，因为它是ECDSA恢复ID，不能包含它</span>
    signatureWithoutRecoverID <span class="token operator">:=</span> signature<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token function">len</span><span class="token punctuation">(</span>signature<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment">// The signature should have the 64 byte [R || S] format.</span>
    <span class="token comment">// 这也就是为什么需要剔除最后一个字节的原因，最后一个字节是 v，是 0 或者 1.</span>
    isVerified <span class="token operator">=</span> crypto<span class="token punctuation">.</span><span class="token function">VerifySignature</span><span class="token punctuation">(</span>publicKeyBytes<span class="token punctuation">,</span> hash<span class="token punctuation">.</span><span class="token function">Bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> signatureWithoutRecoverID<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;isVerified&quot;</span><span class="token punctuation">,</span> isVerified<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/home/master/ethereum/gas.html" class="" aria-label="Gas 燃料和费用"><!--[--><!--]--> Gas 燃料和费用 <!--[--><!--]--></a></span><span class="next"><a href="/home/master/ethereum/hd_wallet.html" class="" aria-label="分层确定性钱包HD-Wallet"><!--[--><!--]--> 分层确定性钱包HD-Wallet <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/home/assets/app-3a70664a.js" defer></script>
  </body>
</html>
