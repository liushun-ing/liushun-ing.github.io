<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.62">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/home/imgs/favicon.ico"><title>GORM-2 | 不愿飞的蜂鸟首页</title><meta name="description" content="Five的垃圾库">
    <link rel="preload" href="/home/assets/style-d11d67ee.css" as="style"><link rel="stylesheet" href="/home/assets/style-d11d67ee.css">
    <link rel="modulepreload" href="/home/assets/app-6d09a449.js"><link rel="modulepreload" href="/home/assets/gorm_2.html-c8832ac2.js"><link rel="modulepreload" href="/home/assets/gorm_2.html-c9e371bb.js"><link rel="prefetch" href="/home/assets/index.html-8dd1a890.js" as="script"><link rel="prefetch" href="/home/assets/index.html-81b2fcca.js" as="script"><link rel="prefetch" href="/home/assets/index.html-ffc6f5d3.js" as="script"><link rel="prefetch" href="/home/assets/index.html-25f3e375.js" as="script"><link rel="prefetch" href="/home/assets/1.html-b316c5ed.js" as="script"><link rel="prefetch" href="/home/assets/2.html-ac2ea519.js" as="script"><link rel="prefetch" href="/home/assets/3.html-a16fc765.js" as="script"><link rel="prefetch" href="/home/assets/4.html-798018cd.js" as="script"><link rel="prefetch" href="/home/assets/5.html-18ce25f4.js" as="script"><link rel="prefetch" href="/home/assets/6.html-f31143bd.js" as="script"><link rel="prefetch" href="/home/assets/index.html-d4d6df4d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b98c27b4.js" as="script"><link rel="prefetch" href="/home/assets/algorithms.html-f5b5ee0a.js" as="script"><link rel="prefetch" href="/home/assets/c__.html-05ab7a9e.js" as="script"><link rel="prefetch" href="/home/assets/graph.html-dab7b16e.js" as="script"><link rel="prefetch" href="/home/assets/leetcode.html-f105e9f1.js" as="script"><link rel="prefetch" href="/home/assets/other_tree.html-22fe33b0.js" as="script"><link rel="prefetch" href="/home/assets/sort_and_search.html-11f53bfb.js" as="script"><link rel="prefetch" href="/home/assets/string.html-e9db3916.js" as="script"><link rel="prefetch" href="/home/assets/tree.html-ec32110e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-99884eac.js" as="script"><link rel="prefetch" href="/home/assets/10.html-75dc6e9d.js" as="script"><link rel="prefetch" href="/home/assets/11.html-44ed8d03.js" as="script"><link rel="prefetch" href="/home/assets/12.html-1cafae42.js" as="script"><link rel="prefetch" href="/home/assets/13.html-cf9e5046.js" as="script"><link rel="prefetch" href="/home/assets/14.html-513b431e.js" as="script"><link rel="prefetch" href="/home/assets/2.html-094a87ee.js" as="script"><link rel="prefetch" href="/home/assets/3.html-4a8b2796.js" as="script"><link rel="prefetch" href="/home/assets/4.html-1f39f3b9.js" as="script"><link rel="prefetch" href="/home/assets/5.html-e78784fc.js" as="script"><link rel="prefetch" href="/home/assets/6.html-cc4acb22.js" as="script"><link rel="prefetch" href="/home/assets/7.html-ff096a2a.js" as="script"><link rel="prefetch" href="/home/assets/8.html-14b4319a.js" as="script"><link rel="prefetch" href="/home/assets/9.html-f1fd1f24.js" as="script"><link rel="prefetch" href="/home/assets/index.html-47fde470.js" as="script"><link rel="prefetch" href="/home/assets/1.html-769a7684.js" as="script"><link rel="prefetch" href="/home/assets/2.html-594984b8.js" as="script"><link rel="prefetch" href="/home/assets/3.html-5ac058a8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-8a655167.js" as="script"><link rel="prefetch" href="/home/assets/index.html-994c7095.js" as="script"><link rel="prefetch" href="/home/assets/base_concept.html-8c9eb618.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-6eb25c4d.js" as="script"><link rel="prefetch" href="/home/assets/pytorch_usage.html-12ebfb9e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b3cb88be.js" as="script"><link rel="prefetch" href="/home/assets/gas_fee.html-ed17beee.js" as="script"><link rel="prefetch" href="/home/assets/monitoring.html-359c3ac0.js" as="script"><link rel="prefetch" href="/home/assets/statedb_execute.html-39620858.js" as="script"><link rel="prefetch" href="/home/assets/23_Dec.html-b55b0d44.js" as="script"><link rel="prefetch" href="/home/assets/23_Nov.html-7f12af9c.js" as="script"><link rel="prefetch" href="/home/assets/24_Jan.html-aa29373f.js" as="script"><link rel="prefetch" href="/home/assets/index.html-cf670ace.js" as="script"><link rel="prefetch" href="/home/assets/index.html-e9115f16.js" as="script"><link rel="prefetch" href="/home/assets/compose.html-72dd1522.js" as="script"><link rel="prefetch" href="/home/assets/image_construct.html-803fa8bb.js" as="script"><link rel="prefetch" href="/home/assets/intro.html-c97d438d.js" as="script"><link rel="prefetch" href="/home/assets/framework.html-26732a5d.js" as="script"><link rel="prefetch" href="/home/assets/interview.html-c43e6b5a.js" as="script"><link rel="prefetch" href="/home/assets/javabase.html-4b7acc92.js" as="script"><link rel="prefetch" href="/home/assets/javacollection.html-7d0eec7c.js" as="script"><link rel="prefetch" href="/home/assets/javaio.html-2e0ce7a0.js" as="script"><link rel="prefetch" href="/home/assets/javajuc.html-e3adfcb3.js" as="script"><link rel="prefetch" href="/home/assets/project.html-ee5d4ecd.js" as="script"><link rel="prefetch" href="/home/assets/index.html-737a4dbc.js" as="script"><link rel="prefetch" href="/home/assets/distributed.html-cb9755f7.js" as="script"><link rel="prefetch" href="/home/assets/gin.html-93f5f92b.js" as="script"><link rel="prefetch" href="/home/assets/gorm_1.html-c2cc8863.js" as="script"><link rel="prefetch" href="/home/assets/goweb.html-dfefa78e.js" as="script"><link rel="prefetch" href="/home/assets/protobuf.html-46891574.js" as="script"><link rel="prefetch" href="/home/assets/rpc.html-2433bbc8.js" as="script"><link rel="prefetch" href="/home/assets/sse.html-86957496.js" as="script"><link rel="prefetch" href="/home/assets/test.html-0295cc69.js" as="script"><link rel="prefetch" href="/home/assets/websocket.html-2392370e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-f201c773.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3732bf90.js" as="script"><link rel="prefetch" href="/home/assets/index.html-c00cd462.js" as="script"><link rel="prefetch" href="/home/assets/account.html-f2972d26.js" as="script"><link rel="prefetch" href="/home/assets/block.html-a9d64f7a.js" as="script"><link rel="prefetch" href="/home/assets/consensus.html-d4a4313d.js" as="script"><link rel="prefetch" href="/home/assets/contract.html-ebb9a32c.js" as="script"><link rel="prefetch" href="/home/assets/crypto_base.html-6226e31f.js" as="script"><link rel="prefetch" href="/home/assets/erc20.html-9175e857.js" as="script"><link rel="prefetch" href="/home/assets/ethereum_base.html-ed8afc4d.js" as="script"><link rel="prefetch" href="/home/assets/evm.html-c6aa4ef2.js" as="script"><link rel="prefetch" href="/home/assets/gas.html-7e483dbf.js" as="script"><link rel="prefetch" href="/home/assets/go_ethereum.html-7454bd3e.js" as="script"><link rel="prefetch" href="/home/assets/hd_wallet.html-3b70c8a3.js" as="script"><link rel="prefetch" href="/home/assets/jsonrpc.html-4b92012b.js" as="script"><link rel="prefetch" href="/home/assets/leveldb.html-f6dcddfb.js" as="script"><link rel="prefetch" href="/home/assets/mev.html-3b28f6dc.js" as="script"><link rel="prefetch" href="/home/assets/mpt.html-78685936.js" as="script"><link rel="prefetch" href="/home/assets/node_client.html-1945c0e1.js" as="script"><link rel="prefetch" href="/home/assets/rlp.html-c63951dd.js" as="script"><link rel="prefetch" href="/home/assets/statedb.html-57e0e0ee.js" as="script"><link rel="prefetch" href="/home/assets/transaction.html-ea80179c.js" as="script"><link rel="prefetch" href="/home/assets/1.html-8f3c150c.js" as="script"><link rel="prefetch" href="/home/assets/2.html-35ec231b.js" as="script"><link rel="prefetch" href="/home/assets/3.html-5d7e2173.js" as="script"><link rel="prefetch" href="/home/assets/4.html-b019902a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-dd915206.js" as="script"><link rel="prefetch" href="/home/assets/index.html-27666f68.js" as="script"><link rel="prefetch" href="/home/assets/dockerbase.html-359d1c8c.js" as="script"><link rel="prefetch" href="/home/assets/dockerutil.html-7ea89af6.js" as="script"><link rel="prefetch" href="/home/assets/k8sbase.html-dbb7e878.js" as="script"><link rel="prefetch" href="/home/assets/index.html-9e6553b4.js" as="script"><link rel="prefetch" href="/home/assets/mybatis.html-9fde4bbc.js" as="script"><link rel="prefetch" href="/home/assets/index.html-0e097ce5.js" as="script"><link rel="prefetch" href="/home/assets/base.html-0813edec.js" as="script"><link rel="prefetch" href="/home/assets/index.html-4918b69a.js" as="script"><link rel="prefetch" href="/home/assets/section0.html-0b462ef9.js" as="script"><link rel="prefetch" href="/home/assets/1.html-86ebf5bf.js" as="script"><link rel="prefetch" href="/home/assets/2.html-ef334cb2.js" as="script"><link rel="prefetch" href="/home/assets/index.html-beacf8a6.js" as="script"><link rel="prefetch" href="/home/assets/index.html-5b4a2fd2.js" as="script"><link rel="prefetch" href="/home/assets/alert.html-5d3a906c.js" as="script"><link rel="prefetch" href="/home/assets/clustering.html-1888741f.js" as="script"><link rel="prefetch" href="/home/assets/exporter.html-a7927412.js" as="script"><link rel="prefetch" href="/home/assets/intro.html-6a3e2ba8.js" as="script"><link rel="prefetch" href="/home/assets/promql.html-21c67535.js" as="script"><link rel="prefetch" href="/home/assets/servicediscovery.html-22fe93b7.js" as="script"><link rel="prefetch" href="/home/assets/index.html-5747b02b.js" as="script"><link rel="prefetch" href="/home/assets/base_usage.html-313edb82.js" as="script"><link rel="prefetch" href="/home/assets/1.html-84171baf.js" as="script"><link rel="prefetch" href="/home/assets/2.html-96474bc6.js" as="script"><link rel="prefetch" href="/home/assets/3.html-20b1a547.js" as="script"><link rel="prefetch" href="/home/assets/4.html-37db0907.js" as="script"><link rel="prefetch" href="/home/assets/index.html-9d407164.js" as="script"><link rel="prefetch" href="/home/assets/index.html-524f529c.js" as="script"><link rel="prefetch" href="/home/assets/jwt.html-c1c6066a.js" as="script"><link rel="prefetch" href="/home/assets/shiro.html-e4c32de8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-08bf43f7.js" as="script"><link rel="prefetch" href="/home/assets/nacos.html-ed2737e7.js" as="script"><link rel="prefetch" href="/home/assets/index.html-87c2298e.js" as="script"><link rel="prefetch" href="/home/assets/base.html-02cd95dc.js" as="script"><link rel="prefetch" href="/home/assets/progress.html-b37b9c9d.js" as="script"><link rel="prefetch" href="/home/assets/script.html-80de8d8d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-60425c3d.js" as="script"><link rel="prefetch" href="/home/assets/spring_annotation.html-3e4c4f76.js" as="script"><link rel="prefetch" href="/home/assets/springboot.html-dd3747fd.js" as="script"><link rel="prefetch" href="/home/assets/springboot_base.html-cd23c0a8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-dbf7dd00.js" as="script"><link rel="prefetch" href="/home/assets/java_usage.html-baf8cd68.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-5785b28e.js" as="script"><link rel="prefetch" href="/home/assets/system_usage.html-e9649787.js" as="script"><link rel="prefetch" href="/home/assets/index.html-1bcb2be9.js" as="script"><link rel="prefetch" href="/home/assets/docker_tutorial.html-4f5d0900.js" as="script"><link rel="prefetch" href="/home/assets/firewall_tutorial.html-a1c0f732.js" as="script"><link rel="prefetch" href="/home/assets/mysql_tutorial.html-4c6ba5d6.js" as="script"><link rel="prefetch" href="/home/assets/nginx_tutorial.html-93df5119.js" as="script"><link rel="prefetch" href="/home/assets/other_tutorial.html-c3d0505a.js" as="script"><link rel="prefetch" href="/home/assets/1.html-51f0ec55.js" as="script"><link rel="prefetch" href="/home/assets/2.html-a59bf622.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b0e9f560.js" as="script"><link rel="prefetch" href="/home/assets/5.html-a4a0234f.js" as="script"><link rel="prefetch" href="/home/assets/6.html-d1f646bc.js" as="script"><link rel="prefetch" href="/home/assets/7.html-4bfc5de3.js" as="script"><link rel="prefetch" href="/home/assets/Mybatis.html-999b181b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3e3eac32.js" as="script"><link rel="prefetch" href="/home/assets/Spring.html-ebdaae63.js" as="script"><link rel="prefetch" href="/home/assets/SpringBoot.html-c1676d63.js" as="script"><link rel="prefetch" href="/home/assets/SpringMVC.html-7bf971fc.js" as="script"><link rel="prefetch" href="/home/assets/1.html-095f3a2d.js" as="script"><link rel="prefetch" href="/home/assets/2.html-820329b9.js" as="script"><link rel="prefetch" href="/home/assets/3.html-65fa04a9.js" as="script"><link rel="prefetch" href="/home/assets/4.html-6cc0fdbb.js" as="script"><link rel="prefetch" href="/home/assets/5.html-4382da55.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2c443520.js" as="script"><link rel="prefetch" href="/home/assets/index.html-0a2a0106.js" as="script"><link rel="prefetch" href="/home/assets/less.html-26b18828.js" as="script"><link rel="prefetch" href="/home/assets/sass.html-e33a9ecf.js" as="script"><link rel="prefetch" href="/home/assets/1.html-e6ed9dbf.js" as="script"><link rel="prefetch" href="/home/assets/2.html-76ba2e41.js" as="script"><link rel="prefetch" href="/home/assets/index.html-202d5f4b.js" as="script"><link rel="prefetch" href="/home/assets/1.html-c051337a.js" as="script"><link rel="prefetch" href="/home/assets/2.html-c475ae33.js" as="script"><link rel="prefetch" href="/home/assets/index.html-7a9eb86e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-2d63875b.js" as="script"><link rel="prefetch" href="/home/assets/2.html-96ffe2d7.js" as="script"><link rel="prefetch" href="/home/assets/3.html-164f28d8.js" as="script"><link rel="prefetch" href="/home/assets/4.html-770067b7.js" as="script"><link rel="prefetch" href="/home/assets/5.html-94e4a58f.js" as="script"><link rel="prefetch" href="/home/assets/6.html-5fbe2511.js" as="script"><link rel="prefetch" href="/home/assets/7.html-6aaf4692.js" as="script"><link rel="prefetch" href="/home/assets/8.html-6c442319.js" as="script"><link rel="prefetch" href="/home/assets/9.html-1a1241a0.js" as="script"><link rel="prefetch" href="/home/assets/index.html-ca14f1ca.js" as="script"><link rel="prefetch" href="/home/assets/new.html-f39ecd3a.js" as="script"><link rel="prefetch" href="/home/assets/1.html-f45e37f8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3b81aa58.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3505c412.js" as="script"><link rel="prefetch" href="/home/assets/uniCloud.html-d6f4a4e6.js" as="script"><link rel="prefetch" href="/home/assets/uniTips.html-c522b2d1.js" as="script"><link rel="prefetch" href="/home/assets/1.html-3be78b60.js" as="script"><link rel="prefetch" href="/home/assets/index.html-6602172a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-dcc009ab.js" as="script"><link rel="prefetch" href="/home/assets/api_tutorial.html-201e8b68.js" as="script"><link rel="prefetch" href="/home/assets/base_tutorial.html-553e9cd8.js" as="script"><link rel="prefetch" href="/home/assets/pinia.html-93944f84.js" as="script"><link rel="prefetch" href="/home/assets/vue2.html-396e5caf.js" as="script"><link rel="prefetch" href="/home/assets/vue3_1.html-a3f127a4.js" as="script"><link rel="prefetch" href="/home/assets/vue3_2.html-52a41818.js" as="script"><link rel="prefetch" href="/home/assets/1.html-6b5b0d34.js" as="script"><link rel="prefetch" href="/home/assets/index.html-f9a24ca8.js" as="script"><link rel="prefetch" href="/home/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-4a29c502.js" as="script"><link rel="prefetch" href="/home/assets/index.html-85dd1a14.js" as="script"><link rel="prefetch" href="/home/assets/index.html-6478a4d2.js" as="script"><link rel="prefetch" href="/home/assets/index.html-6d0d270b.js" as="script"><link rel="prefetch" href="/home/assets/1.html-408f32d8.js" as="script"><link rel="prefetch" href="/home/assets/2.html-e4856efd.js" as="script"><link rel="prefetch" href="/home/assets/3.html-98d7bf2f.js" as="script"><link rel="prefetch" href="/home/assets/4.html-efe3a83d.js" as="script"><link rel="prefetch" href="/home/assets/5.html-7b237aac.js" as="script"><link rel="prefetch" href="/home/assets/6.html-56ea758e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-c2f72136.js" as="script"><link rel="prefetch" href="/home/assets/index.html-6f419873.js" as="script"><link rel="prefetch" href="/home/assets/algorithms.html-085952eb.js" as="script"><link rel="prefetch" href="/home/assets/c__.html-a92acfa4.js" as="script"><link rel="prefetch" href="/home/assets/graph.html-fc7e0079.js" as="script"><link rel="prefetch" href="/home/assets/leetcode.html-2c5acbfd.js" as="script"><link rel="prefetch" href="/home/assets/other_tree.html-c0a17043.js" as="script"><link rel="prefetch" href="/home/assets/sort_and_search.html-d1d11a4e.js" as="script"><link rel="prefetch" href="/home/assets/string.html-3e4a785a.js" as="script"><link rel="prefetch" href="/home/assets/tree.html-c7afcfa4.js" as="script"><link rel="prefetch" href="/home/assets/1.html-1b0b40ff.js" as="script"><link rel="prefetch" href="/home/assets/10.html-1c2b4b12.js" as="script"><link rel="prefetch" href="/home/assets/11.html-88235f0c.js" as="script"><link rel="prefetch" href="/home/assets/12.html-3fa41508.js" as="script"><link rel="prefetch" href="/home/assets/13.html-8618bb5b.js" as="script"><link rel="prefetch" href="/home/assets/14.html-ad130d1a.js" as="script"><link rel="prefetch" href="/home/assets/2.html-f7d04fff.js" as="script"><link rel="prefetch" href="/home/assets/3.html-9210c983.js" as="script"><link rel="prefetch" href="/home/assets/4.html-ee6cbb7e.js" as="script"><link rel="prefetch" href="/home/assets/5.html-4b3ea197.js" as="script"><link rel="prefetch" href="/home/assets/6.html-cdc72374.js" as="script"><link rel="prefetch" href="/home/assets/7.html-fbce691d.js" as="script"><link rel="prefetch" href="/home/assets/8.html-e9845a35.js" as="script"><link rel="prefetch" href="/home/assets/9.html-9310a4d1.js" as="script"><link rel="prefetch" href="/home/assets/index.html-88bbb178.js" as="script"><link rel="prefetch" href="/home/assets/1.html-a8ff9d59.js" as="script"><link rel="prefetch" href="/home/assets/2.html-a78dde4b.js" as="script"><link rel="prefetch" href="/home/assets/3.html-bc39cc6a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3777e62a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-e949454a.js" as="script"><link rel="prefetch" href="/home/assets/base_concept.html-d427a2dc.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-eb590929.js" as="script"><link rel="prefetch" href="/home/assets/pytorch_usage.html-6c574bfa.js" as="script"><link rel="prefetch" href="/home/assets/index.html-80286dcb.js" as="script"><link rel="prefetch" href="/home/assets/gas_fee.html-3ce4228b.js" as="script"><link rel="prefetch" href="/home/assets/monitoring.html-670a7f75.js" as="script"><link rel="prefetch" href="/home/assets/statedb_execute.html-0cc05702.js" as="script"><link rel="prefetch" href="/home/assets/23_Dec.html-a0bcd4e9.js" as="script"><link rel="prefetch" href="/home/assets/23_Nov.html-2908f671.js" as="script"><link rel="prefetch" href="/home/assets/24_Jan.html-330df74f.js" as="script"><link rel="prefetch" href="/home/assets/index.html-de5373ad.js" as="script"><link rel="prefetch" href="/home/assets/index.html-ac7c9447.js" as="script"><link rel="prefetch" href="/home/assets/compose.html-c8fb9687.js" as="script"><link rel="prefetch" href="/home/assets/image_construct.html-3853e1fe.js" as="script"><link rel="prefetch" href="/home/assets/intro.html-a88290e9.js" as="script"><link rel="prefetch" href="/home/assets/framework.html-37c81216.js" as="script"><link rel="prefetch" href="/home/assets/interview.html-77c46cd7.js" as="script"><link rel="prefetch" href="/home/assets/javabase.html-0405619b.js" as="script"><link rel="prefetch" href="/home/assets/javacollection.html-3baba1c1.js" as="script"><link rel="prefetch" href="/home/assets/javaio.html-930264a6.js" as="script"><link rel="prefetch" href="/home/assets/javajuc.html-561dd7da.js" as="script"><link rel="prefetch" href="/home/assets/project.html-27430039.js" as="script"><link rel="prefetch" href="/home/assets/index.html-c22ff0d2.js" as="script"><link rel="prefetch" href="/home/assets/distributed.html-44c04d49.js" as="script"><link rel="prefetch" href="/home/assets/gin.html-6e749fc5.js" as="script"><link rel="prefetch" href="/home/assets/gorm_1.html-3081adbb.js" as="script"><link rel="prefetch" href="/home/assets/goweb.html-f714f894.js" as="script"><link rel="prefetch" href="/home/assets/protobuf.html-3adcd0c5.js" as="script"><link rel="prefetch" href="/home/assets/rpc.html-3c3452b1.js" as="script"><link rel="prefetch" href="/home/assets/sse.html-ab112a79.js" as="script"><link rel="prefetch" href="/home/assets/test.html-2c52c4f5.js" as="script"><link rel="prefetch" href="/home/assets/websocket.html-807fb550.js" as="script"><link rel="prefetch" href="/home/assets/1.html-78082cb5.js" as="script"><link rel="prefetch" href="/home/assets/index.html-f20ddc55.js" as="script"><link rel="prefetch" href="/home/assets/index.html-abd00335.js" as="script"><link rel="prefetch" href="/home/assets/account.html-2edfa059.js" as="script"><link rel="prefetch" href="/home/assets/block.html-39e25e4c.js" as="script"><link rel="prefetch" href="/home/assets/consensus.html-12ecc3fd.js" as="script"><link rel="prefetch" href="/home/assets/contract.html-ebcb8db2.js" as="script"><link rel="prefetch" href="/home/assets/crypto_base.html-cd6f5a02.js" as="script"><link rel="prefetch" href="/home/assets/erc20.html-29ec56e5.js" as="script"><link rel="prefetch" href="/home/assets/ethereum_base.html-7d1adf40.js" as="script"><link rel="prefetch" href="/home/assets/evm.html-7960c273.js" as="script"><link rel="prefetch" href="/home/assets/gas.html-d3ceaac3.js" as="script"><link rel="prefetch" href="/home/assets/go_ethereum.html-4ca4ddf3.js" as="script"><link rel="prefetch" href="/home/assets/hd_wallet.html-03771194.js" as="script"><link rel="prefetch" href="/home/assets/jsonrpc.html-6340a1e0.js" as="script"><link rel="prefetch" href="/home/assets/leveldb.html-b42d6a08.js" as="script"><link rel="prefetch" href="/home/assets/mev.html-1122ca67.js" as="script"><link rel="prefetch" href="/home/assets/mpt.html-2706d23b.js" as="script"><link rel="prefetch" href="/home/assets/node_client.html-7cd51869.js" as="script"><link rel="prefetch" href="/home/assets/rlp.html-2d60d3b3.js" as="script"><link rel="prefetch" href="/home/assets/statedb.html-6224c1fe.js" as="script"><link rel="prefetch" href="/home/assets/transaction.html-f5e8ccf9.js" as="script"><link rel="prefetch" href="/home/assets/1.html-525e1c63.js" as="script"><link rel="prefetch" href="/home/assets/2.html-72cbdf06.js" as="script"><link rel="prefetch" href="/home/assets/3.html-c37a85d1.js" as="script"><link rel="prefetch" href="/home/assets/4.html-f2ac383b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-73204184.js" as="script"><link rel="prefetch" href="/home/assets/index.html-5ab7c1a6.js" as="script"><link rel="prefetch" href="/home/assets/dockerbase.html-e987d726.js" as="script"><link rel="prefetch" href="/home/assets/dockerutil.html-097fb42b.js" as="script"><link rel="prefetch" href="/home/assets/k8sbase.html-d0faf3cb.js" as="script"><link rel="prefetch" href="/home/assets/index.html-7b4268c3.js" as="script"><link rel="prefetch" href="/home/assets/mybatis.html-9870a94a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-d4425940.js" as="script"><link rel="prefetch" href="/home/assets/base.html-806488fc.js" as="script"><link rel="prefetch" href="/home/assets/index.html-133d111b.js" as="script"><link rel="prefetch" href="/home/assets/section0.html-76c04bb5.js" as="script"><link rel="prefetch" href="/home/assets/1.html-905b6898.js" as="script"><link rel="prefetch" href="/home/assets/2.html-bb052202.js" as="script"><link rel="prefetch" href="/home/assets/index.html-51068e7b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-0af624ee.js" as="script"><link rel="prefetch" href="/home/assets/alert.html-dd603c94.js" as="script"><link rel="prefetch" href="/home/assets/clustering.html-af363cee.js" as="script"><link rel="prefetch" href="/home/assets/exporter.html-178efcc3.js" as="script"><link rel="prefetch" href="/home/assets/intro.html-3eb1baa6.js" as="script"><link rel="prefetch" href="/home/assets/promql.html-622b7dca.js" as="script"><link rel="prefetch" href="/home/assets/servicediscovery.html-9c03c3ab.js" as="script"><link rel="prefetch" href="/home/assets/index.html-4e7e1520.js" as="script"><link rel="prefetch" href="/home/assets/base_usage.html-abf45007.js" as="script"><link rel="prefetch" href="/home/assets/1.html-20cea0fc.js" as="script"><link rel="prefetch" href="/home/assets/2.html-600385f4.js" as="script"><link rel="prefetch" href="/home/assets/3.html-537025a7.js" as="script"><link rel="prefetch" href="/home/assets/4.html-7c5588f9.js" as="script"><link rel="prefetch" href="/home/assets/index.html-abe8b783.js" as="script"><link rel="prefetch" href="/home/assets/index.html-43425558.js" as="script"><link rel="prefetch" href="/home/assets/jwt.html-700937d0.js" as="script"><link rel="prefetch" href="/home/assets/shiro.html-036fc950.js" as="script"><link rel="prefetch" href="/home/assets/index.html-eb2e3c0a.js" as="script"><link rel="prefetch" href="/home/assets/nacos.html-1e7735c0.js" as="script"><link rel="prefetch" href="/home/assets/index.html-1f57cbee.js" as="script"><link rel="prefetch" href="/home/assets/base.html-f091d185.js" as="script"><link rel="prefetch" href="/home/assets/progress.html-f07e0d91.js" as="script"><link rel="prefetch" href="/home/assets/script.html-6ec1704b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-9a3ecb0a.js" as="script"><link rel="prefetch" href="/home/assets/spring_annotation.html-d803f068.js" as="script"><link rel="prefetch" href="/home/assets/springboot.html-386c074c.js" as="script"><link rel="prefetch" href="/home/assets/springboot_base.html-a1235a8a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-6168dcfe.js" as="script"><link rel="prefetch" href="/home/assets/java_usage.html-32cc3f27.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-df2badf0.js" as="script"><link rel="prefetch" href="/home/assets/system_usage.html-18d6298d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-4cf87ca6.js" as="script"><link rel="prefetch" href="/home/assets/docker_tutorial.html-720dbe74.js" as="script"><link rel="prefetch" href="/home/assets/firewall_tutorial.html-e19f828c.js" as="script"><link rel="prefetch" href="/home/assets/mysql_tutorial.html-d1c8df9c.js" as="script"><link rel="prefetch" href="/home/assets/nginx_tutorial.html-8b7031f2.js" as="script"><link rel="prefetch" href="/home/assets/other_tutorial.html-98733ba9.js" as="script"><link rel="prefetch" href="/home/assets/1.html-b479be58.js" as="script"><link rel="prefetch" href="/home/assets/2.html-9414c60c.js" as="script"><link rel="prefetch" href="/home/assets/index.html-53680d09.js" as="script"><link rel="prefetch" href="/home/assets/5.html-39e3cbb3.js" as="script"><link rel="prefetch" href="/home/assets/6.html-dd08e045.js" as="script"><link rel="prefetch" href="/home/assets/7.html-e27816d4.js" as="script"><link rel="prefetch" href="/home/assets/Mybatis.html-b14d8178.js" as="script"><link rel="prefetch" href="/home/assets/index.html-073593ae.js" as="script"><link rel="prefetch" href="/home/assets/Spring.html-62f11898.js" as="script"><link rel="prefetch" href="/home/assets/SpringBoot.html-52945604.js" as="script"><link rel="prefetch" href="/home/assets/SpringMVC.html-b42b333c.js" as="script"><link rel="prefetch" href="/home/assets/1.html-0769d05d.js" as="script"><link rel="prefetch" href="/home/assets/2.html-8008ecb9.js" as="script"><link rel="prefetch" href="/home/assets/3.html-bda7fbbb.js" as="script"><link rel="prefetch" href="/home/assets/4.html-b9394007.js" as="script"><link rel="prefetch" href="/home/assets/5.html-4d90b17a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-7c26fffb.js" as="script"><link rel="prefetch" href="/home/assets/index.html-95f8b5a3.js" as="script"><link rel="prefetch" href="/home/assets/less.html-97c5db37.js" as="script"><link rel="prefetch" href="/home/assets/sass.html-090446b5.js" as="script"><link rel="prefetch" href="/home/assets/1.html-85efaed3.js" as="script"><link rel="prefetch" href="/home/assets/2.html-627bb0b6.js" as="script"><link rel="prefetch" href="/home/assets/index.html-6212085f.js" as="script"><link rel="prefetch" href="/home/assets/1.html-edc27cf2.js" as="script"><link rel="prefetch" href="/home/assets/2.html-c504049f.js" as="script"><link rel="prefetch" href="/home/assets/index.html-1ae9d9f6.js" as="script"><link rel="prefetch" href="/home/assets/1.html-fd67e02b.js" as="script"><link rel="prefetch" href="/home/assets/2.html-3c26cf72.js" as="script"><link rel="prefetch" href="/home/assets/3.html-a35bf149.js" as="script"><link rel="prefetch" href="/home/assets/4.html-8b8a36c6.js" as="script"><link rel="prefetch" href="/home/assets/5.html-556033eb.js" as="script"><link rel="prefetch" href="/home/assets/6.html-472feb8f.js" as="script"><link rel="prefetch" href="/home/assets/7.html-7da55a63.js" as="script"><link rel="prefetch" href="/home/assets/8.html-6e7ef457.js" as="script"><link rel="prefetch" href="/home/assets/9.html-34709618.js" as="script"><link rel="prefetch" href="/home/assets/index.html-85aaf065.js" as="script"><link rel="prefetch" href="/home/assets/new.html-90c7f16f.js" as="script"><link rel="prefetch" href="/home/assets/1.html-fecf8e27.js" as="script"><link rel="prefetch" href="/home/assets/index.html-1b5bb16e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2c061b7e.js" as="script"><link rel="prefetch" href="/home/assets/uniCloud.html-c1f920e8.js" as="script"><link rel="prefetch" href="/home/assets/uniTips.html-3c2be6d7.js" as="script"><link rel="prefetch" href="/home/assets/1.html-83405f61.js" as="script"><link rel="prefetch" href="/home/assets/index.html-069daef7.js" as="script"><link rel="prefetch" href="/home/assets/index.html-7b466066.js" as="script"><link rel="prefetch" href="/home/assets/api_tutorial.html-82bd795d.js" as="script"><link rel="prefetch" href="/home/assets/base_tutorial.html-dcd6d5f2.js" as="script"><link rel="prefetch" href="/home/assets/pinia.html-da444d78.js" as="script"><link rel="prefetch" href="/home/assets/vue2.html-0451f17d.js" as="script"><link rel="prefetch" href="/home/assets/vue3_1.html-6546b580.js" as="script"><link rel="prefetch" href="/home/assets/vue3_2.html-0ccdf3f9.js" as="script"><link rel="prefetch" href="/home/assets/1.html-e10bcad5.js" as="script"><link rel="prefetch" href="/home/assets/index.html-e72ef187.js" as="script"><link rel="prefetch" href="/home/assets/404.html-c91a268d.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/home/" class=""><!----><span class="site-name">不愿飞的蜂鸟首页</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Block Chain Internship</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/ethereum/" class="" aria-label="ethereum"><!--[--><!--]--> ethereum <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/blockchaindevelopment/" class="" aria-label="block chain development"><!--[--><!--]--> block chain development <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/docker/" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/golang/" class="router-link-active" aria-label="golang"><!--[--><!--]--> golang <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/prometheus/" class="" aria-label="prometheus"><!--[--><!--]--> prometheus <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/shell/" class="" aria-label="shell"><!--[--><!--]--> shell <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Deep Learning</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/ubuntu/" class="" aria-label="Ubuntu"><!--[--><!--]--> Ubuntu <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/GNN/" class="" aria-label="GNN"><!--[--><!--]--> GNN <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/python/" class="" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java Engineering</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/spring/" class="" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/jvm/" class="" aria-label="JVM"><!--[--><!--]--> JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/redis/" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/juc/" class="" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/netty/" class="" aria-label="Netty"><!--[--><!--]--> Netty <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/security/" class="" aria-label="Security"><!--[--><!--]--> Security <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/service/" class="" aria-label="Service"><!--[--><!--]--> Service <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/mybatis/" class="" aria-label="MyBatis"><!--[--><!--]--> MyBatis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five本科技术"><span class="title">Five本科技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five本科技术"><span class="title">Five本科技术</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>foreground</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/js/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/typescript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/html_css/" class="" aria-label="HTML_CSS"><!--[--><!--]--> HTML_CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/less_sass/" class="" aria-label="Less_Sass"><!--[--><!--]--> Less_Sass <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/react/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>background</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/java/" class="" aria-label="JAVA"><!--[--><!--]--> JAVA <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>app.mp</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/miniProgram/" class="" aria-label="MiniProgram"><!--[--><!--]--> MiniProgram <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/uni-app/" class="" aria-label="uni-app"><!--[--><!--]--> uni-app <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>server</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/centos/" class="" aria-label="Centos"><!--[--><!--]--> Centos <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five本科课程"><span class="title">Five本科课程</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five本科课程"><span class="title">Five本科课程</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/course/operating_system/" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/computer_network/" class="" aria-label="计算机网络技术"><!--[--><!--]--> 计算机网络技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/datastructure_and_algorithm/" class="" aria-label="数据结构和算法"><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/liushun-ing" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Block Chain Internship</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/ethereum/" class="" aria-label="ethereum"><!--[--><!--]--> ethereum <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/blockchaindevelopment/" class="" aria-label="block chain development"><!--[--><!--]--> block chain development <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/docker/" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/golang/" class="router-link-active" aria-label="golang"><!--[--><!--]--> golang <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/prometheus/" class="" aria-label="prometheus"><!--[--><!--]--> prometheus <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/shell/" class="" aria-label="shell"><!--[--><!--]--> shell <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Deep Learning</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/ubuntu/" class="" aria-label="Ubuntu"><!--[--><!--]--> Ubuntu <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/GNN/" class="" aria-label="GNN"><!--[--><!--]--> GNN <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/python/" class="" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java Engineering</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/spring/" class="" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/jvm/" class="" aria-label="JVM"><!--[--><!--]--> JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/redis/" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/juc/" class="" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/netty/" class="" aria-label="Netty"><!--[--><!--]--> Netty <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/security/" class="" aria-label="Security"><!--[--><!--]--> Security <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/service/" class="" aria-label="Service"><!--[--><!--]--> Service <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/mybatis/" class="" aria-label="MyBatis"><!--[--><!--]--> MyBatis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five本科技术"><span class="title">Five本科技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five本科技术"><span class="title">Five本科技术</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>foreground</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/js/" class="" aria-label="JavaScript"><!--[--><!--]--> JavaScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/typescript/" class="" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/html_css/" class="" aria-label="HTML_CSS"><!--[--><!--]--> HTML_CSS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/less_sass/" class="" aria-label="Less_Sass"><!--[--><!--]--> Less_Sass <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/react/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>background</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/java/" class="" aria-label="JAVA"><!--[--><!--]--> JAVA <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>app.mp</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/miniProgram/" class="" aria-label="MiniProgram"><!--[--><!--]--> MiniProgram <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/uni-app/" class="" aria-label="uni-app"><!--[--><!--]--> uni-app <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>server</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/centos/" class="" aria-label="Centos"><!--[--><!--]--> Centos <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five本科课程"><span class="title">Five本科课程</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five本科课程"><span class="title">Five本科课程</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/course/operating_system/" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/computer_network/" class="" aria-label="计算机网络技术"><!--[--><!--]--> 计算机网络技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/datastructure_and_algorithm/" class="" aria-label="数据结构和算法"><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/liushun-ing" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">Golang <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/home/master/golang/" class="router-link-active sidebar-item" aria-label="Navigation"><!--[--><!--]--> Navigation <!--[--><!--]--></a><!----></li><li><a href="/home/master/golang/goweb.html" class="sidebar-item" aria-label="Go-Web"><!--[--><!--]--> Go-Web <!--[--><!--]--></a><!----></li><li><a href="/home/master/golang/protobuf.html" class="sidebar-item" aria-label="Protobuf3"><!--[--><!--]--> Protobuf3 <!--[--><!--]--></a><!----></li><li><a href="/home/master/golang/rpc.html" class="sidebar-item" aria-label="Go-RPC"><!--[--><!--]--> Go-RPC <!--[--><!--]--></a><!----></li><li><a href="/home/master/golang/websocket.html" class="sidebar-item" aria-label="WebSocket"><!--[--><!--]--> WebSocket <!--[--><!--]--></a><!----></li><li><a href="/home/master/golang/sse.html" class="sidebar-item" aria-label="SSE(Server-Sent Events)"><!--[--><!--]--> SSE(Server-Sent Events) <!--[--><!--]--></a><!----></li><li><a href="/home/master/golang/gin.html" class="sidebar-item" aria-label="Gin Web 框架"><!--[--><!--]--> Gin Web 框架 <!--[--><!--]--></a><!----></li><li><a href="/home/master/golang/distributed.html" class="sidebar-item" aria-label="Go 分布式系统"><!--[--><!--]--> Go 分布式系统 <!--[--><!--]--></a><!----></li><li><a href="/home/master/golang/gorm_1.html" class="sidebar-item" aria-label="GORM-1"><!--[--><!--]--> GORM-1 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="GORM-2"><!--[--><!--]--> GORM-2 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/golang/gorm_2.html#关联篇" class="router-link-active router-link-exact-active sidebar-item" aria-label="关联篇"><!--[--><!--]--> 关联篇 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/golang/gorm_2.html#belongs-to" class="router-link-active router-link-exact-active sidebar-item" aria-label="Belongs to"><!--[--><!--]--> Belongs to <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#has-one" class="router-link-active router-link-exact-active sidebar-item" aria-label="Has One"><!--[--><!--]--> Has One <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#has-many" class="router-link-active router-link-exact-active sidebar-item" aria-label="Has Many"><!--[--><!--]--> Has Many <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#many-to-many" class="router-link-active router-link-exact-active sidebar-item" aria-label="Many to Many"><!--[--><!--]--> Many to Many <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#预加载" class="router-link-active router-link-exact-active sidebar-item" aria-label="预加载"><!--[--><!--]--> 预加载 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#context" class="router-link-active router-link-exact-active sidebar-item" aria-label="Context"><!--[--><!--]--> Context <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/golang/gorm_2.html#超时上下文" class="router-link-active router-link-exact-active sidebar-item" aria-label="超时上下文"><!--[--><!--]--> 超时上下文 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#错误处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="错误处理"><!--[--><!--]--> 错误处理 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/golang/gorm_2.html#基本错误处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="基本错误处理"><!--[--><!--]--> 基本错误处理 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#链式方法" class="router-link-active router-link-exact-active sidebar-item" aria-label="链式方法"><!--[--><!--]--> 链式方法 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#hook" class="router-link-active router-link-exact-active sidebar-item" aria-label="Hook"><!--[--><!--]--> Hook <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/golang/gorm_2.html#对象生命周期" class="router-link-active router-link-exact-active sidebar-item" aria-label="对象生命周期"><!--[--><!--]--> 对象生命周期 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#创建hook" class="router-link-active router-link-exact-active sidebar-item" aria-label="创建hook"><!--[--><!--]--> 创建hook <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#更新-hook" class="router-link-active router-link-exact-active sidebar-item" aria-label="更新 hook"><!--[--><!--]--> 更新 hook <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#删除-hook" class="router-link-active router-link-exact-active sidebar-item" aria-label="删除 hook"><!--[--><!--]--> 删除 hook <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#查询-hook" class="router-link-active router-link-exact-active sidebar-item" aria-label="查询 hook"><!--[--><!--]--> 查询 hook <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#修改当前执行" class="router-link-active router-link-exact-active sidebar-item" aria-label="修改当前执行"><!--[--><!--]--> 修改当前执行 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#事务" class="router-link-active router-link-exact-active sidebar-item" aria-label="事务"><!--[--><!--]--> 事务 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/golang/gorm_2.html#默认事务" class="router-link-active router-link-exact-active sidebar-item" aria-label="默认事务"><!--[--><!--]--> 默认事务 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#db-transaction" class="router-link-active router-link-exact-active sidebar-item" aria-label="db.Transaction"><!--[--><!--]--> db.Transaction <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#手动事务" class="router-link-active router-link-exact-active sidebar-item" aria-label="手动事务"><!--[--><!--]--> 手动事务 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#日志" class="router-link-active router-link-exact-active sidebar-item" aria-label="日志"><!--[--><!--]--> 日志 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#scopes-作用域" class="router-link-active router-link-exact-active sidebar-item" aria-label="Scopes 作用域"><!--[--><!--]--> Scopes 作用域 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/home/master/golang/gorm_2.html#复用" class="router-link-active router-link-exact-active sidebar-item" aria-label="复用"><!--[--><!--]--> 复用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/home/master/golang/gorm_2.html#分页" class="router-link-active router-link-exact-active sidebar-item" aria-label="分页"><!--[--><!--]--> 分页 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/home/master/golang/test.html" class="sidebar-item" aria-label="Go Test"><!--[--><!--]--> Go Test <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="gorm-2" tabindex="-1"><a class="header-anchor" href="#gorm-2" aria-hidden="true">#</a> GORM-2</h1><h2 id="关联篇" tabindex="-1"><a class="header-anchor" href="#关联篇" aria-hidden="true">#</a> 关联篇</h2><h3 id="belongs-to" tabindex="-1"><a class="header-anchor" href="#belongs-to" aria-hidden="true">#</a> Belongs to</h3><p><code>belongs to</code> 会与另一个模型建立了一对一的连接。 这种模型的每一个实例都“属于”另一个模型的一个实例。</p><p>例如，应用包含 user 和 company，并且每个 user 能且只能被分配给一个 company。下面的类型就表示这种关系。 注意，在 <code>User</code> 对象中，有一个和 <code>Company</code> 一样的 <code>CompanyID</code>。 默认情况下， <code>CompanyID</code> 被隐含地用来在 <code>User</code> 和 <code>Company</code> 之间创建一个外键关系， 因此必须包含在 <code>User</code> 结构体中才能填充 <code>Company</code> 内部结构体。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// `User` 属于 `Company`，`CompanyID` 是外键</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Name      <span class="token builtin">string</span>
  CompanyID <span class="token builtin">int</span>
  Company   Company
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Company <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ID   <span class="token builtin">int</span>
  Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="重写外键" tabindex="-1"><a class="header-anchor" href="#重写外键" aria-hidden="true">#</a> 重写外键</h4><p>要定义一个 belongs to 关系，数据库的表中必须存在外键。<strong>默认情况下，外键的名字，使用拥有者的类型名称加上表的主键的字段名字</strong></p><p>例如，定义一个User实体属于Company实体，那么外键的名字一般使用CompanyID。</p><p>GORM同时提供自定义外键名字的方式，如下例所示。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Name         <span class="token builtin">string</span>
  CompanyRefer <span class="token builtin">int</span>
  Company      Company <span class="token string">`gorm:&quot;foreignKey:CompanyRefer&quot;`</span>
  <span class="token comment">// 使用 CompanyRefer 作为外键</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Company <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ID   <span class="token builtin">int</span>
  Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="重写引用" tabindex="-1"><a class="header-anchor" href="#重写引用" aria-hidden="true">#</a> 重写引用</h4><p>对于 belongs to 关系，GORM 通常使用数据库表，<strong>主表（拥有者）的主键值作为外键参考</strong>。</p><p>如果设置了User实体属于Company实体，那么GORM会自动把Company中的<code>ID</code>属性保存到User的<code>CompanyID</code>属性中。</p><p>同样的，也可以使用标签 <code>references</code> 来更改它，例如：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>type User struct {
  gorm.Model
  Name      string
  CompanyID string
  Company   Company `gorm:&quot;references:Code&quot;` // 使用 Code 作为引用
}

type Company struct {
  ID   int
  Code string
  Name string
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>NOTE</strong> 如果外键名恰好在拥有者类型中存在，GORM 通常会错误的认为它是 <code>has one</code> 关系。我们需要在 <code>belongs to</code> 关系中指定 <code>references</code></p></blockquote><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>type User struct {
  gorm.Model
  Name      string
  CompanyID string
  Company   Company `gorm:&quot;references:CompanyID&quot;` // 使用 Company.CompanyID 作为引用
}

type Company struct {
  CompanyID   int
  Code        string
  Name        string
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="has-one" tabindex="-1"><a class="header-anchor" href="#has-one" aria-hidden="true">#</a> Has One</h3><p><code>has one</code> 与另一个模型建立一对一的关联，但它和一对一关系有些许不同。 这种关联表明一个模型的每个实例都包含或拥有另一个模型的一个实例。</p><blockquote><p>注意和 Belongs to 的细微区分，Belongs to 除了有一个实体外，还要包含一个外键字段，是他主动去关联到别人</p><p>而 Has One 则是只有一个实体，然后是别人有一个外键，是别人来关联到自己</p></blockquote><p>例如，您的应用包含 user 和 credit card 模型，且每个 user 只能有一张 credit card。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// User 有一张 CreditCard，UserID 是外键
type User struct {
  gorm.Model
  CreditCard CreditCard
}

type CreditCard struct {
  gorm.Model
  Number string
  UserID uint
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="检索" tabindex="-1"><a class="header-anchor" href="#检索" aria-hidden="true">#</a> 检索</h4><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// 检索用户列表并预加载信用卡</span>
<span class="token keyword">func</span> <span class="token function">GetAll</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
    err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">&quot;CreditCard&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
    <span class="token keyword">return</span> users<span class="token punctuation">,</span> err
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="重写外键-1" tabindex="-1"><a class="header-anchor" href="#重写外键-1" aria-hidden="true">#</a> 重写外键</h4><p>对于 <code>has one</code> 关系，同样必须存在外键字段。拥有者将把属于它的模型的主键保存到这个字段。</p><p>这个字段的名称通常由 <code>has one</code> 模型的类型加上其 <code>主键</code> 生成，对于上面的例子，它是 <code>UserID</code>。</p><p>为 user 添加 credit card 时，它会将 user 的 <code>ID</code> 保存到自己的 <code>UserID</code> 字段。可以使用标签 <code>foreignKey</code> 来更改它，例如：</p><blockquote><p>这里改的是：他原本会使用 User 中的 ID 来填充 UserID 字段，现在是他会使用 User 的 ID 来填充自己的 UserName 字段</p></blockquote><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  CreditCard CreditCard <span class="token string">`gorm:&quot;foreignKey:UserName&quot;`</span> <span class="token comment">// 使用 UserName 作为外键</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> CreditCard <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Number   <span class="token builtin">string</span>
  UserName <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="重写引用-1" tabindex="-1"><a class="header-anchor" href="#重写引用-1" aria-hidden="true">#</a> 重写引用</h4><p>默认情况下，拥有者实体会将 <code>has one</code> 对应模型的主键保存为外键，也可以修改用另一个字段来保存，使用标签 <code>references</code> 来更改</p><blockquote><p>而这里改的是：他原来使用 User 的 Id 来填充自己的 UserName 字段，现在是使用 User 的 Name 字段来填充 UserName 字段</p><p>==仔细品品这个和上面重写外键的区别：针对 creditCard 的角度，外键是去填充自己哪个，引用是我拿哪个来填充==</p></blockquote><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Name       <span class="token builtin">string</span>     <span class="token string">`gorm:&quot;index&quot;`</span>
  CreditCard CreditCard <span class="token string">`gorm:&quot;foreignKey:UserName;references:Name&quot;`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> CreditCard <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Number   <span class="token builtin">string</span>
  UserName <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="自引用-has-one" tabindex="-1"><a class="header-anchor" href="#自引用-has-one" aria-hidden="true">#</a> 自引用 Has One</h4><p>这尼玛感觉又像是 belongs to 了，好抽象</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Name      <span class="token builtin">string</span>
  ManagerID <span class="token operator">*</span><span class="token builtin">uint</span>
  Manager   <span class="token operator">*</span>User
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="has-many" tabindex="-1"><a class="header-anchor" href="#has-many" aria-hidden="true">#</a> Has Many</h3><p><code>has many</code> 与另一个模型建立了一对多的连接。 不同于 <code>has one</code>，拥有者可以有零或多个关联模型。</p><p>例如，应用包含 user 和 credit card 模型，且每个 user 可以有多张 credit card。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// User 有多张 CreditCard，UserID 是外键</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  CreditCards <span class="token punctuation">[</span><span class="token punctuation">]</span>CreditCard
<span class="token punctuation">}</span>

<span class="token keyword">type</span> CreditCard <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Number <span class="token builtin">string</span>
  UserID <span class="token builtin">uint</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="检索-1" tabindex="-1"><a class="header-anchor" href="#检索-1" aria-hidden="true">#</a> 检索</h4><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// 检索用户列表并预加载信用卡</span>
<span class="token keyword">func</span> <span class="token function">GetAll</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
    err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">&quot;CreditCards&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
    <span class="token keyword">return</span> users<span class="token punctuation">,</span> err
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="重写外键-2" tabindex="-1"><a class="header-anchor" href="#重写外键-2" aria-hidden="true">#</a> 重写外键</h4><p>这里和上面的Has One 差不多</p><p>要定义 <code>has many</code> 关系，同样必须存在外键。 默认的外键名是拥有者的类型名加上其主键字段名</p><p>例如，要定义一个属于 <code>User</code> 的模型，则其外键应该是 <code>UserID</code>。</p><p>此外，想要使用另一个字段作为外键，可以使用 <code>foreignKey</code> 标签自定义它：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>type User struct {
  gorm.Model
  CreditCards []CreditCard `gorm:&quot;foreignKey:UserRefer&quot;`
}

type CreditCard struct {
  gorm.Model
  Number    string
  UserRefer uint
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="重写引用-2" tabindex="-1"><a class="header-anchor" href="#重写引用-2" aria-hidden="true">#</a> 重写引用</h4><p>GORM 通常使用拥有者的主键作为外键的值。 对于上面的例子，它是 <code>User</code> 的 <code>ID</code> 字段。</p><p>为 user 添加 credit card 时，GORM 会将 user 的 <code>ID</code> 字段保存到 credit card 的 <code>UserID</code> 字段。</p><p>同样的，也可以使用标签 <code>references</code> 来更改它，例如：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>type User struct {
  gorm.Model
  MemberNumber string
  CreditCards  []CreditCard `gorm:&quot;foreignKey:UserNumber;references:MemberNumber&quot;`
}

type CreditCard struct {
  gorm.Model
  Number     string
  UserNumber string
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="自引用-has-many" tabindex="-1"><a class="header-anchor" href="#自引用-has-many" aria-hidden="true">#</a> 自引用 Has Many</h4><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Name      <span class="token builtin">string</span>
  ManagerID <span class="token operator">*</span><span class="token builtin">uint</span>
  Team      <span class="token punctuation">[</span><span class="token punctuation">]</span>User <span class="token string">`gorm:&quot;foreignkey:ManagerID&quot;`</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="many-to-many" tabindex="-1"><a class="header-anchor" href="#many-to-many" aria-hidden="true">#</a> Many to Many</h3><p>Many to Many 会在两个 model 中添加一张连接表。</p><p>例如，应用包含了 user 和 language，且一个 user 可以说多种 language，多个 user 也可以说一种 language。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// User 拥有并属于多种 language，`user_languages` 是连接表</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Languages <span class="token punctuation">[</span><span class="token punctuation">]</span>Language <span class="token string">`gorm:&quot;many2many:user_languages;&quot;`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Language <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当使用 GORM 的 <code>AutoMigrate</code> 为 <code>User</code> 创建表时，GORM 会自动创建连接表</p><p>连接表的外键关系，对于 <code>many2many</code> 关系，连接表会同时拥有两个模型的外键</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// 	连接表：user_languages
//   foreign key: user_id, reference: users.id
//   foreign key: language_id, reference: languages.id
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="反向引用" tabindex="-1"><a class="header-anchor" href="#反向引用" aria-hidden="true">#</a> 反向引用</h4><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// User 拥有并属于多种 language，`user_languages` 是连接表</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Languages <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>Language <span class="token string">`gorm:&quot;many2many:user_languages;&quot;`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Language <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Name <span class="token builtin">string</span>
  Users <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>User <span class="token string">`gorm:&quot;many2many:user_languages;&quot;`</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="检索-2" tabindex="-1"><a class="header-anchor" href="#检索-2" aria-hidden="true">#</a> 检索</h4><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// 检索 User 列表并预加载 Language</span>
<span class="token keyword">func</span> <span class="token function">GetAllUsers</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>User<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
    err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">&quot;Languages&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
    <span class="token keyword">return</span> users<span class="token punctuation">,</span> err
<span class="token punctuation">}</span>

<span class="token comment">// 检索 Language 列表并预加载 User</span>
<span class="token keyword">func</span> <span class="token function">GetAllLanguages</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>Language<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> languages <span class="token punctuation">[</span><span class="token punctuation">]</span>Language
    err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Language<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">&quot;Users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>languages<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
    <span class="token keyword">return</span> languages<span class="token punctuation">,</span> err
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="重写外键-3" tabindex="-1"><a class="header-anchor" href="#重写外键-3" aria-hidden="true">#</a> 重写外键</h4><p>这尼玛外键有点复杂，重写的话，有四个可选项，跟个绕弯子似得，好抽象，这设计真的有点抽象</p><p>若要重写它们，可以使用标签 <code>foreignKey</code>、<code>references</code>、<code>joinforeignKey</code>、<code>joinReferences</code>。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    gorm<span class="token punctuation">.</span>Model
    Profiles <span class="token punctuation">[</span><span class="token punctuation">]</span>Profile <span class="token string">`gorm:&quot;many2many:user_profiles;foreignKey:Refer;joinForeignKey:UserReferID;References:UserRefer;joinReferences:ProfileRefer&quot;`</span>
    Refer    <span class="token builtin">uint</span>      <span class="token string">`gorm:&quot;index:,unique&quot;`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Profile <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    gorm<span class="token punctuation">.</span>Model
    Name      <span class="token builtin">string</span>
    UserRefer <span class="token builtin">uint</span> <span class="token string">`gorm:&quot;index:,unique&quot;`</span>
<span class="token punctuation">}</span>

<span class="token comment">// 会创建连接表：user_profiles</span>
<span class="token comment">//   foreign key: user_refer_id, reference: users.refer</span>
<span class="token comment">//   foreign key: profile_refer, reference: profiles.user_refer</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>注意：</strong> 某些数据库只允许在唯一索引字段上创建外键，如果您在迁移时会创建外键，则需要指定 <code>unique index</code> 标签。</p></blockquote><h4 id="自引用" tabindex="-1"><a class="header-anchor" href="#自引用" aria-hidden="true">#</a> 自引用</h4><p>自引用 many2many 关系，这玩意更抽象了</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
    Friends <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>User <span class="token string">`gorm:&quot;many2many:user_friends&quot;`</span>
<span class="token punctuation">}</span>

<span class="token comment">// 会创建连接表：user_friends</span>
<span class="token comment">//   foreign key: user_id, reference: users.id</span>
<span class="token comment">//   foreign key: friend_id, reference: users.id</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="预加载" tabindex="-1"><a class="header-anchor" href="#预加载" aria-hidden="true">#</a> 预加载</h3><h4 id="preload" tabindex="-1"><a class="header-anchor" href="#preload" aria-hidden="true">#</a> Preload</h4><p>GORM允许使用 <code>Preload</code>通过多个SQL中来直接加载关系</p><blockquote><p>Has One</p></blockquote><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> Emp <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Eid     <span class="token builtin">int</span> <span class="token string">`gorm:&quot;primaryKey&quot;`</span>
	EmpName <span class="token builtin">string</span>
	Age     <span class="token builtin">int</span>
	Email   <span class="token builtin">string</span>
	Did     <span class="token builtin">int</span>
	Dept    Dept <span class="token string">`gorm:&quot;foreignKey:Did;references:Did&quot;`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Dept <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Did      <span class="token builtin">int</span> <span class="token string">`gorm:&quot;primaryKey&quot;`</span>
	DeptName <span class="token builtin">string</span>
<span class="token punctuation">}</span>

db<span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">&quot;Dept&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/home/assets/preload-c1be578b.png" alt="screenshot2024-07-28 18.37.23" style="zoom:50%;"><p><strong>可以看到他执行了两个 sql，并且很疑惑的是，他咋知道 emps 中的外键只用到了 1,2,3 的，很是离谱。</strong></p><blockquote><p>Has Many</p></blockquote><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> Emp <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Eid     <span class="token builtin">int</span> <span class="token string">`gorm:&quot;primaryKey&quot;`</span>
    EmpName <span class="token builtin">string</span>
    Age     <span class="token builtin">int</span>
    Email   <span class="token builtin">string</span>
    Did     <span class="token builtin">int</span>
    <span class="token comment">//Dept    Dept `gorm:&quot;foreignKey:Did;references:Did&quot;`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Dept <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Did      <span class="token builtin">int</span> <span class="token string">`gorm:&quot;primaryKey&quot;`</span>
    DeptName <span class="token builtin">string</span>
    Emps     <span class="token punctuation">[</span><span class="token punctuation">]</span>Emp <span class="token string">`gorm:&quot;foreignKey:Did;references:Did&quot;`</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> results <span class="token punctuation">[</span><span class="token punctuation">]</span>Dept
db<span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">&quot;Emps&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>==注意：Preload 里放的是 struct 中关联的字段的名字，如 Emps，和上面的 Dept，不是数据库中的表名啥的==</p><p>同样也有点迷惑，他为啥知道要 IN (1,2,3,4)</p><img src="/home/assets/hasmanpreload-98766454.png" alt="screenshot2024-07-29 09.23.44" style="zoom:50%;"><p>这是 chatgpt 的解释</p><img src="/home/assets/gpt-ff2da6f0.png" alt="screenshot2024-07-29 09.29.46" style="zoom:33%;"><p>所以他 sql 执行的顺序并不是日志打印的顺序。真是有点误导人。</p><h4 id="joins-预加载" tabindex="-1"><a class="header-anchor" href="#joins-预加载" aria-hidden="true">#</a> Joins 预加载</h4><p><code>Preload</code> 是按照各种结构体中定义的关联形式进行数据预加载，而 joins 则是按照左连接的方式进行数据预加载的。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Joins</span><span class="token punctuation">(</span><span class="token string">&quot;Dept&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">)</span>
<span class="token comment">// 带条件的 join</span>
db<span class="token punctuation">.</span><span class="token function">Joins</span><span class="token punctuation">(</span><span class="token string">&quot;Company&quot;</span><span class="token punctuation">,</span> DB<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Company<span class="token punctuation">{</span>Alive<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">// SELECT `users`.`id`,`users`.`name`,`users`.`age`,`Company`.`id` AS `Company__id`,`Company`.`name` AS `Company__name` FROM `users` LEFT JOIN `companies` AS `Company` ON `users`.`company_id` = `Company`.`id` AND `Company`.`alive` = true;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/home/assets/joins-93ec7f49.png" alt="screenshot2024-07-28 19.58.19"></p><blockquote><p><code>Join Preload</code> works with one-to-one relation, e.g: <code>has one</code>, <code>belongs to</code></p><p>db.Joins(&quot;Emps&quot;).Find(&amp;results)这样会报错。panic: reflect: call of reflect.Value.Field on slice Value</p><p>根据报错信息可以推断，他底层应该是使用的反射去拿到 join 的字段，这个字段应该是要是一个结构体，因为他底层源码中需要遍历这个字段的所有属性，这就意味着关联的关系必须是单个结构体，不能是一个 slice。</p></blockquote><h4 id="预加载全部" tabindex="-1"><a class="header-anchor" href="#预加载全部" aria-hidden="true">#</a> 预加载全部</h4><p>可以使用 clause.Associations来代替多个 Preload 的连续使用实现多种关系的一次性预加载</p><p><code>clause.Associations</code> can work with <code>Preload</code> similar like <code>Select</code> when creating/updating, you can use it to <code>Preload</code> all associations, for example:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Name       <span class="token builtin">string</span>
  CompanyID  <span class="token builtin">uint</span>
  Company    Company
  Role       Role
  Orders     <span class="token punctuation">[</span><span class="token punctuation">]</span>Order
<span class="token punctuation">}</span>

db<span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>Associations<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>clause.Associations</code> won’t preload nested associations, but you can use it with <a href="https://gorm.io/zh_CN/docs/preload.html#nested_preloading" target="_blank" rel="noopener noreferrer">Nested Preloading<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> together, e.g:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">&quot;Orders.OrderItems.Product&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>Associations<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="条件预加载" tabindex="-1"><a class="header-anchor" href="#条件预加载" aria-hidden="true">#</a> 条件预加载</h4><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// Preload Orders with conditions</span>
db<span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">&quot;Orders&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;state NOT IN (?)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cancelled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">// SELECT * FROM users;</span>
<span class="token comment">// SELECT * FROM orders WHERE user_id IN (1,2,3,4) AND state NOT IN (&#39;cancelled&#39;);</span>
db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;state = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;active&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">&quot;Orders&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;state NOT IN (?)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;cancelled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">// SELECT * FROM users WHERE state = &#39;active&#39;;</span>
<span class="token comment">// SELECT * FROM orders WHERE user_id IN (1,2) AND state NOT IN (&#39;cancelled&#39;);</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>具体实例：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">&quot;Dept&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;did&gt;?&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><img src="/home/assets/preload2-968639d6.png" alt="screenshot2024-07-28 20.42.01" style="zoom:50%;"><p>这种情况下，不会预加载 did 等于 1 的数据，这样在查询的 emps 中，原本应该填充 did=1 的数据，会查不出来，也就是都会被零值填充。现在是这样<code>{1 zhangsan 10 111@qq.com 1 {0 } } </code>，之前才出来是这样的<code>{1 zhangsan 10 111@qq.com 1 {1 a} } </code></p><h4 id="自定义预加载-sql" tabindex="-1"><a class="header-anchor" href="#自定义预加载-sql" aria-hidden="true">#</a> 自定义预加载 SQL</h4><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">&quot;Orders&quot;</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
  <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">Order</span><span class="token punctuation">(</span><span class="token string">&quot;orders.amount DESC&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">// SELECT * FROM users;</span>
<span class="token comment">// SELECT * FROM orders WHERE user_id IN (1,2,3,4) order by orders.amount DESC;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="嵌套预加载" tabindex="-1"><a class="header-anchor" href="#嵌套预加载" aria-hidden="true">#</a> 嵌套预加载</h4><p>对于嵌套的结构体的预加载，采用<code>.</code>的方式进行</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">&quot;Orders.OrderItems.Product&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">&quot;CreditCard&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>

<span class="token comment">// Customize Preload conditions for `Orders`</span>
<span class="token comment">// And GORM won&#39;t preload unmatched order&#39;s OrderItems then</span>
<span class="token comment">// 这的意思应该是对于 state 不满足的 orders，他的嵌套预加载也不会进行了</span>
db<span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">&quot;Orders&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;state = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;paid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Preload</span><span class="token punctuation">(</span><span class="token string">&quot;Orders.OrderItems&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>==<code>Embedded Preload</code> only works with <code>belongs to</code> relation==，Values of other relations are the same in database, we can’t distinguish them. 注意只是针对嵌套预加载。</p><h2 id="context" tabindex="-1"><a class="header-anchor" href="#context" aria-hidden="true">#</a> Context</h2><p>其他上下文的用法没太懂有啥用，插个眼</p><h3 id="超时上下文" tabindex="-1"><a class="header-anchor" href="#超时上下文" aria-hidden="true">#</a> 超时上下文</h3><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>ctx<span class="token punctuation">,</span> cancel <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithTimeout</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
<span class="token keyword">defer</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">WithContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>

ctx<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> context<span class="token punctuation">.</span><span class="token function">WithTimeout</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Nanosecond<span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">WithContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/home/assets/timeout-4c5a00cf.png" alt="screenshot2024-07-29 10.04.42"></p><p>超时会 log 提示，然后查询出来的 row 为 0.</p><h2 id="错误处理" tabindex="-1"><a class="header-anchor" href="#错误处理" aria-hidden="true">#</a> 错误处理</h2><p>在Go语言的应用开发中，特别是在使用GORM与数据库交互时，有效的错误处理是构建稳健应用的基石。 GORM对错误处理的方法，受到其可链式API的影响，需要细致地理解。</p><h3 id="基本错误处理" tabindex="-1"><a class="header-anchor" href="#基本错误处理" aria-hidden="true">#</a> 基本错误处理</h3><p>GORM将错误处理集成到其可链式方法语法中。 <code>*gorm.DB</code>实例包含一个<code>Error</code>字段，当发生错误时会被设置。 通常的做法是在执行数据库操作后，特别是在<a href="https://gorm.io/zh_CN/docs/method_chaining.html#finisher_method" target="_blank" rel="noopener noreferrer">完成方法（Finisher Methods）<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>后，检查这个字段。</p><p>在一系列方法之后，检查<code>Error</code>字段是至关重要的：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">if</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span>Error<span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token comment">// 处理错误...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">if</span> result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> result<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token comment">// 处理错误...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>具体错误处理：</p><p>ErrRecordNotFound 记录未找到</p></blockquote><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Error
<span class="token keyword">if</span> errors<span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> gorm<span class="token punctuation">.</span>ErrRecordNotFound<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 处理未找到记录的错误...}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="链式方法" tabindex="-1"><a class="header-anchor" href="#链式方法" aria-hidden="true">#</a> 链式方法</h2><p>GORM organizes methods into three primary categories: <code>Chain Methods</code>, <code>Finisher Methods</code>, and <code>New Session Methods</code>.</p><p>Chain methods are used to modify or append <code>Clauses</code> to the current <code>Statement</code>. Some common chain methods include:</p><ul><li><code>Where</code></li><li><code>Select</code></li><li><code>Omit</code></li><li><code>Joins</code></li><li><code>Scopes</code></li><li><code>Preload</code></li><li><code>Raw</code>（原生 SQL） (Note: <code>Raw</code> cannot be used in conjunction with other chainable methods to build SQL)</li></ul><p>Finisher methods are immediate, executing registered callbacks that generate and run SQL commands. This category includes methods:</p><ul><li><code>Create</code></li><li><code>First</code></li><li><code>Find</code></li><li><code>Take</code></li><li><code>Save</code></li><li><code>Update</code></li><li><code>Delete</code></li><li><code>Scan</code></li><li><code>Row</code></li><li><code>Rows</code></li></ul><p>GORM defines methods like <code>Session</code>, <code>WithContext</code>, and <code>Debug</code> as New Session Methods, which are essential for creating shareable and reusable <code>*gorm.DB</code> instances.</p><p>链式操作会造成 db 对象的不安全使用问题，大概意思就是一个 db 对象不要连续使用，否则前一次的使用会对后一次使用产生影响。他的上下文会被重用。</p><p>此外，<a href="https://gorm.io/zh_CN/docs/session.html" target="_blank" rel="noopener noreferrer">Session<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 提供了很多可以定制化的方案，如自定义日志，禁用默认事务，是否允许全局更新，预编译，跳过钩子函数等等</p><h2 id="hook" tabindex="-1"><a class="header-anchor" href="#hook" aria-hidden="true">#</a> Hook</h2><h3 id="对象生命周期" tabindex="-1"><a class="header-anchor" href="#对象生命周期" aria-hidden="true">#</a> 对象生命周期</h3><p>Hook 是在创建、查询、更新、删除等操作之前、之后调用的函数。</p><p>如果已经为模型定义了指定的方法，它会在创建、更新、查询、删除时自动被调用。如果任何回调返回错误，GORM 将停止后续的操作并回滚事务。</p><p>钩子方法的函数签名应该是 <strong><code>func(*gorm.DB) error</code></strong></p><h3 id="创建hook" tabindex="-1"><a class="header-anchor" href="#创建hook" aria-hidden="true">#</a> 创建hook</h3><p>创建时可用的 hook</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// 开始事务
BeforeSave
BeforeCreate
// 关联前的 save
// 插入记录至 db
// 关联后的 save
AfterCreate
AfterSave
// 提交或回滚事务
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">BeforeCreate</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  u<span class="token punctuation">.</span>UUID <span class="token operator">=</span> uuid<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token operator">!</span>u<span class="token punctuation">.</span><span class="token function">IsValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    err <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;can&#39;t save invalid data&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">AfterCreate</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> u<span class="token punctuation">.</span>ID <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>
    tx<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;role&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意</strong> 在 GORM 中保存、删除操作会默认运行在事务上， 因此在事务完成之前该事务中所作的更改是不可见的，如果钩子返回了任何错误，则修改将被回滚。也可以看到，提交和回滚事务是在所有钩子都执行完之后才发生的。</p><h3 id="更新-hook" tabindex="-1"><a class="header-anchor" href="#更新-hook" aria-hidden="true">#</a> 更新 hook</h3><p>和创建 hook 类似</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// 开始事务
BeforeSave
BeforeUpdate
// 关联前的 save
// 更新 db
// 关联后的 save
AfterUpdate
AfterSave
// 提交或回滚事务
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="删除-hook" tabindex="-1"><a class="header-anchor" href="#删除-hook" aria-hidden="true">#</a> 删除 hook</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// 开始事务
BeforeDelete
// 删除 db 中的数据
AfterDelete
// 提交或回滚事务
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询-hook" tabindex="-1"><a class="header-anchor" href="#查询-hook" aria-hidden="true">#</a> 查询 hook</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// 从 db 中加载数据
// Preloading (eager loading)
AfterFind
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码示例：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">AfterFind</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> u<span class="token punctuation">.</span>MemberShip <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
    u<span class="token punctuation">.</span>MemberShip <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改当前执行" tabindex="-1"><a class="header-anchor" href="#修改当前执行" aria-hidden="true">#</a> 修改当前执行</h3><p>可以在执行之前的 hook 中使用 statement 修改当前执行的 sql 语句。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">BeforeCreate</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  <span class="token comment">// 通过 tx.Statement 修改当前操作，例如：</span>
  tx<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Age&quot;</span><span class="token punctuation">)</span>
  tx<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span><span class="token function">AddClause</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>OnConflict<span class="token punctuation">{</span>DoNothing<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// tx 是带有 `NewDB` 选项的新会话模式 </span>
  <span class="token comment">// 基于 tx 的操作会在同一个事务中，但不会带上任何当前的条件</span>
  err <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>role<span class="token punctuation">,</span> <span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>Role<span class="token punctuation">)</span><span class="token punctuation">.</span>Error
  <span class="token comment">// SELECT * FROM roles WHERE name = &quot;admin&quot;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> err
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="事务" tabindex="-1"><a class="header-anchor" href="#事务" aria-hidden="true">#</a> 事务</h2><h3 id="默认事务" tabindex="-1"><a class="header-anchor" href="#默认事务" aria-hidden="true">#</a> 默认事务</h3><p>为了确保数据一致性，GORM 会在事务里执行写入操作（创建、更新、删除）。如果没有这方面的要求，您可以在初始化时禁用它，这将获得大约 30%+ 性能提升。默认就具有事务规则。</p><p>可以通过一下操作禁用默认事务</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// 全局禁用</span>
db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;gorm.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  SkipDefaultTransaction<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 持续会话模式</span>
tx <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Session</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Session<span class="token punctuation">{</span>SkipDefaultTransaction<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
tx<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
tx<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
tx<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;Age&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="db-transaction" tabindex="-1"><a class="header-anchor" href="#db-transaction" aria-hidden="true">#</a> db.Transaction</h3><p>通过该方法传入一个函数，可以实现事务操作。返回 nil 则提交事务，返回一个错误则回滚事务。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在事务中执行一些 db 操作（从这里开始，您应该使用 &#39;tx&#39; 而不是 &#39;db&#39;）</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Animal<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;Giraffe&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Error<span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回任何错误都会回滚事务</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> err <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Animal<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;Lion&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Error<span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">}</span>

  <span class="token comment">// 返回 nil 提交事务</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>嵌套事务</p></blockquote><p>GORM 支持嵌套事务，可以回滚较大事务内执行的一部分操作，例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user1<span class="token punctuation">)</span>

  tx<span class="token punctuation">.</span><span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>tx2 <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    tx2<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user2<span class="token punctuation">)</span>
    <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;rollback user2&quot;</span><span class="token punctuation">)</span> <span class="token comment">// Rollback user2</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  tx<span class="token punctuation">.</span><span class="token function">Transaction</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>tx3 <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    tx3<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user3<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// Commit user1, user3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="手动事务" tabindex="-1"><a class="header-anchor" href="#手动事务" aria-hidden="true">#</a> 手动事务</h3><p>还可以手动控制事务的提交，回滚等。不依托 api 的默认实现</p><p>Gorm 支持直接调用事务控制方法（commit、rollback），例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// 开始事务</span>
tx <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 在事务中执行一些 db 操作（从这里开始，您应该使用 &#39;tx&#39; 而不是 &#39;db&#39;）</span>
tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>

<span class="token comment">// 遇到错误时回滚事务</span>
tx<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 否则，提交事务</span>
tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>一个样例</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">CreateAnimals</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  tx <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 确保错误处理</span>
    <span class="token keyword">if</span> r <span class="token operator">:=</span> <span class="token function">recover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> r <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
      tx<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> err <span class="token operator">:=</span> tx<span class="token punctuation">.</span>Error<span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> err <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Animal<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;Giraffe&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Error<span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
     tx<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token keyword">return</span> err
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> err <span class="token operator">:=</span> tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Animal<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;Lion&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Error<span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
     tx<span class="token punctuation">.</span><span class="token function">Rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token keyword">return</span> err
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Error
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>GORM 提供了 <code>SavePoint</code>、<code>Rollbackto</code> 方法，来提供保存点以及回滚至保存点功能，例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>tx <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user1<span class="token punctuation">)</span>

tx<span class="token punctuation">.</span><span class="token function">SavePoint</span><span class="token punctuation">(</span><span class="token string">&quot;sp1&quot;</span><span class="token punctuation">)</span>
tx<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user2<span class="token punctuation">)</span>
tx<span class="token punctuation">.</span><span class="token function">RollbackTo</span><span class="token punctuation">(</span><span class="token string">&quot;sp1&quot;</span><span class="token punctuation">)</span> <span class="token comment">// Rollback user2</span>

tx<span class="token punctuation">.</span><span class="token function">Commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Commit user1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="日志" tabindex="-1"><a class="header-anchor" href="#日志" aria-hidden="true">#</a> 日志</h2><p>Gorm 有一个 <a href="https://github.com/go-gorm/gorm/blob/master/logger/logger.go" target="_blank" rel="noopener noreferrer">默认 logger 实现<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，默认情况下，它会打印慢 SQL 和错误</p><p>Logger 接受的选项不多，您可以在初始化时自定义它，例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>newLogger <span class="token operator">:=</span> logger<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>
  log<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stdout<span class="token punctuation">,</span> <span class="token string">&quot;\r\n&quot;</span><span class="token punctuation">,</span> log<span class="token punctuation">.</span>LstdFlags<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// io writer</span>
  logger<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
    SlowThreshold<span class="token punctuation">:</span>              time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span>   <span class="token comment">// Slow SQL threshold</span>
    LogLevel<span class="token punctuation">:</span>                   logger<span class="token punctuation">.</span>Silent<span class="token punctuation">,</span> <span class="token comment">// Log level</span>
    IgnoreRecordNotFoundError<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>           <span class="token comment">// Ignore ErrRecordNotFound error for logger</span>
    ParameterizedQueries<span class="token punctuation">:</span>      <span class="token boolean">true</span><span class="token punctuation">,</span>           <span class="token comment">// Don&#39;t include params in the SQL log</span>
    Colorful<span class="token punctuation">:</span>                  <span class="token boolean">false</span><span class="token punctuation">,</span>          <span class="token comment">// Disable color</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment">// Globally mode</span>
db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;test.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  Logger<span class="token punctuation">:</span> newLogger<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Continuous session mode</span>
tx <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Session</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Session<span class="token punctuation">{</span>Logger<span class="token punctuation">:</span> newLogger<span class="token punctuation">}</span><span class="token punctuation">)</span>
tx<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
tx<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;Age&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>日志级别</p></blockquote><p>GORM 定义了这些日志级别：<code>Silent</code>、<code>Error</code>、<code>Warn</code>、<code>Info</code></p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;test.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  Logger<span class="token punctuation">:</span> logger<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">LogMode</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>Silent<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 默认为 silent，执行失败或者长操作时会打印</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 可以设置为 info 级别，就可以观察执行了那些 sql</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Debug</p></blockquote><p>Debug 单个操作，将当前操作的 log 级别调整为 logger.Info</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="scopes-作用域" tabindex="-1"><a class="header-anchor" href="#scopes-作用域" aria-hidden="true">#</a> Scopes 作用域</h2><h3 id="复用" tabindex="-1"><a class="header-anchor" href="#复用" aria-hidden="true">#</a> 复用</h3><p>作用域允许复用通用的逻辑，这种共享逻辑需要定义为类型<code>func(*gorm.DB) *gorm.DB</code>。</p><p>通过两层函数可以实现参数的传递</p><p>这得益于链式调用</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">AmountGreaterThan1000</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
  <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;amount &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">PaidWithCreditCard</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
  <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;pay_mode_sign = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">PaidWithCod</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
  <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;pay_mode_sign = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">OrderStatus</span><span class="token punctuation">(</span>status <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token keyword">func</span> <span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">func</span> <span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
    <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;status IN (?)&quot;</span><span class="token punctuation">,</span> status<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

db<span class="token punctuation">.</span><span class="token function">Scopes</span><span class="token punctuation">(</span>AmountGreaterThan1000<span class="token punctuation">,</span> PaidWithCreditCard<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>orders<span class="token punctuation">)</span>
<span class="token comment">// 查找所有金额大于 1000 的信用卡订单</span>

db<span class="token punctuation">.</span><span class="token function">Scopes</span><span class="token punctuation">(</span>AmountGreaterThan1000<span class="token punctuation">,</span> PaidWithCod<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>orders<span class="token punctuation">)</span>
<span class="token comment">// 查找所有金额大于 1000 的 COD 订单</span>

db<span class="token punctuation">.</span><span class="token function">Scopes</span><span class="token punctuation">(</span>AmountGreaterThan1000<span class="token punctuation">,</span> <span class="token function">OrderStatus</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;paid&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;shipped&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>orders<span class="token punctuation">)</span>
<span class="token comment">// 查找所有金额大于1000 的已付款或已发货订单</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="分页" tabindex="-1"><a class="header-anchor" href="#分页" aria-hidden="true">#</a> 分页</h3><p>可以通过scope 来实现统一的分页逻辑</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Paginate</span><span class="token punctuation">(</span>r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">func</span> <span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
    q <span class="token operator">:=</span> r<span class="token punctuation">.</span>URL<span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    page<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> page <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
      page <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>

    pageSize<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;page_size&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">switch</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> pageSize <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">:</span>
      pageSize <span class="token operator">=</span> <span class="token number">100</span>
    <span class="token keyword">case</span> pageSize <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
      pageSize <span class="token operator">=</span> <span class="token number">10</span>
    <span class="token punctuation">}</span>

    offset <span class="token operator">:=</span> <span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize
    <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Limit</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

db<span class="token punctuation">.</span><span class="token function">Scopes</span><span class="token punctuation">(</span><span class="token function">Paginate</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">Scopes</span><span class="token punctuation">(</span><span class="token function">Paginate</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>articles<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1743760069@qq.com">liushun-ing</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/home/master/golang/gorm_1.html" class="" aria-label="GORM-1"><!--[--><!--]--> GORM-1 <!--[--><!--]--></a></span><span class="next"><a href="/home/master/golang/test.html" class="" aria-label="Go Test"><!--[--><!--]--> Go Test <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/home/assets/app-6d09a449.js" defer></script>
  </body>
</html>
