<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.62">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/home/imgs/favicon.ico"><title>Monitoring | 不愿飞的蜂鸟首页</title><meta name="description" content="Five的垃圾库">
    <link rel="preload" href="/home/assets/style-d11d67ee.css" as="style"><link rel="stylesheet" href="/home/assets/style-d11d67ee.css">
    <link rel="modulepreload" href="/home/assets/app-44324ae0.js"><link rel="modulepreload" href="/home/assets/monitoring.html-45825525.js"><link rel="modulepreload" href="/home/assets/monitoring.html-5c540669.js"><link rel="prefetch" href="/home/assets/index.html-572e34ff.js" as="script"><link rel="prefetch" href="/home/assets/index.html-81b2fcca.js" as="script"><link rel="prefetch" href="/home/assets/index.html-9c4bb6b4.js" as="script"><link rel="prefetch" href="/home/assets/index.html-25f3e375.js" as="script"><link rel="prefetch" href="/home/assets/index.html-7e831815.js" as="script"><link rel="prefetch" href="/home/assets/1.html-b316c5ed.js" as="script"><link rel="prefetch" href="/home/assets/2.html-ac2ea519.js" as="script"><link rel="prefetch" href="/home/assets/3.html-a16fc765.js" as="script"><link rel="prefetch" href="/home/assets/4.html-798018cd.js" as="script"><link rel="prefetch" href="/home/assets/5.html-18ce25f4.js" as="script"><link rel="prefetch" href="/home/assets/6.html-f31143bd.js" as="script"><link rel="prefetch" href="/home/assets/index.html-d4d6df4d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b98c27b4.js" as="script"><link rel="prefetch" href="/home/assets/algorithms.html-f5b5ee0a.js" as="script"><link rel="prefetch" href="/home/assets/c__.html-05ab7a9e.js" as="script"><link rel="prefetch" href="/home/assets/graph.html-dab7b16e.js" as="script"><link rel="prefetch" href="/home/assets/leetcode.html-f105e9f1.js" as="script"><link rel="prefetch" href="/home/assets/other_tree.html-22fe33b0.js" as="script"><link rel="prefetch" href="/home/assets/sort_and_search.html-11f53bfb.js" as="script"><link rel="prefetch" href="/home/assets/string.html-e9db3916.js" as="script"><link rel="prefetch" href="/home/assets/tree.html-ec32110e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-99884eac.js" as="script"><link rel="prefetch" href="/home/assets/10.html-75dc6e9d.js" as="script"><link rel="prefetch" href="/home/assets/11.html-44ed8d03.js" as="script"><link rel="prefetch" href="/home/assets/12.html-1cafae42.js" as="script"><link rel="prefetch" href="/home/assets/13.html-cf9e5046.js" as="script"><link rel="prefetch" href="/home/assets/14.html-513b431e.js" as="script"><link rel="prefetch" href="/home/assets/2.html-094a87ee.js" as="script"><link rel="prefetch" href="/home/assets/3.html-4a8b2796.js" as="script"><link rel="prefetch" href="/home/assets/4.html-1f39f3b9.js" as="script"><link rel="prefetch" href="/home/assets/5.html-e78784fc.js" as="script"><link rel="prefetch" href="/home/assets/6.html-cc4acb22.js" as="script"><link rel="prefetch" href="/home/assets/7.html-ff096a2a.js" as="script"><link rel="prefetch" href="/home/assets/8.html-14b4319a.js" as="script"><link rel="prefetch" href="/home/assets/9.html-f1fd1f24.js" as="script"><link rel="prefetch" href="/home/assets/index.html-47fde470.js" as="script"><link rel="prefetch" href="/home/assets/1.html-769a7684.js" as="script"><link rel="prefetch" href="/home/assets/2.html-594984b8.js" as="script"><link rel="prefetch" href="/home/assets/3.html-5ac058a8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-8a655167.js" as="script"><link rel="prefetch" href="/home/assets/framework.html-0ddb7519.js" as="script"><link rel="prefetch" href="/home/assets/interview.html-8d5ca02c.js" as="script"><link rel="prefetch" href="/home/assets/javabase.html-1fa8f93d.js" as="script"><link rel="prefetch" href="/home/assets/javacollection.html-b161f806.js" as="script"><link rel="prefetch" href="/home/assets/javaio.html-2bf0aab6.js" as="script"><link rel="prefetch" href="/home/assets/javajuc.html-df2ba12a.js" as="script"><link rel="prefetch" href="/home/assets/project.html-3006a5d9.js" as="script"><link rel="prefetch" href="/home/assets/23_Dec.html-b55b0d44.js" as="script"><link rel="prefetch" href="/home/assets/23_Nov.html-7f12af9c.js" as="script"><link rel="prefetch" href="/home/assets/24_Jan.html-aa29373f.js" as="script"><link rel="prefetch" href="/home/assets/index.html-cf670ace.js" as="script"><link rel="prefetch" href="/home/assets/index.html-1bcb2be9.js" as="script"><link rel="prefetch" href="/home/assets/docker_tutorial.html-4f5d0900.js" as="script"><link rel="prefetch" href="/home/assets/firewall_tutorial.html-a1c0f732.js" as="script"><link rel="prefetch" href="/home/assets/mysql_tutorial.html-4c6ba5d6.js" as="script"><link rel="prefetch" href="/home/assets/nginx_tutorial.html-93df5119.js" as="script"><link rel="prefetch" href="/home/assets/other_tutorial.html-c3d0505a.js" as="script"><link rel="prefetch" href="/home/assets/1.html-a99eaaf4.js" as="script"><link rel="prefetch" href="/home/assets/index.html-17ad9c14.js" as="script"><link rel="prefetch" href="/home/assets/1.html-039b4262.js" as="script"><link rel="prefetch" href="/home/assets/2.html-42769e2a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-25191acb.js" as="script"><link rel="prefetch" href="/home/assets/index.html-bf41a08e.js" as="script"><link rel="prefetch" href="/home/assets/jwt.html-3b7c50b6.js" as="script"><link rel="prefetch" href="/home/assets/shiro.html-342768e3.js" as="script"><link rel="prefetch" href="/home/assets/index.html-48e4d448.js" as="script"><link rel="prefetch" href="/home/assets/spring_annotation.html-9fe17a51.js" as="script"><link rel="prefetch" href="/home/assets/springboot.html-5ae0091a.js" as="script"><link rel="prefetch" href="/home/assets/springboot_base.html-e6d2a44d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-5427bf36.js" as="script"><link rel="prefetch" href="/home/assets/nacos.html-9e867259.js" as="script"><link rel="prefetch" href="/home/assets/index.html-3091dbfa.js" as="script"><link rel="prefetch" href="/home/assets/gas_fee.html-6a6b1c7c.js" as="script"><link rel="prefetch" href="/home/assets/statedb_execute.html-5640acbf.js" as="script"><link rel="prefetch" href="/home/assets/index.html-1f5ffc7a.js" as="script"><link rel="prefetch" href="/home/assets/compose.html-f3673379.js" as="script"><link rel="prefetch" href="/home/assets/image_construct.html-2b5a4ebd.js" as="script"><link rel="prefetch" href="/home/assets/intro.html-085a128d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-702db84d.js" as="script"><link rel="prefetch" href="/home/assets/account.html-9e85b652.js" as="script"><link rel="prefetch" href="/home/assets/block.html-fc63af06.js" as="script"><link rel="prefetch" href="/home/assets/consensus.html-50cfa19b.js" as="script"><link rel="prefetch" href="/home/assets/contract.html-44f89466.js" as="script"><link rel="prefetch" href="/home/assets/crypto_base.html-a1d2755a.js" as="script"><link rel="prefetch" href="/home/assets/erc20.html-c4c0a5b3.js" as="script"><link rel="prefetch" href="/home/assets/ethereum_base.html-3e8bc10f.js" as="script"><link rel="prefetch" href="/home/assets/evm.html-d1eaca23.js" as="script"><link rel="prefetch" href="/home/assets/gas.html-9ff0c427.js" as="script"><link rel="prefetch" href="/home/assets/go_ethereum.html-eae867c4.js" as="script"><link rel="prefetch" href="/home/assets/hd_wallet.html-91aa6766.js" as="script"><link rel="prefetch" href="/home/assets/jsonrpc.html-a57f7530.js" as="script"><link rel="prefetch" href="/home/assets/leveldb.html-6478dc05.js" as="script"><link rel="prefetch" href="/home/assets/mev.html-a27daf3a.js" as="script"><link rel="prefetch" href="/home/assets/mpt.html-e2f7bc03.js" as="script"><link rel="prefetch" href="/home/assets/node_client.html-a30693a4.js" as="script"><link rel="prefetch" href="/home/assets/rlp.html-53ab1b31.js" as="script"><link rel="prefetch" href="/home/assets/statedb.html-02c5b018.js" as="script"><link rel="prefetch" href="/home/assets/transaction.html-8517471b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-e8e002c3.js" as="script"><link rel="prefetch" href="/home/assets/distributed.html-71d7dfd7.js" as="script"><link rel="prefetch" href="/home/assets/gin.html-fa6f0efd.js" as="script"><link rel="prefetch" href="/home/assets/gorm_1.html-bf15a3ef.js" as="script"><link rel="prefetch" href="/home/assets/gorm_2.html-d83f2f29.js" as="script"><link rel="prefetch" href="/home/assets/goweb.html-1682a7c6.js" as="script"><link rel="prefetch" href="/home/assets/protobuf.html-ffaaa1b6.js" as="script"><link rel="prefetch" href="/home/assets/rpc.html-b5f34982.js" as="script"><link rel="prefetch" href="/home/assets/sse.html-b994eab4.js" as="script"><link rel="prefetch" href="/home/assets/test.html-c549c37e.js" as="script"><link rel="prefetch" href="/home/assets/websocket.html-23b67c10.js" as="script"><link rel="prefetch" href="/home/assets/index.html-e6c87408.js" as="script"><link rel="prefetch" href="/home/assets/dockerbase.html-e6c763c4.js" as="script"><link rel="prefetch" href="/home/assets/dockerutil.html-8fc5df46.js" as="script"><link rel="prefetch" href="/home/assets/k8sbase.html-ea4bc604.js" as="script"><link rel="prefetch" href="/home/assets/index.html-dc007d97.js" as="script"><link rel="prefetch" href="/home/assets/alert.html-c9b22965.js" as="script"><link rel="prefetch" href="/home/assets/clustering.html-cb2eb425.js" as="script"><link rel="prefetch" href="/home/assets/exporter.html-a677d410.js" as="script"><link rel="prefetch" href="/home/assets/intro.html-0cc43907.js" as="script"><link rel="prefetch" href="/home/assets/promql.html-23f025a6.js" as="script"><link rel="prefetch" href="/home/assets/servicediscovery.html-264cecd6.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b7c9dba1.js" as="script"><link rel="prefetch" href="/home/assets/base.html-79b0525f.js" as="script"><link rel="prefetch" href="/home/assets/progress.html-1e7b923d.js" as="script"><link rel="prefetch" href="/home/assets/script.html-d6d09c52.js" as="script"><link rel="prefetch" href="/home/assets/1.html-342ba6a2.js" as="script"><link rel="prefetch" href="/home/assets/2.html-9d1d33ab.js" as="script"><link rel="prefetch" href="/home/assets/3.html-420b60d1.js" as="script"><link rel="prefetch" href="/home/assets/4.html-0c33cb96.js" as="script"><link rel="prefetch" href="/home/assets/index.html-ef6613b6.js" as="script"><link rel="prefetch" href="/home/assets/index.html-475b16d3.js" as="script"><link rel="prefetch" href="/home/assets/mybatis.html-60af6436.js" as="script"><link rel="prefetch" href="/home/assets/index.html-f1fe6766.js" as="script"><link rel="prefetch" href="/home/assets/base.html-9c1a8c70.js" as="script"><link rel="prefetch" href="/home/assets/progress_section_1.html-a1a0dbb9.js" as="script"><link rel="prefetch" href="/home/assets/progress_section_2.html-23b3205f.js" as="script"><link rel="prefetch" href="/home/assets/progress_section_3.html-dd05c473.js" as="script"><link rel="prefetch" href="/home/assets/progress_section_4.html-2255bd42.js" as="script"><link rel="prefetch" href="/home/assets/progress_section_5.html-6695fe54.js" as="script"><link rel="prefetch" href="/home/assets/1.html-7b6a4ff5.js" as="script"><link rel="prefetch" href="/home/assets/2.html-b2effb91.js" as="script"><link rel="prefetch" href="/home/assets/3.html-d3ac085e.js" as="script"><link rel="prefetch" href="/home/assets/4.html-99b856c6.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2fe01cf3.js" as="script"><link rel="prefetch" href="/home/assets/index.html-bdf14349.js" as="script"><link rel="prefetch" href="/home/assets/base_concept.html-e5e444c4.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-1566edbf.js" as="script"><link rel="prefetch" href="/home/assets/pytorch_usage.html-261e26aa.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b6ef7879.js" as="script"><link rel="prefetch" href="/home/assets/base_usage.html-73b2ff79.js" as="script"><link rel="prefetch" href="/home/assets/index.html-0653102b.js" as="script"><link rel="prefetch" href="/home/assets/java_usage.html-fa3119c0.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-c32dac90.js" as="script"><link rel="prefetch" href="/home/assets/system_usage.html-36cb019c.js" as="script"><link rel="prefetch" href="/home/assets/5.html-f54523bb.js" as="script"><link rel="prefetch" href="/home/assets/6.html-651c90f7.js" as="script"><link rel="prefetch" href="/home/assets/7.html-3929716a.js" as="script"><link rel="prefetch" href="/home/assets/Mybatis.html-bb50b209.js" as="script"><link rel="prefetch" href="/home/assets/index.html-75a12fb0.js" as="script"><link rel="prefetch" href="/home/assets/Spring.html-dce5208f.js" as="script"><link rel="prefetch" href="/home/assets/SpringBoot.html-2789fc6a.js" as="script"><link rel="prefetch" href="/home/assets/SpringMVC.html-6be493ac.js" as="script"><link rel="prefetch" href="/home/assets/1.html-57378aba.js" as="script"><link rel="prefetch" href="/home/assets/2.html-a498544a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2e2df2e8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-a8aa2668.js" as="script"><link rel="prefetch" href="/home/assets/js1.html-c3668a2e.js" as="script"><link rel="prefetch" href="/home/assets/js2.html-4f82b430.js" as="script"><link rel="prefetch" href="/home/assets/js3.html-431abf27.js" as="script"><link rel="prefetch" href="/home/assets/js4.html-35d56cc9.js" as="script"><link rel="prefetch" href="/home/assets/js5.html-6efcdaa8.js" as="script"><link rel="prefetch" href="/home/assets/ts1.html-b16b3a0f.js" as="script"><link rel="prefetch" href="/home/assets/index.html-fdb17d2b.js" as="script"><link rel="prefetch" href="/home/assets/csstip.html-27d6cac2.js" as="script"><link rel="prefetch" href="/home/assets/hcbase.html-8143c0ff.js" as="script"><link rel="prefetch" href="/home/assets/less.html-ddc42f2d.js" as="script"><link rel="prefetch" href="/home/assets/sass.html-9bf6cc0b.js" as="script"><link rel="prefetch" href="/home/assets/1.html-fb507cef.js" as="script"><link rel="prefetch" href="/home/assets/2.html-43d2be36.js" as="script"><link rel="prefetch" href="/home/assets/3.html-54232be5.js" as="script"><link rel="prefetch" href="/home/assets/4.html-fef101c0.js" as="script"><link rel="prefetch" href="/home/assets/5.html-c4941179.js" as="script"><link rel="prefetch" href="/home/assets/6.html-797e8a7e.js" as="script"><link rel="prefetch" href="/home/assets/7.html-f5c2c1de.js" as="script"><link rel="prefetch" href="/home/assets/8.html-b8c67cc2.js" as="script"><link rel="prefetch" href="/home/assets/9.html-8521dff9.js" as="script"><link rel="prefetch" href="/home/assets/index.html-946ecd89.js" as="script"><link rel="prefetch" href="/home/assets/new.html-8ae79d55.js" as="script"><link rel="prefetch" href="/home/assets/1.html-be79a9a8.js" as="script"><link rel="prefetch" href="/home/assets/index.html-ff1cb58f.js" as="script"><link rel="prefetch" href="/home/assets/index.html-12b4a19f.js" as="script"><link rel="prefetch" href="/home/assets/api_tutorial.html-44bea25e.js" as="script"><link rel="prefetch" href="/home/assets/base_tutorial.html-fe1f1370.js" as="script"><link rel="prefetch" href="/home/assets/pinia.html-503396dd.js" as="script"><link rel="prefetch" href="/home/assets/vue2.html-17b27ee6.js" as="script"><link rel="prefetch" href="/home/assets/vue3_1.html-deacccfb.js" as="script"><link rel="prefetch" href="/home/assets/vue3_2.html-8f4801a7.js" as="script"><link rel="prefetch" href="/home/assets/1.html-8bcbb7f0.js" as="script"><link rel="prefetch" href="/home/assets/index.html-71879b0a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-be476d9e.js" as="script"><link rel="prefetch" href="/home/assets/uniCloud.html-0af8d736.js" as="script"><link rel="prefetch" href="/home/assets/uniTips.html-3a8cceb1.js" as="script"><link rel="prefetch" href="/home/assets/1.html-7b118e11.js" as="script"><link rel="prefetch" href="/home/assets/2.html-4ab6a64e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b9584b78.js" as="script"><link rel="prefetch" href="/home/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-8e1bc069.js" as="script"><link rel="prefetch" href="/home/assets/index.html-5a576ff2.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b9c0af01.js" as="script"><link rel="prefetch" href="/home/assets/index.html-e8808fcc.js" as="script"><link rel="prefetch" href="/home/assets/index.html-dc7b0bb4.js" as="script"><link rel="prefetch" href="/home/assets/1.html-b8305b67.js" as="script"><link rel="prefetch" href="/home/assets/2.html-032195e9.js" as="script"><link rel="prefetch" href="/home/assets/3.html-197e46e5.js" as="script"><link rel="prefetch" href="/home/assets/4.html-ed6dc8a1.js" as="script"><link rel="prefetch" href="/home/assets/5.html-505c8e08.js" as="script"><link rel="prefetch" href="/home/assets/6.html-4cb6dff9.js" as="script"><link rel="prefetch" href="/home/assets/index.html-04e9be44.js" as="script"><link rel="prefetch" href="/home/assets/index.html-649c81b0.js" as="script"><link rel="prefetch" href="/home/assets/algorithms.html-215eddd6.js" as="script"><link rel="prefetch" href="/home/assets/c__.html-5f10a7b2.js" as="script"><link rel="prefetch" href="/home/assets/graph.html-4b46dd03.js" as="script"><link rel="prefetch" href="/home/assets/leetcode.html-97a220e0.js" as="script"><link rel="prefetch" href="/home/assets/other_tree.html-bf32311d.js" as="script"><link rel="prefetch" href="/home/assets/sort_and_search.html-a69da500.js" as="script"><link rel="prefetch" href="/home/assets/string.html-cec80f1a.js" as="script"><link rel="prefetch" href="/home/assets/tree.html-b5cc200d.js" as="script"><link rel="prefetch" href="/home/assets/1.html-f50fc2d2.js" as="script"><link rel="prefetch" href="/home/assets/10.html-4cbaca86.js" as="script"><link rel="prefetch" href="/home/assets/11.html-1229f387.js" as="script"><link rel="prefetch" href="/home/assets/12.html-5a5bbb7a.js" as="script"><link rel="prefetch" href="/home/assets/13.html-75a2c43e.js" as="script"><link rel="prefetch" href="/home/assets/14.html-1d2a3503.js" as="script"><link rel="prefetch" href="/home/assets/2.html-5b52fc7c.js" as="script"><link rel="prefetch" href="/home/assets/3.html-3cb5e7ac.js" as="script"><link rel="prefetch" href="/home/assets/4.html-3469ab01.js" as="script"><link rel="prefetch" href="/home/assets/5.html-5d8f7601.js" as="script"><link rel="prefetch" href="/home/assets/6.html-888f696d.js" as="script"><link rel="prefetch" href="/home/assets/7.html-f6035d23.js" as="script"><link rel="prefetch" href="/home/assets/8.html-88853180.js" as="script"><link rel="prefetch" href="/home/assets/9.html-ca24c77d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-cc9e5d75.js" as="script"><link rel="prefetch" href="/home/assets/1.html-92d63fea.js" as="script"><link rel="prefetch" href="/home/assets/2.html-9c57ea7b.js" as="script"><link rel="prefetch" href="/home/assets/3.html-07ca040a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-efef0aa9.js" as="script"><link rel="prefetch" href="/home/assets/framework.html-605222d8.js" as="script"><link rel="prefetch" href="/home/assets/interview.html-45caf215.js" as="script"><link rel="prefetch" href="/home/assets/javabase.html-75962e1b.js" as="script"><link rel="prefetch" href="/home/assets/javacollection.html-ca187f42.js" as="script"><link rel="prefetch" href="/home/assets/javaio.html-a96c78ca.js" as="script"><link rel="prefetch" href="/home/assets/javajuc.html-21db6303.js" as="script"><link rel="prefetch" href="/home/assets/project.html-467ed8fa.js" as="script"><link rel="prefetch" href="/home/assets/23_Dec.html-9f54a139.js" as="script"><link rel="prefetch" href="/home/assets/23_Nov.html-ade70ee6.js" as="script"><link rel="prefetch" href="/home/assets/24_Jan.html-d9cca20b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-b0540e45.js" as="script"><link rel="prefetch" href="/home/assets/index.html-5988ed58.js" as="script"><link rel="prefetch" href="/home/assets/docker_tutorial.html-1c5ecc6f.js" as="script"><link rel="prefetch" href="/home/assets/firewall_tutorial.html-bfc5904a.js" as="script"><link rel="prefetch" href="/home/assets/mysql_tutorial.html-6894d8e2.js" as="script"><link rel="prefetch" href="/home/assets/nginx_tutorial.html-dafe8914.js" as="script"><link rel="prefetch" href="/home/assets/other_tutorial.html-6e73545c.js" as="script"><link rel="prefetch" href="/home/assets/1.html-0bdd24e7.js" as="script"><link rel="prefetch" href="/home/assets/index.html-1c3fa712.js" as="script"><link rel="prefetch" href="/home/assets/1.html-84eeb628.js" as="script"><link rel="prefetch" href="/home/assets/2.html-88ff28d4.js" as="script"><link rel="prefetch" href="/home/assets/index.html-a1ef8f56.js" as="script"><link rel="prefetch" href="/home/assets/index.html-51a98cd2.js" as="script"><link rel="prefetch" href="/home/assets/jwt.html-d8d16ada.js" as="script"><link rel="prefetch" href="/home/assets/shiro.html-2ca07694.js" as="script"><link rel="prefetch" href="/home/assets/index.html-0b2c1e98.js" as="script"><link rel="prefetch" href="/home/assets/spring_annotation.html-1b1fbd81.js" as="script"><link rel="prefetch" href="/home/assets/springboot.html-86f5e935.js" as="script"><link rel="prefetch" href="/home/assets/springboot_base.html-bcab773d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-ab73eb3a.js" as="script"><link rel="prefetch" href="/home/assets/nacos.html-d739a298.js" as="script"><link rel="prefetch" href="/home/assets/index.html-e0558047.js" as="script"><link rel="prefetch" href="/home/assets/gas_fee.html-1b9b8d57.js" as="script"><link rel="prefetch" href="/home/assets/statedb_execute.html-2846533d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-acc38084.js" as="script"><link rel="prefetch" href="/home/assets/compose.html-e1b689ab.js" as="script"><link rel="prefetch" href="/home/assets/image_construct.html-466d3ec3.js" as="script"><link rel="prefetch" href="/home/assets/intro.html-803c714d.js" as="script"><link rel="prefetch" href="/home/assets/index.html-adb79fe5.js" as="script"><link rel="prefetch" href="/home/assets/account.html-fe582ff0.js" as="script"><link rel="prefetch" href="/home/assets/block.html-94295d98.js" as="script"><link rel="prefetch" href="/home/assets/consensus.html-aea62729.js" as="script"><link rel="prefetch" href="/home/assets/contract.html-ff7af1e7.js" as="script"><link rel="prefetch" href="/home/assets/crypto_base.html-76a0eb1e.js" as="script"><link rel="prefetch" href="/home/assets/erc20.html-48c827df.js" as="script"><link rel="prefetch" href="/home/assets/ethereum_base.html-d0a377be.js" as="script"><link rel="prefetch" href="/home/assets/evm.html-75ccd44d.js" as="script"><link rel="prefetch" href="/home/assets/gas.html-0202d301.js" as="script"><link rel="prefetch" href="/home/assets/go_ethereum.html-3282c16c.js" as="script"><link rel="prefetch" href="/home/assets/hd_wallet.html-5650c4cd.js" as="script"><link rel="prefetch" href="/home/assets/jsonrpc.html-a76bfbb0.js" as="script"><link rel="prefetch" href="/home/assets/leveldb.html-7c61c563.js" as="script"><link rel="prefetch" href="/home/assets/mev.html-c659ac28.js" as="script"><link rel="prefetch" href="/home/assets/mpt.html-4969eeec.js" as="script"><link rel="prefetch" href="/home/assets/node_client.html-b5fd5783.js" as="script"><link rel="prefetch" href="/home/assets/rlp.html-150c3f8d.js" as="script"><link rel="prefetch" href="/home/assets/statedb.html-8512cd61.js" as="script"><link rel="prefetch" href="/home/assets/transaction.html-b768bec6.js" as="script"><link rel="prefetch" href="/home/assets/index.html-8ba38abc.js" as="script"><link rel="prefetch" href="/home/assets/distributed.html-1ad29364.js" as="script"><link rel="prefetch" href="/home/assets/gin.html-de4dcbb9.js" as="script"><link rel="prefetch" href="/home/assets/gorm_1.html-fc25e694.js" as="script"><link rel="prefetch" href="/home/assets/gorm_2.html-e7186d72.js" as="script"><link rel="prefetch" href="/home/assets/goweb.html-a7cb597b.js" as="script"><link rel="prefetch" href="/home/assets/protobuf.html-3a5868fb.js" as="script"><link rel="prefetch" href="/home/assets/rpc.html-027ad9fc.js" as="script"><link rel="prefetch" href="/home/assets/sse.html-079da750.js" as="script"><link rel="prefetch" href="/home/assets/test.html-bf38763b.js" as="script"><link rel="prefetch" href="/home/assets/websocket.html-db4365c1.js" as="script"><link rel="prefetch" href="/home/assets/index.html-90aab09b.js" as="script"><link rel="prefetch" href="/home/assets/dockerbase.html-4c939f94.js" as="script"><link rel="prefetch" href="/home/assets/dockerutil.html-ebc70acb.js" as="script"><link rel="prefetch" href="/home/assets/k8sbase.html-9f8022fc.js" as="script"><link rel="prefetch" href="/home/assets/index.html-427ae9e7.js" as="script"><link rel="prefetch" href="/home/assets/alert.html-467322c3.js" as="script"><link rel="prefetch" href="/home/assets/clustering.html-723b1822.js" as="script"><link rel="prefetch" href="/home/assets/exporter.html-af389e16.js" as="script"><link rel="prefetch" href="/home/assets/intro.html-51989421.js" as="script"><link rel="prefetch" href="/home/assets/promql.html-45baee1e.js" as="script"><link rel="prefetch" href="/home/assets/servicediscovery.html-dcb2ac5b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-083254fb.js" as="script"><link rel="prefetch" href="/home/assets/base.html-8ccb07d5.js" as="script"><link rel="prefetch" href="/home/assets/progress.html-65c70308.js" as="script"><link rel="prefetch" href="/home/assets/script.html-78ed4f72.js" as="script"><link rel="prefetch" href="/home/assets/1.html-9231d2cb.js" as="script"><link rel="prefetch" href="/home/assets/2.html-fa54459a.js" as="script"><link rel="prefetch" href="/home/assets/3.html-6f58b91c.js" as="script"><link rel="prefetch" href="/home/assets/4.html-d5506191.js" as="script"><link rel="prefetch" href="/home/assets/index.html-d3d930f3.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2fb56f6b.js" as="script"><link rel="prefetch" href="/home/assets/mybatis.html-2fb029ce.js" as="script"><link rel="prefetch" href="/home/assets/index.html-36bf75b2.js" as="script"><link rel="prefetch" href="/home/assets/base.html-93ed7197.js" as="script"><link rel="prefetch" href="/home/assets/progress_section_1.html-281ace88.js" as="script"><link rel="prefetch" href="/home/assets/progress_section_2.html-6cc8d81f.js" as="script"><link rel="prefetch" href="/home/assets/progress_section_3.html-99f1271b.js" as="script"><link rel="prefetch" href="/home/assets/progress_section_4.html-dc7d109e.js" as="script"><link rel="prefetch" href="/home/assets/progress_section_5.html-d96cfd8f.js" as="script"><link rel="prefetch" href="/home/assets/1.html-847d7b7b.js" as="script"><link rel="prefetch" href="/home/assets/2.html-fca5ee81.js" as="script"><link rel="prefetch" href="/home/assets/3.html-a7b4c086.js" as="script"><link rel="prefetch" href="/home/assets/4.html-c7f12cde.js" as="script"><link rel="prefetch" href="/home/assets/index.html-6c23a39e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-5fbf5384.js" as="script"><link rel="prefetch" href="/home/assets/base_concept.html-c6cd3a4a.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-6192bd7e.js" as="script"><link rel="prefetch" href="/home/assets/pytorch_usage.html-26ac61c5.js" as="script"><link rel="prefetch" href="/home/assets/index.html-aa3ff347.js" as="script"><link rel="prefetch" href="/home/assets/base_usage.html-1658dd34.js" as="script"><link rel="prefetch" href="/home/assets/index.html-de0e8d5c.js" as="script"><link rel="prefetch" href="/home/assets/java_usage.html-051a2459.js" as="script"><link rel="prefetch" href="/home/assets/python_usage.html-0ef8b9e4.js" as="script"><link rel="prefetch" href="/home/assets/system_usage.html-d8d48192.js" as="script"><link rel="prefetch" href="/home/assets/5.html-4105bbe8.js" as="script"><link rel="prefetch" href="/home/assets/6.html-b462fa73.js" as="script"><link rel="prefetch" href="/home/assets/7.html-7882c641.js" as="script"><link rel="prefetch" href="/home/assets/Mybatis.html-0990bfde.js" as="script"><link rel="prefetch" href="/home/assets/index.html-88fe24eb.js" as="script"><link rel="prefetch" href="/home/assets/Spring.html-ed1614fc.js" as="script"><link rel="prefetch" href="/home/assets/SpringBoot.html-39765d65.js" as="script"><link rel="prefetch" href="/home/assets/SpringMVC.html-78dcaf1e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-a714f8dc.js" as="script"><link rel="prefetch" href="/home/assets/2.html-c2093b39.js" as="script"><link rel="prefetch" href="/home/assets/index.html-102d6d5b.js" as="script"><link rel="prefetch" href="/home/assets/index.html-1a733d2f.js" as="script"><link rel="prefetch" href="/home/assets/js1.html-40297d03.js" as="script"><link rel="prefetch" href="/home/assets/js2.html-50121bff.js" as="script"><link rel="prefetch" href="/home/assets/js3.html-c1664de9.js" as="script"><link rel="prefetch" href="/home/assets/js4.html-c047ce75.js" as="script"><link rel="prefetch" href="/home/assets/js5.html-1fb58576.js" as="script"><link rel="prefetch" href="/home/assets/ts1.html-86572bbf.js" as="script"><link rel="prefetch" href="/home/assets/index.html-eb2662df.js" as="script"><link rel="prefetch" href="/home/assets/csstip.html-83b1f1b6.js" as="script"><link rel="prefetch" href="/home/assets/hcbase.html-3094fc87.js" as="script"><link rel="prefetch" href="/home/assets/less.html-118314b9.js" as="script"><link rel="prefetch" href="/home/assets/sass.html-85ede040.js" as="script"><link rel="prefetch" href="/home/assets/1.html-54908d23.js" as="script"><link rel="prefetch" href="/home/assets/2.html-ec43cb4e.js" as="script"><link rel="prefetch" href="/home/assets/3.html-cfebbe04.js" as="script"><link rel="prefetch" href="/home/assets/4.html-3302f61d.js" as="script"><link rel="prefetch" href="/home/assets/5.html-9cf4033e.js" as="script"><link rel="prefetch" href="/home/assets/6.html-3c36d0c6.js" as="script"><link rel="prefetch" href="/home/assets/7.html-8ab7479f.js" as="script"><link rel="prefetch" href="/home/assets/8.html-0ca1c44c.js" as="script"><link rel="prefetch" href="/home/assets/9.html-c494c30e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-64084bd2.js" as="script"><link rel="prefetch" href="/home/assets/new.html-203f256f.js" as="script"><link rel="prefetch" href="/home/assets/1.html-45152d3a.js" as="script"><link rel="prefetch" href="/home/assets/index.html-867d42ae.js" as="script"><link rel="prefetch" href="/home/assets/index.html-2feba5f7.js" as="script"><link rel="prefetch" href="/home/assets/api_tutorial.html-d47ead47.js" as="script"><link rel="prefetch" href="/home/assets/base_tutorial.html-500e37ef.js" as="script"><link rel="prefetch" href="/home/assets/pinia.html-2276b518.js" as="script"><link rel="prefetch" href="/home/assets/vue2.html-f06e4f7c.js" as="script"><link rel="prefetch" href="/home/assets/vue3_1.html-973589c0.js" as="script"><link rel="prefetch" href="/home/assets/vue3_2.html-0977d84e.js" as="script"><link rel="prefetch" href="/home/assets/1.html-fe748ec6.js" as="script"><link rel="prefetch" href="/home/assets/index.html-cd66181e.js" as="script"><link rel="prefetch" href="/home/assets/index.html-63943f25.js" as="script"><link rel="prefetch" href="/home/assets/uniCloud.html-6c81a97d.js" as="script"><link rel="prefetch" href="/home/assets/uniTips.html-d0154ccb.js" as="script"><link rel="prefetch" href="/home/assets/1.html-480f8b8f.js" as="script"><link rel="prefetch" href="/home/assets/2.html-59b79a5c.js" as="script"><link rel="prefetch" href="/home/assets/index.html-1c428bd7.js" as="script"><link rel="prefetch" href="/home/assets/404.html-c418af05.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container no-sidebar"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/home/" class=""><!----><span class="site-name">不愿飞的蜂鸟首页</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>区块链研究院池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/gointern/ethereum/" class="" aria-label="ethereum"><!--[--><!--]--> ethereum <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/gointern/blockchaindevelopment/" class="" aria-label="block chain development"><!--[--><!--]--> block chain development <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/gointern/docker/" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/gointern/golang/" class="" aria-label="golang"><!--[--><!--]--> golang <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/gointern/prometheus/" class="" aria-label="prometheus"><!--[--><!--]--> prometheus <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/gointern/shell/" class="" aria-label="shell"><!--[--><!--]--> shell <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java编程池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/java/redis/" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/java/mysql/" class="" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/java/jvm/" class="" aria-label="JVM"><!--[--><!--]--> JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/java/mybatis/" class="" aria-label="MyBatis"><!--[--><!--]--> MyBatis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>不成文研究池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/research/ubuntu/" class="" aria-label="Ubuntu"><!--[--><!--]--> Ubuntu <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/research/GNN/" class="" aria-label="GNN"><!--[--><!--]--> GNN <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/research/python/" class="" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five本科"><span class="title">Five本科</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five本科"><span class="title">Five本科</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>前端池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/frontend/js&amp;ts/" class="" aria-label="JS&amp;TS"><!--[--><!--]--> JS&amp;TS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/frontend/page&amp;style/" class="" aria-label="页面&amp;样式"><!--[--><!--]--> 页面&amp;样式 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/frontend/react/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/frontend/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/frontend/vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/frontend/webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>后端池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/backend/java/" class="" aria-label="JAVA"><!--[--><!--]--> JAVA <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/backend/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>小程序池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/miniprogram/wxmini" class="" aria-label="微信小程序"><!--[--><!--]--> 微信小程序 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/miniprogram/uni-app/" class="" aria-label="uni-app"><!--[--><!--]--> uni-app <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>服务池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/centos/" class="" aria-label="Centos"><!--[--><!--]--> Centos <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five本科课程"><span class="title">Five本科课程</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five本科课程"><span class="title">Five本科课程</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/course/operating_system/" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/computer_network/" class="" aria-label="计算机网络技术"><!--[--><!--]--> 计算机网络技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/datastructure_and_algorithm/" class="" aria-label="数据结构和算法"><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five杂学"><span class="title">Five杂学</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five杂学"><span class="title">Five杂学</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/trivia/spring/" class="" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/trivia/juc/" class="" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/trivia/netty/" class="" aria-label="Netty"><!--[--><!--]--> Netty <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/trivia/security/" class="" aria-label="Security"><!--[--><!--]--> Security <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/trivia/service/" class="" aria-label="Service"><!--[--><!--]--> Service <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/liushun-ing" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five研究生"><span class="title">Five研究生</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>区块链研究院池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/gointern/ethereum/" class="" aria-label="ethereum"><!--[--><!--]--> ethereum <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/gointern/blockchaindevelopment/" class="" aria-label="block chain development"><!--[--><!--]--> block chain development <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/gointern/docker/" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/gointern/golang/" class="" aria-label="golang"><!--[--><!--]--> golang <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/gointern/prometheus/" class="" aria-label="prometheus"><!--[--><!--]--> prometheus <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/gointern/shell/" class="" aria-label="shell"><!--[--><!--]--> shell <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java编程池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/java/redis/" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/java/mysql/" class="" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/java/jvm/" class="" aria-label="JVM"><!--[--><!--]--> JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/java/mybatis/" class="" aria-label="MyBatis"><!--[--><!--]--> MyBatis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>不成文研究池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/master/research/ubuntu/" class="" aria-label="Ubuntu"><!--[--><!--]--> Ubuntu <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/research/GNN/" class="" aria-label="GNN"><!--[--><!--]--> GNN <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/master/research/python/" class="" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five本科"><span class="title">Five本科</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five本科"><span class="title">Five本科</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>前端池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/frontend/js&amp;ts/" class="" aria-label="JS&amp;TS"><!--[--><!--]--> JS&amp;TS <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/frontend/page&amp;style/" class="" aria-label="页面&amp;样式"><!--[--><!--]--> 页面&amp;样式 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/frontend/react/" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/frontend/vue/" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/frontend/vite/" class="" aria-label="Vite"><!--[--><!--]--> Vite <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/frontend/webpack/" class="" aria-label="Webpack"><!--[--><!--]--> Webpack <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>后端池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/backend/java/" class="" aria-label="JAVA"><!--[--><!--]--> JAVA <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/backend/node/" class="" aria-label="Node"><!--[--><!--]--> Node <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>小程序池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/miniprogram/wxmini" class="" aria-label="微信小程序"><!--[--><!--]--> 微信小程序 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/tech/miniprogram/uni-app/" class="" aria-label="uni-app"><!--[--><!--]--> uni-app <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>服务池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/tech/centos/" class="" aria-label="Centos"><!--[--><!--]--> Centos <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five本科课程"><span class="title">Five本科课程</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five本科课程"><span class="title">Five本科课程</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/home/course/operating_system/" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/computer_network/" class="" aria-label="计算机网络技术"><!--[--><!--]--> 计算机网络技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/home/course/datastructure_and_algorithm/" class="" aria-label="数据结构和算法"><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Five杂学"><span class="title">Five杂学</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Five杂学"><span class="title">Five杂学</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java池</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/home/trivia/spring/" class="" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/trivia/juc/" class="" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/trivia/netty/" class="" aria-label="Netty"><!--[--><!--]--> Netty <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/trivia/security/" class="" aria-label="Security"><!--[--><!--]--> Security <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/home/trivia/service/" class="" aria-label="Service"><!--[--><!--]--> Service <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/liushun-ing" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="monitoring" tabindex="-1"><a class="header-anchor" href="#monitoring" aria-hidden="true">#</a> Monitoring</h1><p>记录在测试服务器上部署promethues和grafana的控制面板的过程，<a href="https://geth.ethereum.org/docs/monitoring/dashboards" target="_blank" rel="noopener noreferrer">geth<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><h2 id="服务器环境" tabindex="-1"><a class="header-anchor" href="#服务器环境" aria-hidden="true">#</a> 服务器环境</h2><p>Amazon Linux 2023版本，工具用的也是yum，但和centos不一样。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@ip-172-31-23-171 ~<span class="token punctuation">]</span><span class="token comment"># uname -a</span>
Linux ip-172-31-23-171.ec2.internal <span class="token number">6.1</span>.84-99.169.amzn2023.x86_64 <span class="token comment">#1 SMP PREEMPT_DYNAMIC Mon Apr  8 19:19:48 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="docker知识" tabindex="-1"><a class="header-anchor" href="#docker知识" aria-hidden="true">#</a> docker知识</h2><p>在 Docker 中，挂载数据卷（Volumes）和后挂载（Bind Mounts）都是将主机文件系统和容器文件系统关联的方式，但它们有以下区别：</p><p><strong>1. 数据卷 (Volume)</strong></p><p>数据卷是 Docker 管理的独立存储区，它们可以在多个容器之间共享和重用。通常情况下，数据卷由 Docker 管理，并且存储在 Docker 的内部文件系统中（例如 /var/lib/docker/volumes/）。</p><p><strong>特点</strong>：</p><ul><li>由 Docker 管理，因此独立于容器生命周期（容器删除后卷仍然保留）。</li><li>提供一致的存储路径（由 Docker 控制，避免了直接访问宿主机的路径）。</li><li>支持容器之间的数据共享：可以轻松地在多个容器间共享数据。</li><li>适合持久化容器数据，比如数据库文件、日志数据等。</li><li>具备额外的功能支持，比如备份、恢复、加密等。</li></ul><p><strong>创建和挂载数据卷</strong>：</p><p>通过 docker volume create 来创建独立的数据卷。</p><p>使用 docker run -v volume_name:/container_path 挂载到容器指定路径。</p><p>示例：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> volume create my_volume
<span class="token function">docker</span> run <span class="token parameter variable">-v</span> my_volume:/app/data my_image
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. 后挂载 (Bind Mount)</strong></p><p>后挂载是直接将宿主机的指定目录或文件挂载到容器的指定目录。这种方式更为灵活，但不受 Docker 管理，宿主机路径需要手动管理和指定。</p><p><strong>特点</strong>：</p><ul><li>不受 Docker 控制，直接访问宿主机文件系统的路径。</li><li>容器销毁后挂载的文件夹/文件依然存在。</li><li>适合需要容器实时访问宿主机数据的情况，比如调试、开发环境等。</li><li>更加灵活，可以挂载主机上的任意文件或目录。</li></ul><p><strong>创建和挂载后挂载</strong>：</p><p>使用 docker run -v /host/path:/container_path 挂载主机路径到容器。</p><p>示例：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-v</span> /host/data:/app/data my_image
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>对比总结</strong></p><p><strong>特点</strong> <strong>数据卷 (Volume)</strong> <strong>后挂载 (Bind Mount)</strong></p><p>存储位置 由 Docker 管理（默认在 /var/lib/docker/volumes） 任何宿主机指定路径</p><p>容器共享数据 支持容器之间共享 支持，但路径管理复杂</p><p>数据持久性 持久化，容器删除不会影响数据 取决于宿主机路径是否删除</p><p>数据一致性和隔离 Docker 管理更为一致和隔离性强 直接访问宿主机路径，灵活但隔离性较差</p><p>使用场景 数据持久化需求（如数据库、日志等） 需要直接访问宿主机文件（如开发、调试等）</p><p>总结来说，<strong>数据卷更适合持久化应用数据</strong>，而 <strong>后挂载更适合临时数据访问或需要实时同步主机数据的场景</strong>。</p><h2 id="开放geth-metrics" tabindex="-1"><a class="header-anchor" href="#开放geth-metrics" aria-hidden="true">#</a> 开放geth metrics</h2><p>只需要在启动的时候加上开启参数就行，可以看<a href="https://geth.ethereum.org/docs/monitoring/metrics" target="_blank" rel="noopener noreferrer">文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">nohup</span> ./geth-linux <span class="token parameter variable">--config</span> ./config.toml <span class="token parameter variable">--datadir</span> ./node <span class="token parameter variable">--cache</span> <span class="token number">8000</span> <span class="token parameter variable">--history.transactions</span><span class="token operator">=</span><span class="token number">90000</span> <span class="token parameter variable">--syncmode</span><span class="token operator">=</span>full <span class="token parameter variable">--db.engine</span><span class="token operator">=</span>pebble --tries-verify-mode<span class="token operator">=</span>none <span class="token parameter variable">--http</span> <span class="token parameter variable">--http.port</span> <span class="token number">80</span> <span class="token parameter variable">--ws</span> <span class="token parameter variable">--metrics</span> <span class="token parameter variable">--metrics.expensive</span> <span class="token parameter variable">--metrics.addr</span> <span class="token number">0.0</span>.0.0 <span class="token parameter variable">--metrics.port</span> <span class="token number">6060</span> <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="安装docker" tabindex="-1"><a class="header-anchor" href="#安装docker" aria-hidden="true">#</a> 安装docker</h2><p>要在 6.1.84-99.169.amzn2023.x86_64 服务器上安装 Docker，请按照以下步骤操作。此服务器可能运行的是 Amazon Linux 2023，以下步骤将基于此系统环境进行。</p><p><strong>1、更新软件包和系统</strong>：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">sudo</span> yum update <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>2、安装 Docker</strong>：</p><p>Amazon Linux 提供了 Docker 的软件包，可以直接使用 yum 来安装 Docker。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><img src="/home/assets/yumdocker-982d2f31.png" alt="screenshot2024-11-06 10.50.49" style="zoom:50%;"><p><strong>3、启动 Docker 并将其设置为开机启动</strong>：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl start <span class="token function">docker</span>
<span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/home/assets/dockerstart-ec3183fd.png" alt="screenshot2024-11-06 10.52.12"></p><p><strong>4、验证 Docker 安装</strong>：</p><p>检查 Docker 的版本，确保安装成功：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token parameter variable">--version</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><img src="/home/assets/dockerversion-214bc096.png" alt="screenshot2024-11-06 10.52.50" style="zoom:67%;"><p><strong>5、配置权限（可选）</strong>：</p><p>将当前用户添加到 docker 组中，以便无需 sudo 即可运行 Docker 命令：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">usermod</span> <span class="token parameter variable">-aG</span> <span class="token function">docker</span> <span class="token environment constant">$USER</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>更改后需要重新登录才能生效。</p><img src="/home/assets/dockerinfo-a33dcc26.png" alt="screenshot2024-11-06 10.56.31" style="zoom:67%;"><h2 id="安装promethues" tabindex="-1"><a class="header-anchor" href="#安装promethues" aria-hidden="true">#</a> 安装promethues</h2><p>先准备启动prometheus需要的配置文件。需要准备两个文件：<code>prometheus.yml</code>和<code>record.geth.rules.yml</code></p><p><code>prometheus.yml</code>配置如下：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">global</span><span class="token punctuation">:</span>
  <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 10s
  <span class="token key atrule">evaluation_interval</span><span class="token punctuation">:</span> 10s

<span class="token comment"># Load and evaluate rules in this file every &#39;evaluation_interval&#39; seconds.</span>
<span class="token key atrule">rule_files</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&#39;record.geth.rules.yml&#39;</span>

<span class="token comment"># A scrape configuration containing exactly one endpoint to scrape.</span>
<span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> <span class="token string">&#39;bsc-dev&#39;</span>
    <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 10s
    <span class="token key atrule">metrics_path</span><span class="token punctuation">:</span> /debug/metrics/prometheus
    <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> 34.226.211.254<span class="token punctuation">:</span><span class="token number">6060</span>
        <span class="token key atrule">labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">chain</span><span class="token punctuation">:</span> bsc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>record.geth.rules.yml</code>配置如下：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">groups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> geth_custom_rules
    <span class="token key atrule">rules</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">record</span><span class="token punctuation">:</span> geth_rpc_requests_success
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> label_replace(<span class="token punctuation">{</span>__name__=~&quot;rpc_duration_.<span class="token important">*_success&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;method&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;$1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;__name__&quot;</span><span class="token punctuation">,</span> &quot;rpc_duration_(.+)_success&quot;)
      <span class="token punctuation">-</span> <span class="token key atrule">record</span><span class="token punctuation">:</span> geth_rpc_requests_failure
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> label_replace(<span class="token punctuation">{</span>__name__=~&quot;rpc_duration_.<span class="token important">*_failure&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;method&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;$1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;__name__&quot;</span><span class="token punctuation">,</span> &quot;rpc_duration_(.+)_failure&quot;)
      <span class="token punctuation">-</span> <span class="token key atrule">record</span><span class="token punctuation">:</span> geth_rpc_requests_success_count
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> label_replace(<span class="token punctuation">{</span>__name__=~&quot;rpc_duration_.<span class="token important">*_success_count&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;method&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;$1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;__name__&quot;</span><span class="token punctuation">,</span> &quot;rpc_duration_(.+)_success_count&quot;)
      <span class="token punctuation">-</span> <span class="token key atrule">record</span><span class="token punctuation">:</span> geth_rpc_requests_failure_count
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> label_replace(<span class="token punctuation">{</span>__name__=~&quot;rpc_duration_.<span class="token important">*_failure_count&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;method&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;$1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;__name__&quot;</span><span class="token punctuation">,</span> &quot;rpc_duration_(.+)_failure_count&quot;)
      <span class="token punctuation">-</span> <span class="token key atrule">record</span><span class="token punctuation">:</span> rpc_count
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> label_replace(<span class="token punctuation">{</span>__name__=~&quot;rpc_count_.<span class="token important">*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;method&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;$1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;__name__&quot;</span><span class="token punctuation">,</span> &quot;rpc_count_(.+)&quot;)
      <span class="token punctuation">-</span> <span class="token key atrule">record</span><span class="token punctuation">:</span> geth_rpc_success
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> label_replace(<span class="token punctuation">{</span>__name__=~&quot;rpc_success_.<span class="token important">*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;method&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;$1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;__name__&quot;</span><span class="token punctuation">,</span> &quot;rpc_success_(.+)&quot;)
      <span class="token punctuation">-</span> <span class="token key atrule">record</span><span class="token punctuation">:</span> geth_rpc_failure
        <span class="token key atrule">expr</span><span class="token punctuation">:</span> label_replace(<span class="token punctuation">{</span>__name__=~&quot;rpc_failure_.<span class="token important">*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;method&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;$1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;__name__&quot;</span><span class="token punctuation">,</span> &quot;rpc_failure_(.+)&quot;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个文件的作用是设置一些修改规则，因为geth暴露的metrics是没有标签的，比如最后的rpc_count，表示每个rpc接口的请求次数，按道理来说这个metrics里面应该有一个label来表示统计的是那个rpc接口，如：<code>rpc_count{method=&quot;eth_call&quot;}</code>，但实际上，他是将每个方法都看成了一个独立的metrics，如：<code>rpc_count_eth_call{}</code>。所以为了方便展示，需要将这些数据进行修改。</p><p>这里的含义是匹配所有<code>rpc_count_</code>开头的metrics，然后将他后面的api提取出来，作为一个method标签，然后重新构成为一个<code>rpc_count{method=}</code>的metrics.</p><p>具体的修改规则定义可以看<a href="https://prometheus.io/docs/prometheus/latest/configuration/recording_rules/" target="_blank" rel="noopener noreferrer">文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://prometheus.io/docs/prometheus/latest/installation/" target="_blank" rel="noopener noreferrer">docker启动prometheus<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>直接启动即可，他会自动去拉取，也可以使用docker pull先拉取，然后在启动</p><p>记得加-d让他后台运行</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">-p</span> <span class="token number">9090</span>:9090 <span class="token punctuation">\</span>
    <span class="token parameter variable">-v</span> /root/monitor/prometheus:/etc/prometheus <span class="token punctuation">\</span>
    prom/prometheus:latest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>不加-d可以看到他的启动日志</p><p><img src="/home/assets/dockerrun-d4dbf8a0.png" alt="screenshot2024-11-06 11.42.10"></p><img src="/home/assets/prometheusdocker-e6a7e07f.png" alt="screenshot2024-11-06 11.34.26" style="zoom:50%;"><p>加上-d让他后台运行</p><img src="/home/assets/dockerrun_d-a8f96aec.png" alt="screenshot2024-11-06 11.43.16" style="zoom:67%;"><p>然后请求一个接口查看一下：</p><p><img src="/home/assets/prometheustest-773155c9.png" alt="screenshot2024-11-06 13.38.20"></p><p>说明服务一起启动成功，如果开放了服务器端口，可以直接浏览器请求即可。</p><img src="/home/assets/prometheuspage-69c28f4c.png" alt="screenshot2024-11-06 13.58.21" style="zoom:33%;"><p>为了持久化数据，而不是在容器删除后，换个容器，数据就抹除，需要使用数据挂载。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> volume create prometheus-data
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span><span class="token operator">=</span>prometheus <span class="token punctuation">\</span>
    <span class="token parameter variable">-p</span> <span class="token number">9090</span>:9090 <span class="token punctuation">\</span>
    <span class="token parameter variable">-v</span> /root/monitor/prometheus:/etc/prometheus <span class="token punctuation">\</span>
    <span class="token parameter variable">-v</span> prometheus-data:/prometheus <span class="token punctuation">\</span>
    prom/prometheus:latest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/home/assets/dockerdataprometheus-dc348dd4.png" alt="screenshot2024-11-06 14.17.44" style="zoom:50%;"><p>接下来就可以去安装配置面板了。</p><h2 id="安装grafana" tabindex="-1"><a class="header-anchor" href="#安装grafana" aria-hidden="true">#</a> 安装grafana</h2><p><a href="https://grafana.com/grafana/download?platform=docker" target="_blank" rel="noopener noreferrer">官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>,这个<a href="https://grafana.com/docs/grafana/latest/setup-grafana/installation/docker/" target="_blank" rel="noopener noreferrer">更好<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span><span class="token operator">=</span>grafana <span class="token parameter variable">-p</span> <span class="token number">3000</span>:3000 grafana/grafana-enterprise
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><img src="/home/assets/grafanarun-8cd3426d.png" alt="screenshot2024-11-06 13.43.22" style="zoom:50%;"><p>查看grafana的运行情况</p><img src="/home/assets/dockerportgrafana-9abd3ea8.png" alt="screenshot2024-11-06 13.44.36" style="zoom:67%;"><p>然后访问3000端口，就可以进入grafana的页面了，账号密码都是admin。</p><img src="/home/assets/grafanapage-9b30d29b.png" alt="screenshot2024-11-06 13.57.39" style="zoom:33%;"><p>同样的，也需要数据持久化。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># create a persistent volume for your data</span>
<span class="token function">docker</span> volume create grafana-storage

<span class="token comment"># verify that the volume was created correctly</span>
<span class="token comment"># you should see some JSON output</span>
<span class="token function">docker</span> volume inspect grafana-storage

<span class="token comment"># start grafana</span>
<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">3000</span>:3000 <span class="token parameter variable">--name</span><span class="token operator">=</span>grafana <span class="token punctuation">\</span>
  <span class="token parameter variable">--volume</span> grafana-storage:/var/lib/grafana <span class="token punctuation">\</span>
  grafana/grafana-enterprise
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="/home/assets/grafanavolume-560b73b8.png" alt="screenshot2024-11-06 14.22.01" style="zoom:50%;"><p>接下来就可以去配置面板了。</p><h2 id="配置面板" tabindex="-1"><a class="header-anchor" href="#配置面板" aria-hidden="true">#</a> 配置面板</h2><img src="/home/assets/grafana1-2c5de099.png" alt="screenshot2024-11-06 14.29.20" style="zoom:25%;"><p>选择右下角的<code>Add your first data source</code></p><img src="/home/assets/grafana2-af45a477.png" alt="screenshot2024-11-06 14.30.10" style="zoom:25%;"><p>然后选择prometheus</p><img src="/home/assets/grafana3-712bf435.png" alt="screenshot2024-11-06 14.30.48" style="zoom:25%;"><p>然后就是配置各项信息。</p><img src="/home/assets/datasourcename-2938a9f2.png" alt="screenshot2024-11-06 15.15.05" style="zoom:33%;"><p>这里不能填localhost，和prometheus的配置一样，因为这个是在容器中运行的，用的网络和不互通，所以必须要指定ip，不然需要去<a href="https://liushun-ing.github.io/home/master/prometheus/intro.html#node-exporter" target="_blank" rel="noopener noreferrer">配置docker的网络<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><img src="/home/assets/datasourceconnection-2f7e35c6.png" alt="screenshot2024-11-06 15.15.28" style="zoom:33%;"><p>然后这里可以使用<code>docker container logs prometheus</code>去看启动日志查看版本。</p><img src="/home/assets/datasourceperformance-6de428e4.png" alt="screenshot2024-11-06 15.18.35" style="zoom:33%;"><p>其他没啥需要配置的。</p><p>然后就可以去dashboards去创建一个控制面板了，可以直接导入<a href="https://grafana.com/grafana/dashboards/18463-go-ethereum-by-instance/" target="_blank" rel="noopener noreferrer">这个<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，然后选择刚刚配置好的数据源，就可以看到如下：<strong>完美！！！</strong></p><p><img src="/home/assets/dashboards-cb79204b.png" alt="screenshot2024-11-06 15.21.14"></p><h2 id="docker-compose" tabindex="-1"><a class="header-anchor" href="#docker-compose" aria-hidden="true">#</a> docker compose</h2><p>上面是服务配置有两个，需要启动两个服务，我们可以写一个配置文件，然后使用<code>docker compose</code>一键式配置和启动。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token string">&quot;https://github.com/docker/compose/releases/latest/download/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">)</span></span>&quot;</span> <span class="token parameter variable">-o</span> /usr/local/bin/docker-compose
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="/home/assets/dockercompose-f01fc92f.png" alt="screenshot2024-11-06 15.39.43"></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 设置执行权限</span>
<span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose

<span class="token punctuation">[</span>root@ip-172-31-23-171 ~<span class="token punctuation">]</span><span class="token comment"># docker-compose --version</span>
Docker Compose version v2.30.2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>到这就安装成功啦。</p><p>因为使用的是官方镜像（prom/prometheus 和 grafana/grafana-enterprise），可以直接在 docker-compose.yml 中引用这些镜像，无需额外的 Dockerfile。如果需要构造自己的镜像，就需要自己写DockerFile文件来构造镜像文件了。</p><p>创建<strong>docker-compose.yml</strong>，docker compose就是根据这个文件去启动应用的。</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">prometheus</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> prom/prometheus<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> prometheus
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;9090:9090&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./prometheus<span class="token punctuation">:</span>/etc/prometheus       <span class="token comment"># 配置文件挂载</span>
      <span class="token punctuation">-</span> prometheus<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/prometheus        <span class="token comment"># 数据卷</span>

  <span class="token key atrule">grafana</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> grafana/grafana<span class="token punctuation">-</span>enterprise
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> grafana
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;3000:3000&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> grafana<span class="token punctuation">-</span>storage<span class="token punctuation">:</span>/var/lib/grafana   <span class="token comment"># 数据卷</span>

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">prometheus-data</span><span class="token punctuation">:</span>
  <span class="token key atrule">grafana-storage</span><span class="token punctuation">:</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后在配置文件所在的目录执行一下命令即可。</p><blockquote><p>注意：Docker Compose 无法找到用 docker run 创建的容器，这是因为 Docker Compose 仅管理它自己启动和定义的容器。它会根据 docker-compose.yml 文件来识别和管理服务，<strong>不直接管理</strong>通过 docker run 命令启动的容器，即使它们使用了相同的镜像或相同的名称。</p><p>所以在使用docker-compose之前，记得先把docker直接启动的容器停止并删了,还有数据卷也记得删了。</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
<span class="token comment"># 运行完毕后，可以通过以下命令来检查容器状态</span>
<span class="token function">docker-compose</span> <span class="token function">ps</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/home/assets/docker-composeup-e6a17572.png" alt="screenshot2024-11-06 16.01.17"></p><blockquote><p><strong>一些常用命令</strong></p></blockquote><p>这条命令会启动所有定义在 <code>docker-compose.yml</code> 文件中的服务，如果容器已经在运行，Docker Compose 会<strong>确认其状态</strong>，而不会重复启动。</p><p><code> docker-compose restart</code> <strong>命令</strong>：这会<strong>重新启动</strong>所有定义在 <code>docker-compose.yml</code> 文件中的容器，先停止再启动它们。</p><p><code>docker-compose restart prometheus</code> 命令：这样只会重启该服务，而不会影响其他容器。</p><p><code>docker-compose down</code> 停止所有服务,会把container删了，但数据卷不会受影响：</p><p><strong>注意</strong>：使用 down 命令时，如果添加了 -v 参数（如 <code>docker-compose down -v</code>），会删除所有未使用的数据卷。确保不要在无备份的情况下误加 -v 参数。</p><p><strong>选择适合的方式</strong></p><p>​ • <strong>简单重启</strong>：<code>docker-compose restart</code> 或 <code>docker-compose up -d</code></p><p>​ • <strong>完整停用再启动</strong>：<code>docker-compose down &amp;&amp; docker-compose up -d</code></p><p><code>docker volume ls</code>：查看所有数据卷</p><p>日志相关：</p><p>运行以下命令可以查看所有容器的实时日志输出：</p><p><code>docker-compose logs -f</code></p><ul><li>-f 或 --follow：表示“跟随模式”，会实时输出新日志，就像使用 tail -f。</li><li>这将显示所有服务的日志，并实时更新。</li></ul><p>如果只想查看某个服务的日志，可以在命令后指定服务名称。例如，要查看 prometheus 服务的日志：</p><p><code>docker-compose logs -f prometheus</code></p><p>如果只想查看最近的几行日志，可以使用 --tail 选项。例如，要查看 grafana 服务的最近 100 行日志：</p><p><code>docker-compose logs --tail=100 grafana</code></p><h2 id="脚本" tabindex="-1"><a class="header-anchor" href="#脚本" aria-hidden="true">#</a> 脚本</h2><p>写了一个脚本，chatGPT就是好用</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token comment"># Color functions for output</span>
<span class="token function-name function">color_text</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;<span class="token entity" title="\033">\033</span>[<span class="token variable">$1m</span><span class="token variable">$2</span><span class="token entity" title="\033">\033</span>[0m&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token function-name function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> color_text <span class="token string">&quot;0;34&quot;</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>    <span class="token comment"># Blue</span>
<span class="token function-name function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> color_text <span class="token string">&quot;0;32&quot;</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment"># Green</span>
<span class="token function-name function">warning</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> color_text <span class="token string">&quot;0;33&quot;</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment"># Yellow</span>
<span class="token function-name function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> color_text <span class="token string">&quot;0;31&quot;</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>   <span class="token comment"># Red</span>

<span class="token comment"># Exit on error</span>
<span class="token function-name function">error_exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  error <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token comment"># Display help message</span>
<span class="token function-name function">usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Usage: <span class="token variable">$0</span> -c &lt;chain-name&gt;&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Options:&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;  -c &lt;chain-name&gt;   Specify the blockchain to monitor (e.g., bsc, eth)&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;  -h                Display this help message&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment"># List of valid chain names</span>
<span class="token assign-left variable">VALID_CHAINS</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;bsc&quot;</span> <span class="token string">&quot;eth&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># Check for required parameters</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$#</span>&quot;</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  usage
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token comment"># Only allow -c or -h as valid options</span>
<span class="token keyword">while</span> <span class="token builtin class-name">getopts</span> <span class="token string">&quot;:c:h&quot;</span> opt<span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token keyword">case</span> <span class="token variable">${opt}</span> <span class="token keyword">in</span>
    c<span class="token punctuation">)</span>
      <span class="token assign-left variable">CHAIN_NAME</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${OPTARG}</span>&quot;</span>
      <span class="token punctuation">;</span><span class="token punctuation">;</span>
    h<span class="token punctuation">)</span>
      usage
      <span class="token builtin class-name">exit</span> <span class="token number">0</span>
      <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token punctuation">\</span>?<span class="token punctuation">)</span>
      error_exit <span class="token string">&quot;Invalid option: -<span class="token variable">$OPTARG</span>. Use -h for help.&quot;</span>
      <span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token keyword">esac</span>
<span class="token keyword">done</span>

<span class="token comment"># Shift away parsed options, check for any extra arguments</span>
<span class="token builtin class-name">shift</span> <span class="token variable"><span class="token variable">$((</span>OPTIND <span class="token operator">-</span><span class="token number">1</span><span class="token variable">))</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$#</span>&quot;</span> <span class="token parameter variable">-ne</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  error_exit <span class="token string">&quot;Unexpected argument(s): <span class="token variable">$*</span>. Only -c and -h options are allowed.&quot;</span>
<span class="token keyword">fi</span>

<span class="token comment"># Ensure chain name is provided and is valid</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">&quot;<span class="token variable">$CHAIN_NAME</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  error_exit <span class="token string">&quot;Error: Chain name must be specified with -c.&quot;</span>
<span class="token keyword">fi</span>

<span class="token comment"># Validate chain name</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token string">&quot; <span class="token variable">${VALID_CHAINS<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span> &quot;</span> <span class="token operator">=~</span> <span class="token string">&quot; <span class="token variable">${CHAIN_NAME}</span> &quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  error_exit <span class="token string">&quot;Error: Invalid chain name &#39;<span class="token variable">$CHAIN_NAME</span>&#39;. Valid options are: <span class="token variable">${VALID_CHAINS<span class="token punctuation">[</span>*<span class="token punctuation">]</span>}</span>.&quot;</span>
<span class="token keyword">fi</span>

<span class="token comment"># Docker installation check</span>
<span class="token keyword">if</span> <span class="token operator">!</span> <span class="token builtin class-name">command</span> <span class="token parameter variable">-v</span> <span class="token function">docker</span> <span class="token operator">&amp;&gt;</span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
  info <span class="token string">&quot;Installing Docker...&quot;</span>
  <span class="token function">sudo</span> yum update <span class="token parameter variable">-y</span>
  <span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">docker</span>
  <span class="token function">sudo</span> systemctl start <span class="token function">docker</span>
  <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span>
  <span class="token function">sudo</span> <span class="token function">usermod</span> <span class="token parameter variable">-aG</span> <span class="token function">docker</span> <span class="token string">&quot;<span class="token environment constant">$USER</span>&quot;</span>
<span class="token keyword">else</span>
  success <span class="token string">&quot;Docker is already installed&quot;</span>
<span class="token keyword">fi</span>

<span class="token comment"># Docker Compose installation check</span>
<span class="token keyword">if</span> <span class="token operator">!</span> <span class="token builtin class-name">command</span> <span class="token parameter variable">-v</span> <span class="token function">docker-compose</span> <span class="token operator">&amp;&gt;</span> /dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span>
  info <span class="token string">&quot;Installing Docker Compose...&quot;</span>
  <span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token string">&quot;https://github.com/docker/compose/releases/latest/download/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">)</span></span>&quot;</span> <span class="token parameter variable">-o</span> /usr/local/bin/docker-compose
  <span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose
<span class="token keyword">else</span>
  success <span class="token string">&quot;Docker Compose is already installed&quot;</span>
<span class="token keyword">fi</span>

<span class="token comment"># Setup Prometheus and Grafana configuration files</span>
info <span class="token string">&quot;Setting up Prometheus and Grafana configuration for chain: <span class="token variable">$CHAIN_NAME</span>&quot;</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> monitor/prometheus
<span class="token builtin class-name">cd</span> monitor/prometheus <span class="token operator">||</span> <span class="token builtin class-name">exit</span>

<span class="token comment"># Get server IP address</span>
<span class="token assign-left variable">ipAddress</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token parameter variable">-s</span> ifconfig.me<span class="token variable">)</span></span>

<span class="token comment"># Write Prometheus configuration</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span>prometheus.yml <span class="token operator">&lt;&lt;</span><span class="token string">EOF
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - &#39;record.geth.rules.yml&#39;

scrape_configs:
  - job_name: &#39;<span class="token variable">$CHAIN_NAME</span>-dev&#39;
    scrape_interval: 15s
    metrics_path: /debug/metrics/prometheus
    static_configs:
      - targets:
        - <span class="token variable">$ipAddress</span>:6060
        labels:
          chain: <span class="token variable">$CHAIN_NAME</span>
EOF</span>

<span class="token comment"># Write Prometheus recording rules</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span>record.geth.rules.yml <span class="token operator">&lt;&lt;</span><span class="token string">EOF
groups:
  - name: geth_custom_rules
    rules:
      - record: geth_rpc_requests_success
        expr: label_replace({__name__=~&quot;rpc_duration_.*_success&quot;}, &quot;method&quot;, &quot;\<span class="token variable">$1</span>&quot;, &quot;__name__&quot;, &quot;rpc_duration_(.+)_success&quot;)
      - record: geth_rpc_requests_failure
        expr: label_replace({__name__=~&quot;rpc_duration_.*_failure&quot;}, &quot;method&quot;, &quot;\<span class="token variable">$1</span>&quot;, &quot;__name__&quot;, &quot;rpc_duration_(.+)_failure&quot;)
      - record: geth_rpc_requests_success_count
        expr: label_replace({__name__=~&quot;rpc_duration_.*_success_count&quot;}, &quot;method&quot;, &quot;\<span class="token variable">$1</span>&quot;, &quot;__name__&quot;, &quot;rpc_duration_(.+)_success_count&quot;)
      - record: geth_rpc_requests_failure_count
        expr: label_replace({__name__=~&quot;rpc_duration_.*_failure_count&quot;}, &quot;method&quot;, &quot;\<span class="token variable">$1</span>&quot;, &quot;__name__&quot;, &quot;rpc_duration_(.+)_failure_count&quot;)
      - record: rpc_count
        expr: label_replace({__name__=~&quot;rpc_count_.*&quot;}, &quot;method&quot;, &quot;\<span class="token variable">$1</span>&quot;, &quot;__name__&quot;, &quot;rpc_count_(.+)&quot;)
      - record: geth_rpc_success
        expr: label_replace({__name__=~&quot;rpc_success_.*&quot;}, &quot;method&quot;, &quot;\<span class="token variable">$1</span>&quot;, &quot;__name__&quot;, &quot;rpc_success_(.+)&quot;)
      - record: geth_rpc_failure
        expr: label_replace({__name__=~&quot;rpc_failure_.*&quot;}, &quot;method&quot;, &quot;\<span class="token variable">$1</span>&quot;, &quot;__name__&quot;, &quot;rpc_failure_(.+)&quot;)
EOF</span>

<span class="token comment"># Create Docker Compose file for Prometheus and Grafana</span>
<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span>docker-compose.yml <span class="token operator">&lt;&lt;</span><span class="token string">EOF
services:
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    ports:
      - &quot;9090:9090&quot;
    volumes:
      - ./prometheus:/etc/prometheus
      - prometheus-data:/prometheus

  grafana:
    image: grafana/grafana-enterprise
    container_name: grafana
    ports:
      - &quot;3000:3000&quot;
    volumes:
      - grafana-storage:/var/lib/grafana

volumes:
  prometheus-data:
  grafana-storage:
EOF</span>

<span class="token comment"># Start Prometheus and Grafana</span>
info <span class="token string">&quot;Starting Prometheus and Grafana containers...&quot;</span>
<span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>

<span class="token comment"># Final status message</span>
success <span class="token string">&quot;Setup complete. Prometheus is running on port 9090 and Grafana on port 3000.&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在新的服务器上跑的结果。</p><p><img src="/home/assets/shellstart-2869460a.png" alt="screenshot2024-11-06 17.51.29"></p><h2 id="geth增加新指标" tabindex="-1"><a class="header-anchor" href="#geth增加新指标" aria-hidden="true">#</a> geth增加新指标</h2><h3 id="system-metrics" tabindex="-1"><a class="header-anchor" href="#system-metrics" aria-hidden="true">#</a> system metrics</h3><p>go语言的监测库-<a href="https://github.com/shirou/gopsutil" target="_blank" rel="noopener noreferrer">gopsutil<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">package</span> metrics

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;github.com/ethereum/go-ethereum/log&quot;</span>
    cpuv4 <span class="token string">&quot;github.com/shirou/gopsutil/v4/cpu&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// ReadScutumCPUStats retrieves the current CPU stats.</span>
<span class="token keyword">func</span> <span class="token function">ReadScutumCPUStats</span><span class="token punctuation">(</span>stats <span class="token operator">*</span>CPUStats<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// passing false to request all cpu times</span>
    timeStats<span class="token punctuation">,</span> err <span class="token operator">:=</span> cpuv4<span class="token punctuation">.</span><span class="token function">Times</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
       log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Could not read cpu stats&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;err&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
       <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>timeStats<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
       log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Empty cpu stats&quot;</span><span class="token punctuation">)</span>
       <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// requesting all cpu times will always return an array with only one time stats entry</span>
    timeStat <span class="token operator">:=</span> timeStats<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    stats<span class="token punctuation">.</span>GlobalTime <span class="token operator">=</span> timeStat<span class="token punctuation">.</span>User <span class="token operator">+</span> timeStat<span class="token punctuation">.</span>Nice <span class="token operator">+</span> timeStat<span class="token punctuation">.</span>System
    stats<span class="token punctuation">.</span>GlobalWait <span class="token operator">=</span> timeStat<span class="token punctuation">.</span>Iowait
    stats<span class="token punctuation">.</span>LocalTime <span class="token operator">=</span> <span class="token function">getProcessCPUTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">package</span> metrics

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;github.com/shirou/gopsutil/v4/disk&quot;</span>
    <span class="token string">&quot;github.com/shirou/gopsutil/v4/mem&quot;</span>
    <span class="token string">&quot;github.com/shirou/gopsutil/v4/process&quot;</span>
    <span class="token string">&quot;os&quot;</span>
    <span class="token string">&quot;os/exec&quot;</span>
    <span class="token string">&quot;runtime/metrics&quot;</span>
    <span class="token string">&quot;runtime/pprof&quot;</span>
    <span class="token string">&quot;strconv&quot;</span>
    <span class="token string">&quot;strings&quot;</span>
    <span class="token string">&quot;syscall&quot;</span>
    <span class="token string">&quot;time&quot;</span>

    <span class="token string">&quot;github.com/ethereum/go-ethereum/log&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> runtimeStats <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    GCPauses     <span class="token operator">*</span>metrics<span class="token punctuation">.</span>Float64Histogram
    GCAllocBytes <span class="token builtin">uint64</span>
    GCFreedBytes <span class="token builtin">uint64</span>

    MemTotal     <span class="token builtin">uint64</span>
    HeapObjects  <span class="token builtin">uint64</span>
    HeapFree     <span class="token builtin">uint64</span>
    HeapReleased <span class="token builtin">uint64</span>
    HeapUnused   <span class="token builtin">uint64</span>

    Goroutines   <span class="token builtin">uint64</span>
    SchedLatency <span class="token operator">*</span>metrics<span class="token punctuation">.</span>Float64Histogram
<span class="token punctuation">}</span>

<span class="token keyword">var</span> runtimeSamples <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>metrics<span class="token punctuation">.</span>Sample<span class="token punctuation">{</span>
    <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;/gc/pauses:seconds&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// histogram</span>
    <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;/gc/heap/allocs:bytes&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;/gc/heap/frees:bytes&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;/memory/classes/total:bytes&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;/memory/classes/heap/objects:bytes&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;/memory/classes/heap/free:bytes&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;/memory/classes/heap/released:bytes&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;/memory/classes/heap/unused:bytes&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;/sched/goroutines:goroutines&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;/sched/latencies:seconds&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// histogram</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">ReadRuntimeStats</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>runtimeStats <span class="token punctuation">{</span>
    r <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>runtimeStats<span class="token punctuation">)</span>
    <span class="token function">readRuntimeStats</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
    <span class="token keyword">return</span> r
<span class="token punctuation">}</span>

<span class="token comment">// CollectSystemMetrics 使用 gopsutil 收集系统信息：cpu, disk and memory.</span>
<span class="token keyword">func</span> <span class="token function">CollectSystemMetrics</span><span class="token punctuation">(</span>refresh time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Create the various data collectors</span>
    <span class="token keyword">var</span> <span class="token punctuation">(</span>
       cpustats  <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>CPUStats<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
       diskstats <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>ScutumDiskStats<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
       rstats    <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>runtimeStats<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token comment">// Define the various metrics to collect</span>
    <span class="token keyword">var</span> <span class="token punctuation">(</span>
       cpuSysLoad       <span class="token operator">=</span> <span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/cpu/sysload&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
       cpuSysWait       <span class="token operator">=</span> <span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/cpu/syswait&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
       cpuProcLoad      <span class="token operator">=</span> <span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/cpu/procload&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
       cpuSysLoadTotal  <span class="token operator">=</span> <span class="token function">GetOrRegisterCounterFloat64</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/cpu/sysload/total&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
       cpuSysWaitTotal  <span class="token operator">=</span> <span class="token function">GetOrRegisterCounterFloat64</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/cpu/syswait/total&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
       cpuProcLoadTotal <span class="token operator">=</span> <span class="token function">GetOrRegisterCounterFloat64</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/cpu/procload/total&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
       cpuThreads       <span class="token operator">=</span> <span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/cpu/threads&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
       cpuGoroutines    <span class="token operator">=</span> <span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/cpu/goroutines&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>

       memTotal     <span class="token operator">=</span> <span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/memory/total&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
       memFree      <span class="token operator">=</span> <span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/memory/free&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
       memAvailable <span class="token operator">=</span> <span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/memory/available&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
       memUsed      <span class="token operator">=</span> <span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/memory/used&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
       memGethUsed  <span class="token operator">=</span> <span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/memory/gethused&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>

       diskReadCounter  <span class="token operator">=</span> <span class="token function">GetOrRegisterCounter</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/disk/readcount&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
       diskWriteCounter <span class="token operator">=</span> <span class="token function">GetOrRegisterCounter</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/disk/writecount&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
       readBytes        <span class="token operator">=</span> <span class="token function">GetOrRegisterCounter</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/disk/readbytes&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
       writeBytes       <span class="token operator">=</span> <span class="token function">GetOrRegisterCounter</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/disk/writebytes&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token comment">// 使用 pgrep 查找进程名为 geth-linux 的进程 PID</span>
    cmd <span class="token operator">:=</span> exec<span class="token punctuation">.</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token string">&quot;pgrep&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;geth-linux&quot;</span><span class="token punctuation">)</span>
    output<span class="token punctuation">,</span> err <span class="token operator">:=</span> cmd<span class="token punctuation">.</span><span class="token function">Output</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
       fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;未找到进程或发生错误:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
       <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 去除输出中的换行符</span>
    pidStr <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">TrimSpace</span><span class="token punctuation">(</span><span class="token function">string</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span>
    pid<span class="token punctuation">,</span> err <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>pidStr<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
       fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;geth-linux 进程 pid 解析失败&quot;</span><span class="token punctuation">)</span>
       <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;geth-linux 进程的 PID 是: %v\n&quot;</span><span class="token punctuation">,</span> pid<span class="token punctuation">)</span>

    <span class="token keyword">var</span> mountDirs <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
    gethProcess<span class="token punctuation">,</span> err <span class="token operator">:=</span> process<span class="token punctuation">.</span><span class="token function">NewProcess</span><span class="token punctuation">(</span><span class="token function">int32</span><span class="token punctuation">(</span>pid<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
       gethProcess <span class="token operator">=</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 获取进程启动命令行</span>
    <span class="token keyword">if</span> gethProcess <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
       workingDir<span class="token punctuation">,</span> err <span class="token operator">:=</span> gethProcess<span class="token punctuation">.</span><span class="token function">Cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
          mountDirs <span class="token operator">=</span> <span class="token function">extractMountDir</span><span class="token punctuation">(</span>workingDir<span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">var</span> lastCollectTime time<span class="token punctuation">.</span>Time

    <span class="token comment">// Iterate loading the different stats and updating the meters.</span>
    now<span class="token punctuation">,</span> prev <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
    <span class="token keyword">for</span> <span class="token punctuation">;</span> <span class="token punctuation">;</span> now<span class="token punctuation">,</span> prev <span class="token operator">=</span> prev<span class="token punctuation">,</span> now <span class="token punctuation">{</span>
       <span class="token comment">// Gather CPU times.</span>
       <span class="token function">ReadScutumCPUStats</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cpustats<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">)</span>
       collectTime <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       secondsSinceLastCollect <span class="token operator">:=</span> collectTime<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>lastCollectTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Seconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       lastCollectTime <span class="token operator">=</span> collectTime
       <span class="token keyword">if</span> secondsSinceLastCollect <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
          sysLoad <span class="token operator">:=</span> cpustats<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>GlobalTime <span class="token operator">-</span> cpustats<span class="token punctuation">[</span>prev<span class="token punctuation">]</span><span class="token punctuation">.</span>GlobalTime
          sysWait <span class="token operator">:=</span> cpustats<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>GlobalWait <span class="token operator">-</span> cpustats<span class="token punctuation">[</span>prev<span class="token punctuation">]</span><span class="token punctuation">.</span>GlobalWait
          procLoad <span class="token operator">:=</span> cpustats<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>LocalTime <span class="token operator">-</span> cpustats<span class="token punctuation">[</span>prev<span class="token punctuation">]</span><span class="token punctuation">.</span>LocalTime
          <span class="token comment">// Convert to integer percentage.</span>
          cpuSysLoad<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>sysLoad <span class="token operator">/</span> secondsSinceLastCollect <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          cpuSysWait<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>sysWait <span class="token operator">/</span> secondsSinceLastCollect <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          cpuProcLoad<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>procLoad <span class="token operator">/</span> secondsSinceLastCollect <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token comment">// increment counters (ms)</span>
          cpuSysLoadTotal<span class="token punctuation">.</span><span class="token function">Inc</span><span class="token punctuation">(</span>sysLoad<span class="token punctuation">)</span>
          cpuSysWaitTotal<span class="token punctuation">.</span><span class="token function">Inc</span><span class="token punctuation">(</span>sysWait<span class="token punctuation">)</span>
          cpuProcLoadTotal<span class="token punctuation">.</span><span class="token function">Inc</span><span class="token punctuation">(</span>procLoad<span class="token punctuation">)</span>
       <span class="token punctuation">}</span>

       <span class="token comment">// Threads</span>
       <span class="token keyword">if</span> gethProcess <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
          threads<span class="token punctuation">,</span> err <span class="token operator">:=</span> gethProcess<span class="token punctuation">.</span><span class="token function">NumThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
             cpuThreads<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>threads<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          memoryInfo<span class="token punctuation">,</span> err <span class="token operator">:=</span> gethProcess<span class="token punctuation">.</span><span class="token function">MemoryInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
             memGethUsed<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>memoryInfo<span class="token punctuation">.</span>RSS<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>

       <span class="token comment">// Go runtime metrics</span>
       <span class="token function">readScutumRuntimeStats</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rstats<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">)</span>
       cpuGoroutines<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>rstats<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>Goroutines<span class="token punctuation">)</span><span class="token punctuation">)</span>

       virtualMemory<span class="token punctuation">,</span> err <span class="token operator">:=</span> mem<span class="token punctuation">.</span><span class="token function">VirtualMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
          memAvailable<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>virtualMemory<span class="token punctuation">.</span>Available<span class="token punctuation">)</span><span class="token punctuation">)</span>
          memFree<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>virtualMemory<span class="token punctuation">.</span>Free<span class="token punctuation">)</span><span class="token punctuation">)</span>
          memUsed<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>virtualMemory<span class="token punctuation">.</span>Used<span class="token punctuation">)</span><span class="token punctuation">)</span>
          memTotal<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>virtualMemory<span class="token punctuation">.</span>Total<span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>

       <span class="token comment">// Disk</span>
       <span class="token function">collectDiskMetrics</span><span class="token punctuation">(</span>mountDirs<span class="token punctuation">)</span>
       <span class="token keyword">if</span> <span class="token function">ReadScutumDiskStats</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>diskstats<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
          diskReadCounter<span class="token punctuation">.</span><span class="token function">Inc</span><span class="token punctuation">(</span>diskstats<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>ReadCount <span class="token operator">-</span> diskstats<span class="token punctuation">[</span>prev<span class="token punctuation">]</span><span class="token punctuation">.</span>ReadCount<span class="token punctuation">)</span>
          diskWriteCounter<span class="token punctuation">.</span><span class="token function">Inc</span><span class="token punctuation">(</span>diskstats<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>WriteCount <span class="token operator">-</span> diskstats<span class="token punctuation">[</span>prev<span class="token punctuation">]</span><span class="token punctuation">.</span>WriteCount<span class="token punctuation">)</span>
          readBytes<span class="token punctuation">.</span><span class="token function">Inc</span><span class="token punctuation">(</span>diskstats<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>ReadBytes <span class="token operator">-</span> diskstats<span class="token punctuation">[</span>prev<span class="token punctuation">]</span><span class="token punctuation">.</span>ReadBytes<span class="token punctuation">)</span>
          writeBytes<span class="token punctuation">.</span><span class="token function">Inc</span><span class="token punctuation">(</span>diskstats<span class="token punctuation">[</span>now<span class="token punctuation">]</span><span class="token punctuation">.</span>WriteBytes <span class="token operator">-</span> diskstats<span class="token punctuation">[</span>prev<span class="token punctuation">]</span><span class="token punctuation">.</span>WriteBytes<span class="token punctuation">)</span>
       <span class="token punctuation">}</span>

       time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>refresh<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">collectDiskMetrics</span><span class="token punctuation">(</span>mounts <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> mount <span class="token operator">:=</span> <span class="token keyword">range</span> mounts <span class="token punctuation">{</span>
       k <span class="token operator">:=</span> <span class="token string">&quot;&quot;</span>
       <span class="token keyword">if</span> mount <span class="token operator">==</span> <span class="token string">&quot;/&quot;</span> <span class="token punctuation">{</span>
          k <span class="token operator">=</span> <span class="token string">&quot;/bscdev&quot;</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> mount <span class="token operator">==</span> <span class="token string">&quot;/mnt&quot;</span> <span class="token punctuation">{</span>
          k <span class="token operator">=</span> <span class="token string">&quot;/ethdev&quot;</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>mount<span class="token punctuation">,</span> <span class="token string">&quot;/mnt&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          k <span class="token operator">=</span> mount<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">var</span> <span class="token punctuation">(</span>
          diskTotal <span class="token operator">=</span> <span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/disk&quot;</span><span class="token operator">+</span>k<span class="token operator">+</span><span class="token string">&quot;/total&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
          diskUsed  <span class="token operator">=</span> <span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/disk&quot;</span><span class="token operator">+</span>k<span class="token operator">+</span><span class="token string">&quot;/used&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
          diskFree  <span class="token operator">=</span> <span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span><span class="token string">&quot;scutum/system/disk&quot;</span><span class="token operator">+</span>k<span class="token operator">+</span><span class="token string">&quot;/free&quot;</span><span class="token punctuation">,</span> DefaultRegistry<span class="token punctuation">)</span>
       <span class="token punctuation">)</span>
       <span class="token comment">// Disk</span>
       diskUsage<span class="token punctuation">,</span> err <span class="token operator">:=</span> disk<span class="token punctuation">.</span><span class="token function">Usage</span><span class="token punctuation">(</span>mount<span class="token punctuation">)</span>
       <span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
          diskTotal<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>diskUsage<span class="token punctuation">.</span>Total<span class="token punctuation">)</span><span class="token punctuation">)</span>
          diskUsed<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>diskUsage<span class="token punctuation">.</span>Used<span class="token punctuation">)</span><span class="token punctuation">)</span>
          diskFree<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token function">int64</span><span class="token punctuation">(</span>diskUsage<span class="token punctuation">.</span>Free<span class="token punctuation">)</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">extractMountDir</span><span class="token punctuation">(</span>workingDir <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token punctuation">{</span>
    partitions<span class="token punctuation">,</span> err <span class="token operator">:=</span> disk<span class="token punctuation">.</span><span class="token function">Partitions</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> mounts <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> partition <span class="token operator">:=</span> <span class="token keyword">range</span> partitions <span class="token punctuation">{</span>
       <span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;/root/geth.fast&quot;</span><span class="token punctuation">,</span> workingDir<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// bsc dev</span>
          <span class="token keyword">if</span> partition<span class="token punctuation">.</span>Mountpoint <span class="token operator">==</span> <span class="token string">&quot;/&quot;</span> <span class="token punctuation">{</span>
             mounts <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>mounts<span class="token punctuation">,</span> partition<span class="token punctuation">.</span>Mountpoint<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;/mnt/data&quot;</span><span class="token punctuation">,</span> workingDir<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// eth dev</span>
          <span class="token keyword">if</span> partition<span class="token punctuation">.</span>Mountpoint <span class="token operator">==</span> <span class="token string">&quot;/mnt&quot;</span> <span class="token punctuation">{</span>
             mounts <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>mounts<span class="token punctuation">,</span> partition<span class="token punctuation">.</span>Mountpoint<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>partition<span class="token punctuation">.</span>Mountpoint<span class="token punctuation">,</span> <span class="token string">&quot;/mnt&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             mounts <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>mounts<span class="token punctuation">,</span> partition<span class="token punctuation">.</span>Mountpoint<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> mounts
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">readScutumRuntimeStats</span><span class="token punctuation">(</span>v <span class="token operator">*</span>runtimeStats<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    metrics<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>runtimeSamples<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> s <span class="token operator">:=</span> <span class="token keyword">range</span> runtimeSamples <span class="token punctuation">{</span>
       <span class="token comment">// Skip invalid/unknown metrics. This is needed because some metrics</span>
       <span class="token comment">// are unavailable in older Go versions, and attempting to read a &#39;bad&#39;</span>
       <span class="token comment">// metric panics.</span>
       <span class="token keyword">if</span> s<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> metrics<span class="token punctuation">.</span>KindBad <span class="token punctuation">{</span>
          <span class="token keyword">continue</span>
       <span class="token punctuation">}</span>

       <span class="token keyword">switch</span> s<span class="token punctuation">.</span>Name <span class="token punctuation">{</span>
       <span class="token keyword">case</span> <span class="token string">&quot;/sched/goroutines:goroutines&quot;</span><span class="token punctuation">:</span>
          v<span class="token punctuation">.</span>Goroutines <span class="token operator">=</span> s<span class="token punctuation">.</span>Value<span class="token punctuation">.</span><span class="token function">Uint64</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> ScutumDiskStats <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    ReadCount  <span class="token builtin">int64</span> <span class="token comment">// Number of read operations executed</span>
    ReadBytes  <span class="token builtin">int64</span> <span class="token comment">// Total number of bytes read (include disk cache)</span>
    WriteCount <span class="token builtin">int64</span> <span class="token comment">// Number of write operations executed</span>
    WriteBytes <span class="token builtin">int64</span> <span class="token comment">// Total number of byte written</span>
<span class="token punctuation">}</span>

<span class="token comment">// ReadScutumDiskStats retrieves the disk IO stats for whole system disk.</span>
<span class="token keyword">func</span> <span class="token function">ReadScutumDiskStats</span><span class="token punctuation">(</span>stats <span class="token operator">*</span>ScutumDiskStats<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    counters<span class="token punctuation">,</span> err <span class="token operator">:=</span> disk<span class="token punctuation">.</span><span class="token function">IOCounters</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
       fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;获取 disk IOCounters 失败&quot;</span><span class="token punctuation">)</span>
       <span class="token keyword">return</span> err
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> totalReadCount<span class="token punctuation">,</span> totalWriteCount<span class="token punctuation">,</span> totalReadBytes<span class="token punctuation">,</span> totalWriteBytes <span class="token builtin">uint64</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> counter <span class="token operator">:=</span> <span class="token keyword">range</span> counters <span class="token punctuation">{</span>
       totalReadCount <span class="token operator">+=</span> counter<span class="token punctuation">.</span>ReadCount
       totalReadBytes <span class="token operator">+=</span> counter<span class="token punctuation">.</span>ReadBytes
       totalWriteCount <span class="token operator">+=</span> counter<span class="token punctuation">.</span>WriteCount
       totalWriteBytes <span class="token operator">+=</span> counter<span class="token punctuation">.</span>WriteBytes
    <span class="token punctuation">}</span>
    stats<span class="token punctuation">.</span>ReadCount <span class="token operator">=</span> <span class="token function">int64</span><span class="token punctuation">(</span>totalReadCount<span class="token punctuation">)</span>
    stats<span class="token punctuation">.</span>ReadBytes <span class="token operator">=</span> <span class="token function">int64</span><span class="token punctuation">(</span>totalReadBytes<span class="token punctuation">)</span>
    stats<span class="token punctuation">.</span>WriteCount <span class="token operator">=</span> <span class="token function">int64</span><span class="token punctuation">(</span>totalWriteCount<span class="token punctuation">)</span>
    stats<span class="token punctuation">.</span>WriteBytes <span class="token operator">=</span> <span class="token function">int64</span><span class="token punctuation">(</span>totalWriteBytes<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="api-metrics" tabindex="-1"><a class="header-anchor" href="#api-metrics" aria-hidden="true">#</a> api metrics</h3><p>这个可以看作是个rpc的处理函数，可以看到他runMethod之后进行了metrics的统计。我们可以在这里分析成功和失败的请求的个数。也就是<code>newRPCFailureGauge(msg.Method).Inc(1)</code>和<code>newRPCSuccessGauge(msg.Method).Inc(1)</code>。</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// handleCall processes method calls.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>handler<span class="token punctuation">)</span> <span class="token function">handleCall</span><span class="token punctuation">(</span>cp <span class="token operator">*</span>callProc<span class="token punctuation">,</span> msg <span class="token operator">*</span>jsonrpcMessage<span class="token punctuation">)</span> <span class="token operator">*</span>jsonrpcMessage <span class="token punctuation">{</span>
    <span class="token keyword">if</span> msg<span class="token punctuation">.</span><span class="token function">isSubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> h<span class="token punctuation">.</span><span class="token function">handleSubscribe</span><span class="token punctuation">(</span>cp<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> callb <span class="token operator">*</span>callback
    <span class="token keyword">if</span> msg<span class="token punctuation">.</span><span class="token function">isUnsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       callb <span class="token operator">=</span> h<span class="token punctuation">.</span>unsubscribeCb
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
       callb <span class="token operator">=</span> h<span class="token punctuation">.</span>reg<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>Method<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> callb <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> msg<span class="token punctuation">.</span><span class="token function">errorResponse</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>methodNotFoundError<span class="token punctuation">{</span>method<span class="token punctuation">:</span> msg<span class="token punctuation">.</span>Method<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    args<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">parsePositionalArguments</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>Params<span class="token punctuation">,</span> callb<span class="token punctuation">.</span>argTypes<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> msg<span class="token punctuation">.</span><span class="token function">errorResponse</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>invalidParamsError<span class="token punctuation">{</span>err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    start <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    answer <span class="token operator">:=</span> h<span class="token punctuation">.</span><span class="token function">runMethod</span><span class="token punctuation">(</span>cp<span class="token punctuation">.</span>ctx<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> callb<span class="token punctuation">,</span> args<span class="token punctuation">)</span>

    <span class="token comment">// Collect the statistics for RPC calls if metrics is enabled.</span>
    <span class="token comment">// We only care about pure rpc call. Filter out subscription.</span>
    <span class="token keyword">if</span> callb <span class="token operator">!=</span> h<span class="token punctuation">.</span>unsubscribeCb <span class="token punctuation">{</span>
       rpcRequestGauge<span class="token punctuation">.</span><span class="token function">Inc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
       <span class="token keyword">if</span> answer<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
          failedRequestGauge<span class="token punctuation">.</span><span class="token function">Inc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token function">newRPCFailureGauge</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>Method<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Inc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          successfulRequestGauge<span class="token punctuation">.</span><span class="token function">Inc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token function">newRPCSuccessGauge</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>Method<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Inc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
       rpcServingTimer<span class="token punctuation">.</span><span class="token function">UpdateSince</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span>
       <span class="token function">newRPCRequestGauge</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>Method<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Inc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
       <span class="token function">updateServeTimeHistogram</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>Method<span class="token punctuation">,</span> answer<span class="token punctuation">.</span>Error <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Since</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> answer
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">newRPCRequestGauge</span><span class="token punctuation">(</span>method <span class="token builtin">string</span><span class="token punctuation">)</span> metrics<span class="token punctuation">.</span>Gauge <span class="token punctuation">{</span>
	m <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;rpc/count/%s&quot;</span><span class="token punctuation">,</span> method<span class="token punctuation">)</span>
	<span class="token keyword">return</span> metrics<span class="token punctuation">.</span><span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">newRPCSuccessGauge</span><span class="token punctuation">(</span>method <span class="token builtin">string</span><span class="token punctuation">)</span> metrics<span class="token punctuation">.</span>Gauge <span class="token punctuation">{</span>
	m <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;rpc/success/%s&quot;</span><span class="token punctuation">,</span> method<span class="token punctuation">)</span>
	<span class="token keyword">return</span> metrics<span class="token punctuation">.</span><span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">newRPCFailureGauge</span><span class="token punctuation">(</span>method <span class="token builtin">string</span><span class="token punctuation">)</span> metrics<span class="token punctuation">.</span>Gauge <span class="token punctuation">{</span>
	m <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;rpc/failure/%s&quot;</span><span class="token punctuation">,</span> method<span class="token punctuation">)</span>
	<span class="token keyword">return</span> metrics<span class="token punctuation">.</span><span class="token function">GetOrRegisterGauge</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这两个指标也对了rules中的最后两条rules。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>- record: geth_rpc_success
  expr: label_replace({__name__=~&quot;rpc_success_.*&quot;}, &quot;method&quot;, &quot;$1&quot;, &quot;__name__&quot;, &quot;rpc_success_(.+)&quot;)
- record: geth_rpc_failure
  expr: label_replace({__name__=~&quot;rpc_failure_.*&quot;}, &quot;method&quot;, &quot;$1&quot;, &quot;__name__&quot;, &quot;rpc_failure_(.+)&quot;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样，通过rate函数就可以查询最近一段时间内的接口请求个数的增长情况。</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1743760069@qq.com">liushun-ing</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/home/assets/app-44324ae0.js" defer></script>
  </body>
</html>
